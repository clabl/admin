function noop$1(){}function run(r){return r()}function blank_object(){return Object.create(null)}function run_all(r){r.forEach(run)}function is_function(r){return typeof r=="function"}function safe_not_equal(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let src_url_equal_anchor;function src_url_equal(r,e){return src_url_equal_anchor||(src_url_equal_anchor=document.createElement("a")),src_url_equal_anchor.href=e,r===src_url_equal_anchor.href}function is_empty(r){return Object.keys(r).length===0}function append(r,e){r.appendChild(e)}function insert(r,e,s){r.insertBefore(e,s||null)}function detach(r){r.parentNode.removeChild(r)}function destroy_each(r,e){for(let s=0;s<r.length;s+=1)r[s]&&r[s].d(e)}function element(r){return document.createElement(r)}function text(r){return document.createTextNode(r)}function space(){return text(" ")}function empty(){return text("")}function listen(r,e,s,o){return r.addEventListener(e,s,o),()=>r.removeEventListener(e,s,o)}function attr(r,e,s){s==null?r.removeAttribute(e):r.getAttribute(e)!==s&&r.setAttribute(e,s)}function children(r){return Array.from(r.childNodes)}function set_data(r,e){e=""+e,r.wholeText!==e&&(r.data=e)}function set_input_value(r,e){r.value=e==null?"":e}function set_style(r,e,s,o){r.style.setProperty(e,s,o?"important":"")}function select_option(r,e){for(let s=0;s<r.options.length;s+=1){const o=r.options[s];if(o.__value===e){o.selected=!0;return}}r.selectedIndex=-1}function select_value(r){const e=r.querySelector(":checked")||r.options[0];return e&&e.__value}function toggle_class(r,e,s){r.classList[s?"add":"remove"](e)}function custom_event(r,e,s=!1){const o=document.createEvent("CustomEvent");return o.initCustomEvent(r,s,!1,e),o}let current_component;function set_current_component(r){current_component=r}function get_current_component(){if(!current_component)throw new Error("Function called outside component initialization");return current_component}function createEventDispatcher(){const r=get_current_component();return(e,s)=>{const o=r.$$.callbacks[e];if(o){const a=custom_event(e,s);o.slice().forEach(d=>{d.call(r,a)})}}}const dirty_components=[],binding_callbacks=[],render_callbacks=[],flush_callbacks=[],resolved_promise=Promise.resolve();let update_scheduled=!1;function schedule_update(){update_scheduled||(update_scheduled=!0,resolved_promise.then(flush))}function add_render_callback(r){render_callbacks.push(r)}const seen_callbacks=new Set;let flushidx=0;function flush(){const r=current_component;do{for(;flushidx<dirty_components.length;){const e=dirty_components[flushidx];flushidx++,set_current_component(e),update(e.$$)}for(set_current_component(null),dirty_components.length=0,flushidx=0;binding_callbacks.length;)binding_callbacks.pop()();for(let e=0;e<render_callbacks.length;e+=1){const s=render_callbacks[e];seen_callbacks.has(s)||(seen_callbacks.add(s),s())}render_callbacks.length=0}while(dirty_components.length);for(;flush_callbacks.length;)flush_callbacks.pop()();update_scheduled=!1,seen_callbacks.clear(),set_current_component(r)}function update(r){if(r.fragment!==null){r.update(),run_all(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(add_render_callback)}}const outroing=new Set;let outros;function group_outros(){outros={r:0,c:[],p:outros}}function check_outros(){outros.r||run_all(outros.c),outros=outros.p}function transition_in(r,e){r&&r.i&&(outroing.delete(r),r.i(e))}function transition_out(r,e,s,o){if(r&&r.o){if(outroing.has(r))return;outroing.add(r),outros.c.push(()=>{outroing.delete(r),o&&(s&&r.d(1),o())}),r.o(e)}}function create_component(r){r&&r.c()}function mount_component(r,e,s,o){const{fragment:a,on_mount:d,on_destroy:u,after_update:f}=r.$$;a&&a.m(e,s),o||add_render_callback(()=>{const h=d.map(run).filter(is_function);u?u.push(...h):run_all(h),r.$$.on_mount=[]}),f.forEach(add_render_callback)}function destroy_component(r,e){const s=r.$$;s.fragment!==null&&(run_all(s.on_destroy),s.fragment&&s.fragment.d(e),s.on_destroy=s.fragment=null,s.ctx=[])}function make_dirty(r,e){r.$$.dirty[0]===-1&&(dirty_components.push(r),schedule_update(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function init(r,e,s,o,a,d,u,f=[-1]){const h=current_component;set_current_component(r);const g=r.$$={fragment:null,ctx:null,props:d,update:noop$1,not_equal:a,bound:blank_object(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(h?h.$$.context:[])),callbacks:blank_object(),dirty:f,skip_bound:!1,root:e.target||h.$$.root};u&&u(g.root);let b=!1;if(g.ctx=s?s(r,e.props||{},(m,_,...Ge)=>{const ot=Ge.length?Ge[0]:_;return g.ctx&&a(g.ctx[m],g.ctx[m]=ot)&&(!g.skip_bound&&g.bound[m]&&g.bound[m](ot),b&&make_dirty(r,m)),_}):[],g.update(),b=!0,run_all(g.before_update),g.fragment=o?o(g.ctx):!1,e.target){if(e.hydrate){const m=children(e.target);g.fragment&&g.fragment.l(m),m.forEach(detach)}else g.fragment&&g.fragment.c();e.intro&&transition_in(r.$$.fragment),mount_component(r,e.target,e.anchor,e.customElement),flush()}set_current_component(h)}class SvelteComponent{$destroy(){destroy_component(this,1),this.$destroy=noop$1}$on(e,s){const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(s),()=>{const a=o.indexOf(s);a!==-1&&o.splice(a,1)}}$set(e){this.$$set&&!is_empty(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const stringToByteArray$1=function(r){const e=[];let s=0;for(let o=0;o<r.length;o++){let a=r.charCodeAt(o);a<128?e[s++]=a:a<2048?(e[s++]=a>>6|192,e[s++]=a&63|128):(a&64512)==55296&&o+1<r.length&&(r.charCodeAt(o+1)&64512)==56320?(a=65536+((a&1023)<<10)+(r.charCodeAt(++o)&1023),e[s++]=a>>18|240,e[s++]=a>>12&63|128,e[s++]=a>>6&63|128,e[s++]=a&63|128):(e[s++]=a>>12|224,e[s++]=a>>6&63|128,e[s++]=a&63|128)}return e},byteArrayToString=function(r){const e=[];let s=0,o=0;for(;s<r.length;){const a=r[s++];if(a<128)e[o++]=String.fromCharCode(a);else if(a>191&&a<224){const d=r[s++];e[o++]=String.fromCharCode((a&31)<<6|d&63)}else if(a>239&&a<365){const d=r[s++],u=r[s++],f=r[s++],h=((a&7)<<18|(d&63)<<12|(u&63)<<6|f&63)-65536;e[o++]=String.fromCharCode(55296+(h>>10)),e[o++]=String.fromCharCode(56320+(h&1023))}else{const d=r[s++],u=r[s++];e[o++]=String.fromCharCode((a&15)<<12|(d&63)<<6|u&63)}}return e.join("")},base64={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[];for(let a=0;a<r.length;a+=3){const d=r[a],u=a+1<r.length,f=u?r[a+1]:0,h=a+2<r.length,g=h?r[a+2]:0,b=d>>2,m=(d&3)<<4|f>>4;let _=(f&15)<<2|g>>6,Ge=g&63;h||(Ge=64,u||(_=64)),o.push(s[b],s[m],s[_],s[Ge])}return o.join("")},encodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(r):this.encodeByteArray(stringToByteArray$1(r),e)},decodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(r):byteArrayToString(this.decodeStringToByteArray(r,e))},decodeStringToByteArray(r,e){this.init_();const s=e?this.charToByteMapWebSafe_:this.charToByteMap_,o=[];for(let a=0;a<r.length;){const d=s[r.charAt(a++)],f=a<r.length?s[r.charAt(a)]:0;++a;const g=a<r.length?s[r.charAt(a)]:64;++a;const m=a<r.length?s[r.charAt(a)]:64;if(++a,d==null||f==null||g==null||m==null)throw Error();const _=d<<2|f>>4;if(o.push(_),g!==64){const Ge=f<<4&240|g>>2;if(o.push(Ge),m!==64){const ot=g<<6&192|m;o.push(ot)}}}return o},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}},base64Decode=function(r){try{return base64.decodeString(r,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Deferred{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,s)=>{this.resolve=e,this.reject=s})}wrapCallback(e){return(s,o)=>{s?this.reject(s):this.resolve(o),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(s):e(s,o))}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getUA(){return typeof navigator!="undefined"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function isMobileCordova(){return typeof window!="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA())}function isBrowserExtension(){const r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function isReactNative(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function isElectron(){return getUA().indexOf("Electron/")>=0}function isIE(){const r=getUA();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function isUWP(){return getUA().indexOf("MSAppHost/")>=0}function isIndexedDBAvailable(){return typeof indexedDB=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ERROR_NAME="FirebaseError";class FirebaseError extends Error{constructor(e,s,o){super(s);this.code=e,this.customData=o,this.name=ERROR_NAME,Object.setPrototypeOf(this,FirebaseError.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ErrorFactory.prototype.create)}}class ErrorFactory{constructor(e,s,o){this.service=e,this.serviceName=s,this.errors=o}create(e,...s){const o=s[0]||{},a=`${this.service}/${e}`,d=this.errors[e],u=d?replaceTemplate(d,o):"Error",f=`${this.serviceName}: ${u} (${a}).`;return new FirebaseError(a,f,o)}}function replaceTemplate(r,e){return r.replace(PATTERN,(s,o)=>{const a=e[o];return a!=null?String(a):`<${o}?>`})}const PATTERN=/\{\$([^}]+)}/g;function isEmpty(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}function deepEqual(r,e){if(r===e)return!0;const s=Object.keys(r),o=Object.keys(e);for(const a of s){if(!o.includes(a))return!1;const d=r[a],u=e[a];if(isObject(d)&&isObject(u)){if(!deepEqual(d,u))return!1}else if(d!==u)return!1}for(const a of o)if(!s.includes(a))return!1;return!0}function isObject(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function querystring(r){const e=[];for(const[s,o]of Object.entries(r))Array.isArray(o)?o.forEach(a=>{e.push(encodeURIComponent(s)+"="+encodeURIComponent(a))}):e.push(encodeURIComponent(s)+"="+encodeURIComponent(o));return e.length?"&"+e.join("&"):""}function querystringDecode(r){const e={};return r.replace(/^\?/,"").split("&").forEach(o=>{if(o){const[a,d]=o.split("=");e[decodeURIComponent(a)]=decodeURIComponent(d)}}),e}function extractQuerystring(r){const e=r.indexOf("?");if(!e)return"";const s=r.indexOf("#",e);return r.substring(e,s>0?s:void 0)}function createSubscribe(r,e){const s=new ObserverProxy(r,e);return s.subscribe.bind(s)}class ObserverProxy{constructor(e,s){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=s,this.task.then(()=>{e(this)}).catch(o=>{this.error(o)})}next(e){this.forEachObserver(s=>{s.next(e)})}error(e){this.forEachObserver(s=>{s.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,s,o){let a;if(e===void 0&&s===void 0&&o===void 0)throw new Error("Missing Observer.");implementsAnyMethods(e,["next","error","complete"])?a=e:a={next:e,error:s,complete:o},a.next===void 0&&(a.next=noop),a.error===void 0&&(a.error=noop),a.complete===void 0&&(a.complete=noop);const d=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?a.error(this.finalError):a.complete()}catch{}}),this.observers.push(a),d}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let s=0;s<this.observers.length;s++)this.sendOne(s,e)}sendOne(e,s){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{s(this.observers[e])}catch(o){typeof console!="undefined"&&console.error&&console.error(o)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function implementsAnyMethods(r,e){if(typeof r!="object"||r===null)return!1;for(const s of e)if(s in r&&typeof r[s]=="function")return!0;return!1}function noop(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getModularInstance(r){return r&&r._delegate?r._delegate:r}const subscriber_queue=[];function writable(r,e=noop$1){let s;const o=new Set;function a(f){if(safe_not_equal(r,f)&&(r=f,s)){const h=!subscriber_queue.length;for(const g of o)g[1](),subscriber_queue.push(g,r);if(h){for(let g=0;g<subscriber_queue.length;g+=2)subscriber_queue[g][0](subscriber_queue[g+1]);subscriber_queue.length=0}}}function d(f){a(f(r))}function u(f,h=noop$1){const g=[f,h];return o.add(g),o.size===1&&(s=e(a)||noop$1),f(r),()=>{o.delete(g),o.size===0&&(s(),s=null)}}return{set:a,update:d,subscribe:u}}var commonjsGlobal$1=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function commonjsRequire(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var dist={exports:{}},jsuites={exports:{}};(function(r,e){(function(s,o){r.exports=o()})(commonjsGlobal$1,function(){var s=function(a){var d={},u="4.9.33",f=function(g,b){return g[b.type]&&g[b.type]==b?!0:g.parentNode?f(g.parentNode,b):!1},h=function(g){if(s.current.length>0)for(var b=0;b<s.current.length;b++)s.current[b]&&!f(g,s.current[b])&&s.current[b].close()};return d.init=function(){var g=null;document.addEventListener("mousedown",function(b){if(b.changedTouches&&b.changedTouches[0])var m=b.changedTouches[0].clientX,_=b.changedTouches[0].clientY;else var m=b.clientX,_=b.clientY;if(b.target&&b.target.shadowRoot)var Ge=b.target.shadowRoot;else var Ge=document;g=Ge.elementFromPoint(m,_)}),document.addEventListener("click",function(b){h(g)}),d.version=u},d.setExtensions=function(g){if(typeof g=="object")for(var b=Object.keys(g),m=0;m<b.length;m++)d[b[m]]=g[b[m]]},d.tracking=function(g,b){if(b==!0)s.current=s.current.filter(function(_){return _!==null}),setTimeout(function(){s.current.push(g)},0);else{var m=s.current.indexOf(g);m>=0&&(s.current[m]=null)}},d.path=function(g,b){if(g=g.split("."),g.length){for(var m=this,_=null;g.length>1;)if(_=g.shift(),m.hasOwnProperty(_))m=m[_];else{if(b===void 0)return;m[_]={},m=m[_]}if(_=g.shift(),b!==void 0)return m[_]=b,!0;if(m)return m[_]}return!1},d.setDictionary=function(g){var b=Object.keys(d.dictionary);if(b.length==0)d.dictionary=g;else for(var b=Object.keys(g),m=0;m<b.length;m++)d.dictionary[b[m]]=g[b[m]];for(var _=null,m=0;m<s.calendar.weekdays.length;m++)_=s.translate(s.calendar.weekdays[m]),s.calendar.weekdays[m]&&(s.calendar.weekdays[m]=_,s.calendar.weekdaysShort[m]=_.substr(0,3));for(var m=0;m<s.calendar.months.length;m++)_=s.translate(s.calendar.months[m]),_&&(s.calendar.months[m]=_,s.calendar.monthsShort[m]=_.substr(0,3))},d.dictionary={},d.translate=function(g){return d.dictionary[g]||g},d.current=[],d}();typeof document!="undefined"&&s.init(),s.ajax=function(a,d){if(Array.isArray(a)){var u={instance:[],complete:d};if(a.length>0)for(var f=0;f<a.length;f++)a[f].multiple=u,u.instance.push(s.ajax(a[f]));return u}if(a.data||(a.data={}),a.type&&(a.method=a.type),a.method||(a.method="GET"),a.dataType||(a.dataType="json"),a.data){var h=function(ot,rr){var ir=[],er=Object.keys(ot);if(er.length)for(var ar=0;ar<er.length;ar++){if(rr)var Lr=rr+"["+er[ar]+"]";else var Lr=er[ar];if(ot[Lr]instanceof FileList)ir[Lr]=ot[er[ar]];else if(typeof ot[er[ar]]=="object")for(var Mr=h(ot[er[ar]],Lr),Br=Object.keys(Mr),Qr=0;Qr<Br.length;Qr++)ir[Br[Qr]]=Mr[Br[Qr]];else ir[Lr]=ot[er[ar]]}return ir},g=h(a.data),b=Object.keys(g);if(a.method=="GET"){if(b.length){for(var m=[],f=0;f<b.length;f++)m.push(b[f]+"="+encodeURIComponent(g[b[f]]));a.url.indexOf("?")<0&&(a.url+="?"),a.url+=m.join("&")}}else for(var m=new FormData,f=0;f<b.length;f++)if(g[b[f]]instanceof FileList){if(g[b[f]].length)for(var _=0;_<g[b[f]].length;_++)m.append(b[f],g[b[f]][_],g[b[f]][_].name)}else m.append(b[f],g[b[f]])}var Ge=new XMLHttpRequest;return Ge.open(a.method,a.url,!0),Ge.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.contentType&&Ge.setRequestHeader("Content-Type",a.contentType),a.method=="POST"?Ge.setRequestHeader("Accept","application/json"):a.dataType=="blob"?Ge.responseType="blob":a.contentType||(a.dataType=="json"?Ge.setRequestHeader("Content-Type","text/json"):a.dataType=="html"&&Ge.setRequestHeader("Content-Type","text/html")),a.cache!=!0&&(Ge.setRequestHeader("pragma","no-cache"),Ge.setRequestHeader("cache-control","no-cache")),a.withCredentials==!0&&(Ge.withCredentials=!0),typeof a.beforeSend=="function"&&a.beforeSend(Ge),Ge.onload=function(){if(Ge.status===200)if(a.dataType=="json")try{var ot=JSON.parse(Ge.responseText);a.success&&typeof a.success=="function"&&a.success(ot)}catch(ir){a.error&&typeof a.error=="function"&&a.error(ir,ot)}else{if(a.dataType=="blob")var ot=Ge.response;else var ot=Ge.responseText;a.success&&typeof a.success=="function"&&a.success(ot)}else a.error&&typeof a.error=="function"&&a.error(Ge.responseText,Ge.status);if(s.ajax.queue&&s.ajax.queue.length>0&&s.ajax.send(s.ajax.queue.shift()),s.ajax.requests&&s.ajax.requests.length){var rr=s.ajax.requests.indexOf(Ge);if(s.ajax.requests.splice(rr,1),s.ajax.requests.length||a.complete&&typeof a.complete=="function"&&a.complete(ot),a.group&&s.ajax.oncomplete&&typeof s.ajax.oncomplete[a.group]=="function"&&(s.ajax.pending(a.group)||(s.ajax.oncomplete[a.group](),s.ajax.oncomplete[a.group]=null)),a.multiple&&a.multiple.instance){var rr=a.multiple.instance.indexOf(Ge);a.multiple.instance.splice(rr,1),a.multiple.instance.length||a.multiple.complete&&typeof a.multiple.complete=="function"&&a.multiple.complete(ot)}}},Ge.options=a,Ge.data=m,a.queue==!0&&s.ajax.requests.length>0?s.ajax.queue.push(Ge):s.ajax.send(Ge),Ge},s.ajax.send=function(a){a.data?Array.isArray(a.data)?a.send(a.data.join("&")):a.send(a.data):a.send(),s.ajax.requests.push(a)},s.ajax.exists=function(a,d){var u=new XMLHttpRequest;u.open("HEAD",a,!1),u.send(),u.status&&d(u.status)},s.ajax.pending=function(a){var d=0,u=s.ajax.requests;if(u&&u.length)for(var f=0;f<u.length;f++)(!a||a==u[f].options.group)&&d++;return d},s.ajax.oncomplete={},s.ajax.requests=[],s.ajax.queue=[],s.alert=function(a){s.getWindowWidth()<800&&s.dialog?s.dialog.open({title:"Alert",message:a}):alert(a)},s.animation={},s.animation.slideLeft=function(a,d,u){d==!0?(a.classList.add("slide-left-in"),setTimeout(function(){a.classList.remove("slide-left-in"),typeof u=="function"&&u()},400)):(a.classList.add("slide-left-out"),setTimeout(function(){a.classList.remove("slide-left-out"),typeof u=="function"&&u()},400))},s.animation.slideRight=function(a,d,u){d==!0?(a.classList.add("slide-right-in"),setTimeout(function(){a.classList.remove("slide-right-in"),typeof u=="function"&&u()},400)):(a.classList.add("slide-right-out"),setTimeout(function(){a.classList.remove("slide-right-out"),typeof u=="function"&&u()},400))},s.animation.slideTop=function(a,d,u){d==!0?(a.classList.add("slide-top-in"),setTimeout(function(){a.classList.remove("slide-top-in"),typeof u=="function"&&u()},400)):(a.classList.add("slide-top-out"),setTimeout(function(){a.classList.remove("slide-top-out"),typeof u=="function"&&u()},400))},s.animation.slideBottom=function(a,d,u){d==!0?(a.classList.add("slide-bottom-in"),setTimeout(function(){a.classList.remove("slide-bottom-in"),typeof u=="function"&&u()},400)):(a.classList.add("slide-bottom-out"),setTimeout(function(){a.classList.remove("slide-bottom-out"),typeof u=="function"&&u()},100))},s.animation.fadeIn=function(a,d){a.style.display="",a.classList.add("fade-in"),setTimeout(function(){a.classList.remove("fade-in"),typeof d=="function"&&d()},2e3)},s.animation.fadeOut=function(a,d){a.classList.add("fade-out"),setTimeout(function(){a.style.display="none",a.classList.remove("fade-out"),typeof d=="function"&&d()},1e3)},s.calendar=function(a,d){if(a.calendar)return a.calendar.setOptions(d,!0);var u={type:"calendar"};u.options={},u.date=null,u.setOptions=function(tr,br){for(var tt={type:"default",validRange:null,startingDay:null,format:"DD/MM/YYYY",readonly:!0,today:!1,time:!1,resetButton:!0,placeholder:"",months:s.calendar.monthsShort,monthsFull:s.calendar.months,weekdays:s.calendar.weekdays,weekdays_short:s.calendar.weekdays,textDone:s.translate("Done"),textReset:s.translate("Reset"),textUpdate:s.translate("Update"),value:null,fullscreen:!1,opened:!1,onopen:null,onclose:null,onchange:null,onupdate:null,mode:null,position:null,dataType:null},nr=0;nr<tt.weekdays_short.length;nr++)tt.weekdays_short[nr]=tt.weekdays_short[nr].substr(0,1);for(var sr in tt)tr&&tr.hasOwnProperty(sr)?u.options[sr]=tr[sr]:(typeof u.options[sr]=="undefined"||br===!0)&&(u.options[sr]=tt[sr]);if(u.options.resetButton==!1?m.style.display="none":m.style.display="",u.options.readonly?a.setAttribute("readonly","readonly"):a.removeAttribute("readonly"),u.options.placeholder?a.setAttribute("placeholder",u.options.placeholder):a.removeAttribute("placeholder"),s.isNumeric(u.options.value)&&u.options.value>0&&(u.options.value=s.calendar.numToDate(u.options.value),u.options.dataType="numeric"),m.innerHTML=u.options.textReset,_.innerHTML=u.options.textDone,Qr.innerHTML=u.options.textUpdate,a.setAttribute("data-mask",u.options.format.toLowerCase()),!u.options.value&&u.options.today)var Rr=s.calendar.now();else var Rr=u.options.value;return Rr&&(u.options.value=null,u.setValue(Rr)),u},u.open=function(tr){if(!b.classList.contains("jcalendar-focus")&&!b.classList.contains("jcalendar-inline")){if(s.calendar.current=u,s.tracking(u,!0),u.getDays(),u.options.type=="year-month-picker"&&u.getMonths(),u.options.time&&(ii.value=u.date[3],Ir.value=u.date[4]),b.classList.add("jcalendar-focus"),s.getWindowWidth()<800||u.options.fullscreen)b.classList.add("jcalendar-fullsize"),s.animation.slideBottom(ot,1);else{b.classList.remove("jcalendar-fullsize");var br=a.getBoundingClientRect(),tt=ot.getBoundingClientRect();if(u.options.position)Ge.style.position="fixed",window.innerHeight<br.bottom+tt.height?Ge.style.top=br.top-(tt.height+2)+"px":Ge.style.top=br.top+br.height+2+"px",Ge.style.left=br.left+"px";else{if(window.innerHeight<br.bottom+tt.height){var nr=-1*(br.height+tt.height+2);nr+br.top<0&&(nr=-1*(br.top+br.height)),Ge.style.top=nr+"px"}else Ge.style.top=2+"px";if(window.innerWidth<br.left+tt.width){var nr=window.innerWidth-(br.left+tt.width+20);Ge.style.left=nr+"px"}else Ge.style.left="0px"}}typeof u.options.onopen=="function"&&u.options.onopen(a)}},u.close=function(tr,br){if(b.classList.contains("jcalendar-focus")){if(br!==!1){var tt=b.querySelector(".jcalendar-selected");if(typeof br=="string")var nr=br;else if(!tt||tt.classList.contains("jcalendar-disabled"))var nr=u.options.value;else var nr=u.getValue();u.setValue(nr)}!tr&&typeof u.options.onclose=="function"&&u.options.onclose(a),b.classList.remove("jcalendar-focus"),s.tracking(u,!1),s.calendar.current=null}return u.options.value},u.prev=function(){u.options.mode=="years"?(u.date[0]=u.date[0]-12,u.getYears()):u.options.mode=="months"?(u.date[0]=parseInt(u.date[0])-1,u.getMonths()):(u.date[1]<2?(u.date[0]=u.date[0]-1,u.date[1]=12):u.date[1]=u.date[1]-1,u.getDays())},u.next=function(){u.options.mode=="years"?(u.date[0]=parseInt(u.date[0])+12,u.getYears()):u.options.mode=="months"?(u.date[0]=parseInt(u.date[0])+1,u.getMonths()):(u.date[1]>11?(u.date[0]=parseInt(u.date[0])+1,u.date[1]=1):u.date[1]=parseInt(u.date[1])+1,u.getDays())},u.setToday=function(){var tr=new Date().toISOString().substr(0,10);return u.setValue(tr),tr},u.setValue=function(tr){tr||(tr=""+tr);var br=tr,tt=u.options.value;if(tt!=br){if(br){u.setLabel(br,u.options);var nr=br.split(" ");nr[1]||(nr[1]="00:00:00");var sr=nr[1].split(":"),nr=nr[0].split("-"),Rr=parseInt(nr[0]),Ar=parseInt(nr[1]),Or=parseInt(nr[2]),qr=parseInt(sr[0]),ni=parseInt(sr[1]);u.date=[Rr,Ar,Or,qr,ni,0];var tr=u.setLabel(br,u.options)}else{u.date=null;var tr=""}u.options.value=br,typeof u.options.onchange=="function"&&u.options.onchange(a,br,tt),a.value!=tr&&(a.value=tr,typeof a.oninput=="function"&&a.oninput({type:"input",target:a,value:a.value}))}u.getDays()},u.getValue=function(){return u.date?u.options.time?s.two(u.date[0])+"-"+s.two(u.date[1])+"-"+s.two(u.date[2])+" "+s.two(u.date[3])+":"+s.two(u.date[4])+":"+s.two(0):s.two(u.date[0])+"-"+s.two(u.date[1])+"-"+s.two(u.date[2])+" "+s.two(0)+":"+s.two(0)+":"+s.two(0):""},u.update=function(tr,br){if(!tr.classList.contains("jcalendar-disabled")){var tt=b.querySelector(".jcalendar-selected");tt&&tt.classList.remove("jcalendar-selected"),tr.classList.add("jcalendar-selected"),tr.classList.contains("jcalendar-set-month")?u.date[1]=br:u.date[2]=tr.innerText,u.options.time?(u.date[3]=ii.value,u.date[4]=Ir.value):u.close()}g()},u.reset=function(){u.setValue(""),u.date=null,u.close(!1,!1)},u.getDays=function(){u.options.mode="days";var tr=new Date,br=u.date&&s.isNumeric(u.date[0])?u.date[0]:parseInt(tr.getFullYear()),tt=u.date&&s.isNumeric(u.date[1])?u.date[1]:parseInt(tr.getMonth())+1,nr=u.date&&s.isNumeric(u.date[2])?u.date[2]:parseInt(tr.getDate()),sr=u.date&&s.isNumeric(u.date[3])?u.date[3]:parseInt(tr.getHours()),Rr=u.date&&s.isNumeric(u.date[4])?u.date[4]:parseInt(tr.getMinutes());u.date=[br,tt,nr,sr,Rr,0],rr.innerHTML=br,ir.innerHTML=u.options.months[tt-1];var Ar=tr.getMonth()==tt-1&&tr.getFullYear()==br,Or=tr.getDate(),tr=new Date(br,tt,0,0,0),qr=tr.getDate(),tr=new Date(br,tt-1,0,0,0),ni=tr.getDay()+1,Xr=u.options.startingDay||0;ni=ni-Xr,ar.innerHTML="";var ui=document.createElement("tr");ui.setAttribute("align","center"),ar.appendChild(ui);for(var Kr=0;Kr<7;Kr++){var ei=document.createElement("td");ei.classList.add("jcalendar-weekday"),ei.innerHTML=u.options.weekdays_short[Xr],ui.appendChild(ei),Xr++,Xr>6&&(Xr=0)}for(var Xr=0,or=0,Pr=0;Pr<6;Pr++){var ui=document.createElement("tr");ui.setAttribute("align","center");for(var Ur=!0,Kr=0;Kr<7;Kr++){var ei=document.createElement("td");if(ei.classList.add("jcalendar-set-day"),Xr>=ni&&Xr<ni+qr){or++,ei.innerHTML=or,or==nr&&ei.classList.add("jcalendar-selected"),Ar&&Or==or&&(ei.style.fontWeight="bold");var ti=s.calendar.now(new Date(br,tt-1,or),!0);if(u.options.validRange){if(!u.options.validRange[0]||ti>=u.options.validRange[0])var li=!0;else var li=!1;if(!u.options.validRange[1]||ti<=u.options.validRange[1])var si=!0;else var si=!1;li&&si||ei.classList.add("jcalendar-disabled")}Ur=!1}ui.appendChild(ei),Xr++}Ur==!1&&ar.appendChild(ui)}u.options.time?Mr.style.display="":Mr.style.display="none",g()},u.getMonths=function(){u.options.mode="months";var tr=u.options.months;u.options.value;var br=new Date,tt=parseInt(br.getFullYear()),nr=parseInt(br.getMonth())+1,sr=u.date&&s.isNumeric(u.date[0])?u.date[0]:tt,Rr=u.date&&s.isNumeric(u.date[1])?u.date[1]:nr;rr.innerHTML=u.date[0],ir.innerHTML=tr[Rr-1];var Ar=document.createElement("table");Ar.setAttribute("width","100%");for(var Or=null,qr=0;qr<12;qr++){if(!(qr%4)){var Or=document.createElement("tr");Or.setAttribute("align","center"),Ar.appendChild(Or)}var ni=document.createElement("td");if(ni.classList.add("jcalendar-set-month"),ni.setAttribute("data-value",qr+1),ni.innerText=tr[qr],u.options.validRange){var Xr=sr+"-"+s.two(qr+1);if(!u.options.validRange[0]||Xr>=u.options.validRange[0].substr(0,7))var ui=!0;else var ui=!1;if(!u.options.validRange[1]||Xr<=u.options.validRange[1].substr(0,7))var Kr=!0;else var Kr=!1;ui&&Kr||ni.classList.add("jcalendar-disabled")}qr+1==Rr&&ni.classList.add("jcalendar-selected"),tt==sr&&qr+1==nr&&(ni.style.fontWeight="bold"),Or.appendChild(ni)}ar.innerHTML='<tr><td colspan="7"></td></tr>',ar.children[0].children[0].appendChild(Ar),g()},u.getYears=function(){u.options.mode="years";for(var tr=new Date,br=tr.getFullYear(),tt=u.date&&s.isNumeric(u.date[0])?u.date[0]:parseInt(tr.getFullYear()),nr=[],sr=0;sr<25;sr++)nr[sr]=parseInt(u.date[0])+(sr-12);var Rr=document.createElement("table");Rr.setAttribute("width","100%");for(var sr=0;sr<25;sr++){if(!(sr%5)){var Ar=document.createElement("tr");Ar.setAttribute("align","center"),Rr.appendChild(Ar)}var Or=document.createElement("td");Or.classList.add("jcalendar-set-year"),Or.innerText=nr[sr],tt==nr[sr]&&Or.classList.add("jcalendar-selected"),br==nr[sr]&&(Or.style.fontWeight="bold"),Ar.appendChild(Or)}ar.innerHTML='<tr><td colspan="7"></td></tr>',ar.firstChild.firstChild.appendChild(Rr),g()},u.setLabel=function(tr,br){return s.calendar.getDateString(tr,br)},u.fromFormatted=function(tr,br){return s.calendar.extractDateFromString(tr,br)};var f=function(tr){var br=s.findElement(tr.target,"jcalendar-container");if(br){var tt=tr.target.className;if(tt=="jcalendar-prev")u.prev();else if(tt=="jcalendar-next")u.next();else if(tt=="jcalendar-month")u.getMonths();else if(tt=="jcalendar-year")u.getYears();else if(tt=="jcalendar-set-year")u.date[0]=tr.target.innerText,u.options.type=="year-month-picker"?u.getMonths():u.getDays();else if(tr.target.classList.contains("jcalendar-set-month")){var nr=parseInt(tr.target.getAttribute("data-value"));u.options.type=="year-month-picker"?u.update(tr.target,nr):(u.date[1]=nr,u.getDays())}else tt=="jcalendar-confirm"||tt=="jcalendar-update"||tt=="jcalendar-close"?u.close():tt=="jcalendar-backdrop"?u.close(!1,!1):tt=="jcalendar-reset"?u.reset():tr.target.classList.contains("jcalendar-set-day")&&tr.target.innerText&&u.update(tr.target)}else u.close()},h=function(tr){if(tr.target.value&&tr.target.value.length>3){var br=s.calendar.extractDateFromString(tr.target.value,u.options.format);br&&u.setValue(br)}},g=function(){var tr=b.querySelector(".jcalendar-selected");tr&&tr.classList.contains("jcalendar-disabled")?(Qr.setAttribute("disabled","disabled"),ii.setAttribute("disabled","disabled"),Ir.setAttribute("disabled","disabled")):(Qr.removeAttribute("disabled"),ii.removeAttribute("disabled"),Ir.removeAttribute("disabled")),typeof u.options.onupdate=="function"&&u.options.onupdate(a,u.getValue())},b=null,m=null,_=null,Ge=null,ot=null,rr=null,ir=null,er=null,ar=null,Lr=null,Mr=null,Br=null,Qr=null,ii=null,Ir=null,gt=function(){a.tagName=="INPUT"&&a.value&&(d.value=a.value),m=document.createElement("div"),m.className="jcalendar-reset",_=document.createElement("div"),_.className="jcalendar-confirm",Lr=document.createElement("div"),Lr.className="jcalendar-controls",Lr.style.borderBottom="1px solid #ddd",Lr.appendChild(m),Lr.appendChild(_),Ge=document.createElement("div"),Ge.className="jcalendar-container",ot=document.createElement("div"),ot.className="jcalendar-content",Ge.appendChild(ot),a.tagName=="DIV"?(b=a,b.classList.add("jcalendar-inline")):(ot.appendChild(Lr),b=document.createElement("div"),b.className="jcalendar"),b.classList.add("jcalendar-container"),b.appendChild(Ge);var tr=document.createElement("div");tr.className="jcalendar-table",ot.appendChild(tr);var br=document.createElement("td");br.setAttribute("colspan","2"),br.className="jcalendar-prev",rr=document.createElement("span"),rr.className="jcalendar-year",ir=document.createElement("span"),ir.className="jcalendar-month";var tt=document.createElement("td");tt.className="jcalendar-header",tt.setAttribute("colspan","3"),tt.appendChild(ir),tt.appendChild(rr);var nr=document.createElement("td");nr.setAttribute("colspan","2"),nr.className="jcalendar-next";var sr=document.createElement("thead"),Rr=document.createElement("tr");Rr.appendChild(br),Rr.appendChild(tt),Rr.appendChild(nr),sr.appendChild(Rr),er=document.createElement("table"),ar=document.createElement("tbody"),er.setAttribute("cellpadding","0"),er.setAttribute("cellspacing","0"),er.appendChild(sr),er.appendChild(ar),tr.appendChild(er),ii=document.createElement("select"),ii.className="jcalendar-select",ii.onchange=function(){u.date[3]=this.value,typeof u.options.onupdate=="function"&&u.options.onupdate(a,u.getValue())};for(var Ar=0;Ar<24;Ar++){var Or=document.createElement("option");Or.value=Ar,Or.innerHTML=s.two(Ar),ii.appendChild(Or)}Ir=document.createElement("select"),Ir.className="jcalendar-select",Ir.onchange=function(){u.date[4]=this.value,typeof u.options.onupdate=="function"&&u.options.onupdate(a,u.getValue())};for(var Ar=0;Ar<60;Ar++){var Or=document.createElement("option");Or.value=Ar,Or.innerHTML=s.two(Ar),Ir.appendChild(Or)}var qr=document.createElement("div");qr.className="jcalendar-controls",Mr=document.createElement("div"),Mr.className="jcalendar-time",Mr.style.maxWidth="140px",Mr.appendChild(ii),Mr.appendChild(Ir),Qr=document.createElement("button"),Qr.setAttribute("type","button"),Qr.className="jcalendar-update",Br=document.createElement("div"),Br.style.flexGrow="10",Br.appendChild(Qr),qr.appendChild(Mr),a.tagName=="INPUT"&&qr.appendChild(Br),ot.appendChild(qr);var ni=document.createElement("div");ni.className="jcalendar-backdrop",b.appendChild(ni),a.addEventListener("keyup",h),b.addEventListener("swipeleft",function(Xr){s.animation.slideLeft(er,0,function(){u.next(),s.animation.slideRight(er,1)}),Xr.preventDefault(),Xr.stopPropagation()}),b.addEventListener("swiperight",function(Xr){s.animation.slideRight(er,0,function(){u.prev(),s.animation.slideLeft(er,1)}),Xr.preventDefault(),Xr.stopPropagation()}),a.onmouseup=function(){u.open()},"ontouchend"in document.documentElement?b.addEventListener("touchend",f):b.addEventListener("mouseup",f),s.calendar.hasEvents||(s.calendar.hasEvents=!0,document.addEventListener("keydown",s.calendar.keydown)),u.setOptions(d),a.tagName=="INPUT"?(a.parentNode.insertBefore(b,a.nextSibling),a.setAttribute("autocomplete","off"),a.classList.add("jcalendar-input"),a.value=u.setLabel(u.getValue(),u.options)):(u.getDays(),u.options.time&&(ii.value=u.date[3],Ir.value=u.date[4])),u.options.opened==!0&&u.open(),a.change=u.setValue,a.val=function(Xr){if(Xr===void 0)return u.getValue();u.setValue(Xr)},a.calendar=b.calendar=u};return gt(),u},s.calendar.keydown=function(a){var d=null;(d=s.calendar.current)&&(a.which==13?d.close(!1,!0):a.which==27&&d.close(!1,!1))},s.calendar.prettify=function(a,d){if(!d)var d={justNow:"Just now",xMinutesAgo:"{0}m ago",xHoursAgo:"{0}h ago",xDaysAgo:"{0}d ago",xWeeksAgo:"{0}w ago",xMonthsAgo:"{0} mon ago",xYearsAgo:"{0}y ago"};var u=new Date,f=new Date(a),h=parseInt((u-f)/1e3/60);if(String.prototype.format=function(b){return this.replace("{0}",b)},h==0)var g=d.justNow;else if(h<90)var g=d.xMinutesAgo.format(h);else if(h<1440)var g=d.xHoursAgo.format(Math.round(h/60));else if(h<20160)var g=d.xDaysAgo.format(Math.round(h/1440));else if(h<43200)var g=d.xWeeksAgo.format(Math.round(h/10080));else if(h<1036800)var g=d.xMonthsAgo.format(Math.round(h/43200));else var g=d.xYearsAgo.format(Math.round(h/525600));return g},s.calendar.prettifyAll=function(){for(var a=document.querySelectorAll(".prettydate"),d=0;d<a.length;d++)a[d].getAttribute("data-date")?a[d].innerHTML=s.calendar.prettify(a[d].getAttribute("data-date")):a[d].innerHTML&&(a[d].setAttribute("data-date",a[d].innerHTML),a[d].innerHTML=s.calendar.prettify(a[d].innerHTML))},s.calendar.now=function(a,d){if(Array.isArray(a))var u=a[0],f=a[1],h=a[2],g=a[3],b=a[4],m=a[5];else{if(!a)var a=new Date;var u=a.getFullYear(),f=a.getMonth()+1,h=a.getDate(),g=a.getHours(),b=a.getMinutes(),m=a.getSeconds()}return d==!0?s.two(u)+"-"+s.two(f)+"-"+s.two(h):s.two(u)+"-"+s.two(f)+"-"+s.two(h)+" "+s.two(g)+":"+s.two(b)+":"+s.two(m)},s.calendar.toArray=function(a){var d=a.split(a.indexOf("T")!==-1?"T":" "),u=d[1],d=d[0].split("-"),f=parseInt(d[0]),h=parseInt(d[1]),g=parseInt(d[2]);if(u)var u=u.split(":"),b=parseInt(u[0]),m=parseInt(u[1]);else var b=0,m=0;return[f,h,g,b,m,0]},s.calendar.extractDateFromString=function(a,d){if(a>0&&Number(a)==a){var u=new Date(Math.round((a-25569)*86400*1e3));return u.getFullYear()+"-"+s.two(u.getMonth())+"-"+s.two(u.getDate())+" 00:00:00"}var f=s.mask(a,{mask:d},!0);return f.date[0]&&f.date[1]?(f.date[2]||(f.date[2]=1),f.date[0]+"-"+s.two(f.date[1])+"-"+s.two(f.date[2])+" "+s.two(f.date[3])+":"+s.two(f.date[4])+":"+s.two(f.date[5])):""},s.calendar.dateToNum=function(a,d){a=new Date(a),d||(d="1899-12-30 "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()),d=new Date(d);var u=a.getTime()-d.getTime();return Math.round(u/864e5)},s.calendar.numToDate=function(a){var d=new Date(Math.round((a-25569)*86400*1e3));return d.getFullYear()+"-"+s.two(d.getMonth()+1)+"-"+s.two(d.getDate())+" 00:00:00"},s.calendar.getDateString=function(a,d){if(!d)var d={};if(d&&typeof d=="object")var u=d.format;else var u=d;if(u||(u="YYYY-MM-DD"),typeof a=="number"&&u.indexOf("[h]")>=0){var f=parseFloat(24*Number(a));if(u.indexOf("mm")>=0){var h=(""+f).split(".");if(h[1]){var g=60*parseFloat("0."+h[1]);g=parseFloat(g.toFixed(2))}else var g=0;f=parseInt(h[0])+":"+s.two(g)}return f}a instanceof Date?a=s.calendar.now(a):a&&s.isNumeric(a)&&(a=s.calendar.numToDate(a));for(var b=["DAY","WD","DDDD","DDD","DD","D","Q","HH24","HH12","HH","H","AM/PM","MI","SS","MS","YYYY","YYY","YY","Y","MONTH","MON","MMMMM","MMMM","MMM","MM","M","."],m=new RegExp(b.join("|"),"gi"),_=u.match(m),Ge=0;Ge<_.length;Ge++)_[Ge].toUpperCase()=="MM"&&(_[Ge-1]&&_[Ge-1].toUpperCase().indexOf("H")>=0||_[Ge-2]&&_[Ge-2].toUpperCase().indexOf("H")>=0||_[Ge+1]&&_[Ge+1].toUpperCase().indexOf("S")>=0||_[Ge+2]&&_[Ge+2].toUpperCase().indexOf("S")>=0)&&(_[Ge]="mi");var ot={tokens:_};if(a){var g=""+a,rr=g.indexOf("T")!==-1?"T":" ";g=g.split(rr);var h=0,ir=0,er=0;if(g[1]&&(h=g[1].split(":"),ir=h[1]?h[1]:0,er=h[2]?h[2]:0,h=h[0]?h[0]:0),g=g[0].split("-"),g[0]&&g[1]&&g[2]&&g[0]>0&&g[1]>0&&g[1]<13&&g[2]>0&&g[2]<32){ot.data=[g[0],g[1],g[2],h,ir,er],ot.value=[];for(var ar=new Date(ot.data[0],ot.data[1]-1,ot.data[2],ot.data[3],ot.data[4],ot.data[5]),Lr=function(Qr){var ii=this.tokens[Qr],Ir=ii.toUpperCase(),gt=null;Ir==="YYYY"?gt=this.data[0]:Ir==="YYY"?gt=this.data[0].substring(1,4):Ir==="YY"?gt=this.data[0].substring(2,4):Ir==="Y"?gt=this.data[0].substring(3,4):ii==="MON"?gt=s.calendar.months[ar.getMonth()].substr(0,3).toUpperCase():ii==="mon"?gt=s.calendar.months[ar.getMonth()].substr(0,3).toLowerCase():ii==="MONTH"?gt=s.calendar.months[ar.getMonth()].toUpperCase():ii==="month"?gt=s.calendar.months[ar.getMonth()].toLowerCase():Ir==="MMMMM"?gt=s.calendar.months[ar.getMonth()].substr(0,1):Ir==="MMMM"||ii==="Month"?gt=s.calendar.months[ar.getMonth()]:Ir==="MMM"||ii=="Mon"?gt=s.calendar.months[ar.getMonth()].substr(0,3):Ir==="MM"?gt=s.two(this.data[1]):Ir==="M"?gt=ar.getMonth()+1:ii==="DAY"?gt=s.calendar.weekdays[ar.getDay()].toUpperCase():ii==="day"?gt=s.calendar.weekdays[ar.getDay()].toLowerCase():Ir==="DDDD"||ii=="Day"?gt=s.calendar.weekdays[ar.getDay()]:Ir==="DDD"?gt=s.calendar.weekdays[ar.getDay()].substr(0,3):Ir==="DD"?gt=s.two(this.data[2]):Ir==="D"?gt=this.data[2]:Ir==="Q"?gt=Math.floor((ar.getMonth()+3)/3):Ir==="HH24"||Ir==="HH"?gt=s.two(this.data[3]):Ir==="HH12"?this.data[3]>12?gt=s.two(this.data[3]-12):gt=s.two(this.data[3]):Ir==="H"?gt=this.data[3]:Ir==="MI"?gt=s.two(this.data[4]):Ir==="SS"?gt=s.two(this.data[5]):Ir==="MS"?gt=ar.getMilliseconds():Ir==="AM/PM"?this.data[3]>=12?gt="PM":gt="AM":Ir==="WD"&&(gt=s.calendar.weekdays[ar.getDay()]),gt===null?this.value[Qr]=this.tokens[Qr]:this.value[Qr]=gt},Ge=0;Ge<ot.tokens.length;Ge++)Lr.call(ot,Ge);a=ot.value.join("")}else a=""}return a},s.calendar.weekdays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],s.calendar.months=["January","February","March","April","May","June","July","August","September","October","November","December"],s.calendar.weekdaysShort=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],s.calendar.monthsShort=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],s.color=function(a,d){if(a.color)return a.color.setOptions(d,!0);var u={type:"color"};u.options={};var f=null,h=null,g=null,b=null,m=null,_=null,Ge=null;u.setOptions=function(sr,Rr){var Ar={placeholder:"",value:null,onopen:null,onclose:null,onchange:null,closeOnChange:!0,palette:null,position:null,doneLabel:"Done",resetLabel:"Reset",fullscreen:!1,opened:!1};sr||(sr={}),sr&&!sr.palette&&(sr.palette=s.palette());for(var Or in Ar)sr&&sr.hasOwnProperty(Or)?u.options[Or]=sr[Or]:(typeof u.options[Or]=="undefined"||Rr===!0)&&(u.options[Or]=Ar[Or]);return b&&(b.innerHTML=u.options.resetLabel),m&&(m.innerHTML=u.options.doneLabel),u.options.palette&&Ge&&Ge.updateContent(0,Lr()),typeof u.options.value=="string"&&(a.value=u.options.value),u.options.placeholder?a.setAttribute("placeholder",u.options.placeholder):a.getAttribute("placeholder")&&a.removeAttribute("placeholder"),u},u.open=function(){if(!f.classList.contains("jcolor-focus")){s.tracking(u,!0),f.classList.add("jcolor-focus"),g.style.marginTop="",g.style.marginLeft="";var sr=g.getBoundingClientRect(),Rr=s.getWindowWidth(),Ar=s.getWindowHeight();if(Rr<800||u.options.fullscreen==!0?(g.classList.add("jcolor-fullscreen"),s.animation.slideBottom(g,1),h.style.display="block"):(g.classList.contains("jcolor-fullscreen")&&(g.classList.remove("jcolor-fullscreen"),h.style.display=""),u.options.position?g.style.position="fixed":g.style.position="",sr.left+sr.width>Rr&&(g.style.marginLeft=-1*(sr.left+sr.width-(Rr-20))+"px"),sr.top+sr.height>Ar&&(g.style.marginTop=-1*(sr.top+sr.height-(Ar-20))+"px")),typeof u.options.onopen=="function"&&u.options.onopen(a),Ge.setBorder(Ge.getActive()),u.options.value){var Or=ar(u.options.value);tr.forEach(function(qr,ni){qr.value=Or[ni],qr.dispatchEvent(new Event("input"))})}}},u.close=function(sr){return f.classList.contains("jcolor-focus")&&(f.classList.remove("jcolor-focus"),h.style.display="",!sr&&typeof u.options.onclose=="function"&&u.options.onclose(a),s.tracking(u,!1)),u.options.value},u.setValue=function(sr){if(sr||(sr=""),sr!=u.options.value){u.options.value=sr,gt=sr;var Rr=f.querySelector(".jcolor-selected");Rr&&Rr.classList.remove("jcolor-selected"),u.values[sr]&&u.values[sr].classList.add("jcolor-selected"),typeof u.options.onchange=="function"&&u.options.onchange(a,sr),a.value!=u.options.value&&(a.value=u.options.value,typeof a.oninput=="function"&&a.oninput({type:"input",target:a,value:a.value})),u.options.closeOnChange==!0&&u.close()}},u.getValue=function(){return u.options.value};var ot=!1,rr=function(sr){var Rr=sr.toString(16);return Rr.length===1?"0"+Rr:Rr},ir=function(sr,Rr,Ar){return"#"+rr(sr)+rr(Rr)+rr(Ar)},er=function(sr){return parseInt("0x"+sr)},ar=function(sr){return[er(sr.substr(1,2)),er(sr.substr(3,2)),er(sr.substr(5,2))]},Lr=function(){var sr=document.createElement("div");sr.className="jcolor-grid",u.values=[];var Rr=document.createElement("table");Rr.setAttribute("cellpadding","7"),Rr.setAttribute("cellspacing","0");for(var Ar=0;Ar<u.options.palette.length;Ar++){for(var Or=document.createElement("tr"),qr=0;qr<u.options.palette[Ar].length;qr++){var ni=document.createElement("td"),Xr=u.options.palette[Ar][qr];Xr.length<7&&Xr.substr(0,1)!=="#"&&(Xr="#"+Xr),ni.style.backgroundColor=Xr,ni.setAttribute("data-value",Xr),ni.innerHTML="",Or.appendChild(ni),u.options.value==Xr&&ni.classList.add("jcolor-selected"),u.values[Xr]=ni}Rr.appendChild(Or)}return sr.appendChild(Rr),sr.addEventListener("mousedown",function(ui){if(ui.target.tagName=="TD"){var Kr=ui.target.getAttribute("data-value");Kr&&u.setValue(Kr)}}),sr},Mr=document.createElement("canvas");Mr.width=200,Mr.height=160;var Br=Mr.getContext("2d"),Qr=function(){var sr=_.firstChild.getBoundingClientRect();Mr.width=sr.width-14,ii()},ii=function(){var sr=Br.createLinearGradient(0,0,Mr.width,0);sr.addColorStop(0,"rgb(255,0,0)"),sr.addColorStop(.15,"rgb(255,0,255)"),sr.addColorStop(.33,"rgb(0,0,255)"),sr.addColorStop(.49,"rgb(0,255,255)"),sr.addColorStop(.67,"rgb(0,255,0)"),sr.addColorStop(.84,"rgb(255,255,0)"),sr.addColorStop(1,"rgb(255,0,0)"),Br.fillStyle=sr,Br.fillRect(0,0,Mr.width,Mr.height),sr=Br.createLinearGradient(0,0,0,Mr.height),sr.addColorStop(0,"rgba(255,255,255,1)"),sr.addColorStop(.5,"rgba(255,255,255,0)"),sr.addColorStop(.5,"rgba(0,0,0,0)"),sr.addColorStop(1,"rgba(0,0,0,1)"),Br.fillStyle=sr,Br.fillRect(0,0,Mr.width,Mr.height)},Ir=function(){var sr=document.createElement("div");sr.className="jcolor-hsl";var Rr=document.createElement("div");Rr.className="jcolor-point";var Ar=document.createElement("div");Ar.appendChild(Mr),Ar.appendChild(Rr),sr.appendChild(Ar);var Or=function(qr,ni,Xr){if(qr===1){var ui=sr.getBoundingClientRect(),Kr=ni-ui.left,ei=Xr-ui.top;Kr<0&&(Kr=0),ei<0&&(ei=0),Kr>ui.width&&(Kr=ui.width),ei>ui.height&&(ei=ui.height),Rr.style.left=Kr+"px",Rr.style.top=ei+"px";var or=Br.getImageData(Kr,ei,1,1).data;gt=ir(or[0],or[1],or[2])}};return sr.addEventListener("mousedown",function(qr){Or(qr.buttons,qr.clientX,qr.clientY)}),sr.addEventListener("mousemove",function(qr){Or(qr.buttons,qr.clientX,qr.clientY)}),sr.addEventListener("touchmove",function(qr){Or(1,qr.changedTouches[0].clientX,qr.changedTouches[0].clientY)}),sr},gt="",tr=[],br=function(){if(gt!=="")for(var sr=0;sr<tr.length;sr++){var Rr=ar(gt);Rr[sr]=0;var Ar="linear-gradient(90deg, rgb(";Ar+=Rr.join(", "),Ar+="), rgb(",Rr[sr]=255,Ar+=Rr.join(", "),Ar+="))",tr[sr].style.backgroundImage=Ar}},tt=function(){var sr=document.createElement("div");sr.className="jcolor-sliders";var Rr=document.createElement("div"),Ar=function(Xr){var ui=document.createElement("div");ui.className="jcolor-sliders-input-container";var Kr=document.createElement("label");Kr.innerText=Xr;var ei=document.createElement("div");ei.className="jcolor-sliders-input-subcontainer";var or=document.createElement("input");or.type="range",or.min=0,or.max=255,or.value=0,ui.appendChild(Kr),ei.appendChild(or);var Pr=document.createElement("div");return Pr.innerText=or.value,or.addEventListener("input",function(){Pr.innerText=or.value}),ei.appendChild(Pr),ui.appendChild(ei),Rr.appendChild(ui),or};tr=[Ar("Red"),Ar("Green"),Ar("Blue")],sr.appendChild(Rr);var Or=document.createElement("div");Or.className="jcolor-sliders-final-color";var qr=document.createElement("div");qr.style.visibility="hidden",qr.innerText="a",Or.appendChild(qr);var ni=function(){var Xr=ir(parseInt(tr[0].value),parseInt(tr[1].value),parseInt(tr[2].value));qr.innerText=Xr,qr.style.color=Xr,qr.style.removeProperty("visibility"),gt=Xr};return tr.forEach(function(Xr){Xr.addEventListener("input",function(){ni(),br()})}),sr.appendChild(Or),sr},nr=function(){u.setOptions(d),a.tagName=="INPUT"&&(a.classList.add("jcolor-input"),a.readOnly=!0),f=document.createElement("div"),f.className="jcolor",h=document.createElement("div"),h.className="jcolor-backdrop",f.appendChild(h),g=document.createElement("div"),g.className="jcolor-content";var sr=document.createElement("div");sr.className="jcolor-controls",g.appendChild(sr),b=document.createElement("div"),b.className="jcolor-reset",b.innerHTML=u.options.resetLabel,b.onclick=function(Rr){u.setValue(""),u.close()},sr.appendChild(b),m=document.createElement("div"),m.className="jcolor-close",m.innerHTML=u.options.doneLabel,m.onclick=function(Rr){Ge.getActive()>0&&u.setValue(gt),u.close()},sr.appendChild(m),_=document.createElement("div"),g.appendChild(_),Ge=s.tabs(_,{animation:!0,data:[{title:"Grid",contentElement:Lr()},{title:"Spectrum",contentElement:Ir()},{title:"Sliders",contentElement:tt()}],onchange:function(Rr,Ar,Or){if(Or===1)Qr();else{var qr=gt!==""?gt:u.getValue();if(Or===2&&qr){var ni=ar(qr);tr.forEach(function(Xr,ui){Xr.value=ni[ui],Xr.dispatchEvent(new Event("input"))})}}},palette:"modern"}),f.appendChild(g),a.tagName=="INPUT"?a.parentNode.insertBefore(f,a.nextSibling):a.appendChild(f),a.addEventListener("mouseup",function(Rr){u.open()}),h.addEventListener("mousedown",function(Rr){ot=!0}),h.addEventListener("click",function(Rr){ot&&(ot=!1,u.close())}),window.addEventListener("resize",function(){f.classList.contains("jcolor-focus")&&Ge.getActive()==1&&Qr()}),u.options.opened==!0&&u.open(),a.change=u.setValue,a.val=function(Rr){if(Rr===void 0)return u.getValue();u.setValue(Rr)},a.color=u,f.color=u};return nr(),u},s.contextmenu=function(a,d){var u={};u.options={};var f={items:null,onclick:null};for(var h in f)d&&d.hasOwnProperty(h)?u.options[h]=d[h]:u.options[h]=f[h];a.classList.add("jcontextmenu"),a.setAttribute("tabindex","900"),u.open=function(m,_){if(_&&(u.options.items=_,u.create(_)),u.options.items&&u.options.items.length>0||a.children.length){if(m.target)var Ge=m.clientX,ot=m.clientY;else var Ge=m.x,ot=m.y;a.classList.add("jcontextmenu-focus"),a.focus();var rr=a.getBoundingClientRect();if(window.innerHeight<ot+rr.height){var ir=ot-rr.height;ir<0&&(ir=0),a.style.top=ir+"px"}else a.style.top=ot+"px";window.innerWidth<Ge+rr.width?Ge-rr.width>0?a.style.left=Ge-rr.width+"px":a.style.left="10px":a.style.left=Ge+"px"}},u.close=function(){a.classList.contains("jcontextmenu-focus")&&a.classList.remove("jcontextmenu-focus")},u.create=function(m){a.innerHTML="";var _=g();a.appendChild(_);for(var Ge=0;Ge<m.length;Ge++){var ot=b(m[Ge]);a.appendChild(ot)}};function g(){var m=document.createElement("div");m.classList.add("header"),m.addEventListener("click",function(ot){ot.preventDefault(),ot.stopPropagation()});var _=document.createElement("a");_.classList.add("title"),_.innerHTML=s.translate("Menu"),m.appendChild(_);var Ge=document.createElement("a");return Ge.classList.add("close"),Ge.innerHTML=s.translate("close"),Ge.addEventListener("click",function(ot){u.close()}),m.appendChild(Ge),m}function b(m){if(m.type&&(m.type=="line"||m.type=="divisor"))var _=document.createElement("hr");else{var _=document.createElement("div"),Ge=document.createElement("a");if(Ge.innerHTML=m.title,m.tooltip&&_.setAttribute("title",m.tooltip),m.icon&&_.setAttribute("data-icon",m.icon),m.id&&(_.id=m.id),m.disabled?_.className="jcontextmenu-disabled":m.onclick&&(_.method=m.onclick,_.addEventListener("mousedown",function(Br){Br.preventDefault()}),_.addEventListener("mouseup",function(Br){this.method(this,Br)})),_.appendChild(Ge),m.submenu){var ot=document.createElement("span");ot.innerHTML="&#9658;",_.appendChild(ot),_.classList.add("jcontexthassubmenu");var rr=document.createElement("div");rr.classList.add("jcontextmenu"),rr.setAttribute("tabindex","900");for(var ir=m.submenu,er=0;er<ir.length;er++){var ar=b(ir[er]);rr.appendChild(ar)}_.appendChild(rr)}else if(m.shortcut){var Lr=document.createElement("span");Lr.innerHTML=m.shortcut,_.appendChild(Lr)}}return _}return typeof u.options.onclick=="function"&&a.addEventListener("click",function(m){u.options.onclick(u,m)}),u.options.items&&u.create(u.options.items),a.addEventListener("blur",function(m){u.close()}),s.contextmenu.hasEvents||(window.addEventListener("mousewheel",function(){u.close()}),document.addEventListener("contextmenu",function(m){var _=s.contextmenu.getElement(m.target);if(_){var Ge=document.querySelector("#"+_);Ge?(Ge.contextmenu.open(m),m.preventDefault()):console.error("JSUITES: Contextmenu id not found")}}),s.contextmenu.hasEvents=!0),a.contextmenu=u,u},s.contextmenu.getElement=function(a){var d=0;function u(f){f.parentNode&&f.getAttribute("aria-contextmenu-id")?d=f.getAttribute("aria-contextmenu-id"):f.parentNode&&u(f.parentNode)}return u(a),d},s.dropdown=function(a,d){if(a.dropdown)return a.dropdown.setOptions(d,!0);var u={type:"dropdown"};u.options={};var f=function(gt,tr){gt&&gt.length&&(u.options.sortResults!==!1&&(typeof u.options.sortResults=="function"?gt.sort(u.options.sortResults):gt.sort(h)),u.setData(gt)),typeof u.options.onload=="function"&&u.options.onload(a,u,gt,tr),tr&&b(tr),tr==null&&(u.options.value=""),a.value=u.options.value,u.options.opened==!0&&u.open()},h=function(gt,tr){var br,tt;return typeof gt=="string"?br=gt:gt.text?br=gt.text:gt.name&&(br=gt.name),typeof tr=="string"?tt=tr:tr.text?tt=tr.text:tr.name&&(tt=tr.name),typeof br=="string"||typeof tt=="string"?(typeof br!="string"&&(br=""+br),typeof tt!="string"&&(tt=""+tt),br.localeCompare(tt)):br-tt},g=function(){u.value={};for(var gt=0;gt<u.items.length;gt++)u.items[gt].selected==!0&&(u.items[gt].element&&u.items[gt].element.classList.remove("jdropdown-selected"),u.items[gt].selected=null);u.options.value=""},b=function(gt){if(g(),gt!==null)if(!gt)typeof u.value[""]!="undefined"&&(u.value[""]="");else{Array.isArray(gt)||(gt=(""+gt).split(";"));for(var tr=0;tr<gt.length;tr++)u.value[gt[tr]]=""}for(var tr=0;tr<u.items.length;tr++)typeof u.value[m(tr)]!="undefined"&&(u.items[tr].element&&u.items[tr].element.classList.add("jdropdown-selected"),u.items[tr].selected=!0,u.value[m(tr)]=_(tr));u.options.value=Object.keys(u.value).join(";"),u.header.value=u.getText()},m=function(gt,tr){if(u.options.format)var br="id";else var br="value";return u.items[gt]?tr!==void 0?u.items[gt].data[br]=tr:u.items[gt].data[br]:""},_=function(gt,tr){if(u.options.format)var br="name";else var br="text";return u.items[gt]?tr!==void 0?u.items[gt].data[br]=tr:u.items[gt].data[br]:""},Ge=function(){return Object.keys(u.value)},ot=function(){for(var gt=[],tr=Object.keys(u.value),br=0;br<tr.length;br++)gt.push(u.value[tr[br]]);return gt};u.setOptions=function(gt,tr){gt||(gt={});var br={url:null,data:[],format:0,multiple:!1,autocomplete:!1,remoteSearch:!1,lazyLoading:!1,type:null,width:null,maxWidth:null,opened:!1,value:null,placeholder:"",newOptions:!1,position:!1,onchange:null,onload:null,onopen:null,onclose:null,onfocus:null,onblur:null,oninsert:null,onbeforeinsert:null,sortResults:!1,autofocus:!1};for(var tt in br)gt&&gt.hasOwnProperty(tt)?u.options[tt]=gt[tt]:(typeof u.options[tt]=="undefined"||tr===!0)&&(u.options[tt]=br[tt]);return(u.options.remoteSearch==!0||u.options.type==="searchbar")&&(u.options.autocomplete=!0),u.options.newOptions==!0?u.header.classList.add("jdropdown-add"):u.header.classList.remove("jdropdown-add"),u.options.autocomplete==!0?u.header.removeAttribute("readonly"):u.header.setAttribute("readonly","readonly"),u.options.placeholder?u.header.setAttribute("placeholder",u.options.placeholder):u.header.removeAttribute("placeholder"),a.classList.remove("jdropdown-searchbar"),a.classList.remove("jdropdown-picker"),a.classList.remove("jdropdown-list"),u.options.type=="searchbar"?a.classList.add("jdropdown-searchbar"):u.options.type=="list"?a.classList.add("jdropdown-list"):u.options.type=="picker"?a.classList.add("jdropdown-picker"):s.getWindowWidth()<800?u.options.autocomplete?(a.classList.add("jdropdown-searchbar"),u.options.type="searchbar"):(a.classList.add("jdropdown-picker"),u.options.type="picker"):(u.options.width?(a.style.width=u.options.width,a.style.minWidth=u.options.width):(a.style.removeProperty("width"),a.style.removeProperty("min-width")),a.classList.add("jdropdown-default"),u.options.type="default"),u.options.type=="searchbar"?rr.appendChild(ar):ir.insertBefore(ar,ir.firstChild),u.options.url&&!gt.data?s.ajax({url:u.options.url,method:"GET",dataType:"json",success:function(nr){nr&&f(nr,u.options.value)}}):f(u.options.data,u.options.value),u};var rr=null,ir=null,er=null,ar=null,Lr=null,Mr=null,Br=null,Qr=function(){if(d||(d={}),a.tagName=="SELECT"){var gt=s.dropdown.extractFromDom(a,d);a=gt.el,d=gt.options}!d.placeholder&&a.getAttribute("placeholder")&&(d.placeholder=a.getAttribute("placeholder")),u.value={},u.items=[],u.groups=[],u.search="",u.results=null,a.classList.add("jdropdown"),rr=document.createElement("div"),rr.className="jdropdown-container-header",u.header=document.createElement("input"),u.header.className="jdropdown-header",u.header.type="text",u.header.setAttribute("autocomplete","off"),u.header.onfocus=function(){typeof u.options.onfocus=="function"&&u.options.onfocus(a)},u.header.onblur=function(){typeof u.options.onblur=="function"&&u.options.onblur(a)},u.header.onkeyup=function(tr){u.options.autocomplete==!0&&!Br?(u.search!=u.header.value.trim()&&(Br=setTimeout(function(){u.find(u.header.value.trim()),Br=null},400)),a.classList.contains("jdropdown-focus")||u.open()):u.options.autocomplete||u.next(tr.key)},s.dropdown.hasEvents||(s.dropdown.hasEvents=!0,document.addEventListener("keydown",s.dropdown.keydown)),ir=document.createElement("div"),ir.className="jdropdown-container",er=document.createElement("div"),er.className="jdropdown-content",ar=document.createElement("div"),ar.className="jdropdown-close",ar.innerHTML="Done",Lr=document.createElement("div"),Lr.className="jdropdown-reset",Lr.innerHTML="x",Lr.onclick=function(){u.reset(),u.close()},Mr=document.createElement("div"),Mr.className="jdropdown-backdrop",rr.appendChild(u.header),ir.appendChild(er),a.appendChild(rr),a.appendChild(ir),a.appendChild(Mr),u.setOptions(d),"ontouchsend"in document.documentElement?a.addEventListener("touchsend",s.dropdown.mouseup):a.addEventListener("mouseup",s.dropdown.mouseup),u.options.lazyLoading==!0&&s.lazyLoading(er,{loadUp:u.loadUp,loadDown:u.loadDown}),er.onwheel=function(tr){tr.stopPropagation()},a.change=u.setValue,a.val=function(tr){if(tr===void 0)return u.getValue(!!u.options.multiple);u.setValue(tr)},a.dropdown=u};u.getUrl=function(){return u.options.url},u.setUrl=function(gt,tr){u.options.url=gt,s.ajax({url:u.options.url,method:"GET",dataType:"json",success:function(br){u.setData(br),typeof tr=="function"&&tr(u)}})},u.setId=function(gt,tr){if(u.options.format)var br="id";else var br="value";typeof gt=="object"?gt[br]=tr:u.items[gt].data[br]=tr},u.add=function(gt,tr){if(!gt){var br=u.options.autocomplete==!0?u.header.value:"",gt=prompt(s.translate("Add A New Option"),br);if(!gt)return!1}if(tr||(tr=s.guid()),u.options.format)var tt={id:tr,name:gt};else var tt={value:tr,text:gt};if(typeof u.options.onbeforeinsert=="function"){var nr=u.options.onbeforeinsert(u,tt);if(nr===!1)return!1;nr&&(tt=nr)}u.options.data.push(tt);var sr=u.createItem(tt);return er.appendChild(sr.element),typeof u.options.oninsert=="function"&&u.options.oninsert(u,tt,sr),er.style.display=="none"&&(er.style.display=""),u.results&&u.results.push(sr),tt},u.createItem=function(gt,tr,br){u.options.format?(!gt.id&&gt.value!==void 0&&(gt.id=gt.value),!gt.name&&gt.text!==void 0&&(gt.name=gt.text)):(!gt.value&&gt.id!==void 0&&(gt.value=gt.id),!gt.text&&gt.name!==void 0&&(gt.text=gt.name));var tt={};if(tt.element=document.createElement("div"),tt.element.className="jdropdown-item",tt.element.indexValue=u.items.length,tt.data=gt,tr&&(tt.group=tr),gt.id&&tt.element.setAttribute("id",gt.id),gt.disabled==!0&&tt.element.setAttribute("data-disabled",!0),gt.tooltip&&tt.element.setAttribute("title",gt.tooltip),gt.image){var nr=document.createElement("img");nr.className="jdropdown-image",nr.src=gt.image,gt.title||nr.classList.add("jdropdown-image-small"),tt.element.appendChild(nr)}else if(gt.icon){var sr=document.createElement("span");sr.className="jdropdown-icon material-icons",sr.innerText=gt.icon,gt.title||sr.classList.add("jdropdown-icon-small"),gt.color&&(sr.style.color=gt.color),tt.element.appendChild(sr)}else if(gt.color){var Rr=document.createElement("div");Rr.className="jdropdown-color",Rr.style.backgroundColor=gt.color,tt.element.appendChild(Rr)}if(u.options.format)var Ar=gt.name;else var Ar=gt.text;var Or=document.createElement("div");if(Or.className="jdropdown-description",Or.innerHTML=Ar||"&nbsp;",gt.title){var qr=document.createElement("div");qr.className="jdropdown-title",qr.innerText=gt.title,Or.appendChild(qr)}if(u.options.format)var ni=gt.id;else var ni=gt.value;return u.value[ni]&&(tt.element.classList.add("jdropdown-selected"),tt.selected=!0),u.items.push(tt),tt.element.appendChild(Or),tt},u.appendData=function(gt){if(gt.length){for(var tr=[],br=[],tt=0;tt<gt.length;tt++)gt[tt].group?(br[gt[tt].group]||(br[gt[tt].group]=[]),br[gt[tt].group].push(tt)):tr.push(tt);var nr=0,sr=Object.keys(br);if(sr.length>0)for(var tt=0;tt<sr.length;tt++){var Rr=document.createElement("div");Rr.className="jdropdown-group";var Ar=document.createElement("div");Ar.className="jdropdown-group-name",Ar.innerHTML=sr[tt];var Or=document.createElement("i");Or.className="jdropdown-group-arrow jdropdown-group-arrow-down",Ar.appendChild(Or);var qr=document.createElement("div");qr.className="jdropdown-group-items";for(var ni=0;ni<br[sr[tt]].length;ni++){var Xr=u.createItem(gt[br[sr[tt]][ni]],Rr,sr[tt]);(u.options.lazyLoading==!1||nr<200)&&(qr.appendChild(Xr.element),nr++)}Rr.appendChild(Ar),Rr.appendChild(qr),u.groups.push(Rr),qr.children.length>0&&er.appendChild(Rr)}if(tr.length)for(var tt=0;tt<tr.length;tt++){var Xr=u.createItem(gt[tr[tt]]);(u.options.lazyLoading==!1||nr<200)&&(er.appendChild(Xr.element),nr++)}}},u.setData=function(gt){if(gt.length){for(var tr=0;tr<gt.length;tr++)typeof gt[tr]!="object"&&(u.options.format?gt[tr]={id:gt[tr],name:gt[tr]}:gt[tr]={value:gt[tr],text:gt[tr]});g(),er.innerHTML="",u.header.value="",u.items=[],u.appendData(gt),u.options.data=gt}},u.getData=function(){return u.options.data},u.getPosition=function(gt){for(var tr=0;tr<u.items.length;tr++)if(m(tr)==gt)return tr;return!1},u.getText=function(gt){var tr=ot();return gt?tr:tr.join("; ")},u.getValue=function(gt){var tr=Ge();return gt?tr:tr.join(";")};var ii=function(gt){typeof u.options.onchange=="function"&&u.options.onchange(a,u,gt,u.options.value),a.value!=u.options.value&&(a.value=u.options.value,typeof a.oninput=="function"&&a.oninput({type:"input",target:a,value:a.value}))};u.setValue=function(gt){var tr=u.getValue();Array.isArray(gt)&&(gt=gt.join(";")),tr!==gt&&(b(gt),ii(tr))},u.resetSelected=function(){u.setValue(null)},u.selectIndex=function(gt,tr){var gt=parseInt(gt);if(u.items&&u.items[gt]&&(tr===!0||u.items[gt].data.disabled!==!0))if(u.setCursor(gt,!1),!u.options.multiple)u.items[gt].selected?u.setValue(null):u.setValue(m(gt)),u.close();else{var br=u.options.value;u.items[gt].selected?(u.items[gt].element.classList.remove("jdropdown-selected"),u.items[gt].selected=!1,delete u.value[m(gt)]):(u.items[gt].element.classList.add("jdropdown-selected"),u.items[gt].selected=!0,u.value[m(gt)]=_(gt)),u.options.value=Object.keys(u.value).join(";"),u.options.autocomplete==!1&&(u.header.value=ot().join("; ")),ii(br)}},u.selectItem=function(gt){u.selectIndex(gt.indexValue)};var Ir=function(gt,tr){for(var br=0;br<tr.length;br++)if(u.options.format){if(tr[br].id==gt)return!0}else if(tr[br].value==gt)return!0;return!1};return u.find=function(gt){if(u.search==gt.trim())return!1;if(u.search=gt,u.setCursor(),u.groups.length)for(var tr=0;tr<u.groups.length;tr++)u.groups[tr].lastChild.innerHTML="";if(er.innerHTML="",u.options.remoteSearch==!0){u.results=null;var br=u.options.url+(u.options.url.indexOf("?")>0?"&":"?")+"q="+gt;s.ajax({url:br,method:"GET",dataType:"json",success:function(qr){u.items=[];var ni=Object.keys(u.value);if(ni.length)for(var Xr=0;Xr<ni.length;Xr++)Ir(ni[Xr],qr)||(u.options.format?qr.unshift({id:ni[Xr],name:u.value[ni[Xr]]}):qr.unshift({value:ni[Xr],text:u.value[ni[Xr]]}));u.appendData(qr),qr.length?er.style.display="":er.style.display="none"}})}else{gt=new RegExp(gt,"gi");for(var tt=[],tr=0;tr<u.items.length;tr++){var nr=_(tr),sr=u.items[tr].data.title||"",Rr=u.items[tr].data.group||"",Ar=u.items[tr].data.synonym||"";Ar&&(Ar=Ar.join(" ")),(gt==null||u.items[tr].selected==!0||nr.match(gt)||sr.match(gt)||Rr.match(gt)||Ar.match(gt))&&tt.push(u.items[tr])}if(!tt.length)er.style.display="none",u.results=null;else{er.style.display="",u.results=tt;var Or=tt.length||0;u.options.lazyLoading==!0&&Or>200&&(Or=200);for(var tr=0;tr<Or;tr++)u.results[tr].group?(u.results[tr].group.parentNode||er.appendChild(u.results[tr].group),u.results[tr].group.lastChild.appendChild(u.results[tr].element)):er.appendChild(u.results[tr].element)}}u.options.autofocus==!0&&u.first()},u.open=function(){if(!a.classList.contains("jdropdown-focus")){s.dropdown.current=u,s.tracking(u,!0),a.classList.add("jdropdown-focus"),s.getWindowWidth()<800&&(u.options.type==null||u.options.type=="picker")&&s.animation.slideBottom(ir,1),u.options.autocomplete==!0&&(u.header.value=u.search,u.header.focus());var gt=Ge();if(gt[0]){var tr=u.getPosition(gt[0]);tr!==!1&&u.setCursor(tr)}if(!u.options.type||u.options.type=="default"){var br=a.getBoundingClientRect(),tt=ir.getBoundingClientRect();u.options.position?(ir.style.position="fixed",window.innerHeight<br.bottom+tt.height?(ir.style.top="",ir.style.bottom=window.innerHeight-br.top+1+"px"):(ir.style.top=br.bottom+"px",ir.style.bottom=""),ir.style.left=br.left+"px"):window.innerHeight<br.bottom+tt.height?(ir.style.top="",ir.style.bottom=br.height+1+"px"):(ir.style.top="",ir.style.bottom=""),ir.style.minWidth=br.width+"px",u.options.maxWidth&&(ir.style.maxWidth=u.options.maxWidth),!u.items.length&&u.options.autocomplete==!0?er.style.display="none":er.style.display=""}}typeof u.options.onopen=="function"&&u.options.onopen(a)},u.close=function(gt){return a.classList.contains("jdropdown-focus")&&(u.header.value=u.getText(),u.setCursor(),!gt&&typeof u.options.onclose=="function"&&u.options.onclose(a),u.header.blur&&u.header.blur(),a.classList.remove("jdropdown-focus"),s.tracking(u,!1),s.dropdown.current=null),u.getValue()},u.setCursor=function(gt,tr){if(u.currentIndex!=null&&u.items&&u.items[u.currentIndex]&&u.items[u.currentIndex].element.classList.remove("jdropdown-cursor"),gt==null)u.currentIndex=null;else if(gt=parseInt(gt),u.items[gt].element.parentNode&&(u.items[gt].element.classList.add("jdropdown-cursor"),u.currentIndex=gt,tr!==!1&&u.items[u.currentIndex].element)){er.scrollTop;var br=u.items[u.currentIndex].element;er.scrollTop=br.offsetTop-br.scrollTop+br.clientTop-95}},u.resetCursor=u.setCursor,u.updateCursor=u.setCursor,u.reset=function(){u.setCursor(),u.setValue(null)},u.first=function(){u.options.lazyLoading===!0&&u.loadFirst();var gt=er.querySelectorAll(".jdropdown-item");if(gt.length){var tr=gt[0].indexValue;u.setCursor(tr)}},u.last=function(){u.options.lazyLoading===!0&&u.loadLast();var gt=er.querySelectorAll(".jdropdown-item");if(gt.length){var tr=gt[gt.length-1].indexValue;u.setCursor(tr)}},u.next=function(gt){var tr=null;if(gt){if(gt.length==1){var br=u.currentIndex||-1;gt=gt.toLowerCase();var tt=null,nr=null,sr=er.querySelectorAll(".jdropdown-item");if(sr.length){for(var Rr=0;Rr<sr.length;Rr++)if(sr[Rr].indexValue>br&&(tt=u.items[sr[Rr].indexValue])&&(nr=tt.element.innerText[0])&&(nr=nr.toLowerCase(),gt==nr)){tr=sr[Rr].indexValue;break}u.setCursor(tr)}}}else if(u.currentIndex==null||u.currentIndex==null)u.first();else{var Ar=u.items[u.currentIndex].element,Or=Ar.nextElementSibling;Or?(Or.classList.contains("jdropdown-group")&&(Or=Or.lastChild.firstChild),tr=Or.indexValue):Ar.parentNode.classList.contains("jdropdown-group-items")&&((Or=Ar.parentNode.parentNode.nextElementSibling)&&(Or.classList.contains("jdropdown-group")?Or=Or.lastChild.firstChild:Or.classList.contains("jdropdown-item")?tr=Or.indexValue:Or=null),Or&&(tr=Or.indexValue)),tr!==null&&u.setCursor(tr)}},u.prev=function(){var gt=null;if(u.currentIndex===null)u.first();else{var tr=u.items[u.currentIndex].element,br=tr.previousElementSibling;br?(br.classList.contains("jdropdown-group")&&(br=br.lastChild.lastChild),gt=br.indexValue):tr.parentNode.classList.contains("jdropdown-group-items")&&((br=tr.parentNode.parentNode.previousElementSibling)&&(br.classList.contains("jdropdown-group")?br=br.lastChild.lastChild:br.classList.contains("jdropdown-item")?gt=br.indexValue:br=null),br&&(gt=br.indexValue))}gt!==null&&u.setCursor(gt)},u.loadFirst=function(){if(u.results)var gt=u.results;else var gt=u.items;var tr=gt.length||0;u.options.lazyLoading==!0&&tr>200&&(tr=200),er.innerHTML="";for(var br=0;br<tr;br++)gt[br].group?(gt[br].group.parentNode||er.appendChild(gt[br].group),gt[br].group.lastChild.appendChild(gt[br].element)):er.appendChild(gt[br].element);er.scrollTop=0},u.loadLast=function(){if(u.results)var gt=u.results;else var gt=u.items;var tr=gt.length;if(tr>200){tr=tr-200,er.innerHTML="";for(var br=tr;br<gt.length;br++)gt[br].group?(gt[br].group.parentNode||er.appendChild(gt[br].group),gt[br].group.lastChild.appendChild(gt[br].element)):er.appendChild(gt[br].element);er.scrollTop=er.scrollHeight}},u.loadUp=function(){var gt=!1;if(u.results)var tr=u.results;else var tr=u.items;var br=er.querySelectorAll(".jdropdown-item"),tt=br[0].indexValue;tt=u.items[tt];var nr=tr.indexOf(tt)-1;if(nr>0){for(var sr=0;nr>0&&tr[nr]&&sr<200;)tr[nr].group?(tr[nr].group.parentNode||er.insertBefore(tr[nr].group,er.firstChild),tr[nr].group.lastChild.insertBefore(tr[nr].element,tr[nr].group.lastChild.firstChild)):er.insertBefore(tr[nr].element,er.firstChild),nr--,sr++;gt=!0}return gt},u.loadDown=function(){var gt=!1;if(u.results)var tr=u.results;else var tr=u.items;var br=er.querySelectorAll(".jdropdown-item"),tt=br[br.length-1].indexValue;tt=u.items[tt];var nr=tr.indexOf(tt)+1;if(nr<tr.length){for(var sr=0;nr<tr.length&&tr[nr]&&sr<200;)tr[nr].group?(tr[nr].group.parentNode||er.appendChild(tr[nr].group),tr[nr].group.lastChild.appendChild(tr[nr].element)):er.appendChild(tr[nr].element),nr++,sr++;gt=!0}return gt},Qr(),u},s.dropdown.keydown=function(a){var d=null;if(d=s.dropdown.current){if(a.which==13||a.which==9)d.header.value&&d.currentIndex==null&&d.options.newOptions?d.add():(d.currentIndex==null&&d.options.autocomplete==!0&&d.header.value!=""&&d.find(d.header.value),d.selectIndex(d.currentIndex));else if(a.which==38)d.currentIndex==null?d.first():d.currentIndex>0&&d.prev(),a.preventDefault();else if(a.which==40)d.currentIndex==null?d.first():d.currentIndex+1<d.items.length&&d.next(),a.preventDefault();else if(a.which==36)d.first(),a.target.classList.contains("jdropdown-header")||a.preventDefault();else if(a.which==35)d.last(),a.target.classList.contains("jdropdown-header")||a.preventDefault();else if(a.which==27)d.close();else if(a.which==33){if(d.currentIndex==null)d.first();else if(d.currentIndex>0)for(var u=0;u<7;u++)d.prev();a.preventDefault()}else if(a.which==34){if(d.currentIndex==null)d.first();else if(d.currentIndex+1<d.items.length)for(var u=0;u<7;u++)d.next();a.preventDefault()}}},s.dropdown.mouseup=function(a){var d=s.findElement(a.target,"jdropdown");if(d){var u=d.dropdown;if(a.target.classList.contains("jdropdown-header"))if(d.classList.contains("jdropdown-focus")&&d.classList.contains("jdropdown-default")){var f=d.getBoundingClientRect();if(a.changedTouches&&a.changedTouches[0]){var h=a.changedTouches[0].clientX;a.changedTouches[0].clientY}else{var h=a.clientX;a.clientY}f.width-(h-f.left)<30?a.target.classList.contains("jdropdown-add")?u.add():u.close():u.options.autocomplete==!1&&u.close()}else u.open();else if(a.target.classList.contains("jdropdown-group-name")){var g=a.target.nextSibling.children;if(a.target.nextSibling.style.display!="none")for(var b=0;b<g.length;b++)g[b].style.display!="none"&&u.selectItem(g[b])}else a.target.classList.contains("jdropdown-group-arrow")?a.target.classList.contains("jdropdown-group-arrow-down")?(a.target.classList.remove("jdropdown-group-arrow-down"),a.target.classList.add("jdropdown-group-arrow-up"),a.target.parentNode.nextSibling.style.display="none"):(a.target.classList.remove("jdropdown-group-arrow-up"),a.target.classList.add("jdropdown-group-arrow-down"),a.target.parentNode.nextSibling.style.display=""):a.target.classList.contains("jdropdown-item")?u.selectItem(a.target):a.target.classList.contains("jdropdown-image")||a.target.classList.contains("jdropdown-description")?u.selectItem(a.target.parentNode):a.target.classList.contains("jdropdown-title")?u.selectItem(a.target.parentNode.parentNode):(a.target.classList.contains("jdropdown-close")||a.target.classList.contains("jdropdown-backdrop"))&&u.close()}},s.dropdown.extractFromDom=function(a,d){var u=a;if(d||(d={}),a.getAttribute("multiple")&&(!d||d.multiple==null)&&(d.multiple=!0),a.getAttribute("placeholder")&&(!d||d.placeholder==null)&&(d.placeholder=a.getAttribute("placeholder")),a.getAttribute("data-autocomplete")&&(!d||d.autocomplete==null)&&(d.autocomplete=!0),(!d||d.width==null)&&(d.width=a.offsetWidth),a.value&&(!d||d.value==null)&&(d.value=a.value),!d||d.data==null){d.data=[];for(var f=0;f<a.children.length;f++)if(a.children[f].tagName=="OPTGROUP")for(var h=0;h<a.children[f].children.length;h++)d.data.push({value:a.children[f].children[h].value,text:a.children[f].children[h].innerHTML,group:a.children[f].getAttribute("label")});else d.data.push({value:a.children[f].value,text:a.children[f].innerHTML})}(!d||d.onchange==null)&&(d.onchange=function(b,m,_,Ge){d.multiple==!0?obj.items[m].classList.contains("jdropdown-selected")?u.options[m].setAttribute("selected","selected"):u.options[m].removeAttribute("selected"):u.value=Ge});var g=document.createElement("div");return a.parentNode.insertBefore(g,a),a.style.display="none",a=g,{el:a,options:d}},s.editor=function(a,d){var u={type:"editor"};u.options={};var f={value:null,snippet:null,toolbar:null,remoteParser:null,placeholder:null,parseURL:!1,filterPaste:!0,dropZone:!1,dropAsSnippet:!1,acceptImages:!1,acceptFiles:!1,maxFileSize:5e6,allowImageResize:!0,border:!0,padding:!0,maxHeight:null,height:null,focus:!1,onclick:null,onfocus:null,onblur:null,onload:null,onkeyup:null,onkeydown:null,onchange:null};for(var h in f)d&&d.hasOwnProperty(h)?u.options[h]=d[h]:u.options[h]=f[h];var g=null,b=null,m=[];a.innerHTML="",u.el=a,typeof u.options.onclick=="function"&&(a.onclick=function(or){u.options.onclick(a,u,or)}),a.classList.add("jeditor-container"),u.options.padding==!0&&a.classList.add("jeditor-padding"),u.options.border==!1&&(a.style.border="0px");var _=document.createElement("div");_.className="jsnippet",_.setAttribute("contenteditable",!1);var Ge=document.createElement("div");Ge.className="jeditor-toolbar";var ot=document.createElement("div");if(ot.setAttribute("contenteditable",!0),ot.setAttribute("spellcheck",!1),ot.className="jeditor",u.options.placeholder&&ot.setAttribute("data-placeholder",u.options.placeholder),(u.options.maxHeight||u.options.height)&&(ot.style.overflowY="auto",u.options.maxHeight&&(ot.style.maxHeight=u.options.maxHeight),u.options.height&&(ot.style.height=u.options.height)),u.options.value)var rr=u.options.value;else var rr=a.innerHTML?a.innerHTML:"";if(!rr)var rr="";var ir=function(or){typeof u.options.onchange=="function"&&u.options.onchange(a,u,or),u.options.value=u.getData(),a.value!=u.options.value&&(a.value=u.options.value,typeof a.oninput=="function"&&a.oninput({type:"input",target:a,value:a.value}))},er=function(or){var Pr=document.createElement("div");Pr.innerHTML=or;var Ur=Pr.querySelectorAll("img");if(Ur.length)for(var ti=0;ti<Ur.length;ti++)u.addImage(Ur[ti].src)},ar=function(or){var Pr,Ur;window.getSelection&&(Pr=window.getSelection(),Pr.rangeCount&&(Ur=Pr.getRangeAt(0),Ur.toString(),Ur.deleteContents(),Ur.insertNode(or),Ur.setStartAfter(or),Ur.setEndAfter(or),Pr.removeAllRanges(),Pr.addRange(Ur)))},Lr=function(){var or=null;if(or=_.children[0]){or.classList.contains("jslider-grid")||or.classList.add("jslider-grid");var Pr=or.children.length;or.setAttribute("data-number",Pr>4?4:Pr),Pr>4?or.setAttribute("data-total",Pr-4):or.removeAttribute("data-total")}},Mr=function(or){_.innerHTML||Br({}),_.children[0].appendChild(or),Lr()},Br=function(or){_.innerHTML="";for(var Pr=["image","title","description","host","url"],Ur=0;Ur<Pr.length;Ur++){var ti=document.createElement("div");if(ti.className="jsnippet-"+Pr[Ur],ti.setAttribute("data-k",Pr[Ur]),_.appendChild(ti),or[Pr[Ur]])if(Pr[Ur]=="image"){Array.isArray(or.image)||(or.image=[or.image]);for(var li=0;li<or.image.length;li++){var si=document.createElement("img");si.src=or.image[li],ti.appendChild(si)}}else ti.innerHTML=or[Pr[Ur]]}ot.appendChild(document.createElement("br")),ot.appendChild(_)},Qr=function(){clearTimeout(g),g=setTimeout(function(){var or=ot.querySelector(".jsnippet");if(!or){var Pr=ot.innerHTML.replace(/\n/g," "),Ur=document.createElement("div");Ur.innerHTML=Pr;var ti=Ur.innerText,li=s.editor.detectUrl(ti);if(li)if(li[0].substr(-3)=="jpg"||li[0].substr(-3)=="png"||li[0].substr(-3)=="gif")u.addImage(li[0],!0);else{var si=s.editor.youtubeParser(li[0]);u.parseWebsite(li[0],si)}}},1e3)};u.parseContent=function(){Qr()},u.parseWebsite=function(or,Pr){if(!u.options.remoteParser)console.log("The remoteParser is not defined");else{if(Pr)var or="https://www.youtube.com/watch?v="+Pr;var Ur={title:"",description:"",image:"",host:or.split("/")[2],url:or};s.ajax({url:u.options.remoteParser+encodeURI(or.trim()),method:"GET",dataType:"json",success:function(ti){ti.title&&(Ur.title=ti.title),ti.description&&(Ur.description=ti.description),ti.host&&(Ur.host=ti.host),ti.url&&(Ur.url=ti.url),Br(Ur),ti.image?u.addImage(ti.image,!0):ti["og:image"]&&u.addImage(ti["og:image"],!0)}})}},u.setData=function(or){ot.innerHTML=or,u.options.focus&&s.editor.setCursor(ot,!0),m=[]},u.getFiles=function(){for(var or=ot.querySelectorAll(".jfile"),Pr=[],Ur=0;Ur<or.length;Ur++)m[or[Ur].src]&&Pr.push(m[or[Ur].src]);return Pr},u.getText=function(){return ot.innerText},u.getData=function(or){if(or){var Pr={content:""};if(_.innerHTML){Pr.snippet={};for(var Ur=0;Ur<_.children.length;Ur++){var ti=_.children[Ur].getAttribute("data-k");if(ti)if(ti=="image"){Pr.snippet.image||(Pr.snippet.image=[]);for(var li=0;li<_.children[Ur].children.length;li++)Pr.snippet.image.push(_.children[Ur].children[li].getAttribute("src"))}else Pr.snippet[ti]=_.children[Ur].innerHTML}}var si=Object.keys(m);if(si.length){Pr.files=[];for(var Ur=0;Ur<si.length;Ur++)Pr.files.push(m[si[Ur]])}var di=ot.innerHTML;di=di.replace(/<br>/g,`
`),di=di.replace(/<\/div>/g,`</div>
`),di=di.replace(/<(?:.|\n)*?>/gm,""),Pr.content=di.trim()}else var Pr=ot.innerHTML;return Pr},u.reset=function(){ot.innerHTML="",_.innerHTML="",m=[]},u.addPdf=function(or){if(or.result.substr(0,4)!="data")console.error("Invalid source");else{var Pr=document.createElement("canvas");Pr.width=60,Pr.height=60;var Ur=new Image,ti=Pr.getContext("2d");ti.drawImage(Ur,0,0,Pr.width,Pr.height),Pr.toBlob(function(li){var si=document.createElement("img");si.src=window.URL.createObjectURL(li),si.title=or.name,si.className="jfile pdf",m[si.src]={file:si.src,extension:"pdf",content:or.result},ar(si)})}},u.addImage=function(or,Pr){if(or||(or=""),or.substr(0,4)!="data"&&!u.options.remoteParser)console.error("remoteParser not defined in your initialization");else{if(or.substr(0,4)=="data"){var Ur=or.split(";");Ur=Ur[0].split("/"),Ur=Ur[1]}else{var Ur=or.substr(or.lastIndexOf(".")+1);or=u.options.remoteParser+or}var ti=new Image;ti.onload=function(){var si=document.createElement("canvas");si.width=ti.width,si.height=ti.height;var di=si.getContext("2d");di.drawImage(ti,0,0,si.width,si.height),si.toBlob(function(pi){var fi=document.createElement("img");fi.src=window.URL.createObjectURL(pi),fi.classList.add("jfile"),fi.setAttribute("tabindex","900"),m[fi.src]={file:fi.src,extension:Ur,content:si.toDataURL()},u.options.dropAsSnippet||Pr?(Mr(fi),m[fi.src].snippet=!0):ar(fi),ir()})},ti.src=or}},u.addFile=function(or){for(var Pr=[],Ur=0;Ur<or.length;Ur++)if(or[Ur].size>u.options.maxFileSize)alert("The file is too big");else{var ti=or[Ur].type.split("/");ti[0]=="image"?ti=1:ti[1]=="pdf"?ti=2:ti=0,ti?(Pr[Ur]=new FileReader,Pr[Ur].index=Ur,Pr[Ur].type=ti,Pr[Ur].name=or[Ur].name,Pr[Ur].date=or[Ur].lastModified,Pr[Ur].size=or[Ur].size,Pr[Ur].addEventListener("load",function(li){li.target.type==2?u.options.acceptFiles==!0&&u.addPdf(li.target):u.addImage(li.target.result)},!1),Pr[Ur].readAsDataURL(or[Ur])):alert("The extension is not allowed")}},u.destroy=function(){ot.removeEventListener("mouseup",ii),ot.removeEventListener("mousedown",Ir),ot.removeEventListener("mousemove",gt),ot.removeEventListener("keyup",tr),ot.removeEventListener("keydown",br),ot.removeEventListener("dragstart",qr),ot.removeEventListener("dragenter",ni),ot.removeEventListener("dragover",Xr),ot.removeEventListener("drop",ui),ot.removeEventListener("paste",Or),typeof u.options.onblur=="function"&&ot.removeEventListener("blur",Kr),typeof u.options.onfocus=="function"&&ot.removeEventListener("focus",ei),a.editor=null,a.classList.remove("jeditor-container"),Ge.remove(),_.remove(),ot.remove()};var ii=function(or){b&&b.e&&b.e.classList.remove("resizing"),b=!1},Ir=function(or){var Pr=function(si){var di=si.getBoundingClientRect();di.width-(or.clientX-di.left)<40&&or.clientY-di.top<40&&(si.innerHTML="",si.remove())};if(or.target.tagName=="IMG")if(or.target.style.cursor){var Ur=or.target.getBoundingClientRect();b={e:or.target,x:or.clientX,y:or.clientY,w:Ur.width,h:Ur.height,d:or.target.style.cursor},or.target.width||(or.target.width=Ur.width+"px"),or.target.height||(or.target.height=Ur.height+"px");var ti=window.getSelection();if(ti.rangeCount)for(var li=0;li<ti.rangeCount;li++)ti.removeRange(ti.getRangeAt(li));or.target.classList.add("resizing")}else b=!0;else or.target.classList.contains("jsnippet")?Pr(or.target):or.target.parentNode.classList.contains("jsnippet")&&Pr(or.target.parentNode),b=!0},gt=function(or){if(or.target.tagName=="IMG"&&!or.target.parentNode.classList.contains("jsnippet-image")&&u.options.allowImageResize==!0&&or.target.getAttribute("tabindex")){var Pr=or.target.getBoundingClientRect();or.clientY-Pr.top<5?Pr.width-(or.clientX-Pr.left)<5?or.target.style.cursor="ne-resize":or.clientX-Pr.left<5?or.target.style.cursor="nw-resize":or.target.style.cursor="n-resize":Pr.height-(or.clientY-Pr.top)<5?Pr.width-(or.clientX-Pr.left)<5?or.target.style.cursor="se-resize":or.clientX-Pr.left<5?or.target.style.cursor="sw-resize":or.target.style.cursor="s-resize":Pr.width-(or.clientX-Pr.left)<5?or.target.style.cursor="e-resize":or.clientX-Pr.left<5?or.target.style.cursor="w-resize":or.target.style.cursor=""}if(or.which==1&&b&&b.d){if(b.d=="e-resize"||b.d=="ne-resize"||b.d=="se-resize")if(b.e.width=b.w+(or.clientX-b.x),or.shiftKey){var Ur=(or.clientX-b.x)*(b.h/b.w);b.e.height=b.h+Ur}else var Ur=null;Ur||(b.d=="s-resize"||b.d=="se-resize"||b.d=="sw-resize")&&(or.shiftKey||(b.e.height=b.h+(or.clientY-b.y)))}},tr=function(or){ot.innerHTML||(ot.innerHTML="<div><br></div>"),typeof u.options.onkeyup=="function"&&u.options.onkeyup(a,u,or)},br=function(or){u.options.parseURL==!0&&Qr(),typeof u.options.onkeydown=="function"&&u.options.onkeydown(a,u,or),or.key=="Delete"&&or.target.tagName=="IMG"&&or.target.parentNode.classList.contains("jsnippet-image")&&(or.target.remove(),Lr())},tt=[HTMLUnknownElement,HTMLAudioElement,HTMLEmbedElement,HTMLIFrameElement,HTMLTextAreaElement,HTMLInputElement,HTMLScriptElement],nr=["width","height","align","border","src","tabindex"],sr=["color","font-weight","font-size","background","background-color","margin"],Rr=function(or){if(or.attributes&&or.attributes.length){var Pr=null,Ur=or.getAttribute("style");if(Ur){Pr=[];for(var ti=Ur.split(";"),li=0;li<ti.length;li++){var si=ti[li].trim().split(":");if(sr.indexOf(si[0].trim())>=0){var di=si.shift(),si=si.join(":");Pr.push(di+":"+si)}}}or.tagName.toUpperCase()=="IMG"&&(!u.options.acceptImages||!or.src?or.parentNode.removeChild(or):(or.setAttribute("tabindex","900"),u.addImage(or.src)));var pi=[],fi=or.attributes.length-1;if(fi>0){for(var hi=fi;hi>=0;hi--)pi.push(or.attributes[hi].name);pi.forEach(function(gi){nr.indexOf(gi)==-1&&or.removeAttribute(gi)})}or.style="",Pr&&Pr.length&&or.setAttribute("style",Pr.join(";"))}if(or.children.length)for(var hi=0;hi<or.children.length;hi++)Rr(or.children[hi]);tt.indexOf(or.constructor)>=0&&or.remove()},Ar=function(or){or&&(or=or.replace(new RegExp("<!--(.*?)-->","gsi"),""));var Pr=new DOMParser,Ur=Pr.parseFromString(or,"text/html");Rr(Ur);var ti=document.createElement("span");return ti.innerHTML=Ur.firstChild.innerHTML,ti},Or=function(or){if(u.options.filterPaste==!0){if(or.clipboardData||or.originalEvent.clipboardData)var Pr=(or.originalEvent||or).clipboardData.getData("text/html"),Ur=(or.originalEvent||or).clipboardData.getData("text/plain"),ti=(or.originalEvent||or).clipboardData.files;else if(window.clipboardData)var Pr=window.clipboardData.getData("Html"),Ur=window.clipboardData.getData("Text"),ti=window.clipboardData.files;if(ti.length)u.addFile(ti);else if(!Pr)Pr=Ur.split(`\r
`),or.target.innerText?(Pr=Pr.map(function(si){return"<div>"+si+"</div>"}),document.execCommand("insertHtml",!1,Pr.join(""))):Pr.map(function(si){var di=document.createElement("div");di.innerText=si,ot.appendChild(di)});else{var li=Ar(Pr);document.execCommand("insertHtml",!1,li.innerHTML)}or.preventDefault()}},qr=function(or){b&&b.e&&or.preventDefault()},ni=function(or){b||u.options.dropZone==!1||(a.classList.add("jeditor-dragging"),or.preventDefault())},Xr=function(or){b||u.options.dropZone==!1||(g&&clearTimeout(g),g=setTimeout(function(){a.classList.remove("jeditor-dragging")},100),or.preventDefault())},ui=function(or){if(!(b||u.options.dropZone==!1)){var Pr=null;document.caretRangeFromPoint?Pr=document.caretRangeFromPoint(or.clientX,or.clientY):or.rangeParent&&(Pr=document.createRange(),Pr.setStart(or.rangeParent,or.rangeOffset));var Ur=window.getSelection();Ur.removeAllRanges(),Ur.addRange(Pr),Ur.anchorNode.parentNode.focus();var ti=(or.originalEvent||or).dataTransfer.getData("text/html"),li=(or.originalEvent||or).dataTransfer.getData("text/plain"),si=(or.originalEvent||or).dataTransfer.files;si.length?u.addFile(si):li&&er(ti),a.classList.remove("jeditor-dragging"),or.preventDefault()}},Kr=function(or){typeof u.options.onblur=="function"&&u.options.onblur(a,u,or),ir(or)},ei=function(or){typeof u.options.onfocus=="function"&&u.options.onfocus(a,u,or)};return ot.addEventListener("mouseup",ii),ot.addEventListener("mousedown",Ir),ot.addEventListener("mousemove",gt),ot.addEventListener("keyup",tr),ot.addEventListener("keydown",br),ot.addEventListener("dragstart",qr),ot.addEventListener("dragenter",ni),ot.addEventListener("dragover",Xr),ot.addEventListener("drop",ui),ot.addEventListener("paste",Or),ot.addEventListener("focus",ei),ot.addEventListener("blur",Kr),typeof u.options.onload=="function"&&u.options.onload(a,u,ot),ot.innerHTML=rr,a.appendChild(ot),u.options.snippet&&Br(u.options.snippet),u.options.toolbar==null&&(u.options.toolbar=s.editor.getDefaultToolbar()),u.options.toolbar&&(a.appendChild(Ge),s.toolbar(Ge,{container:!0,responsive:!0,items:u.options.toolbar})),u.options.focus&&s.editor.setCursor(ot,u.options.focus=="initial"),a.change=u.setData,a.val=function(or){if(or===void 0){var Pr=a.getAttribute("data-html")!=="true";return u.getData(Pr)}else u.setData(or)},a.editor=u,u},s.editor.setCursor=function(a,d){a.focus(),document.execCommand("selectAll");var u=window.getSelection(),f=u.getRangeAt(0);if(d==!0)var h=f.startContainer,g=0;else var h=f.endContainer,g=h.length;f.setStart(h,g),f.setEnd(h,g),u.removeAllRanges(),u.addRange(f)},s.editor.getDomain=function(a){return a.replace("http://","").replace("https://","").replace("www.","").split(/[/?#]/)[0].split(/:/g)[0]},s.editor.detectUrl=function(a){var d=/(((https?:\/\/)|(www\.))[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|]+)/ig,u=a.match(d);return u&&u[0].substr(0,3)=="www"&&(u[0]="http://"+u[0]),u},s.editor.youtubeParser=function(a){var d=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/,u=a.match(d);return u&&u[7].length==11?u[7]:!1},s.editor.getDefaultToolbar=function(){return[{content:"undo",onclick:function(){document.execCommand("undo")}},{content:"redo",onclick:function(){document.execCommand("redo")}},{type:"divisor"},{content:"format_bold",onclick:function(a,d,u){document.execCommand("bold"),document.queryCommandState("bold")?u.classList.add("selected"):u.classList.remove("selected")}},{content:"format_italic",onclick:function(a,d,u){document.execCommand("italic"),document.queryCommandState("italic")?u.classList.add("selected"):u.classList.remove("selected")}},{content:"format_underline",onclick:function(a,d,u){document.execCommand("underline"),document.queryCommandState("underline")?u.classList.add("selected"):u.classList.remove("selected")}},{type:"divisor"},{content:"format_list_bulleted",onclick:function(a,d,u){document.execCommand("insertUnorderedList"),document.queryCommandState("insertUnorderedList")?u.classList.add("selected"):u.classList.remove("selected")}},{content:"format_list_numbered",onclick:function(a,d,u){document.execCommand("insertOrderedList"),document.queryCommandState("insertOrderedList")?u.classList.add("selected"):u.classList.remove("selected")}},{content:"format_indent_increase",onclick:function(a,d,u){document.execCommand("indent",!0,null),document.queryCommandState("indent")?u.classList.add("selected"):u.classList.remove("selected")}},{content:"format_indent_decrease",onclick:function(){document.execCommand("outdent"),document.queryCommandState("outdent")?this.classList.add("selected"):this.classList.remove("selected")}}]},s.form=function(a,d){var u={};u.options={};var f={url:null,message:"Are you sure? There are unsaved information in your form",ignore:!1,currentHash:null,submitButton:null,validations:null,onbeforeload:null,onload:null,onbeforesave:null,onsave:null,onbeforeremove:null,onremove:null,onerror:function(m,_){s.alert(_)}};for(var h in f)d&&d.hasOwnProperty(h)?u.options[h]=d[h]:u.options[h]=f[h];u.options.validations||(u.options.validations={}),u.options.submitButton||(u.options.submitButton=a.querySelector("input[type=submit]")),u.options.submitButton&&u.options.url&&(u.options.submitButton.onclick=function(){u.save()}),u.options.validations.email||(u.options.validations.email=s.validations.email),u.options.validations.length||(u.options.validations.length=s.validations.length),u.options.validations.required||(u.options.validations.required=s.validations.required),u.setUrl=function(m){u.options.url=m},u.load=function(){s.ajax({url:u.options.url,method:"GET",dataType:"json",queue:!0,success:function(m){if(typeof u.options.onbeforeload=="function"){var _=u.options.onbeforeload(a,m);_&&(m=_)}s.form.setElements(a,m),typeof u.options.onload=="function"&&u.options.onload(a,m)}})},u.save=function(){var m=u.validate();if(m)u.options.onerror(a,m);else{var _=s.form.getElements(a,!0);if(typeof u.options.onbeforesave=="function"){var _=u.options.onbeforesave(a,_);if(_===!1)return}s.ajax({url:u.options.url,method:"POST",dataType:"json",data:_,success:function(Ge){typeof u.options.onsave=="function"&&u.options.onsave(a,_,Ge)}})}},u.remove=function(){if(typeof u.options.onbeforeremove=="function"){var m=u.options.onbeforeremove(a,u);if(m===!1)return!1}s.ajax({url:u.options.url,method:"DELETE",dataType:"json",success:function(_){typeof u.options.onremove=="function"&&u.options.onremove(a,u,_),u.reset()}})};var g=function(m){m.classList.add("error"),u.options.submitButton&&u.options.submitButton.setAttribute("disabled",!0);var _=m.getAttribute("data-error")||"There is an error in the form";return m.setAttribute("title",_),_},b=function(m){var _=!1;m.classList.remove("error"),m.removeAttribute("title");for(var Ge=a.querySelectorAll("input, select, textarea, div[name]"),ot=0;ot<Ge.length;ot++)Ge[ot].getAttribute("data-validation")&&Ge[ot].classList.contains("error")&&(_=!0);u.options.submitButton&&(_?u.options.submitButton.setAttribute("disabled",!0):u.options.submitButton.removeAttribute("disabled"))};return u.validateElement=function(m){var _=!1,Ge=s.form.getValue(m),ot=m.getAttribute("data-validation");return typeof u.options.validations[ot]=="function"&&!u.options.validations[ot](Ge,m)?_=g(m):m.classList.contains("error")&&b(m),_},u.reset=function(){for(var m=a.querySelectorAll("input, select, textarea, div[name]"),_=0;_<m.length;_++)m[_].getAttribute("name")&&(m[_].type=="checkbox"||m[_].type=="radio"?m[_].checked=!1:typeof m[_].val=="function"?m[_].val(""):m[_].value="")},u.validate=function(){for(var m=[],_=a.querySelectorAll("input, select, textarea, div[name]"),Ge=0;Ge<_.length;Ge++)if(_[Ge].getAttribute("data-validation")){var ot=u.validateElement(_[Ge]);ot&&m.push(ot)}return m.length>0?m.join("<br>"):!1},u.getError=function(){return!!u.validation()},u.setHash=function(){return u.getHash(s.form.getElements(a))},u.getHash=function(m){var _=0,Ge,ot;if(m.length===0)return _;for(Ge=0;Ge<m.length;Ge++)ot=m.charCodeAt(Ge),_=(_<<5)-_+ot,_|=0;return _},u.isChanged=function(){var m=u.setHash();return u.options.currentHash!=m},u.resetTracker=function(){u.options.currentHash=u.setHash(),u.options.ignore=!1},u.setIgnore=function(m){u.options.ignore=!!m},setTimeout(function(){u.options.currentHash=u.setHash()},1e3),a.addEventListener("keyup",function(m){m.target.getAttribute("data-validation")&&u.validateElement(m.target)}),s.form.hasEvents||(window.addEventListener("beforeunload",function(m){if(u.isChanged()&&u.options.ignore==!1){var _=u.options.message?u.options.message:"o/";return _?(typeof m=="undefined"&&(m=window.event),m&&(m.returnValue=_),_):void 0}}),s.form.hasEvents=!0),a.form=u,u},s.form.getValue=function(a){var d=null;if(a.type=="checkbox")a.checked==!0&&(d=a.value||!0);else if(a.type=="radio")a.checked==!0&&(d=a.value);else if(a.type=="file")d=a.files;else if(a.tagName=="select"&&a.multiple==!0){d=[];for(var u=a.querySelectorAll("options[selected]"),f=0;f<u.length;f++)d.push(u[f].value)}else typeof a.val=="function"?d=a.val():d=a.value||"";return d},s.form.getElements=function(a,d){for(var u={},f=null,h=a.querySelectorAll("input, select, textarea, div[name]"),g=0;g<h.length;g++)(f=h[g].getAttribute("name"))&&(u[f]=s.form.getValue(h[g])||"");return d==!0?u:JSON.stringify(u)},s.form.setElements=function(a,d){for(var u=null,f=null,h=a.querySelectorAll("input, select, textarea, div[name]"),g=0;g<h.length;g++){var b=h[g].getAttribute("type");if(u=h[g].getAttribute("name")){if(u=u.replace(new RegExp(/\[(.*?)\]/ig),".$1"),f=null,u.match(/\./)){var m=s.path.call(d,u)||"";typeof m!="undefined"&&(f=m)}else typeof d[u]!="undefined"&&(f=d[u]);f!==null&&(b=="checkbox"||b=="radio"?h[g].checked=!!f:b=="file"||(typeof h[g].val=="function"?h[g].val(f):h[g].value=f))}}},s.tracker=s.form,s.focus=function(a){if(a.innerText.length){var d=document.createRange(),u=window.getSelection(),f=a.childNodes[a.childNodes.length-1];d.setStart(f,f.length),d.collapse(!0),u.removeAllRanges(),u.addRange(d),a.scrollLeft=a.scrollWidth}},s.isNumeric=function(a){return!isNaN(a)&&a!==null&&a!==""},s.guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var d=Math.random()*16|0,u=a=="x"?d:d&3|8;return u.toString(16)})},s.getNode=function(){var a=document.getSelection().anchorNode;return a?a.nodeType==3?a.parentNode:a:null},s.hash=function(a){var d=0,u,f;if(a.length===0)return d;for(u=0;u<a.length;u++)f=a.charCodeAt(u),f>32&&(d=(d<<5)-d+f,d|=0);return d},s.randomColor=function(a){var d=-.25,u=String("#"+Math.random().toString(16).slice(2,8).toUpperCase()).replace(/[^0-9a-f]/gi,"");u.length<6&&(u=u[0]+u[0]+u[1]+u[1]+u[2]+u[2]);var f=[],h,g;for(g=0;g<3;g++)h=parseInt(u.substr(g*2,2),16),h=Math.round(Math.min(Math.max(0,h+h*d),255)).toString(16),f.push(("00"+h).substr(h.length));return a==!0?"#"+s.two(f[0].toString(16))+s.two(f[1].toString(16))+s.two(f[2].toString(16)):f},s.getWindowWidth=function(){var a=window,d=document,u=d.documentElement,f=d.getElementsByTagName("body")[0],h=a.innerWidth||u.clientWidth||f.clientWidth;return h},s.getWindowHeight=function(){var a=window,d=document,u=d.documentElement,f=d.getElementsByTagName("body")[0],h=a.innerHeight||u.clientHeight||f.clientHeight;return h},s.getPosition=function(a){if(a.changedTouches&&a.changedTouches[0])var d=a.changedTouches[0].pageX,u=a.changedTouches[0].pageY;else var d=window.Event?a.pageX:a.clientX+(document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft),u=window.Event?a.pageY:a.clientY+(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop);return[d,u]},s.click=function(a){if(a.click)a.click();else{var d=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});a.dispatchEvent(d)}},s.findElement=function(a,d){var u=!1;function f(h){h&&!u&&(typeof d=="function"?u=d(h):typeof d=="string"&&h.classList&&h.classList.contains(d)&&(u=h)),h.parentNode&&!u&&f(h.parentNode)}return f(a),u},s.two=function(a){return a=""+a,a.length==1&&(a="0"+a),a},s.sha512=function(a){function d(Kr,ei){this.highOrder=Kr,this.lowOrder=ei}var u=[new d(1779033703,4089235720),new d(3144134277,2227873595),new d(1013904242,4271175723),new d(2773480762,1595750129),new d(1359893119,2917565137),new d(2600822924,725511199),new d(528734635,4215389547),new d(1541459225,327033209)],f=[new d(1116352408,3609767458),new d(1899447441,602891725),new d(3049323471,3964484399),new d(3921009573,2173295548),new d(961987163,4081628472),new d(1508970993,3053834265),new d(2453635748,2937671579),new d(2870763221,3664609560),new d(3624381080,2734883394),new d(310598401,1164996542),new d(607225278,1323610764),new d(1426881987,3590304994),new d(1925078388,4068182383),new d(2162078206,991336113),new d(2614888103,633803317),new d(3248222580,3479774868),new d(3835390401,2666613458),new d(4022224774,944711139),new d(264347078,2341262773),new d(604807628,2007800933),new d(770255983,1495990901),new d(1249150122,1856431235),new d(1555081692,3175218132),new d(1996064986,2198950837),new d(2554220882,3999719339),new d(2821834349,766784016),new d(2952996808,2566594879),new d(3210313671,3203337956),new d(3336571891,1034457026),new d(3584528711,2466948901),new d(113926993,3758326383),new d(338241895,168717936),new d(666307205,1188179964),new d(773529912,1546045734),new d(1294757372,1522805485),new d(1396182291,2643833823),new d(1695183700,2343527390),new d(1986661051,1014477480),new d(2177026350,1206759142),new d(2456956037,344077627),new d(2730485921,1290863460),new d(2820302411,3158454273),new d(3259730800,3505952657),new d(3345764771,106217008),new d(3516065817,3606008344),new d(3600352804,1432725776),new d(4094571909,1467031594),new d(275423344,851169720),new d(430227734,3100823752),new d(506948616,1363258195),new d(659060556,3750685593),new d(883997877,3785050280),new d(958139571,3318307427),new d(1322822218,3812723403),new d(1537002063,2003034995),new d(1747873779,3602036899),new d(1955562222,1575990012),new d(2024104815,1125592928),new d(2227730452,2716904306),new d(2361852424,442776044),new d(2428436474,593698344),new d(2756734187,3733110249),new d(3204031479,2999351573),new d(3329325298,3815920427),new d(3391569614,3928383900),new d(3515267271,566280711),new d(3940187606,3454069534),new d(4118630271,4000239992),new d(116418474,1914138554),new d(174292421,2731055270),new d(289380356,3203993006),new d(460393269,320620315),new d(685471733,587496836),new d(852142971,1086792851),new d(1017036298,365543100),new d(1126000580,2618297676),new d(1288033470,3409855158),new d(1501505948,4234509866),new d(1607167915,987167468),new d(1816402316,1246189591)],h=new Array(64),g,b,m,_,Ge,ot,rr,ir,er,ar,Lr,Mr,Br=8;function Qr(Kr){return unescape(encodeURIComponent(Kr))}function ii(Kr){for(var ei=[],or=(1<<Br)-1,Pr=Kr.length*Br,Ur=0;Ur<Pr;Ur+=Br)ei[Ur>>5]|=(Kr.charCodeAt(Ur/Br)&or)<<32-Br-Ur%32;return ei}function Ir(Kr){for(var ei="0123456789abcdef",or="",Pr=Kr.length*4,Ur,ti=0;ti<Pr;ti+=1)Ur=Kr[ti>>2]>>(3-ti%4)*8,or+=ei.charAt(Ur>>4&15)+ei.charAt(Ur&15);return or}function gt(Kr,ei){var or,Pr,Ur,ti;return or=(Kr.lowOrder&65535)+(ei.lowOrder&65535),Pr=(Kr.lowOrder>>>16)+(ei.lowOrder>>>16)+(or>>>16),Ur=(Pr&65535)<<16|or&65535,or=(Kr.highOrder&65535)+(ei.highOrder&65535)+(Pr>>>16),Pr=(Kr.highOrder>>>16)+(ei.highOrder>>>16)+(or>>>16),ti=(Pr&65535)<<16|or&65535,new d(ti,Ur)}function tr(Kr,ei,or,Pr){var Ur,ti,li,si;return Ur=(Kr.lowOrder&65535)+(ei.lowOrder&65535)+(or.lowOrder&65535)+(Pr.lowOrder&65535),ti=(Kr.lowOrder>>>16)+(ei.lowOrder>>>16)+(or.lowOrder>>>16)+(Pr.lowOrder>>>16)+(Ur>>>16),li=(ti&65535)<<16|Ur&65535,Ur=(Kr.highOrder&65535)+(ei.highOrder&65535)+(or.highOrder&65535)+(Pr.highOrder&65535)+(ti>>>16),ti=(Kr.highOrder>>>16)+(ei.highOrder>>>16)+(or.highOrder>>>16)+(Pr.highOrder>>>16)+(Ur>>>16),si=(ti&65535)<<16|Ur&65535,new d(si,li)}function br(Kr,ei,or,Pr,Ur){var ti,li,si,di;return ti=(Kr.lowOrder&65535)+(ei.lowOrder&65535)+(or.lowOrder&65535)+(Pr.lowOrder&65535)+(Ur.lowOrder&65535),li=(Kr.lowOrder>>>16)+(ei.lowOrder>>>16)+(or.lowOrder>>>16)+(Pr.lowOrder>>>16)+(Ur.lowOrder>>>16)+(ti>>>16),si=(li&65535)<<16|ti&65535,ti=(Kr.highOrder&65535)+(ei.highOrder&65535)+(or.highOrder&65535)+(Pr.highOrder&65535)+(Ur.highOrder&65535)+(li>>>16),li=(Kr.highOrder>>>16)+(ei.highOrder>>>16)+(or.highOrder>>>16)+(Pr.highOrder>>>16)+(Ur.highOrder>>>16)+(ti>>>16),di=(li&65535)<<16|ti&65535,new d(di,si)}function tt(Kr,ei,or){return new d(Kr.highOrder&ei.highOrder^Kr.highOrder&or.highOrder^ei.highOrder&or.highOrder,Kr.lowOrder&ei.lowOrder^Kr.lowOrder&or.lowOrder^ei.lowOrder&or.lowOrder)}function nr(Kr,ei,or){return new d(Kr.highOrder&ei.highOrder^~Kr.highOrder&or.highOrder,Kr.lowOrder&ei.lowOrder^~Kr.lowOrder&or.lowOrder)}function sr(Kr,ei){return ei<=32?new d(Kr.highOrder>>>ei|Kr.lowOrder<<32-ei,Kr.lowOrder>>>ei|Kr.highOrder<<32-ei):new d(Kr.lowOrder>>>ei|Kr.highOrder<<32-ei,Kr.highOrder>>>ei|Kr.lowOrder<<32-ei)}function Rr(Kr){var ei=sr(Kr,28),or=sr(Kr,34),Pr=sr(Kr,39);return new d(ei.highOrder^or.highOrder^Pr.highOrder,ei.lowOrder^or.lowOrder^Pr.lowOrder)}function Ar(Kr){var ei=sr(Kr,14),or=sr(Kr,18),Pr=sr(Kr,41);return new d(ei.highOrder^or.highOrder^Pr.highOrder,ei.lowOrder^or.lowOrder^Pr.lowOrder)}function Or(Kr){var ei=sr(Kr,1),or=sr(Kr,8),Pr=ni(Kr,7);return new d(ei.highOrder^or.highOrder^Pr.highOrder,ei.lowOrder^or.lowOrder^Pr.lowOrder)}function qr(Kr){var ei=sr(Kr,19),or=sr(Kr,61),Pr=ni(Kr,6);return new d(ei.highOrder^or.highOrder^Pr.highOrder,ei.lowOrder^or.lowOrder^Pr.lowOrder)}function ni(Kr,ei){return ei<=32?new d(Kr.highOrder>>>ei,Kr.lowOrder>>>ei|Kr.highOrder<<32-ei):new d(0,Kr.highOrder<<32-ei)}var a=Qr(a),Xr=a.length*Br;a=ii(a),a[Xr>>5]|=128<<24-Xr%32,a[(Xr+128>>10<<5)+31]=Xr;for(var er=0;er<a.length;er+=32){g=u[0],b=u[1],m=u[2],_=u[3],Ge=u[4],ot=u[5],rr=u[6],ir=u[7];for(var ar=0;ar<80;ar++)ar<16?h[ar]=new d(a[ar*2+er],a[ar*2+er+1]):h[ar]=tr(qr(h[ar-2]),h[ar-7],Or(h[ar-15]),h[ar-16]),Lr=br(ir,Ar(Ge),nr(Ge,ot,rr),f[ar],h[ar]),Mr=gt(Rr(g),tt(g,b,m)),ir=rr,rr=ot,ot=Ge,Ge=gt(_,Lr),_=m,m=b,b=g,g=gt(Lr,Mr);u[0]=gt(g,u[0]),u[1]=gt(b,u[1]),u[2]=gt(m,u[2]),u[3]=gt(_,u[3]),u[4]=gt(Ge,u[4]),u[5]=gt(ot,u[5]),u[6]=gt(rr,u[6]),u[7]=gt(ir,u[7])}for(var ui=[],er=0;er<u.length;er++)ui.push(u[er].highOrder),ui.push(u[er].lowOrder);return Ir(ui)},s.login||(s.login={},s.login.sha512=s.sha512),s.image=s.upload=function(a,d){var u={};u.options={};var f={type:"image",extension:"*",input:!1,minWidth:!1,maxWidth:null,maxHeight:null,maxJpegSizeBytes:null,onchange:null,multiple:!1,remoteParser:null,text:{extensionNotAllowed:"The extension is not allowed"}};for(var h in f)d&&d.hasOwnProperty(h)?u.options[h]=d[h]:u.options[h]=f[h];u.options.multiple==!0&&a.setAttribute("data-multiple",!0),a.content=[],a.classList.add("jupload"),u.options.input==!0&&a.classList.add("input"),u.add=function(_){if(u.options.multiple==!1&&(a.content=[],a.innerText=""),u.options.type=="image"){var Ge=document.createElement("img");Ge.setAttribute("src",_.file),Ge.setAttribute("tabindex",-1),a.getAttribute("name")||(Ge.className="jfile",Ge.content=_),a.appendChild(Ge)}else{if(_.name)var ot=_.name;else var ot=_.file;var rr=document.createElement("div");rr.innerText=ot||u.options.type,rr.classList.add("jupload-item"),rr.setAttribute("tabindex",-1),a.appendChild(rr)}_.content&&(_.file=s.guid()),a.content.push(_),typeof u.options.onchange=="function"&&u.options.onchange(a,_)},u.addFromFile=function(_){var Ge=_.type.split("/");if(Ge[0]==u.options.type){var ot=new FileReader;ot.addEventListener("load",function(rr){var ir={file:rr.srcElement.result,extension:_.name.substr(_.name.lastIndexOf(".")+1),name:_.name,size:_.size,lastmodified:_.lastModified,content:rr.srcElement.result};u.add(ir)}),ot.readAsDataURL(_)}else alert(u.options.text.extensionNotAllowed)},u.addFromUrl=function(_){if(_.substr(0,4)!="data"&&!u.options.remoteParser)console.error("remoteParser not defined in your initialization");else if(_.substr(0,4)=="data"){var Ge=_.split(";");Ge=Ge[0].split("/");var ot=Ge[0].replace("data:","");if(ot==u.options.type){var rr={file:_,name:"",extension:Ge[1],content:_};u.add(rr)}else alert(u.options.text.extensionNotAllowed)}else{var Ge=_.substr(_.lastIndexOf(".")+1);_=u.options.remoteParser+_,s.ajax({url:_,type:"GET",dataType:"blob",success:function(er){}})}};var g=u.options.type+"/"+u.options.extension,b=document.createElement("input");b.type="file",b.setAttribute("accept",g),b.onchange=function(){for(var _=0;_<this.files.length;_++)u.addFromFile(this.files[_])},u.options.multiple==!0&&b.setAttribute("multiple",!0);var m=null;return a.addEventListener("click",function(_){m=null,!a.children.length||_.target===a?s.click(b):_.target.parentNode==a&&(m=_.target)}),a.addEventListener("dblclick",function(_){s.click(b)}),a.addEventListener("dragenter",function(_){a.style.border="1px dashed #000"}),a.addEventListener("dragleave",function(_){a.style.border="1px solid #eee"}),a.addEventListener("dragstop",function(_){a.style.border="1px solid #eee"}),a.addEventListener("dragover",function(_){_.preventDefault()}),a.addEventListener("keydown",function(_){if(m&&_.which==46){var Ge=Array.prototype.indexOf.call(a.children,m);Ge>=0&&(a.content.splice(Ge,1),m.remove(),m=null)}}),a.addEventListener("drop",function(_){_.preventDefault(),_.stopPropagation();var Ge=(_.originalEvent||_).dataTransfer.getData("text/html"),ot=(_.originalEvent||_).dataTransfer.files;if(ot.length)for(var rr=0;rr<_.dataTransfer.files.length;rr++)u.addFromFile(_.dataTransfer.files[rr]);else if(Ge){u.options.multiple==!1&&(a.innerText="");var ir=document.createElement("div");ir.innerHTML=Ge;var er=ir.querySelectorAll("img");if(er.length)for(var rr=0;rr<er.length;rr++)u.addFromUrl(er[rr].src)}return a.style.border="1px solid #eee",!1}),a.val=function(_){if(_===void 0)return a.content&&a.content.length?a.content:null;if(a.innerText="",a.content=[],_)if(Array.isArray(_))for(var Ge=0;Ge<_.length;Ge++)typeof _[Ge]=="string"?u.add({file:_[Ge]}):u.add(_[Ge]);else typeof _=="string"&&u.add({file:_})},a.upload=a.image=u,u},s.image.create=function(a){var d=document.createElement("img");return d.setAttribute("src",a.file),d.className="jfile",d.setAttribute("tabindex",-1),d.content=a,d},s.lazyLoading=function(a,d){var u={};(!d.loadUp||typeof d.loadUp!="function")&&(d.loadUp=function(){return!1}),(!d.loadDown||typeof d.loadDown!="function")&&(d.loadDown=function(){return!1}),d.timer||(d.timer=100);var f=null,h=function(g){if(f==null){var b=!1,m=a.scrollTop;a.scrollTop+a.clientHeight*2>=a.scrollHeight?d.loadDown()&&(m==a.scrollTop&&(a.scrollTop=a.scrollTop-a.clientHeight),b=!0):a.scrollTop<=a.clientHeight&&d.loadUp()&&(m==a.scrollTop&&(a.scrollTop=a.scrollTop+a.clientHeight),b=!0),f=setTimeout(function(){f=null},d.timer),b&&typeof d.onupdate=="function"&&d.onupdate()}};return a.onscroll=function(g){h()},a.onwheel=function(g){h()},u},s.loading=function(){var a={},d=null;return a.show=function(){d||(d=document.createElement("div"),d.className="jloading"),document.body.appendChild(d)},a.hide=function(){d&&d.parentNode&&document.body.removeChild(d)},a}(),s.mask=function(){var a={currency:["#(.{1})##0?(.{1}0+)?( ?;(.*)?)?","#"],percentage:["0{1}(.{1}0+)?%"],numeric:["0{1}(.{1}0+)?"],datetime:["YYYY","YYY","YY","MMMMM","MMMM","MMM","MM","DDDDD","DDDD","DDD","DD","DY","DAY","WD","D","Q","HH24","HH12","HH","\\[H\\]","H","AM/PM","PM","AM","MI","SS","MS","MONTH","MON","Y","M"],general:["A","0","[0-9a-zA-Z$]+","."]},d=function(){if(this.mask.toLowerCase().indexOf("[h]")!==-1){var tt=0;this.date[4]&&(tt=parseFloat(this.date[4]/60));var nr=parseInt(this.date[3])+tt;nr/=24}else!(this.date[0]&&this.date[1]&&this.date[2])&&(this.date[3]||this.date[4])?nr=s.two(this.date[3])+":"+s.two(this.date[4])+":"+s.two(this.date[5]):(this.date[0]&&this.date[1]&&!this.date[2]&&(this.date[2]=1),nr=s.two(this.date[0])+"-"+s.two(this.date[1])+"-"+s.two(this.date[2]),(this.date[3]||this.date[4]||this.date[5])&&(nr+=" "+s.two(this.date[3])+":"+s.two(this.date[4])+":"+s.two(this.date[5])));return nr},u=function(tt){return tt===null||tt===""||tt===void 0},f=function(tt){return(""+tt).chartAt(0)=="="},h=function(tt){return tt==="currency"||tt==="percentage"||tt==="numeric"},g=function(tt){if(tt&&Number(tt)==tt)return".";if(this.options.decimal)return this.options.decimal;if(this.locale){var nr=Intl.NumberFormat(this.locale).format(1.1);return this.options.decimal=nr[1]}else{tt||(tt=this.mask);var sr=new RegExp("0{1}(.{1})0+","ig"),nr=sr.exec(tt);if(nr&&nr[1]&&nr[1].length==1)return this.options.decimal=nr[1],nr[1];var sr=new RegExp("#{1}(.{1})#+","ig"),nr=sr.exec(tt);nr&&nr[1]&&nr[1].length==1?nr[1]===","?this.options.decimal=".":this.options.decimal=",":this.options.decimal="1.1".toLocaleString().substring(1,2)}return this.options.decimal?this.options.decimal:null},b=function(tt,nr){if(tt=="")return"";if(nr||(nr=g.call(this)),tt=(""+tt).split(nr),tt[0]=tt[0].match(/[\-0-9]+/g,""),tt[0]&&(tt[0]=tt[0].join("")),tt[0]||tt[1])tt[1]!==void 0&&(tt[1]=tt[1].match(/[0-9]+/g,""),tt[1]?tt[1]=tt[1].join(""):tt[1]="");else return"";return tt},m=function(tt){if(tt=="")return"";var nr=g.call(this),sr=this.options;if(tt=b.call(this,tt),tt=="")return"";if(tt[0]){var Rr=parseFloat(tt[0]);sr.style=="percent"&&(Rr/=100)}else var Rr=null;var Ar=new Intl.NumberFormat(this.locale,sr).format(Rr);if(Ar=Ar.split(nr),typeof Ar[1]!="undefined"){var Or=Ar[1].replace(/[0-9]*/g,"");Or&&(Ar[2]=Or)}return tt[1]!==void 0?Ar[1]=nr+tt[1]:Ar[1]="",Ar.join("")},_=function(tt){var nr=rr.call(tt);if(!!nr){g.call(this);var sr=m.call(this,nr),Rr=sr.length-nr.length,Ar=ot.call(tt)+Rr;rr.call(tt,sr,Ar,!0)}},Ge=function(tt){var nr=b.call(this,tt);return nr?parseFloat(nr.join(".")):null},ot=function(tt,nr){if(tt===void 0)if(this.tagName=="DIV"){var sr=0,Rr=window.getSelection();if(Rr&&Rr.rangeCount!==0){var Ar=Rr.getRangeAt(0),Or=Ar.cloneRange();Or.selectNodeContents(this),Or.setEnd(Ar.endContainer,Ar.endOffset),sr=Or.toString().length}return sr}else return this.selectionStart;else{var qr=rr.call(this);if(nr){for(var Or=null,ni=0;ni<qr.length;ni++)(qr[ni].match(/[\-0-9]/g)||qr[ni]=="."||qr[ni]==",")&&(Or=ni);Or===null&&(Or=qr.indexOf(" ")),tt>=Or&&(tt=Or+1)}if(tt>qr.length&&(tt=qr.length),tt)if(this.tagName=="DIV"){var Rr=window.getSelection(),Ar=document.createRange();Ar.setStart(this.childNodes[0],tt),Rr.removeAllRanges(),Rr.addRange(Ar)}else this.selectionStart=tt,this.selectionEnd=tt}},rr=function(tt,nr,sr){if(this.tagName=="DIV"){if(tt===void 0)return this.innerText;this.innerText!==tt&&(this.innerText=tt,nr&&ot.call(this,nr,sr))}else{if(tt===void 0)return this.value;this.value!==tt&&(this.value=tt,nr&&ot.call(this,nr,sr))}},ir=s.calendar.weekdays,er=s.calendar.weekdaysShort,ar=s.calendar.months,Lr=s.calendar.monthsShort,Mr={YEAR:function(tt,nr){var sr=""+new Date().getFullYear();if(typeof this.values[this.index]=="undefined"&&(this.values[this.index]=""),parseInt(tt)>=0&&parseInt(tt)<=10&&this.values[this.index].length<nr&&(this.values[this.index]+=tt),this.values[this.index].length==nr){if(nr==2)var sr=sr.substr(0,2)+this.values[this.index];else if(nr==3)var sr=sr.substr(0,1)+this.values[this.index];else if(nr==4)var sr=this.values[this.index];this.date[0]=sr,this.index++}},YYYY:function(tt){Mr.YEAR.call(this,tt,4)},YYY:function(tt){Mr.YEAR.call(this,tt,3)},YY:function(tt){Mr.YEAR.call(this,tt,2)},FIND:function(tt,nr){u(this.values[this.index])&&(this.values[this.index]="");for(var sr=0,Rr=0,Ar=(this.values[this.index]+tt).toLowerCase(),Or=0;Or<nr.length;Or++)nr[Or].toLowerCase().indexOf(Ar)==0&&(sr=Or,Rr++);if(Rr>1)this.values[this.index]+=tt;else if(Rr==1){var qr=nr[sr].length-this.values[this.index].length-1;return this.position+=qr,this.values[this.index]=nr[sr],this.index++,sr}},MMM:function(tt){var nr=Mr.FIND.call(this,tt,Lr);nr!==void 0&&(this.date[1]=nr+1)},MMMM:function(tt){var nr=Mr.FIND.call(this,tt,ar);nr!==void 0&&(this.date[1]=nr+1)},MMMMM:function(tt){u(this.values[this.index])&&(this.values[this.index]="");for(var nr=(this.values[this.index]+tt).toLowerCase(),sr=0;sr<ar.length;sr++)if(ar[sr][0].toLowerCase().indexOf(nr)==0){this.values[this.index]=ar[sr][0],this.date[1]=sr+1,this.index++;break}},MM:function(tt){u(this.values[this.index])?parseInt(tt)>1&&parseInt(tt)<10?(this.date[1]=this.values[this.index]="0"+tt,this.index++):parseInt(tt)<2&&(this.values[this.index]=tt):this.values[this.index]==1&&parseInt(tt)<3?(this.date[1]=this.values[this.index]+=tt,this.index++):this.values[this.index]==0&&parseInt(tt)>0&&parseInt(tt)<10&&(this.date[1]=this.values[this.index]+=tt,this.index++)},M:function(tt){var nr=!1;if(parseInt(tt)>=0&&parseInt(tt)<10)if(u(this.values[this.index]))this.values[this.index]=tt,tt>1&&(this.date[1]=this.values[this.index],this.index++);else if(this.values[this.index]==1&&parseInt(tt)<3)this.date[1]=this.values[this.index]+=tt,this.index++;else if(this.values[this.index]==0&&parseInt(tt)>0)this.date[1]=this.values[this.index]+=tt,this.index++;else var nr=!0;else var nr=!0;if(nr==!0){var sr=parseInt(this.values[this.index]);sr>0&&sr<12&&(this.date[2]=this.values[this.index],this.index++,this.position--)}},D:function(tt){var nr=!1;if(parseInt(tt)>=0&&parseInt(tt)<10)if(u(this.values[this.index]))this.values[this.index]=tt,parseInt(tt)>3&&(this.date[2]=this.values[this.index],this.index++);else if(this.values[this.index]==3&&parseInt(tt)<2)this.date[2]=this.values[this.index]+=tt,this.index++;else if(this.values[this.index]==1||this.values[this.index]==2)this.date[2]=this.values[this.index]+=tt,this.index++;else if(this.values[this.index]==0&&parseInt(tt)>0)this.date[2]=this.values[this.index]+=tt,this.index++;else var nr=!0;else var nr=!0;if(nr==!0){var sr=parseInt(this.values[this.index]);sr>0&&sr<32&&(this.date[2]=this.values[this.index],this.index++,this.position--)}},DD:function(tt){u(this.values[this.index])?parseInt(tt)>3&&parseInt(tt)<10?(this.date[2]=this.values[this.index]="0"+tt,this.index++):parseInt(tt)<10&&(this.values[this.index]=tt):this.values[this.index]==3&&parseInt(tt)<2?(this.date[2]=this.values[this.index]+=tt,this.index++):(this.values[this.index]==1||this.values[this.index]==2)&&parseInt(tt)<10?(this.date[2]=this.values[this.index]+=tt,this.index++):this.values[this.index]==0&&parseInt(tt)>0&&parseInt(tt)<10&&(this.date[2]=this.values[this.index]+=tt,this.index++)},DDD:function(tt){Mr.FIND.call(this,tt,er)},DDDD:function(tt){Mr.FIND.call(this,tt,ir)},HH12:function(tt,nr){u(this.values[this.index])?parseInt(tt)>1&&parseInt(tt)<10?(nr&&(tt=0+tt),this.date[3]=this.values[this.index]=tt,this.index++):parseInt(tt)<10&&(this.values[this.index]=tt):this.values[this.index]==1&&parseInt(tt)<3?(this.date[3]=this.values[this.index]+=tt,this.index++):this.values[this.index]<1&&parseInt(tt)<10&&(this.date[3]=this.values[this.index]+=tt,this.index++)},HH24:function(tt,nr){parseInt(tt)>=0&&parseInt(tt)<10&&(this.values[this.index]==null||this.values[this.index]==""?parseInt(tt)>2&&parseInt(tt)<10?(nr&&(tt=0+tt),this.date[3]=this.values[this.index]=tt,this.index++):parseInt(tt)<10&&(this.values[this.index]=tt):this.values[this.index]==2&&parseInt(tt)<4?(this.date[3]=this.values[this.index]+=tt,this.index++):this.values[this.index]<2&&parseInt(tt)<10&&(this.date[3]=this.values[this.index]+=tt,this.index++))},HH:function(tt){Mr.HH24.call(this,tt,1)},H:function(tt){Mr.HH24.call(this,tt,0)},"\\[H\\]":function(tt){this.values[this.index]==null&&(this.values[this.index]=""),tt.match(/[0-9]/g)?this.date[3]=this.values[this.index]+=tt:this.values[this.index].match(/[0-9]/g)&&(this.date[3]=this.values[this.index],this.index++,this.position--)},N60:function(tt,nr){this.values[this.index]==null||this.values[this.index]==""?parseInt(tt)>5&&parseInt(tt)<10?(this.date[nr]=this.values[this.index]="0"+tt,this.index++):parseInt(tt)<10&&(this.values[this.index]=tt):parseInt(tt)<10&&(this.date[nr]=this.values[this.index]+=tt,this.index++)},MI:function(tt){Mr.N60.call(this,tt,4)},SS:function(tt){Mr.N60.call(this,tt,5)},"AM/PM":function(tt){this.values[this.index]="",tt&&(this.date[3]>12?this.values[this.index]="PM":this.values[this.index]="AM"),this.index++},WD:function(tt){typeof this.values[this.index]=="undefined"&&(this.values[this.index]=""),parseInt(tt)>=0&&parseInt(tt)<7&&(this.values[this.index]=tt),this.value[this.index].length==1&&this.index++},"0{1}(.{1}0+)?":function(tt){var nr=g.call(this),sr=!1;u(this.values[this.index])?this.values[this.index]="":this.values[this.index]=="-"&&(sr=!0);var Rr=b.call(this,this.values[this.index],nr);Rr&&(this.values[this.index]=Rr.join(nr)),parseInt(tt)>=0&&parseInt(tt)<10?(this.values[this.index]!="0"||tt==nr)&&(this.values[this.index]+=tt):nr&&tt==nr?this.values[this.index].indexOf(nr)==-1&&(this.values[this.index]||(this.values[this.index]="0"),this.values[this.index]+=tt):tt=="-"&&(sr=!0),sr===!0&&this.values[this.index][0]!=="-"&&(this.values[this.index]="-"+this.values[this.index])},"0{1}(.{1}0+)?%":function(tt){Mr["0{1}(.{1}0+)?"].call(this,tt),this.values[this.index].match(/[\-0-9]/g)?this.values[this.index]&&this.values[this.index].indexOf("%")==-1&&(this.values[this.index]+="%"):this.values[this.index]=""},"#(.{1})##0?(.{1}0+)?( ?;(.*)?)?":function(tt){Mr["0{1}(.{1}0+)?"].call(this,tt);var nr=g.call(this),sr=this.tokens[this.index].substr(1,1),Rr=this.values[this.index][0]==="-",Ar=b.call(this,this.values[this.index],nr);if(Ar!==""){var Or=Ar[0].match(/[0-9]/g);if(Or){Or=Or.join("");for(var qr=[],ni=0,Xr=Or.length-1;Xr>=0;Xr--)qr.push(Or[Xr]),ni++,ni%3||qr.push(sr);qr=qr.reverse(),Ar[0]=qr.join(""),Ar[0].substr(0,1)==sr&&(Ar[0]=Ar[0].substr(1))}else Ar[0]="";this.values[this.index]=Ar.join(nr),Rr&&(this.values[this.index]="-"+this.values[this.index])}},"0":function(tt){tt.match(/[0-9]/g)&&(this.values[this.index]=tt,this.index++)},"[0-9a-zA-Z$]+":function(tt){u(this.values[this.index])&&(this.values[this.index]="");var nr=this.tokens[this.index],sr=this.values[this.index],Rr=sr.length;nr[Rr]==tt?(this.values[this.index]+=tt,this.values[this.index]==nr&&this.index++):(this.values[this.index]=nr,this.index++,tt.match(/[\-0-9]/g)&&this.position--)},A:function(tt){tt.match(/[a-zA-Z]/gi)&&(this.values[this.index]=tt,this.index++)},".":function(tt){Mr["[0-9a-zA-Z$]+"].call(this,tt)}},Br=function(tt){if(this.type=="general")var nr=[].concat(a.general);else var nr=[].concat(a.currency,a.datetime,a.percentage,a.numeric,a.general);var sr=new RegExp(nr.join("|"),"gi");return tt.match(sr)},Qr=function(tt){if(this.type)if(this.type=="general")var nr=["general"];else if(this.type=="datetime")var nr=["numeric","datetime","general"];else var nr=["currency","percentage","numeric","general"];else var nr=Object.keys(a);for(var sr=0;sr<nr.length;sr++)for(var Rr=nr[sr],Ar=0;Ar<a[Rr].length;Ar++){var Or=new RegExp(a[Rr][Ar],"gi"),qr=tt.match(Or);if(qr)return{type:Rr,method:a[Rr][Ar]}}},ii=function(tt){for(var nr=[],sr=0;sr<tt.length;sr++){var Rr=Qr.call(this,tt[sr]);Rr?nr.push(Rr.method):nr.push(null)}for(var sr=0;sr<nr.length;sr++)nr[sr]=="MM"&&(nr[sr-1]&&nr[sr-1].indexOf("H")>=0||nr[sr-2]&&nr[sr-2].indexOf("H")>=0||nr[sr+1]&&nr[sr+1].indexOf("S")>=0||nr[sr+2]&&nr[sr+2].indexOf("S")>=0)&&(nr[sr]="MI");return nr},Ir=function(tt){var nr=Qr.call(this,tt);if(nr)var sr=nr.type;if(sr){for(var Rr=0,Ar=Br.call(this,tt),Or=0;Or<Ar.length;Or++)nr=Qr.call(this,Ar[Or]),nr&&h(nr.type)&&Rr++;Rr>1&&(sr="general")}return sr},gt=function(){typeof Mr[this.methods[this.index]]=="function"?(Mr[this.methods[this.index]].call(this,this.value[this.position]),this.position++):(this.values[this.index]=this.tokens[this.index],this.index++)},f=function(tt){var nr=(""+tt)[0];return nr=="="},tr=function(tt){return(""+ +tt).replace(/(-?)(\d*)\.?(\d*)e([+-]\d+)/,function(nr,sr,Rr,Ar,Or){return Or<0?sr+"0."+Array(1-Or-Rr.length).join(0)+Rr+Ar:sr+Rr+Ar+Array(Or-Ar.length+1).join(0)})},br=function(tt,nr,sr){var Rr=null,Ar={input:null,value:null,options:{},values:[],index:0,position:0,date:[0,0,0,0,0,0],number:0};if(typeof tt=="object"){if(Ar.input=tt.target,Ar.value=rr.call(tt.target),Ar.caret=ot.call(tt.target),(Rr=tt.target.getAttribute("data-mask"))&&(Ar.mask=Rr),(Rr=tt.target.getAttribute("data-type"))&&(Ar.type=Rr),tt.target.mask?(tt.target.mask.options&&(Ar.options=tt.target.mask.options),tt.target.mask.locale&&(Ar.locale=tt.target.mask.locale)):(Rr=tt.target.getAttribute("data-locale"))&&(Ar.locale=Rr,Ar.mask&&(Ar.options.style=Ar.mask)),tt.target.attributes&&tt.target.attributes.length)for(var Or=0;Or<tt.target.attributes.length;Or++){var qr=tt.target.attributes[Or].name,ni=tt.target.attributes[Or].value;qr.substr(0,4)=="data"&&(Ar.options[qr.substr(5)]=ni)}}else{if(typeof nr=="string")Ar.mask=nr;else for(var qr=Object.keys(nr),Or=0;Or<qr.length;Or++)Ar[qr[Or]]=nr[qr[Or]];typeof tt=="number"&&(g.call(Ar,Ar.mask),tt=(""+tt).replace(".",Ar.options.decimal)),Ar.value=tt,Ar.input&&(rr.call(Ar.input,tt),s.focus(Ar.input),Ar.caret=ot.call(Ar.input))}if(!f(Ar.value)&&(Ar.mask||Ar.locale)){if(Ar.mask){if(Ar.mask=Ar.mask.replace("[-]",""),Ar.mask.indexOf("##")!==-1){var Xr=Ar.mask.split(";");Xr[0]&&(Xr[0]=Xr[0].replace("*",""),Xr[0]=Xr[0].replace(/_/g,""),Xr[0]=Xr[0].replace(/-/g,""),Xr[0]=Xr[0].replace("(",""),Xr[0]=Xr[0].replace(")",""),Xr[0]=Xr[0].replace("##0.###","##0.000"),Xr[0]=Xr[0].replace("##0.##","##0.00"),Xr[0]=Xr[0].replace("##0.#","##0.0")),Ar.mask=Xr[0]}Ar.type||(Ar.type=Ir.call(Ar,Ar.mask)),Ar.tokens=Br.call(Ar,Ar.mask)}if(typeof tt!="object"||!tt.inputType||tt.inputType=="insertText"||tt.inputType=="insertFromPaste")if(Ar.locale)if(Ar.input)_.call(Ar,Ar.input);else var ui=m.call(Ar,Ar.value);else{for(Ar.methods=ii.call(Ar,Ar.tokens);Ar.position<Ar.value.length&&typeof Ar.tokens[Ar.index]!="undefined";)gt.call(Ar);if(h(Ar.type)){for(;typeof Ar.tokens[Ar.index]!="undefined";){var Rr=Qr.call(Ar,Ar.tokens[Ar.index]);Rr&&Rr.type=="general"&&(Ar.values[Ar.index]=Ar.tokens[Ar.index]),Ar.index++}var Kr=!0}else var Kr=!1;var ui=Ar.values.join("");if(Ar.input){if(Rr=ui.length-Ar.value.length,Rr>0)var ei=Ar.caret+Rr;else var ei=Ar.caret;rr.call(Ar.input,ui,ei,Kr)}}if(Ar.input){var or=null;h(Ar.type)?(Ar.number=Ge.call(Ar,rr.call(Ar.input)),Ar.type=="percentage"?or=Ar.number/100:or=Ar.number):Ar.type=="datetime"&&(or=d.call(Ar),Ar.date[0]&&Ar.date[1]&&Ar.date[2]&&Ar.input.setAttribute("data-completed",!0)),or&&Ar.input.setAttribute("data-value",or)}if(ui!==void 0)return sr?Ar:ui}};return br.prepare=function(tt,nr){return nr||(nr={}),Br.call(nr,tt)},br.apply=function(tt){var nr=rr.call(tt.target);tt.key.length==1&&(nr+=tt.key),rr.call(tt.target,br(nr,tt.target.getAttribute("data-mask")))},br.run=function(tt,nr,sr){return br(tt,{mask:nr,decimal:sr})},br.extract=function(tt,nr,sr){if(u(tt))return tt;if(typeof nr!="object")return qr;nr.options||(nr.options={}),!nr.mask&&nr.format&&(nr.mask=nr.format),g.call(nr,nr.mask);var Rr=null;if(nr.type=="percent"||nr.options.style=="percent"?Rr="percentage":nr.mask&&(Rr=Ir.call(nr,nr.mask)),Rr==="datetime"){if(tt instanceof Date)var Ar=s.calendar.getDateString(qr,nr.mask);var Or=br(tt,nr,!0),qr=d.call(Or);if(Or.date[0]&&Or.date[1]&&Or.date[2]&&!(Or.date[3]||Or.date[4]||Or.date[5])){var Ar=s.calendar.now(Or.date);qr=s.calendar.dateToNum(Ar)}}else{var qr=Ge.call(nr,tt);Rr=="percentage"&&(qr/=100);var Or=nr}return Or.value=qr,sr?Or:qr},br.render=function(tt,nr,sr){if(u(tt)||typeof nr!="object")return tt;nr.options||(nr.options={}),!nr.mask&&nr.format&&(nr.mask=nr.format);var Rr=null;nr.type=="percent"||nr.options.style=="percent"?Rr="percentage":nr.mask?Rr=Ir.call(nr,nr.mask):tt instanceof Date&&(Rr="datetime");var Ar=!1;if(Rr=="datetime"||nr.type=="calendar"){var Or=s.calendar.getDateString(tt,nr.mask);Or&&(tt=Or),nr.mask&&sr&&(Ar=!0)}else if(Rr=="percentage"&&(tt*=100),typeof tt=="number"){var Or=null;if(nr.mask&&sr){var qr=new RegExp("0{1}(.{1})0+","ig"),ni=nr.mask.match(qr);ni&&ni[0]?(ni=ni[0].length-2,Or=tt.toFixed(ni)):Or=tt.toFixed(0)}else if(nr.locale&&sr){var ni=(""+tt).split(".");if(nr.options){typeof ni[1]=="undefined"&&(ni[1]="");var ui=ni[1].length;if(nr.options.minimumFractionDigits>ui)for(var Xr=0;Xr<nr.options.minimumFractionDigits-ui;Xr++)ni[1]+="0"}ni[1].length?Or=ni.join("."):Or=ni[0];var ui=ni[1].length;nr.options&&nr.options.maximumFractionDigits<ui&&(Or=parseFloat(Or).toFixed(nr.options.maximumFractionDigits))}else Or=tr(tt);Or!==null&&(tt=Or,g.call(nr,nr.mask),nr.options.decimal&&(tt=tt.replace(".",nr.options.decimal)))}else nr.mask&&sr&&(Ar=!0);if(Ar){var Kr=nr.mask.length-tt.length;if(Kr>0)for(var Xr=0;Xr<Kr;Xr++)tt+=" "}return tt=br(tt,nr),tt},br.set=function(tt,nr){if(nr){tt.setAttribute("data-mask",nr);var sr=new Event("input",{bubbles:!0,cancelable:!0});tt.dispatchEvent(sr)}},typeof document!="undefined"&&document.addEventListener("input",function(tt){(tt.target.getAttribute("data-mask")||tt.target.mask)&&br(tt)}),br}(),s.modal=function(a,d){var u={};u.options={};var f={url:null,onopen:null,onclose:null,closed:!1,width:null,height:null,title:null,padding:null,backdrop:!0};for(var h in f)d&&d.hasOwnProperty(h)?u.options[h]=d[h]:u.options[h]=f[h];!u.options.title&&a.getAttribute("title")&&(u.options.title=a.getAttribute("title"));for(var g=document.createElement("div");a.children[0];)g.appendChild(a.children[0]);for(u.content=document.createElement("div"),u.content.className="jmodal_content",u.content.innerHTML=a.innerHTML;g.children[0];)u.content.appendChild(g.children[0]);if(u.container=document.createElement("div"),u.container.className="jmodal",u.container.appendChild(u.content),u.options.padding&&(u.content.style.padding=u.options.padding),u.options.width&&(u.container.style.width=u.options.width),u.options.height&&(u.container.style.height=u.options.height),u.options.title?u.container.setAttribute("title",u.options.title):u.container.classList.add("no-title"),a.innerHTML="",a.style.display="none",a.appendChild(u.container),u.options.backdrop){var b=document.createElement("div");b.className="jmodal_backdrop",b.onclick=function(){u.close()},a.appendChild(b)}if(u.open=function(){a.style.display="block";var _=u.container.getBoundingClientRect();s.getWindowWidth()<_.width?(u.container.style.top="",u.container.style.left="",u.container.classList.add("jmodal_fullscreen"),s.animation.slideBottom(u.container,1)):u.options.backdrop&&(b.style.display="block"),typeof u.options.onopen=="function"&&u.options.onopen(a,u)},u.resetPosition=function(){u.container.style.top="",u.container.style.left=""},u.isOpen=function(){return a.style.display!="none"},u.close=function(){a.style.display="none",u.options.backdrop&&(b.style.display=""),u.container.classList.remove("jmodal_fullscreen"),typeof u.options.onclose=="function"&&u.options.onclose(a,u)},!s.modal.hasEvents){var m=null;document.addEventListener("keydown",function(_){if(_.which==27)for(var Ge=document.querySelectorAll(".jmodal"),ot=0;ot<Ge.length;ot++)Ge[ot].parentNode.modal.close()}),document.addEventListener("mouseup",function(_){m&&(m.element.style.cursor="auto",m=null)}),document.addEventListener("mousedown",function(_){var Ge=s.findElement(_.target,"jmodal");if(Ge){var ot=Ge.getBoundingClientRect();if(_.changedTouches&&_.changedTouches[0])var rr=_.changedTouches[0].clientX,ir=_.changedTouches[0].clientY;else var rr=_.clientX,ir=_.clientY;ot.width-(rr-ot.left)<50&&ir-ot.top<50?Ge.parentNode.modal.close():_.target.getAttribute("title")&&ir-ot.top<50&&(document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),m={left:ot.left,top:ot.top,x:_.clientX,y:_.clientY,width:ot.width,height:ot.height,element:Ge})}}),document.addEventListener("mousemove",function(_){if(m){if(_=_||window.event,_.buttons)var Ge=_.buttons;else if(_.button)var Ge=_.button;else var Ge=_.which;Ge?(m.element.style.top=m.top+(_.clientY-m.y)+m.height/2+"px",m.element.style.left=m.left+(_.clientX-m.x)+m.width/2+"px",m.element.style.cursor="move"):m.element.style.cursor="auto"}}),s.modal.hasEvents=!0}return u.options.url?s.ajax({url:u.options.url,method:"GET",dataType:"text/html",success:function(_){u.content.innerHTML=_,u.options.closed||u.open()}}):u.options.closed||u.open(),a.modal=u,u},s.notification=function(a){var d={};d.options={};var u={icon:null,name:"Notification",date:null,error:null,title:null,message:null,timeout:4e3,autoHide:!0,closeable:!0};for(var f in u)a&&a.hasOwnProperty(f)?d.options[f]=a[f]:d.options[f]=u[f];var h=document.createElement("div");h.className="jnotification",d.options.error&&h.classList.add("jnotification-error");var g=document.createElement("div");g.className="jnotification-container",h.appendChild(g);var b=document.createElement("div");b.className="jnotification-header",g.appendChild(b);var m=document.createElement("div");if(m.className="jnotification-image",b.appendChild(m),d.options.icon){var _=document.createElement("img");_.src=d.options.icon,m.appendChild(_)}var Ge=document.createElement("div");if(Ge.className="jnotification-name",Ge.innerHTML=d.options.name,b.appendChild(Ge),d.options.closeable==!0){var ot=document.createElement("div");ot.className="jnotification-close",ot.onclick=function(){d.hide()},b.appendChild(ot)}var rr=document.createElement("div");rr.className="jnotification-date",b.appendChild(rr);var ir=document.createElement("div");if(ir.className="jnotification-content",g.appendChild(ir),d.options.title){var er=document.createElement("div");er.className="jnotification-title",er.innerHTML=d.options.title,ir.appendChild(er)}var ar=document.createElement("div");if(ar.className="jnotification-message",ar.innerHTML=d.options.message,ir.appendChild(ar),d.show=function(){document.body.appendChild(h),s.getWindowWidth()>800?s.animation.fadeIn(h):s.animation.slideTop(h,1)},d.hide=function(){s.getWindowWidth()>800?s.animation.fadeOut(h,function(){h.parentNode&&(h.parentNode.removeChild(h),Lr&&clearTimeout(Lr))}):s.animation.slideTop(h,0,function(){h.parentNode&&(h.parentNode.removeChild(h),Lr&&clearTimeout(Lr))})},d.show(),d.options.autoHide==!0)var Lr=setTimeout(function(){d.hide()},d.options.timeout);return s.getWindowWidth()<800&&h.addEventListener("swipeup",function(Mr){d.hide(),Mr.preventDefault(),Mr.stopPropagation()}),d},s.notification.isVisible=function(){var a=document.querySelector(".jnotification");return!!(a&&a.parentNode)},s.palette=function(){var a={material:[["#ffebee","#fce4ec","#f3e5f5","#e8eaf6","#e3f2fd","#e0f7fa","#e0f2f1","#e8f5e9","#f1f8e9","#f9fbe7","#fffde7","#fff8e1","#fff3e0","#fbe9e7","#efebe9","#fafafa","#eceff1"],["#ffcdd2","#f8bbd0","#e1bee7","#c5cae9","#bbdefb","#b2ebf2","#b2dfdb","#c8e6c9","#dcedc8","#f0f4c3","#fff9c4","#ffecb3","#ffe0b2","#ffccbc","#d7ccc8","#f5f5f5","#cfd8dc"],["#ef9a9a","#f48fb1","#ce93d8","#9fa8da","#90caf9","#80deea","#80cbc4","#a5d6a7","#c5e1a5","#e6ee9c","#fff59d","#ffe082","#ffcc80","#ffab91","#bcaaa4","#eeeeee","#b0bec5"],["#e57373","#f06292","#ba68c8","#7986cb","#64b5f6","#4dd0e1","#4db6ac","#81c784","#aed581","#dce775","#fff176","#ffd54f","#ffb74d","#ff8a65","#a1887f","#e0e0e0","#90a4ae"],["#ef5350","#ec407a","#ab47bc","#5c6bc0","#42a5f5","#26c6da","#26a69a","#66bb6a","#9ccc65","#d4e157","#ffee58","#ffca28","#ffa726","#ff7043","#8d6e63","#bdbdbd","#78909c"],["#f44336","#e91e63","#9c27b0","#3f51b5","#2196f3","#00bcd4","#009688","#4caf50","#8bc34a","#cddc39","#ffeb3b","#ffc107","#ff9800","#ff5722","#795548","#9e9e9e","#607d8b"],["#e53935","#d81b60","#8e24aa","#3949ab","#1e88e5","#00acc1","#00897b","#43a047","#7cb342","#c0ca33","#fdd835","#ffb300","#fb8c00","#f4511e","#6d4c41","#757575","#546e7a"],["#d32f2f","#c2185b","#7b1fa2","#303f9f","#1976d2","#0097a7","#00796b","#388e3c","#689f38","#afb42b","#fbc02d","#ffa000","#f57c00","#e64a19","#5d4037","#616161","#455a64"],["#c62828","#ad1457","#6a1b9a","#283593","#1565c0","#00838f","#00695c","#2e7d32","#558b2f","#9e9d24","#f9a825","#ff8f00","#ef6c00","#d84315","#4e342e","#424242","#37474f"],["#b71c1c","#880e4f","#4a148c","#1a237e","#0d47a1","#006064","#004d40","#1b5e20","#33691e","#827717","#f57f17","#ff6f00","#e65100","#bf360c","#3e2723","#212121","#263238"]],fire:[["0b1a6d","840f38","b60718","de030b","ff0c0c","fd491c","fc7521","faa331","fbb535","ffc73a"],["071147","5f0b28","930513","be0309","ef0000","fa3403","fb670b","f9991b","faad1e","ffc123"],["03071e","370617","6a040f","9d0208","d00000","dc2f02","e85d04","f48c06","faa307","ffba08"],["020619","320615","61040d","8c0207","bc0000","c82a02","d05203","db7f06","e19405","efab00"],["020515","2d0513","58040c","7f0206","aa0000","b62602","b94903","c57205","ca8504","d89b00"]],baby:[["eddcd2","fff1e6","fde2e4","fad2e1","c5dedd","dbe7e4","f0efeb","d6e2e9","bcd4e6","99c1de"],["e1c4b3","ffd5b5","fab6ba","f5a8c4","aacecd","bfd5cf","dbd9d0","baceda","9dc0db","7eb1d5"],["daa990","ffb787","f88e95","f282a9","8fc4c3","a3c8be","cec9b3","9dbcce","82acd2","649dcb"],["d69070","ff9c5e","f66770","f05f8f","74bbb9","87bfae","c5b993","83aac3","699bca","4d89c2"],["c97d5d","f58443","eb4d57","e54a7b","66a9a7","78ae9c","b5a67e","7599b1","5c88b7","4978aa"]],chart:[["#C1D37F","#4C5454","#FFD275","#66586F","#D05D5B","#C96480","#95BF8F","#6EA240","#0F0F0E","#EB8258","#95A3B3","#995D81"]]},d=function(u){return a[u]?a[u]:a.material};return d.get=function(u){return a[u]?a[u]:a},d.set=function(u,f){a[u]=f},d}(),s.picker=function(a,d){if(a.picker)return a.picker.setOptions(d,!0);var u={type:"picker"};u.options={};var f=null,h=null,g=function(){h.innerHTML="";for(var m=Object.keys(u.options.data),_=0;_<m.length;_++){var Ge=document.createElement("div");Ge.classList.add("jpicker-item"),Ge.k=m[_],Ge.v=u.options.data[m[_]],Ge.innerHTML=u.getLabel(m[_]),h.appendChild(Ge)}};u.setOptions=function(m,_){var Ge={value:0,data:null,render:null,onchange:null,onselect:null,onopen:null,onclose:null,onload:null,width:null,header:!0,right:!1,content:!1,columns:null,height:null};m&&m.options&&(m.data=m.options);for(var ot in Ge)m&&m.hasOwnProperty(ot)?u.options[ot]=m[ot]:(typeof u.options[ot]=="undefined"||_===!0)&&(u.options[ot]=Ge[ot]);return u.options.header===!1?f.style.display="none":f.style.display="",u.options.width?f.style.width=parseInt(u.options.width)+"px":f.style.width="",u.options.height?(h.style.maxHeight=u.options.height+"px",h.style.overflow="scroll"):h.style.overflow="",u.options.columns>0&&(h.classList.add("jpicker-columns"),h.style.width=u.options.width?u.options.width:36*u.options.columns+"px"),isNaN(u.options.value)&&(u.options.value="0"),g(),u.setValue(u.options.value),u},u.getValue=function(){return u.options.value},u.setValue=function(m){u.setLabel(m),u.options.value=String(m),a.value!=u.options.value&&(a.value=u.options.value,typeof a.oninput=="function"&&a.oninput({type:"input",target:a,value:a.value})),h.children[m].getAttribute("type")!=="generic"&&u.close()},u.getLabel=function(m){var _=u.options.data[m]||null;return typeof u.options.render=="function"&&(_=u.options.render(_)),_},u.setLabel=function(m){if(u.options.content)var _='<i class="material-icons">'+u.options.content+"</i>";else var _=u.getLabel(m);f.innerHTML=_},u.open=function(){if(!a.classList.contains("jpicker-focus")){s.tracking(u,!0),a.classList.add("jpicker-focus"),a.focus();var m=0,_=0;h.style.marginLeft="";var Ge=f.getBoundingClientRect(),ot=h.getBoundingClientRect();window.innerHeight<Ge.bottom+ot.height?m=-1*(ot.height+4):m=Ge.height+4,u.options.right===!0&&(_=-1*ot.width+Ge.width),ot.left+_<0&&(_=_+ot.left+10),ot.left+ot.width>window.innerWidth&&(_=-1*(10+ot.left+ot.width-window.innerWidth)),h.style.marginTop=parseInt(m)+"px",h.style.marginLeft=parseInt(_)+"px",typeof u.options.onopen=="function"&&u.options.onopen(a,u)}},u.close=function(){a.classList.contains("jpicker-focus")&&(a.classList.remove("jpicker-focus"),s.tracking(u,!1),typeof u.options.onclose=="function"&&u.options.onclose(a,u))};var b=function(){a.classList.add("jpicker"),a.setAttribute("tabindex","900"),a.onmousedown=function(m){a.classList.contains("jpicker-focus")||u.open()},f=document.createElement("div"),f.classList.add("jpicker-header"),h=document.createElement("div"),h.classList.add("jpicker-content"),h.onclick=function(m){var _=s.findElement(m.target,"jpicker-item");_&&_.parentNode===h&&(u.setValue(_.k),typeof u.options.onchange=="function"&&u.options.onchange.call(u,a,u,_.v,_.v,_.k))},a.appendChild(f),a.appendChild(h),a.value=d.value||0,u.setOptions(d),typeof u.options.onload=="function"&&u.options.onload(a,u),a.change=u.setValue,a.val=function(m){if(m===void 0)return u.getValue();u.setValue(m)},a.picker=u};return b(),u},s.progressbar=function(a,d){var u={};u.options={};var f={value:0,onchange:null,width:null};for(var h in f)d&&d.hasOwnProperty(h)?u.options[h]=d[h]:u.options[h]=f[h];a.classList.add("jprogressbar"),a.setAttribute("tabindex",1),a.setAttribute("data-value",u.options.value);var g=document.createElement("div");g.style.width=u.options.value+"%",g.style.color="#fff",a.appendChild(g),u.options.width&&(a.style.width=u.options.width),u.setValue=function(m){m=parseInt(m),u.options.value=m,g.style.width=m+"%",a.setAttribute("data-value",m+"%"),m<6?a.style.color="#000":a.style.color="#fff",u.options.value=m,typeof u.options.onchange=="function"&&u.options.onchange(a,m),a.value!=u.options.value&&(a.value=u.options.value,typeof a.oninput=="function"&&a.oninput({type:"input",target:a,value:a.value}))},u.getValue=function(){return u.options.value};var b=function(m){if(m.which){var _=a.getBoundingClientRect();if(m.changedTouches&&m.changedTouches[0]){var Ge=m.changedTouches[0].clientX;m.changedTouches[0].clientY}else{var Ge=m.clientX;m.clientY}u.setValue(Math.round((Ge-_.left)/_.width*100))}};return"touchstart"in document.documentElement?(a.addEventListener("touchstart",b),a.addEventListener("touchend",b)):(a.addEventListener("mousedown",b),a.addEventListener("mousemove",b)),a.change=u.setValue,a.val=function(m){if(m===void 0)return u.getValue();u.setValue(m)},a.progressbar=u,u},s.rating=function(a,d){if(a.rating)return a.rating.setOptions(d,!0);var u={};u.options={},u.setOptions=function(h,g){var b={number:5,value:0,tooltip:["Very bad","Bad","Average","Good","Very good"],onchange:null};for(var m in b)h&&h.hasOwnProperty(m)?u.options[m]=h[m]:(typeof u.options[m]=="undefined"||g===!0)&&(u.options[m]=b[m]);a.innerHTML="";for(var _=0;_<u.options.number;_++){var Ge=document.createElement("div");Ge.setAttribute("data-index",_+1),Ge.setAttribute("title",u.options.tooltip[_]),a.appendChild(Ge)}if(u.options.value)for(var _=0;_<u.options.number;_++)_<u.options.value&&a.children[_].classList.add("jrating-selected");return u},u.setValue=function(h){for(var g=0;g<u.options.number;g++)g<h?a.children[g].classList.add("jrating-selected"):(a.children[g].classList.remove("jrating-over"),a.children[g].classList.remove("jrating-selected"));u.options.value=h,typeof u.options.onchange=="function"&&u.options.onchange(a,h),a.value!=u.options.value&&(a.value=u.options.value,typeof a.oninput=="function"&&a.oninput({type:"input",target:a,value:a.value}))},u.getValue=function(){return u.options.value};var f=function(){u.setOptions(d),a.classList.add("jrating"),a.addEventListener("click",function(h){var g=h.target.getAttribute("data-index");g!=null&&(g==u.options.value?u.setValue(0):u.setValue(g))}),a.addEventListener("mouseover",function(h){for(var g=h.target.getAttribute("data-index"),b=0;b<u.options.number;b++)b<g?a.children[b].classList.add("jrating-over"):a.children[b].classList.remove("jrating-over")}),a.addEventListener("mouseout",function(h){for(var g=0;g<u.options.number;g++)a.children[g].classList.remove("jrating-over")}),a.change=u.setValue,a.val=function(h){if(h===void 0)return u.getValue();u.setValue(h)},a.rating=u};return f(),u},s.search=function(a,d){if(a.search)return a.search;var u=null,f=function(Ge){if(Ge.target.classList.contains("jsearch_item"))var ot=Ge.target;else var ot=Ge.target.parentNode;m.selectIndex(ot),Ge.preventDefault()},h=function(Ge){if(_.innerHTML="",!Ge.length)a.style.display="";else{a.style.display="block";for(var ot=Ge.length<11?Ge.length:10,rr=0;rr<ot;rr++){if(typeof Ge[rr]=="string")var ir=Ge[rr],er=Ge[rr];else{var ir=Ge[rr].text;!ir&&Ge[rr].name&&(ir=Ge[rr].name);var er=Ge[rr].value;!er&&Ge[rr].id&&(er=Ge[rr].id)}var ar=document.createElement("div");ar.setAttribute("data-value",er),ar.setAttribute("data-text",ir),ar.className="jsearch_item",Ge[rr].id&&ar.setAttribute("id",Ge[rr].id),m.options.forceSelect&&rr==0&&ar.classList.add("selected");var Lr=document.createElement("img");Ge[rr].image?Lr.src=Ge[rr].image:Lr.style.display="none",ar.appendChild(Lr);var Mr=document.createElement("div");Mr.innerHTML=ir,ar.appendChild(Mr),_.appendChild(ar)}}},g=function(Ge){if(Ge!=m.terms)if(m.terms=Ge,m.options.forceSelect?u=0:u=null,Array.isArray(m.options.data)){var ot=function(ir){if(typeof ir=="string"){if((""+ir).toLowerCase().search(Ge.toLowerCase())>=0)return!0}else for(var er in ir){var ar=ir[er];if((""+ar).toLowerCase().search(Ge.toLowerCase())>=0)return!0}return!1},rr=m.options.data.filter(function(ir){return ot(ir)});h(rr)}else s.ajax({url:m.options.data+Ge,method:"GET",dataType:"json",success:function(ir){h(ir)}})},b=null,m=function(Ge){b&&clearTimeout(b),b=setTimeout(function(){g(Ge)},500)};d.forceSelect===null&&(d.forceSelect=!0),m.options={data:d.data||null,input:d.input||null,onselect:d.onselect||null,forceSelect:d.forceSelect},m.selectIndex=function(Ge){var ot=Ge.getAttribute("id"),rr=Ge.getAttribute("data-text"),ir=Ge.getAttribute("data-value");typeof m.options.onselect=="function"&&m.options.onselect(m,rr,ir,ot),m.close()},m.open=function(){a.style.display="block"},m.close=function(){b&&clearTimeout(b),m.terms="",_.innerHTML="",a.style.display=""},m.isOpened=function(){return!!a.style.display},m.keydown=function(Ge){m.isOpened()&&(Ge.key=="Enter"?u!==null&&_.children[u]?(m.selectIndex(_.children[u]),Ge.preventDefault()):m.close():Ge.key==="ArrowUp"?(u!==null&&_.children[0]&&(_.children[u].classList.remove("selected"),!m.options.forceSelect&&u===0?u=null:(u=Math.max(0,u-1),_.children[u].classList.add("selected"))),Ge.preventDefault()):Ge.key==="ArrowDown"&&(u==null?u=-1:_.children[u].classList.remove("selected"),u<9&&_.children[u+1]&&u++,_.children[u].classList.add("selected"),Ge.preventDefault()))},m.keyup=function(Ge){if(m.options.input)m(m.options.input.value);else{var ot=s.getNode();ot&&m(ot.innerText)}},m.options.input&&(m.options.input.addEventListener("keyup",m.keyup),m.options.input.addEventListener("keydown",m.keydown));var _=document.createElement("div");return _.classList.add("jsearch_container"),_.onmousedown=f,a.appendChild(_),a.classList.add("jsearch"),a.search=m,m},s.slider=function(a,d){var u={};if(u.options={},u.currentImage=null,d&&(u.options=d),a.setAttribute("tabindex","900"),u.options.items=[],!a.classList.contains("jslider")){if(a.classList.add("jslider"),a.classList.add("unselectable"),u.options.height&&(a.style.minHeight=u.options.height),u.options.width&&(a.style.width=u.options.width),u.options.grid){a.classList.add("jslider-grid");var f=a.children.length;f>4&&a.setAttribute("data-total",f-4),a.setAttribute("data-number",f>4?4:f)}var h=document.createElement("div");if(h.classList.add("jslider-counter"),a.children.length>0)for(var g=0;g<a.children.length;g++){u.options.items.push(a.children[g]);var b=document.createElement("div");b.onclick=function(){var rr=Array.prototype.slice.call(h.children).indexOf(this);u.show(u.currentImage=u.options.items[rr])},h.appendChild(b)}var m=document.createElement("div");m.className="jslider-caption";var _=document.createElement("div"),Ge=document.createElement("div");Ge.className="jslider-close",Ge.innerHTML="",Ge.onclick=function(){u.close()},_.appendChild(m),_.appendChild(Ge)}u.updateCounter=function(rr){for(var ir=0;ir<h.children.length;ir++)if(h.children[ir].classList.contains("jslider-counter-focus")){h.children[ir].classList.remove("jslider-counter-focus");break}h.children[rr].classList.add("jslider-counter-focus")},u.show=function(rr){if(!rr)var rr=a.children[0];a.classList.add("jslider-focus"),a.classList.remove("jslider-grid"),a.appendChild(_),a.appendChild(h);var ir=u.options.items.indexOf(rr);u.updateCounter(ir);for(var er=0;er<a.children.length;er++)a.children[er].style.display="";rr.style.display="block",rr.previousElementSibling?a.classList.add("jslider-left"):a.classList.remove("jslider-left"),rr.nextElementSibling&&rr.nextElementSibling.tagName=="IMG"?a.classList.add("jslider-right"):a.classList.remove("jslider-right"),u.currentImage=rr,u.currentImage.offsetHeight>u.currentImage.offsetWidth&&u.currentImage.classList.add("jslider-vertical"),_.children[0].innerText=u.currentImage.getAttribute("title")},u.open=function(){u.show(),typeof u.options.onopen=="function"&&u.options.onopen(a)},u.close=function(){a.classList.remove("jslider-focus"),a.classList.remove("jslider-left"),a.classList.remove("jslider-right"),u.options.grid&&a.classList.add("jslider-grid");for(var rr=0;rr<a.children.length;rr++)a.children[rr].style.display="";h.remove(),_.remove(),u.currentImage=null,typeof u.options.onclose=="function"&&u.options.onclose(a)},u.reset=function(){a.innerHTML=""},u.next=function(){var rr=u.currentImage.nextElementSibling;rr&&rr.tagName==="IMG"&&u.show(u.currentImage.nextElementSibling)},u.prev=function(){u.currentImage.previousElementSibling&&u.show(u.currentImage.previousElementSibling)};var ot=function(rr){if(rr.target.tagName=="IMG")u.show(rr.target);else if(!rr.target.classList.contains("jslider-close")&&!(rr.target.parentNode.classList.contains("jslider-counter")||rr.target.classList.contains("jslider-counter"))){var ir=rr.offsetX||rr.changedTouches[0].clientX;rr.target.clientWidth-ir<40?u.next():ir<40&&u.prev()}};return"ontouchend"in document.documentElement?a.addEventListener("touchend",ot):a.addEventListener("mouseup",ot),a.addEventListener("swipeleft",function(rr){u.next(),rr.preventDefault(),rr.stopPropagation()}),a.addEventListener("swiperight",function(rr){u.prev(),rr.preventDefault(),rr.stopPropagation()}),a.addEventListener("keydown",function(rr){rr.which==27&&u.close()}),a.slider=u,u},s.sorting=function(a,d){var u={};u.options={};var f={pointer:null,direction:null,ondragstart:null,ondragend:null,ondrop:null},h=null;for(var g in f)d&&d.hasOwnProperty(g)?u.options[g]=d[g]:u.options[g]=f[g];a.classList.add("jsorting"),a.addEventListener("dragstart",function(_){var Ge=Array.prototype.indexOf.call(_.target.parentNode.children,_.target);h={element:_.target,o:Ge,d:Ge},_.target.style.opacity="0.25",typeof u.options.ondragstart=="function"&&u.options.ondragstart(a,_.target,_)}),a.addEventListener("dragover",function(_){if(_.preventDefault(),b(_.target)&&h&&_.target.getAttribute("draggable")=="true"&&h.element!=_.target){if(u.options.direction)var Ge=_.target.clientWidth/2>_.offsetX;else var Ge=_.target.clientHeight/2>_.offsetY;Ge?_.target.parentNode.insertBefore(h.element,_.target):_.target.parentNode.insertBefore(h.element,_.target.nextSibling),h.d=Array.prototype.indexOf.call(_.target.parentNode.children,h.element)}}),a.addEventListener("dragleave",function(_){_.preventDefault()}),a.addEventListener("dragend",function(_){_.preventDefault(),h&&(typeof u.options.ondragend=="function"&&u.options.ondragend(a,h.element,_),h.o<h.d?_.target.parentNode.insertBefore(h.element,_.target.parentNode.children[h.o]):_.target.parentNode.insertBefore(h.element,_.target.parentNode.children[h.o].nextSibling),h.element.style.opacity="",h=null)}),a.addEventListener("drop",function(_){_.preventDefault(),h&&h.o!=h.d&&typeof u.options.ondrop=="function"&&u.options.ondrop(a,h.o,h.d,h.element,_.target,_),h.element.style.opacity="",h=null});for(var b=function(_){var Ge=!1;function ot(rr){rr.className&&rr.classList.contains("jsorting")&&(Ge=!0),Ge||ot(rr.parentNode)}return ot(_),Ge},m=0;m<a.children.length;m++)a.children[m].hasAttribute("draggable")||a.children[m].setAttribute("draggable","true");return a.val=function(){for(var _=null,Ge=[],ot=0;ot<a.children.length;ot++)(_=a.children[ot].getAttribute("data-id"))&&Ge.push(_);return Ge},a},s.tabs=function(a,d){var u={};u.options={};var f={data:[],position:null,allowCreate:!1,allowChangePosition:!1,onclick:null,onload:null,onchange:null,oncreate:null,ondelete:null,onbeforecreate:null,onchangeposition:null,animation:!1,hideHeaders:!1,padding:null,palette:null,maxWidth:null};for(var h in f)d&&d.hasOwnProperty(h)?u.options[h]=d[h]:u.options[h]=f[h];a.classList.add("jtabs");var g=null,b=null,m=null,_=function(er){if(u.options.animation){var ar=u.headers.children[er].getBoundingClientRect();u.options.palette=="modern"?(m.style.width=ar.width-4+"px",m.style.left=u.headers.children[er].offsetLeft+2+"px"):(m.style.width=ar.width+"px",m.style.left=u.headers.children[er].offsetLeft+"px"),u.options.position=="bottom"?m.style.top="0px":m.style.bottom="0px"}},Ge=function(er){typeof u.headers.scrollTo=="function"?u.headers.scrollTo({left:er,behavior:"smooth"}):u.headers.scrollLeft=er,er<=1?g.classList.add("disabled"):g.classList.remove("disabled"),er>=u.headers.scrollWidth-u.headers.offsetWidth?b.classList.add("disabled"):b.classList.remove("disabled"),u.headers.scrollWidth<=u.headers.offsetWidth?(g.style.display="none",b.style.display="none"):(g.style.display="",b.style.display="")};if(u.setBorder=_,u.open=function(er){for(var ar=null,Lr=0;Lr<u.headers.children.length;Lr++)u.headers.children[Lr].classList.contains("jtabs-selected")&&(ar=Lr),u.headers.children[Lr].classList.remove("jtabs-selected"),u.content.children[Lr]&&u.content.children[Lr].classList.remove("jtabs-selected");if(u.headers.children[er].classList.add("jtabs-selected"),u.content.children[er]&&u.content.children[er].classList.add("jtabs-selected"),ar!=er&&typeof u.options.onchange=="function"&&u.content.children[er]&&u.options.onchange(a,u,er,u.headers.children[er],u.content.children[er]),u.options.hideHeaders==!0&&u.headers.children.length<3&&u.options.allowCreate==!1)u.headers.parentNode.style.display="none";else{_(er),u.headers.parentNode.style.display="";var Mr=u.headers.children[er].offsetLeft,Br=Mr+u.headers.children[er].offsetWidth,Qr=u.headers.scrollLeft,ii=Qr+u.headers.offsetWidth;Qr<=Mr&&ii>=Br||Ge(Mr-1)}},u.selectIndex=function(er){var ar=Array.prototype.indexOf.call(u.headers.children,er);return ar>=0&&u.open(ar),ar},u.rename=function(er,ar){ar||(ar=prompt("New title",u.headers.children[er].innerText)),u.headers.children[er].innerText=ar,u.open(er)},u.create=function(er,ar){if(typeof u.options.onbeforecreate=="function"){var Lr=u.options.onbeforecreate(a);if(Lr===!1)return!1;er=Lr}var Mr=u.appendElement(er);return typeof u.options.oncreate=="function"&&u.options.oncreate(a,Mr),Mr},u.remove=function(er){return u.deleteElement(er)},u.nextNumber=function(){for(var er=0,ar=0;ar<u.headers.children.length;ar++){var Lr=u.headers.children[ar].innerText.match(/[0-9].*/);Lr>er&&(er=parseInt(Lr))}return er?er++:er=1,er},u.deleteElement=function(er){if(u.headers.children[er])u.headers.removeChild(u.headers.children[er]),u.content.removeChild(u.content.children[er]);else return!1;u.open(0),typeof u.options.ondelete=="function"&&u.options.ondelete(a,er)},u.appendElement=function(er,ar){if(!er)var er=prompt("Title?","");if(er){var Lr=document.createElement("div");u.content.appendChild(Lr);var Mr=document.createElement("div");return Mr.innerHTML=er,Mr.content=Lr,u.headers.insertBefore(Mr,u.headers.lastChild),u.options.allowChangePosition&&Mr.setAttribute("draggable","true"),u.selectIndex(Mr),typeof ar=="function"&&ar(Lr,Mr),Lr}},u.getActive=function(){for(var er=0;er<u.headers.children.length;er++)if(u.headers.children[er].classList.contains("jtabs-selected"))return er;return 0},u.updateContent=function(er,ar){if(typeof ar!="string")var Lr=ar;else{var Lr=document.createElement("div");Lr.innerHTML=ar}u.content.children[er].classList.contains("jtabs-selected")&&ar.classList.add("jtabs-selected"),u.content.replaceChild(ar,u.content.children[er])},u.updatePosition=function(er,ar){er>ar?u.content.insertBefore(u.content.children[er],u.content.children[ar]):u.content.insertBefore(u.content.children[er],u.content.children[ar].nextSibling),u.open(ar),typeof u.options.onchangeposition=="function"&&u.options.onchangeposition(u.headers,er,ar)},u.move=function(er,ar){er>ar?u.headers.insertBefore(u.headers.children[er],u.headers.children[ar]):u.headers.insertBefore(u.headers.children[er],u.headers.children[ar].nextSibling),u.updatePosition(er,ar)},u.setBorder=_,u.init=function(){a.innerHTML="",u.headers=document.createElement("div"),u.content=document.createElement("div"),u.headers.classList.add("jtabs-headers"),u.content.classList.add("jtabs-content"),u.options.palette?a.classList.add("jtabs-modern"):a.classList.remove("jtabs-modern"),u.options.padding&&(u.content.style.padding=parseInt(u.options.padding)+"px");var er=document.createElement("div");er.className="jtabs-headers-container",er.appendChild(u.headers),u.options.maxWidth&&(er.style.maxWidth=parseInt(u.options.maxWidth)+"px");var ar=document.createElement("div");if(ar.className="jtabs-controls",ar.setAttribute("draggable","false"),er.appendChild(ar),u.options.position=="bottom"?(a.appendChild(u.content),a.appendChild(er)):(a.appendChild(er),a.appendChild(u.content)),u.options.allowCreate==!0){var Lr=document.createElement("div");Lr.className="jtabs-add",Lr.onclick=function(){u.create()},ar.appendChild(Lr)}g=document.createElement("div"),g.className="jtabs-prev",g.onclick=function(){Ge(u.headers.scrollLeft-u.headers.offsetWidth)},ar.appendChild(g),b=document.createElement("div"),b.className="jtabs-next",b.onclick=function(){Ge(u.headers.scrollLeft+u.headers.offsetWidth)},ar.appendChild(b);for(var Mr=0;Mr<u.options.data.length;Mr++){if(u.options.data[Mr].titleElement)var Br=u.options.data[Mr].titleElement;else var Br=document.createElement("div");if(u.options.data[Mr].icon){var Qr=document.createElement("div"),ii=document.createElement("i");ii.classList.add("material-icons"),ii.innerHTML=u.options.data[Mr].icon,Qr.appendChild(ii),Br.appendChild(Qr)}if(u.options.data[Mr].title){var Ir=document.createTextNode(u.options.data[Mr].title);Br.appendChild(Ir)}if(u.options.data[Mr].width&&(Br.style.width=u.options.data[Mr].width),u.options.data[Mr].contentElement)var gt=u.options.data[Mr].contentElement;else{var gt=document.createElement("div");gt.innerHTML=u.options.data[Mr].content}u.headers.appendChild(Br),u.content.appendChild(gt)}m=document.createElement("div"),m.className="jtabs-border",u.headers.appendChild(m),u.options.animation&&a.classList.add("jtabs-animation"),u.headers.addEventListener("click",function(tr){if(tr.target.parentNode.classList.contains("jtabs-headers"))var br=tr.target;else if(tr.target.tagName=="I")var br=tr.target.parentNode.parentNode;else var br=tr.target.parentNode;var tt=u.selectIndex(br);typeof u.options.onclick=="function"&&u.options.onclick(a,u,tt,u.headers.children[tt],u.content.children[tt])}),u.headers.addEventListener("contextmenu",function(tr){u.selectIndex(tr.target)}),u.headers.children.length&&u.open(0),Ge(0),u.options.allowChangePosition==!0&&s.sorting(u.headers,{direction:1,ondrop:function(tr,br,tt){u.updatePosition(br,tt)}}),typeof u.options.onload=="function"&&u.options.onload(a,u)},a.children[0]&&a.children[0].children.length)for(var ot=0;ot<a.children[0].children.length;ot++){var rr=u.options.data&&u.options.data[ot]?u.options.data[ot]:{};a.children[1]&&a.children[1].children[ot]?(rr.titleElement=a.children[0].children[ot],rr.contentElement=a.children[1].children[ot]):rr.contentElement=a.children[0].children[ot],u.options.data[ot]=rr}var ir=!1;if(u.options.data)for(var ot=0;ot<u.options.data.length;ot++)u.options.data[ot].url&&(s.ajax({url:u.options.data[ot].url,type:"GET",dataType:"text/html",index:ot,success:function(ar){u.options.data[this.index].content=ar},complete:function(){u.init()}}),ir=!0);return ir||u.init(),a.tabs=u,u},s.tags=function(a,d){if(a.tags)return a.tags.setOptions(d,!0);var u={type:"tags"};u.options={};var f=function(){return!!(u.options.limit&&a.children.length>=u.options.limit)},h=null,g=null;u.setOptions=function(Ir,gt){var tr={value:"",limit:null,limitMessage:null,search:null,placeholder:null,validation:null,onbeforechange:null,onlimit:null,onchange:null,onfocus:null,onblur:null,onload:null,colors:null};for(var br in tr)Ir&&Ir.hasOwnProperty(br)?u.options[br]=Ir[br]:(typeof u.options[br]=="undefined"||gt===!0)&&(u.options[br]=tr[br]);return u.options.placeholder?a.setAttribute("data-placeholder",u.options.placeholder):a.removeAttribute("data-placeholder"),a.placeholder=u.options.placeholder,u.setValue(u.options.value),Ge(),u.options.search?g||(g=document.createElement("div"),a.parentNode.insertBefore(g,a.nextSibling),h=s.search(g,{data:u.options.search,onselect:function(tt,nr,sr){u.selectIndex(nr,sr)}})):g&&(h=null,g.remove(),g=null),u},u.add=function(Ir,gt){if(typeof u.options.onbeforechange=="function"){var tr=u.options.onbeforechange(a,u,u.options.value,Ir);if(tr===!1)return!1;tr!=null&&(Ir=tr)}if(h&&h.close(),f())typeof u.options.onlimit=="function"?u.options.onlimit(u,u.options.limit):u.options.limitMessage&&alert(u.options.limitMessage+" "+u.options.limit);else{var br=s.getNode();if(br&&br.parentNode&&br.parentNode.classList.contains("jtags")&&br.nextSibling&&!(br.nextSibling.innerText&&br.nextSibling.innerText.trim()))tt=br.nextSibling;else{if(a.lastChild&&(a.lastChild.innerText.trim()||a.removeChild(a.lastChild)),!Ir||typeof Ir=="string")var tt=m(Ir,Ir,br);else for(var nr=0;nr<=Ir.length;nr++)if(!f()){if(!Ir[nr]||typeof Ir[nr]=="string")var sr=Ir[nr]||"",Rr=null;else var sr=Ir[nr].text,Rr=Ir[nr].value;var tt=m(sr,Rr)}_()}gt&&b(tt)}},u.setLimit=function(Ir){for(u.options.limit=Ir,a.children.length-Ir;a.children.length>Ir;)a.removeChild(a.lastChild)},u.remove=function(Ir){Ir.parentNode.removeChild(Ir),a.children.length?_():u.add("",!0)},u.getData=function(){for(var Ir=[],gt=0;gt<a.children.length;gt++){var tr=a.children[gt].innerText.replace(`
`,""),br=a.children[gt].getAttribute("data-value");br||(br=tr),(tr||br)&&Ir.push({text:tr,value:br})}return Ir},u.getValue=function(Ir){var gt=null;if(Ir!=null)gt=a.children[Ir].getAttribute("data-value"),gt||(gt=a.children[Ir].innerText.replace(`
`,""));else{for(var tr=[],br=0;br<a.children.length;br++)gt=a.children[br].innerText.replace(`
`,""),gt&&tr.push(u.getValue(br));gt=tr.join(",")}return gt},u.setValue=function(Ir){if(!Ir)u.reset();else if(a.value!=Ir)if(Array.isArray(Ir))u.add(Ir);else{var gt=(""+Ir).trim(),tr=rr(gt);a.innerHTML="",u.add(tr)}},u.reset=function(){a.classList.add("jtags-empty"),a.innerHTML="<div></div>",_()},u.isValid=function(){for(var Ir=0,gt=0;gt<a.children.length;gt++)a.children[gt].classList.contains("jtags_error")&&Ir++;return Ir==0},u.selectIndex=function(Ir,gt){var tr=s.getNode();tr&&(tr.innerText=Ir,gt&&tr.setAttribute("data-value",gt),tr.classList.remove("jtags_error"),f()||u.add("",!0))},u.search=function(Ir){Ir.innerText},u.destroy=function(){a.removeEventListener("mouseup",Mr),a.removeEventListener("keydown",er),a.removeEventListener("keyup",ar),a.removeEventListener("paste",Lr),a.removeEventListener("focus",Br),a.removeEventListener("blur",Qr),a.parentNode.removeChild(a)};var b=function(Ir){if(a.children.length>1){var gt=document.createRange(),tr=window.getSelection();if(!Ir)var Ir=a.childNodes[a.childNodes.length-1];gt.setStart(Ir,Ir.length),gt.collapse(!0),tr.removeAllRanges(),tr.addRange(gt),a.scrollLeft=a.scrollWidth}},m=function(Ir,gt,tr){var br=document.createElement("div");return br.innerHTML=Ir||"",gt&&br.setAttribute("data-value",gt),tr&&tr.parentNode.classList.contains("jtags")?a.insertBefore(br,tr.nextSibling):a.appendChild(br),br},_=function(){var Ir=u.getValue();Ir!=u.options.value&&(u.options.value=Ir,typeof u.options.onchange=="function"&&u.options.onchange(a,u,u.options.value),a.value!=u.options.value&&(a.value=u.options.value,typeof a.oninput=="function"&&a.oninput({type:"input",target:a,value:a.value}))),Ge()},Ge=function(){for(var Ir=0;Ir<a.children.length;Ir++)u.getValue(Ir)?(a.children[Ir].classList.add("jtags_label"),typeof u.options.validation=="function"&&u.getValue(Ir)?u.options.validation(a.children[Ir],a.children[Ir].innerText,a.children[Ir].getAttribute("data-value"))?a.children[Ir].classList.remove("jtags_error"):a.children[Ir].classList.add("jtags_error"):a.children[Ir].classList.remove("jtags_error")):a.children[Ir].classList.remove("jtags_label");ot()},ot=function(){a.innerText.trim()?a.classList.remove("jtags-empty"):(a.innerHTML="<div></div>",a.classList.add("jtags-empty"))},rr=function(Ir){var gt=[],tr="";if(Ir=Ir.trim(),Ir){for(var br=0;br<Ir.length;br++)Ir[br]==","||Ir[br]==";"||Ir[br]==`
`?tr&&(gt.push(tr.trim()),tr=""):tr+=Ir[br];tr&&gt.push(tr)}return gt},ir=0,er=function(Ir){if(ir=window.getSelection().anchorOffset,ot(),Ir.key==="Tab"||Ir.key===";"||Ir.key===","){var gt=window.getSelection().anchorOffset;gt>1&&(f()?typeof u.options.onlimit=="function"&&u.options.onlimit(u,u.options.limit):u.add("",!0)),Ir.preventDefault()}else if(Ir.key=="Enter"){if(!h||!h.isOpened()){var gt=window.getSelection().anchorOffset;gt>1&&(f()||u.add("",!0)),Ir.preventDefault()}}else Ir.key=="Backspace"&&a.children.length==1&&window.getSelection().anchorOffset<1&&Ir.preventDefault();h&&h.keydown(Ir)},ar=function(Ir){if(Ir.which==39){var gt=window.getSelection().anchorOffset;gt>1&&gt==ir&&u.add("",!0)}else Ir.which==13||Ir.which==38||Ir.which==40?Ir.preventDefault():h&&h.keyup(Ir);Ge()},Lr=function(Ir){if(Ir.clipboardData||Ir.originalEvent.clipboardData)var gt=(Ir.originalEvent||Ir).clipboardData.getData("text/plain");else if(window.clipboardData)var gt=window.clipboardData.getData("Text");var tr=rr(gt);tr.length>1&&(u.add(tr,!0),Ir.preventDefault())},Mr=function(Ir){if(Ir.target.parentNode&&Ir.target.parentNode.classList.contains("jtags")&&(Ir.target.classList.contains("jtags_label")||Ir.target.classList.contains("jtags_error"))){var gt=Ir.target.getBoundingClientRect();gt.width-(Ir.clientX-gt.left)<16&&u.remove(Ir.target)}Ir.target==a&&b()},Br=function(){a.classList.contains("jtags-focus")||((!a.children.length||u.getValue(a.children.length-1))&&(f()||m("")),typeof u.options.onfocus=="function"&&u.options.onfocus(a,u,u.getValue()),a.classList.add("jtags-focus"))},Qr=function(){if(a.classList.contains("jtags-focus")){h&&h.close();for(var Ir=0;Ir<a.children.length-1;Ir++)u.getValue(Ir)||a.removeChild(a.children[Ir]);_(),a.classList.remove("jtags-focus"),typeof u.options.onblur=="function"&&u.options.onblur(a,u,u.getValue())}},ii=function(){"touchend"in document.documentElement?a.addEventListener("touchend",Mr):a.addEventListener("mouseup",Mr),a.addEventListener("keydown",er),a.addEventListener("keyup",ar),a.addEventListener("paste",Lr),a.addEventListener("focus",Br),a.addEventListener("blur",Qr),a.setAttribute("contenteditable",!0),a.classList.add("jtags"),u.setOptions(d),typeof u.options.onload=="function"&&u.options.onload(a,u),a.change=u.setValue,a.val=function(Ir){if(Ir===void 0)return u.getValue();u.setValue(Ir)},a.tags=u};return ii(),u},s.toolbar=function(a,d){var u={type:"toolbar"};u.options={};var f={app:null,container:!1,badge:!1,title:!1,responsive:!1,maxWidth:null,bottom:!0,items:[]};for(var h in f)d&&d.hasOwnProperty(h)?u.options[h]=d[h]:u.options[h]=f[h];!a&&d.app&&d.app.el&&(a=document.createElement("div"),d.app.el.appendChild(a));var g=document.createElement("div");g.classList.add("jtoolbar-item"),g.classList.add("jtoolbar-arrow");var b=document.createElement("div");b.classList.add("jtoolbar-floating"),g.appendChild(b),u.selectItem=function(_){for(var Ge=m.children,ot=0;ot<Ge.length;ot++)_!=Ge[ot]&&Ge[ot].classList.remove("jtoolbar-selected");_.classList.add("jtoolbar-selected")},u.hide=function(){s.animation.slideBottom(a,0,function(){a.style.display="none"})},u.show=function(){a.style.display="",s.animation.slideBottom(a,1)},u.get=function(){return a},u.setBadge=function(_,Ge){m.children[_].children[1].firstChild.innerHTML=Ge},u.destroy=function(){toolbar.remove(),a.innerHTML=""},u.update=function(_,Ge){for(var ot=0;ot<m.children.length;ot++){var rr=m.children[ot];typeof rr.updateState=="function"&&rr.updateState(a,u,rr,_,Ge)}},u.create=function(_){m.innerHTML="";for(var Ge=0;Ge<_.length;Ge++){var ot=document.createElement("div");if(ot.classList.add("jtoolbar-item"),_[Ge].width&&(ot.style.width=parseInt(_[Ge].width)+"px"),_[Ge].k&&(ot.k=_[Ge].k),_[Ge].tooltip&&ot.setAttribute("title",_[Ge].tooltip),_[Ge].id&&ot.setAttribute("id",_[Ge].id),_[Ge].updateState&&(ot.updateState=_[Ge].updateState),_[Ge].active&&ot.classList.add("jtoolbar-active"),_[Ge].type=="select"||_[Ge].type=="dropdown")s.picker(ot,_[Ge]);else if(_[Ge].type=="divisor")ot.classList.add("jtoolbar-divisor");else if(_[Ge].type=="label")ot.classList.add("jtoolbar-label"),ot.innerHTML=_[Ge].content;else{var rr=document.createElement("i");if(typeof _[Ge].class=="undefined")rr.classList.add("material-icons");else for(var ir=_[Ge].class.split(" "),er=0;er<ir.length;er++)rr.classList.add(ir[er]);if(rr.innerHTML=_[Ge].content?_[Ge].content:"",ot.appendChild(rr),u.options.badge==!0){var ar=document.createElement("div");ar.classList.add("jbadge");var Lr=document.createElement("div");Lr.innerHTML=_[Ge].badge?_[Ge].badge:"",ar.appendChild(Lr),ot.appendChild(ar)}if(_[Ge].title)if(u.options.title==!0){var Mr=document.createElement("span");Mr.innerHTML=_[Ge].title,ot.appendChild(Mr)}else ot.setAttribute("title",_[Ge].title);u.options.app&&_[Ge].route&&(ot.route=_[Ge].route,ot.onclick=function(){u.options.app.pages(this.route)},u.options.app.pages(_[Ge].route,{toolbarItem:ot,closed:!0}))}_[Ge].onclick&&(ot.onclick=_[Ge].onclick.bind(_[Ge],a,u,ot)),m.appendChild(ot)}setTimeout(function(){u.refresh()},0)},u.open=function(){g.classList.add("jtoolbar-arrow-selected"),a.getBoundingClientRect();var _=b.getBoundingClientRect();_.bottom>window.innerHeight||u.options.bottom?b.style.bottom="0":b.style.removeProperty("bottom"),b.style.right="0",g.children[0].focus(),s.tracking(u,!0)},u.close=function(){g.classList.remove("jtoolbar-arrow-selected"),s.tracking(u,!1)},u.refresh=function(){if(u.options.responsive==!0){var _=a.parentNode.getBoundingClientRect();u.options.maxWidth||(u.options.maxWidth=_.width);var Ge=parseInt(u.options.maxWidth);for(g.remove();b.firstChild;)m.appendChild(b.firstChild);if(Ge<m.offsetWidth)for(Ge-=50;m.lastChild&&Ge<m.offsetWidth;)b.insertBefore(m.lastChild,b.firstChild);b.children.length>0&&m.appendChild(g)}},a.onclick=function(_){var Ge=s.findElement(_.target,"jtoolbar-item");Ge&&u.selectItem(Ge),_.target.classList.contains("jtoolbar-arrow")&&u.open()},window.addEventListener("resize",function(){u.refresh()}),a.classList.add("jtoolbar"),a.innerHTML="",u.options.container==!0&&a.classList.add("jtoolbar-container");var m=document.createElement("div");return a.appendChild(m),u.options.app&&a.classList.add("jtoolbar-mobile"),u.create(u.options.items),a.toolbar=u,u},s.validations=function(a,d){return typeof s.validations[d.type]=="function"?s.validations[d.type](a,d):null},s.validations.email=function(a){var d=new RegExp(/^[^\s@]+@[^\s@]+\.[^\s@]+$/);return!!(a&&d.test(a))},s.validations.required=function(a){return!!a.trim()},s.validations.number=function(a){return s.isNumber(a)},s.validations.login=function(a){var d=new RegExp(/^[a-zA-Z0-9\_\-\.\s+]+$/);return!!(a&&d.test(a))};var o=function(a,d){return d.constraint==="="?a===d.reference:d.constraint==="<"?a<d.reference:d.constraint==="<="?a<=d.reference:d.constraint===">"?a>d.reference:d.constraint===">="?a>=d.reference:d.constraint==="between"?a>=d.reference[0]&&a<=d.reference[1]:d.constraint==="not between"?a<d.reference[0]||a>d.reference[1]:null};return s.validations.number=function(a,d){return s.isNumeric(a)?d===void 0||d.constraint===void 0?!0:o(a,d):!1},s.validations.date=function(a,d){return new Date(a)=="Invalid Date"?!1:d===void 0||d.constraint===void 0?!0:typeof d=="object"?(a=new Date(a).getTime(),Array.isArray(d.reference)?d.reference=d.reference.map(function(u){return new Date(u).getTime()}):d.reference=new Date(d.reference).getTime(),o(a,d)):null},s.validations.itemList=function(a,d){return d.reference.some(function(u){return u==a})},s.validations.text=function(a,d){if(typeof a!="string")return!1;if(d===void 0||d.constraint===void 0)return!0;if(d.constraint==="=")return a===d.reference;if(d.constraint==="contains")return a.includes(d.reference);if(d.constraint==="not contain")return!a.includes(d.reference);if(d.constraint==="email")return s.validations.email(a);if(d.constraint==="url"){var u=new RegExp(/(((https?:\/\/)|(www\.))[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|]+)/ig);return!!u.test(a)}return null},s.validations.constraints=function(){},s})})(jsuites);(function(module,exports){var formula=function(){var error=function(){var r={};return r.nil=new Error("#NULL!"),r.div0=new Error("#DIV/0!"),r.value=new Error("#VALUE!"),r.ref=new Error("#REF!"),r.name=new Error("#NAME?"),r.num=new Error("#NUM!"),r.na=new Error("#N/A"),r.error=new Error("#ERROR!"),r.data=new Error("#GETTING_DATA"),r}(),utils=function(){var r={};r.flattenShallow=function(s){return!s||!s.reduce?s:s.reduce(function(o,a){var d=Array.isArray(o),u=Array.isArray(a);return d&&u?o.concat(a):d?(o.push(a),o):u?[o].concat(a):[o,a]})},r.isFlat=function(s){if(!s)return!1;for(var o=0;o<s.length;++o)if(Array.isArray(s[o]))return!1;return!0},r.flatten=function(){for(var s=r.argsToArray.apply(null,arguments);!r.isFlat(s);)s=r.flattenShallow(s);return s},r.argsToArray=function(s){var o=[];return r.arrayEach(s,function(a){o.push(a)}),o},r.numbers=function(){var s=this.flatten.apply(null,arguments);return s.filter(function(o){return typeof o=="number"})},r.cleanFloat=function(s){var o=1e14;return Math.round(s*o)/o},r.parseBool=function(s){if(typeof s=="boolean"||s instanceof Error)return s;if(typeof s=="number")return s!==0;if(typeof s=="string"){var o=s.toUpperCase();if(o==="TRUE")return!0;if(o==="FALSE")return!1}return s instanceof Date&&!isNaN(s)?!0:error.value},r.parseNumber=function(s){return s===void 0||s===""||isNaN(s)?error.value:parseFloat(s)},r.parseNumberArray=function(s){var o;if(!s||(o=s.length)===0)return error.value;for(var a;o--;){if(a=r.parseNumber(s[o]),a===error.value)return a;s[o]=a}return s},r.parseMatrix=function(s){if(!s||s.length===0)return error.value;for(var o,a=0;a<s.length;a++)if(o=r.parseNumberArray(s[a]),s[a]=o,o instanceof Error)return o;return s};var e=new Date(Date.UTC(1900,0,1));return r.parseDate=function(s){if(!isNaN(s)){if(s instanceof Date)return new Date(s);var o=parseInt(s,10);return o<0?error.num:o<=60?new Date(e.getTime()+(o-1)*864e5):new Date(e.getTime()+(o-2)*864e5)}return typeof s=="string"&&(s=new Date(s),!isNaN(s))?s:error.value},r.parseDateArray=function(s){for(var o=s.length,a;o--;){if(a=this.parseDate(s[o]),a===error.value)return a;s[o]=a}return s},r.anyIsError=function(){for(var s=arguments.length;s--;)if(arguments[s]instanceof Error)return!0;return!1},r.arrayValuesToNumbers=function(s){for(var o=s.length,a;o--;)if(a=s[o],typeof a!="number"){if(a===!0){s[o]=1;continue}if(a===!1){s[o]=0;continue}if(typeof a=="string"){var d=this.parseNumber(a);d instanceof Error?s[o]=0:s[o]=d}}return s},r.rest=function(s,o){return o=o||1,!s||typeof s.slice!="function"?s:s.slice(o)},r.initial=function(s,o){return o=o||1,!s||typeof s.slice!="function"?s:s.slice(0,s.length-o)},r.arrayEach=function(s,o){for(var a=-1,d=s.length;++a<d&&o(s[a],a,s)!==!1;);return s},r.transpose=function(s){return s?s[0].map(function(o,a){return s.map(function(d){return d[a]})}):error.value},r}(),met={};met.datetime=function(){var r={},e=new Date(1900,0,1),s=[[],[1,2,3,4,5,6,7],[7,1,2,3,4,5,6],[6,0,1,2,3,4,5],[],[],[],[],[],[],[],[7,1,2,3,4,5,6],[6,7,1,2,3,4,5],[5,6,7,1,2,3,4],[4,5,6,7,1,2,3],[3,4,5,6,7,1,2],[2,3,4,5,6,7,1],[1,2,3,4,5,6,7]];r.DATE=function(a,d,u){if(a=utils.parseNumber(a),d=utils.parseNumber(d),u=utils.parseNumber(u),utils.anyIsError(a,d,u))return error.value;if(a<0||d<0||u<0)return error.num;var f=new Date(a,d-1,u);return f},r.DATEVALUE=function(a){if(typeof a!="string")return error.value;var d=Date.parse(a);return isNaN(d)?error.value:d<=-22038912e5?(d-e)/864e5+1:(d-e)/864e5+2},r.DAY=function(a){var d=utils.parseDate(a);return d instanceof Error?d:d.getDate()},r.DAYS=function(a,d){return a=utils.parseDate(a),d=utils.parseDate(d),a instanceof Error?a:d instanceof Error?d:o(a)-o(d)},r.DAYS360=function(a,d,u){},r.EDATE=function(a,d){return a=utils.parseDate(a),a instanceof Error?a:isNaN(d)?error.value:(d=parseInt(d,10),a.setMonth(a.getMonth()+d),o(a))},r.EOMONTH=function(a,d){return a=utils.parseDate(a),a instanceof Error?a:isNaN(d)?error.value:(d=parseInt(d,10),o(new Date(a.getFullYear(),a.getMonth()+d+1,0)))},r.HOUR=function(a){return a=utils.parseDate(a),a instanceof Error?a:a.getHours()},r.INTERVAL=function(a){if(typeof a!="number"&&typeof a!="string")return error.value;a=parseInt(a,10);var d=Math.floor(a/94608e4);a=a%94608e4;var u=Math.floor(a/2592e3);a=a%2592e3;var f=Math.floor(a/86400);a=a%86400;var h=Math.floor(a/3600);a=a%3600;var g=Math.floor(a/60);a=a%60;var b=a;return d=d>0?d+"Y":"",u=u>0?u+"M":"",f=f>0?f+"D":"",h=h>0?h+"H":"",g=g>0?g+"M":"",b=b>0?b+"S":"","P"+d+u+f+"T"+h+g+b},r.ISOWEEKNUM=function(a){if(a=utils.parseDate(a),a instanceof Error)return a;a.setHours(0,0,0),a.setDate(a.getDate()+4-(a.getDay()||7));var d=new Date(a.getFullYear(),0,1);return Math.ceil(((a-d)/864e5+1)/7)},r.MINUTE=function(a){return a=utils.parseDate(a),a instanceof Error?a:a.getMinutes()},r.MONTH=function(a){return a=utils.parseDate(a),a instanceof Error?a:a.getMonth()+1},r.NETWORKDAYS=function(a,d,u){},r.NETWORKDAYS.INTL=function(a,d,u,f){},r.NOW=function(){return new Date},r.SECOND=function(a){return a=utils.parseDate(a),a instanceof Error?a:a.getSeconds()},r.TIME=function(a,d,u){return a=utils.parseNumber(a),d=utils.parseNumber(d),u=utils.parseNumber(u),utils.anyIsError(a,d,u)?error.value:a<0||d<0||u<0?error.num:(3600*a+60*d+u)/86400},r.TIMEVALUE=function(a){return a=utils.parseDate(a),a instanceof Error?a:(3600*a.getHours()+60*a.getMinutes()+a.getSeconds())/86400},r.TODAY=function(){return new Date},r.WEEKDAY=function(a,d){if(a=utils.parseDate(a),a instanceof Error)return a;d===void 0&&(d=1);var u=a.getDay();return s[d][u]},r.WEEKNUM=function(a,d){},r.WORKDAY=function(a,d,u){},r.WORKDAY.INTL=function(a,d,u,f){},r.YEAR=function(a){return a=utils.parseDate(a),a instanceof Error?a:a.getFullYear()},r.YEARFRAC=function(a,d,u){};function o(a){var d=a>-22038912e5?2:1;return(a-e)/864e5+d}return r}(),met.database=function(){var exports={};function compact(r){if(!r)return r;for(var e=[],s=0;s<r.length;++s)!r[s]||e.push(r[s]);return e}exports.FINDFIELD=function(r,e){for(var s=null,o=0;o<r.length;o++)if(r[o][0]===e){s=o;break}return s==null?error.value:s};function findResultIndex(database,criterias){for(var matches={},i=1;i<database[0].length;++i)matches[i]=!0;var maxCriteriaLength=criterias[0].length;for(i=1;i<criterias.length;++i)criterias[i].length>maxCriteriaLength&&(maxCriteriaLength=criterias[i].length);for(var k=1;k<database.length;++k)for(var l=1;l<database[k].length;++l){for(var currentCriteriaResult=!1,hasMatchingCriteria=!1,j=0;j<criterias.length;++j){var criteria=criterias[j];if(!(criteria.length<maxCriteriaLength)){var criteriaField=criteria[0];if(database[k][0]===criteriaField){hasMatchingCriteria=!0;for(var p=1;p<criteria.length;++p)currentCriteriaResult=currentCriteriaResult||eval(database[k][l]+criteria[p])}}}hasMatchingCriteria&&(matches[l]=matches[l]&&currentCriteriaResult)}for(var result=[],n=0;n<database[0].length;++n)matches[n]&&result.push(n-1);return result}return exports.DAVERAGE=function(r,e,s){if(isNaN(e)&&typeof e!="string")return error.value;var o=findResultIndex(r,s),a=[];if(typeof e=="string"){var d=exports.FINDFIELD(r,e);a=utils.rest(r[d])}else a=utils.rest(r[e]);for(var u=0,f=0;f<o.length;f++)u+=a[o[f]];return o.length===0?error.div0:u/o.length},exports.DCOUNT=function(r,e,s){},exports.DCOUNTA=function(r,e,s){},exports.DGET=function(r,e,s){if(isNaN(e)&&typeof e!="string")return error.value;var o=findResultIndex(r,s),a=[];if(typeof e=="string"){var d=exports.FINDFIELD(r,e);a=utils.rest(r[d])}else a=utils.rest(r[e]);return o.length===0?error.value:o.length>1?error.num:a[o[0]]},exports.DMAX=function(r,e,s){if(isNaN(e)&&typeof e!="string")return error.value;var o=findResultIndex(r,s),a=[];if(typeof e=="string"){var d=exports.FINDFIELD(r,e);a=utils.rest(r[d])}else a=utils.rest(r[e]);for(var u=a[o[0]],f=1;f<o.length;f++)u<a[o[f]]&&(u=a[o[f]]);return u},exports.DMIN=function(r,e,s){if(isNaN(e)&&typeof e!="string")return error.value;var o=findResultIndex(r,s),a=[];if(typeof e=="string"){var d=exports.FINDFIELD(r,e);a=utils.rest(r[d])}else a=utils.rest(r[e]);for(var u=a[o[0]],f=1;f<o.length;f++)u>a[o[f]]&&(u=a[o[f]]);return u},exports.DPRODUCT=function(r,e,s){if(isNaN(e)&&typeof e!="string")return error.value;var o=findResultIndex(r,s),a=[];if(typeof e=="string"){var d=exports.FINDFIELD(r,e);a=utils.rest(r[d])}else a=utils.rest(r[e]);for(var u=[],f=0;f<o.length;f++)u[f]=a[o[f]];u=compact(u);var h=1;for(f=0;f<u.length;f++)h*=u[f];return h},exports.DSTDEV=function(r,e,s){},exports.DSTDEVP=function(r,e,s){},exports.DSUM=function(r,e,s){},exports.DVAR=function(r,e,s){},exports.DVARP=function(r,e,s){},exports.MATCH=function(r,e,s){if(!r&&!e||(arguments.length===2&&(s=1),!(e instanceof Array))||s!==-1&&s!==0&&s!==1)return error.na;for(var o,a,d=0;d<e.length;d++)if(s===1){if(e[d]===r)return d+1;e[d]<r&&(a?e[d]>a&&(o=d+1,a=e[d]):(o=d+1,a=e[d]))}else if(s===0){if(typeof r=="string"){if(r=r.replace(/\?/g,"."),e[d].toLowerCase().match(r.toLowerCase()))return d+1}else if(e[d]===r)return d+1}else if(s===-1){if(e[d]===r)return d+1;e[d]>r&&(a?e[d]<a&&(o=d+1,a=e[d]):(o=d+1,a=e[d]))}return o||error.na},exports}(),met.engineering=function(){var r={};function e(s){return/^[01]{1,10}$/.test(s)}return r.BESSELI=function(s,o){},r.BESSELJ=function(s,o){},r.BESSELK=function(s,o){},r.BESSELY=function(s,o){},r.BIN2DEC=function(s){if(!e(s))return error.num;var o=parseInt(s,2),a=s.toString();return a.length===10&&a.substring(0,1)==="1"?parseInt(a.substring(1),2)-512:o},r.BIN2HEX=function(s,o){if(!e(s))return error.num;var a=s.toString();if(a.length===10&&a.substring(0,1)==="1")return(1099511627264+parseInt(a.substring(1),2)).toString(16);var d=parseInt(s,2).toString(16);return o===void 0?d:isNaN(o)?error.value:o<0?error.num:(o=Math.floor(o),o>=d.length?REPT("0",o-d.length)+d:error.num)},r.BIN2OCT=function(s,o){if(!e(s))return error.num;var a=s.toString();if(a.length===10&&a.substring(0,1)==="1")return(1073741312+parseInt(a.substring(1),2)).toString(8);var d=parseInt(s,2).toString(8);return o===void 0?d:isNaN(o)?error.value:o<0?error.num:(o=Math.floor(o),o>=d.length?REPT("0",o-d.length)+d:error.num)},r.BITAND=function(s,o){return s=utils.parseNumber(s),o=utils.parseNumber(o),utils.anyIsError(s,o)?error.value:s<0||o<0||Math.floor(s)!==s||Math.floor(o)!==o||s>281474976710655||o>281474976710655?error.num:s&o},r.BITLSHIFT=function(s,o){return s=utils.parseNumber(s),o=utils.parseNumber(o),utils.anyIsError(s,o)?error.value:s<0||Math.floor(s)!==s||s>281474976710655||Math.abs(o)>53?error.num:o>=0?s<<o:s>>-o},r.BITOR=function(s,o){return s=utils.parseNumber(s),o=utils.parseNumber(o),utils.anyIsError(s,o)?error.value:s<0||o<0||Math.floor(s)!==s||Math.floor(o)!==o||s>281474976710655||o>281474976710655?error.num:s|o},r.BITRSHIFT=function(s,o){return s=utils.parseNumber(s),o=utils.parseNumber(o),utils.anyIsError(s,o)?error.value:s<0||Math.floor(s)!==s||s>281474976710655||Math.abs(o)>53?error.num:o>=0?s>>o:s<<-o},r.BITXOR=function(s,o){return s=utils.parseNumber(s),o=utils.parseNumber(o),utils.anyIsError(s,o)?error.value:s<0||o<0||Math.floor(s)!==s||Math.floor(o)!==o||s>281474976710655||o>281474976710655?error.num:s^o},r.COMPLEX=function(s,o,a){if(s=utils.parseNumber(s),o=utils.parseNumber(o),utils.anyIsError(s,o))return s;if(a=a===void 0?"i":a,a!=="i"&&a!=="j")return error.value;if(s===0&&o===0)return 0;if(s===0)return o===1?a:o.toString()+a;if(o===0)return s.toString();var d=o>0?"+":"";return s.toString()+d+(o===1?a:o.toString()+a)},r.CONVERT=function(s,o,a){if(s=utils.parseNumber(s),s instanceof Error)return s;for(var d=[["a.u. of action","?",null,"action",!1,!1,105457168181818e-48],["a.u. of charge","e",null,"electric_charge",!1,!1,160217653141414e-33],["a.u. of energy","Eh",null,"energy",!1,!1,435974417757576e-32],["a.u. of length","a?",null,"length",!1,!1,529177210818182e-25],["a.u. of mass","m?",null,"mass",!1,!1,910938261616162e-45],["a.u. of time","?/Eh",null,"time",!1,!1,241888432650516e-31],["admiralty knot","admkn",null,"speed",!1,!0,.514773333],["ampere","A",null,"electric_current",!0,!1,1],["ampere per meter","A/m",null,"magnetic_field_intensity",!0,!1,1],["\xE5ngstr\xF6m","\xC5",["ang"],"length",!1,!0,1e-10],["are","ar",null,"area",!1,!0,100],["astronomical unit","ua",null,"length",!1,!1,149597870691667e-25],["bar","bar",null,"pressure",!1,!1,1e5],["barn","b",null,"area",!1,!1,1e-28],["becquerel","Bq",null,"radioactivity",!0,!1,1],["bit","bit",["b"],"information",!1,!0,1],["btu","BTU",["btu"],"energy",!1,!0,1055.05585262],["byte","byte",null,"information",!1,!0,8],["candela","cd",null,"luminous_intensity",!0,!1,1],["candela per square metre","cd/m?",null,"luminance",!0,!1,1],["coulomb","C",null,"electric_charge",!0,!1,1],["cubic \xE5ngstr\xF6m","ang3",["ang^3"],"volume",!1,!0,1e-30],["cubic foot","ft3",["ft^3"],"volume",!1,!0,.028316846592],["cubic inch","in3",["in^3"],"volume",!1,!0,16387064e-12],["cubic light-year","ly3",["ly^3"],"volume",!1,!0,846786664623715e-61],["cubic metre","m?",null,"volume",!0,!0,1],["cubic mile","mi3",["mi^3"],"volume",!1,!0,416818182544058e-5],["cubic nautical mile","Nmi3",["Nmi^3"],"volume",!1,!0,6352182208],["cubic Pica","Pica3",["Picapt3","Pica^3","Picapt^3"],"volume",!1,!0,758660370370369e-22],["cubic yard","yd3",["yd^3"],"volume",!1,!0,.764554857984],["cup","cup",null,"volume",!1,!0,.0002365882365],["dalton","Da",["u"],"mass",!1,!1,166053886282828e-41],["day","d",["day"],"time",!1,!0,86400],["degree","\xB0",null,"angle",!1,!1,.0174532925199433],["degrees Rankine","Rank",null,"temperature",!1,!0,.555555555555556],["dyne","dyn",["dy"],"force",!1,!0,1e-5],["electronvolt","eV",["ev"],"energy",!1,!0,1.60217656514141],["ell","ell",null,"length",!1,!0,1.143],["erg","erg",["e"],"energy",!1,!0,1e-7],["farad","F",null,"electric_capacitance",!0,!1,1],["fluid ounce","oz",null,"volume",!1,!0,295735295625e-16],["foot","ft",null,"length",!1,!0,.3048],["foot-pound","flb",null,"energy",!1,!0,1.3558179483314],["gal","Gal",null,"acceleration",!1,!1,.01],["gallon","gal",null,"volume",!1,!0,.003785411784],["gauss","G",["ga"],"magnetic_flux_density",!1,!0,1],["grain","grain",null,"mass",!1,!0,647989e-10],["gram","g",null,"mass",!1,!0,.001],["gray","Gy",null,"absorbed_dose",!0,!1,1],["gross registered ton","GRT",["regton"],"volume",!1,!0,2.8316846592],["hectare","ha",null,"area",!1,!0,1e4],["henry","H",null,"inductance",!0,!1,1],["hertz","Hz",null,"frequency",!0,!1,1],["horsepower","HP",["h"],"power",!1,!0,745.69987158227],["horsepower-hour","HPh",["hh","hph"],"energy",!1,!0,2684519538e-3],["hour","h",["hr"],"time",!1,!0,3600],["imperial gallon (U.K.)","uk_gal",null,"volume",!1,!0,.00454609],["imperial hundredweight","lcwt",["uk_cwt","hweight"],"mass",!1,!0,50.802345],["imperial quart (U.K)","uk_qt",null,"volume",!1,!0,.0011365225],["imperial ton","brton",["uk_ton","LTON"],"mass",!1,!0,1016.046909],["inch","in",null,"length",!1,!0,.0254],["international acre","uk_acre",null,"area",!1,!0,4046.8564224],["IT calorie","cal",null,"energy",!1,!0,4.1868],["joule","J",null,"energy",!0,!0,1],["katal","kat",null,"catalytic_activity",!0,!1,1],["kelvin","K",["kel"],"temperature",!0,!0,1],["kilogram","kg",null,"mass",!0,!0,1],["knot","kn",null,"speed",!1,!0,.514444444444444],["light-year","ly",null,"length",!1,!0,9460730472580800],["litre","L",["l","lt"],"volume",!1,!0,.001],["lumen","lm",null,"luminous_flux",!0,!1,1],["lux","lx",null,"illuminance",!0,!1,1],["maxwell","Mx",null,"magnetic_flux",!1,!1,1e-18],["measurement ton","MTON",null,"volume",!1,!0,1.13267386368],["meter per hour","m/h",["m/hr"],"speed",!1,!0,.00027777777777778],["meter per second","m/s",["m/sec"],"speed",!0,!0,1],["meter per second squared","m?s??",null,"acceleration",!0,!1,1],["parsec","pc",["parsec"],"length",!1,!0,30856775814671900],["meter squared per second","m?/s",null,"kinematic_viscosity",!0,!1,1],["metre","m",null,"length",!0,!0,1],["miles per hour","mph",null,"speed",!1,!0,.44704],["millimetre of mercury","mmHg",null,"pressure",!1,!1,133.322],["minute","?",null,"angle",!1,!1,.000290888208665722],["minute","min",["mn"],"time",!1,!0,60],["modern teaspoon","tspm",null,"volume",!1,!0,5e-6],["mole","mol",null,"amount_of_substance",!0,!1,1],["morgen","Morgen",null,"area",!1,!0,2500],["n.u. of action","?",null,"action",!1,!1,105457168181818e-48],["n.u. of mass","m?",null,"mass",!1,!1,910938261616162e-45],["n.u. of speed","c?",null,"speed",!1,!1,299792458],["n.u. of time","?/(me?c??)",null,"time",!1,!1,128808866778687e-35],["nautical mile","M",["Nmi"],"length",!1,!0,1852],["newton","N",null,"force",!0,!0,1],["\u0153rsted","Oe ",null,"magnetic_field_intensity",!1,!1,79.5774715459477],["ohm","\u03A9",null,"electric_resistance",!0,!1,1],["ounce mass","ozm",null,"mass",!1,!0,.028349523125],["pascal","Pa",null,"pressure",!0,!1,1],["pascal second","Pa?s",null,"dynamic_viscosity",!0,!1,1],["pferdest\xE4rke","PS",null,"power",!1,!0,735.49875],["phot","ph",null,"illuminance",!1,!1,1e-4],["pica (1/6 inch)","pica",null,"length",!1,!0,.00035277777777778],["pica (1/72 inch)","Pica",["Picapt"],"length",!1,!0,.00423333333333333],["poise","P",null,"dynamic_viscosity",!1,!1,.1],["pond","pond",null,"force",!1,!0,.00980665],["pound force","lbf",null,"force",!1,!0,4.4482216152605],["pound mass","lbm",null,"mass",!1,!0,.45359237],["quart","qt",null,"volume",!1,!0,.000946352946],["radian","rad",null,"angle",!0,!1,1],["second","?",null,"angle",!1,!1,484813681109536e-20],["second","s",["sec"],"time",!0,!0,1],["short hundredweight","cwt",["shweight"],"mass",!1,!0,45.359237],["siemens","S",null,"electrical_conductance",!0,!1,1],["sievert","Sv",null,"equivalent_dose",!0,!1,1],["slug","sg",null,"mass",!1,!0,14.59390294],["square \xE5ngstr\xF6m","ang2",["ang^2"],"area",!1,!0,1e-20],["square foot","ft2",["ft^2"],"area",!1,!0,.09290304],["square inch","in2",["in^2"],"area",!1,!0,64516e-8],["square light-year","ly2",["ly^2"],"area",!1,!0,895054210748189e17],["square meter","m?",null,"area",!0,!0,1],["square mile","mi2",["mi^2"],"area",!1,!0,2589988110336e-6],["square nautical mile","Nmi2",["Nmi^2"],"area",!1,!0,3429904],["square Pica","Pica2",["Picapt2","Pica^2","Picapt^2"],"area",!1,!0,1792111111111e-17],["square yard","yd2",["yd^2"],"area",!1,!0,.83612736],["statute mile","mi",null,"length",!1,!0,1609.344],["steradian","sr",null,"solid_angle",!0,!1,1],["stilb","sb",null,"luminance",!1,!1,1e-4],["stokes","St",null,"kinematic_viscosity",!1,!1,1e-4],["stone","stone",null,"mass",!1,!0,6.35029318],["tablespoon","tbs",null,"volume",!1,!0,147868e-10],["teaspoon","tsp",null,"volume",!1,!0,492892e-11],["tesla","T",null,"magnetic_flux_density",!0,!0,1],["thermodynamic calorie","c",null,"energy",!1,!0,4.184],["ton","ton",null,"mass",!1,!0,907.18474],["tonne","t",null,"mass",!1,!1,1e3],["U.K. pint","uk_pt",null,"volume",!1,!0,.00056826125],["U.S. bushel","bushel",null,"volume",!1,!0,.03523907],["U.S. oil barrel","barrel",null,"volume",!1,!0,.158987295],["U.S. pint","pt",["us_pt"],"volume",!1,!0,.000473176473],["U.S. survey mile","survey_mi",null,"length",!1,!0,1609.347219],["U.S. survey/statute acre","us_acre",null,"area",!1,!0,4046.87261],["volt","V",null,"voltage",!0,!1,1],["watt","W",null,"power",!0,!0,1],["watt-hour","Wh",["wh"],"energy",!1,!0,3600],["weber","Wb",null,"magnetic_flux",!0,!1,1],["yard","yd",null,"length",!1,!0,.9144],["year","yr",null,"time",!1,!0,31557600]],u={Yi:["yobi",80,12089258196146292e8,"Yi","yotta"],Zi:["zebi",70,11805916207174113e5,"Zi","zetta"],Ei:["exbi",60,1152921504606847e3,"Ei","exa"],Pi:["pebi",50,1125899906842624,"Pi","peta"],Ti:["tebi",40,1099511627776,"Ti","tera"],Gi:["gibi",30,1073741824,"Gi","giga"],Mi:["mebi",20,1048576,"Mi","mega"],ki:["kibi",10,1024,"ki","kilo"]},f={Y:["yotta",1e24,"Y"],Z:["zetta",1e21,"Z"],E:["exa",1e18,"E"],P:["peta",1e15,"P"],T:["tera",1e12,"T"],G:["giga",1e9,"G"],M:["mega",1e6,"M"],k:["kilo",1e3,"k"],h:["hecto",100,"h"],e:["dekao",10,"e"],d:["deci",.1,"d"],c:["centi",.01,"c"],m:["milli",.001,"m"],u:["micro",1e-6,"u"],n:["nano",1e-9,"n"],p:["pico",1e-12,"p"],f:["femto",1e-15,"f"],a:["atto",1e-18,"a"],z:["zepto",1e-21,"z"],y:["yocto",1e-24,"y"]},h=null,g=null,b=o,m=a,_=1,Ge=1,ot,rr=0;rr<d.length;rr++)ot=d[rr][2]===null?[]:d[rr][2],(d[rr][1]===b||ot.indexOf(b)>=0)&&(h=d[rr]),(d[rr][1]===m||ot.indexOf(m)>=0)&&(g=d[rr]);if(h===null){var ir=u[o.substring(0,2)],er=f[o.substring(0,1)];o.substring(0,2)==="da"&&(er=["dekao",10,"da"]),ir?(_=ir[2],b=o.substring(2)):er&&(_=er[1],b=o.substring(er[2].length));for(var ar=0;ar<d.length;ar++)ot=d[ar][2]===null?[]:d[ar][2],(d[ar][1]===b||ot.indexOf(b)>=0)&&(h=d[ar])}if(g===null){var Lr=u[a.substring(0,2)],Mr=f[a.substring(0,1)];a.substring(0,2)==="da"&&(Mr=["dekao",10,"da"]),Lr?(Ge=Lr[2],m=a.substring(2)):Mr&&(Ge=Mr[1],m=a.substring(Mr[2].length));for(var Br=0;Br<d.length;Br++)ot=d[Br][2]===null?[]:d[Br][2],(d[Br][1]===m||ot.indexOf(m)>=0)&&(g=d[Br])}return h===null||g===null||h[3]!==g[3]?error.na:s*h[6]*_/(g[6]*Ge)},r.DEC2BIN=function(s,o){if(s=utils.parseNumber(s),s instanceof Error)return s;if(!/^-?[0-9]{1,3}$/.test(s)||s<-512||s>511)return error.num;if(s<0)return"1"+REPT("0",9-(512+s).toString(2).length)+(512+s).toString(2);var a=parseInt(s,10).toString(2);return typeof o=="undefined"?a:isNaN(o)?error.value:o<0?error.num:(o=Math.floor(o),o>=a.length?REPT("0",o-a.length)+a:error.num)},r.DEC2HEX=function(s,o){if(s=utils.parseNumber(s),s instanceof Error)return s;if(!/^-?[0-9]{1,12}$/.test(s)||s<-549755813888||s>549755813887)return error.num;if(s<0)return(1099511627776+s).toString(16);var a=parseInt(s,10).toString(16);return typeof o=="undefined"?a:isNaN(o)?error.value:o<0?error.num:(o=Math.floor(o),o>=a.length?REPT("0",o-a.length)+a:error.num)},r.DEC2OCT=function(s,o){if(s=utils.parseNumber(s),s instanceof Error)return s;if(!/^-?[0-9]{1,9}$/.test(s)||s<-536870912||s>536870911)return error.num;if(s<0)return(1073741824+s).toString(8);var a=parseInt(s,10).toString(8);return typeof o=="undefined"?a:isNaN(o)?error.value:o<0?error.num:(o=Math.floor(o),o>=a.length?REPT("0",o-a.length)+a:error.num)},r.DELTA=function(s,o){return o=o===void 0?0:o,s=utils.parseNumber(s),o=utils.parseNumber(o),utils.anyIsError(s,o)?error.value:s===o?1:0},r.ERF=function(s,o){},r.ERF.PRECISE=function(){},r.ERFC=function(s){},r.ERFC.PRECISE=function(){},r.GESTEP=function(s,o){return o=o||0,s=utils.parseNumber(s),utils.anyIsError(o,s)?s:s>=o?1:0},r.HEX2BIN=function(s,o){if(!/^[0-9A-Fa-f]{1,10}$/.test(s))return error.num;var a=s.length===10&&s.substring(0,1).toLowerCase()==="f",d=a?parseInt(s,16)-1099511627776:parseInt(s,16);if(d<-512||d>511)return error.num;if(a)return"1"+REPT("0",9-(512+d).toString(2).length)+(512+d).toString(2);var u=d.toString(2);return o===void 0?u:isNaN(o)?error.value:o<0?error.num:(o=Math.floor(o),o>=u.length?REPT("0",o-u.length)+u:error.num)},r.HEX2DEC=function(s){if(!/^[0-9A-Fa-f]{1,10}$/.test(s))return error.num;var o=parseInt(s,16);return o>=549755813888?o-1099511627776:o},r.HEX2OCT=function(s,o){if(!/^[0-9A-Fa-f]{1,10}$/.test(s))return error.num;var a=parseInt(s,16);if(a>536870911&&a<1098974756864)return error.num;if(a>=1098974756864)return(a-1098437885952).toString(8);var d=a.toString(8);return o===void 0?d:isNaN(o)?error.value:o<0?error.num:(o=Math.floor(o),o>=d.length?REPT("0",o-d.length)+d:error.num)},r.IMABS=function(s){var o=r.IMREAL(s),a=r.IMAGINARY(s);return utils.anyIsError(o,a)?error.value:Math.sqrt(Math.pow(o,2)+Math.pow(a,2))},r.IMAGINARY=function(s){if(s===void 0||s===!0||s===!1)return error.value;if(s===0||s==="0")return 0;if(["i","j"].indexOf(s)>=0)return 1;s=s.replace("+i","+1i").replace("-i","-1i").replace("+j","+1j").replace("-j","-1j");var o=s.indexOf("+"),a=s.indexOf("-");o===0&&(o=s.indexOf("+",1)),a===0&&(a=s.indexOf("-",1));var d=s.substring(s.length-1,s.length),u=d==="i"||d==="j";return o>=0||a>=0?u?o>=0?isNaN(s.substring(0,o))||isNaN(s.substring(o+1,s.length-1))?error.num:Number(s.substring(o+1,s.length-1)):isNaN(s.substring(0,a))||isNaN(s.substring(a+1,s.length-1))?error.num:-Number(s.substring(a+1,s.length-1)):error.num:u?isNaN(s.substring(0,s.length-1))?error.num:s.substring(0,s.length-1):isNaN(s)?error.num:0},r.IMARGUMENT=function(s){var o=r.IMREAL(s),a=r.IMAGINARY(s);return utils.anyIsError(o,a)?error.value:o===0&&a===0?error.div0:o===0&&a>0?Math.PI/2:o===0&&a<0?-Math.PI/2:a===0&&o>0?0:a===0&&o<0?-Math.PI:o>0?Math.atan(a/o):o<0&&a>=0?Math.atan(a/o)+Math.PI:Math.atan(a/o)-Math.PI},r.IMCONJUGATE=function(s){var o=r.IMREAL(s),a=r.IMAGINARY(s);if(utils.anyIsError(o,a))return error.value;var d=s.substring(s.length-1);return d=d==="i"||d==="j"?d:"i",a!==0?r.COMPLEX(o,-a,d):s},r.IMCOS=function(s){var o=r.IMREAL(s),a=r.IMAGINARY(s);if(utils.anyIsError(o,a))return error.value;var d=s.substring(s.length-1);return d=d==="i"||d==="j"?d:"i",r.COMPLEX(Math.cos(o)*(Math.exp(a)+Math.exp(-a))/2,-Math.sin(o)*(Math.exp(a)-Math.exp(-a))/2,d)},r.IMCOSH=function(s){var o=r.IMREAL(s),a=r.IMAGINARY(s);if(utils.anyIsError(o,a))return error.value;var d=s.substring(s.length-1);return d=d==="i"||d==="j"?d:"i",r.COMPLEX(Math.cos(a)*(Math.exp(o)+Math.exp(-o))/2,Math.sin(a)*(Math.exp(o)-Math.exp(-o))/2,d)},r.IMCOT=function(s){var o=r.IMREAL(s),a=r.IMAGINARY(s);return utils.anyIsError(o,a)?error.value:r.IMDIV(r.IMCOS(s),r.IMSIN(s))},r.IMDIV=function(s,o){var a=r.IMREAL(s),d=r.IMAGINARY(s),u=r.IMREAL(o),f=r.IMAGINARY(o);if(utils.anyIsError(a,d,u,f))return error.value;var h=s.substring(s.length-1),g=o.substring(o.length-1),b="i";if((h==="j"||g==="j")&&(b="j"),u===0&&f===0)return error.num;var m=u*u+f*f;return r.COMPLEX((a*u+d*f)/m,(d*u-a*f)/m,b)},r.IMEXP=function(s){var o=r.IMREAL(s),a=r.IMAGINARY(s);if(utils.anyIsError(o,a))return error.value;var d=s.substring(s.length-1);d=d==="i"||d==="j"?d:"i";var u=Math.exp(o);return r.COMPLEX(u*Math.cos(a),u*Math.sin(a),d)},r.IMLN=function(s){var o=r.IMREAL(s),a=r.IMAGINARY(s);if(utils.anyIsError(o,a))return error.value;var d=s.substring(s.length-1);return d=d==="i"||d==="j"?d:"i",r.COMPLEX(Math.log(Math.sqrt(o*o+a*a)),Math.atan(a/o),d)},r.IMLOG10=function(s){var o=r.IMREAL(s),a=r.IMAGINARY(s);if(utils.anyIsError(o,a))return error.value;var d=s.substring(s.length-1);return d=d==="i"||d==="j"?d:"i",r.COMPLEX(Math.log(Math.sqrt(o*o+a*a))/Math.log(10),Math.atan(a/o)/Math.log(10),d)},r.IMLOG2=function(s){var o=r.IMREAL(s),a=r.IMAGINARY(s);if(utils.anyIsError(o,a))return error.value;var d=s.substring(s.length-1);return d=d==="i"||d==="j"?d:"i",r.COMPLEX(Math.log(Math.sqrt(o*o+a*a))/Math.log(2),Math.atan(a/o)/Math.log(2),d)},r.IMPOWER=function(s,o){o=utils.parseNumber(o);var a=r.IMREAL(s),d=r.IMAGINARY(s);if(utils.anyIsError(o,a,d))return error.value;var u=s.substring(s.length-1);u=u==="i"||u==="j"?u:"i";var f=Math.pow(r.IMABS(s),o),h=r.IMARGUMENT(s);return r.COMPLEX(f*Math.cos(o*h),f*Math.sin(o*h),u)},r.IMPRODUCT=function(){for(var s=arguments[0],o=1;o<arguments.length;o++){var a=r.IMREAL(s),d=r.IMAGINARY(s),u=r.IMREAL(arguments[o]),f=r.IMAGINARY(arguments[o]);if(utils.anyIsError(a,d,u,f))return error.value;s=r.COMPLEX(a*u-d*f,a*f+d*u)}return s},r.IMREAL=function(s){if(s===void 0||s===!0||s===!1)return error.value;if(s===0||s==="0"||["i","+i","1i","+1i","-i","-1i","j","+j","1j","+1j","-j","-1j"].indexOf(s)>=0)return 0;var o=s.indexOf("+"),a=s.indexOf("-");o===0&&(o=s.indexOf("+",1)),a===0&&(a=s.indexOf("-",1));var d=s.substring(s.length-1,s.length),u=d==="i"||d==="j";return o>=0||a>=0?u?o>=0?isNaN(s.substring(0,o))||isNaN(s.substring(o+1,s.length-1))?error.num:Number(s.substring(0,o)):isNaN(s.substring(0,a))||isNaN(s.substring(a+1,s.length-1))?error.num:Number(s.substring(0,a)):error.num:u?isNaN(s.substring(0,s.length-1))?error.num:0:isNaN(s)?error.num:s},r.IMSEC=function(s){if(s===!0||s===!1)return error.value;var o=r.IMREAL(s),a=r.IMAGINARY(s);return utils.anyIsError(o,a)?error.value:r.IMDIV("1",r.IMCOS(s))},r.IMSECH=function(s){var o=r.IMREAL(s),a=r.IMAGINARY(s);return utils.anyIsError(o,a)?error.value:r.IMDIV("1",r.IMCOSH(s))},r.IMSIN=function(s){var o=r.IMREAL(s),a=r.IMAGINARY(s);if(utils.anyIsError(o,a))return error.value;var d=s.substring(s.length-1);return d=d==="i"||d==="j"?d:"i",r.COMPLEX(Math.sin(o)*(Math.exp(a)+Math.exp(-a))/2,Math.cos(o)*(Math.exp(a)-Math.exp(-a))/2,d)},r.IMSINH=function(s){var o=r.IMREAL(s),a=r.IMAGINARY(s);if(utils.anyIsError(o,a))return error.value;var d=s.substring(s.length-1);return d=d==="i"||d==="j"?d:"i",r.COMPLEX(Math.cos(a)*(Math.exp(o)-Math.exp(-o))/2,Math.sin(a)*(Math.exp(o)+Math.exp(-o))/2,d)},r.IMSQRT=function(s){var o=r.IMREAL(s),a=r.IMAGINARY(s);if(utils.anyIsError(o,a))return error.value;var d=s.substring(s.length-1);d=d==="i"||d==="j"?d:"i";var u=Math.sqrt(r.IMABS(s)),f=r.IMARGUMENT(s);return r.COMPLEX(u*Math.cos(f/2),u*Math.sin(f/2),d)},r.IMCSC=function(s){if(s===!0||s===!1)return error.value;var o=r.IMREAL(s),a=r.IMAGINARY(s);return utils.anyIsError(o,a)?error.num:r.IMDIV("1",r.IMSIN(s))},r.IMCSCH=function(s){if(s===!0||s===!1)return error.value;var o=r.IMREAL(s),a=r.IMAGINARY(s);return utils.anyIsError(o,a)?error.num:r.IMDIV("1",r.IMSINH(s))},r.IMSUB=function(s,o){var a=this.IMREAL(s),d=this.IMAGINARY(s),u=this.IMREAL(o),f=this.IMAGINARY(o);if(utils.anyIsError(a,d,u,f))return error.value;var h=s.substring(s.length-1),g=o.substring(o.length-1),b="i";return(h==="j"||g==="j")&&(b="j"),this.COMPLEX(a-u,d-f,b)},r.IMSUM=function(){for(var s=utils.flatten(arguments),o=s[0],a=1;a<s.length;a++){var d=this.IMREAL(o),u=this.IMAGINARY(o),f=this.IMREAL(s[a]),h=this.IMAGINARY(s[a]);if(utils.anyIsError(d,u,f,h))return error.value;o=this.COMPLEX(d+f,u+h)}return o},r.IMTAN=function(s){if(s===!0||s===!1)return error.value;var o=r.IMREAL(s),a=r.IMAGINARY(s);return utils.anyIsError(o,a)?error.value:this.IMDIV(this.IMSIN(s),this.IMCOS(s))},r.OCT2BIN=function(s,o){if(!/^[0-7]{1,10}$/.test(s))return error.num;var a=s.length===10&&s.substring(0,1)==="7",d=a?parseInt(s,8)-1073741824:parseInt(s,8);if(d<-512||d>511)return error.num;if(a)return"1"+REPT("0",9-(512+d).toString(2).length)+(512+d).toString(2);var u=d.toString(2);return typeof o=="undefined"?u:isNaN(o)?error.value:o<0?error.num:(o=Math.floor(o),o>=u.length?REPT("0",o-u.length)+u:error.num)},r.OCT2DEC=function(s){if(!/^[0-7]{1,10}$/.test(s))return error.num;var o=parseInt(s,8);return o>=536870912?o-1073741824:o},r.OCT2HEX=function(s,o){if(!/^[0-7]{1,10}$/.test(s))return error.num;var a=parseInt(s,8);if(a>=536870912)return"ff"+(a+3221225472).toString(16);var d=a.toString(16);return o===void 0?d:isNaN(o)?error.value:o<0?error.num:(o=Math.floor(o),o>=d.length?REPT("0",o-d.length)+d:error.num)},r}(),met.financial=function(){var r={};function e(o){return o&&o.getTime&&!isNaN(o.getTime())}function s(o){return o instanceof Date?o:new Date(o)}return r.ACCRINT=function(o,a,d,u,f,h,g){return o=s(o),a=s(a),d=s(d),!e(o)||!e(a)||!e(d)?"#VALUE!":u<=0||f<=0||[1,2,4].indexOf(h)===-1||[0,1,2,3,4].indexOf(g)===-1||d<=o?"#NUM!":(f=f||0,g=g||0,f*u*YEARFRAC(o,d,g))},r.ACCRINTM=null,r.AMORDEGRC=null,r.AMORLINC=null,r.COUPDAYBS=null,r.COUPDAYS=null,r.COUPDAYSNC=null,r.COUPNCD=null,r.COUPNUM=null,r.COUPPCD=null,r.CUMIPMT=function(o,a,d,u,f,h){if(o=utils.parseNumber(o),a=utils.parseNumber(a),d=utils.parseNumber(d),utils.anyIsError(o,a,d))return error.value;if(o<=0||a<=0||d<=0||u<1||f<1||u>f||h!==0&&h!==1)return error.num;var g=r.PMT(o,a,d,0,h),b=0;u===1&&h===0&&(b=-d,u++);for(var m=u;m<=f;m++)h===1?b+=r.FV(o,m-2,g,d,1)-g:b+=r.FV(o,m-1,g,d,0);return b*=o,b},r.CUMPRINC=function(o,a,d,u,f,h){if(o=utils.parseNumber(o),a=utils.parseNumber(a),d=utils.parseNumber(d),utils.anyIsError(o,a,d))return error.value;if(o<=0||a<=0||d<=0||u<1||f<1||u>f||h!==0&&h!==1)return error.num;var g=r.PMT(o,a,d,0,h),b=0;u===1&&(h===0?b=g+d*o:b=g,u++);for(var m=u;m<=f;m++)h>0?b+=g-(r.FV(o,m-2,g,d,1)-g)*o:b+=g-r.FV(o,m-1,g,d,0)*o;return b},r.DB=function(o,a,d,u,f){if(f=f===void 0?12:f,o=utils.parseNumber(o),a=utils.parseNumber(a),d=utils.parseNumber(d),u=utils.parseNumber(u),f=utils.parseNumber(f),utils.anyIsError(o,a,d,u,f))return error.value;if(o<0||a<0||d<0||u<0||[1,2,3,4,5,6,7,8,9,10,11,12].indexOf(f)===-1||u>d)return error.num;if(a>=o)return 0;for(var h=(1-Math.pow(a/o,1/d)).toFixed(3),g=o*h*f/12,b=g,m=0,_=u===d?d-1:u,Ge=2;Ge<=_;Ge++)m=(o-b)*h,b+=m;return u===1?g:u===d?(o-b)*h:m},r.DDB=function(o,a,d,u,f){if(f=f===void 0?2:f,o=utils.parseNumber(o),a=utils.parseNumber(a),d=utils.parseNumber(d),u=utils.parseNumber(u),f=utils.parseNumber(f),utils.anyIsError(o,a,d,u,f))return error.value;if(o<0||a<0||d<0||u<0||f<=0||u>d)return error.num;if(a>=o)return 0;for(var h=0,g=0,b=1;b<=u;b++)g=Math.min((o-h)*(f/d),o-a-h),h+=g;return g},r.DISC=null,r.DOLLARDE=function(o,a){if(o=utils.parseNumber(o),a=utils.parseNumber(a),utils.anyIsError(o,a))return error.value;if(a<0)return error.num;if(a>=0&&a<1)return error.div0;a=parseInt(a,10);var d=parseInt(o,10);d+=o%1*Math.pow(10,Math.ceil(Math.log(a)/Math.LN10))/a;var u=Math.pow(10,Math.ceil(Math.log(a)/Math.LN2)+1);return d=Math.round(d*u)/u,d},r.DOLLARFR=function(o,a){if(o=utils.parseNumber(o),a=utils.parseNumber(a),utils.anyIsError(o,a))return error.value;if(a<0)return error.num;if(a>=0&&a<1)return error.div0;a=parseInt(a,10);var d=parseInt(o,10);return d+=o%1*Math.pow(10,-Math.ceil(Math.log(a)/Math.LN10))*a,d},r.DURATION=null,r.EFFECT=function(o,a){return o=utils.parseNumber(o),a=utils.parseNumber(a),utils.anyIsError(o,a)?error.value:o<=0||a<1?error.num:(a=parseInt(a,10),Math.pow(1+o/a,a)-1)},r.FV=function(o,a,d,u,f){if(u=u||0,f=f||0,o=utils.parseNumber(o),a=utils.parseNumber(a),d=utils.parseNumber(d),u=utils.parseNumber(u),f=utils.parseNumber(f),utils.anyIsError(o,a,d,u,f))return error.value;var h;if(o===0)h=u+d*a;else{var g=Math.pow(1+o,a);f===1?h=u*g+d*(1+o)*(g-1)/o:h=u*g+d*(g-1)/o}return-h},r.FVSCHEDULE=function(o,a){if(o=utils.parseNumber(o),a=utils.parseNumberArray(utils.flatten(a)),utils.anyIsError(o,a))return error.value;for(var d=a.length,u=o,f=0;f<d;f++)u*=1+a[f];return u},r.INTRATE=null,r.IPMT=function(o,a,d,u,f,h){if(f=f||0,h=h||0,o=utils.parseNumber(o),a=utils.parseNumber(a),d=utils.parseNumber(d),u=utils.parseNumber(u),f=utils.parseNumber(f),h=utils.parseNumber(h),utils.anyIsError(o,a,d,u,f,h))return error.value;var g=r.PMT(o,d,u,f,h),b;return a===1?h===1?b=0:b=-u:h===1?b=r.FV(o,a-2,g,u,1)-g:b=r.FV(o,a-1,g,u,0),b*o},r.IRR=function(o,a){if(a=a||0,o=utils.parseNumberArray(utils.flatten(o)),a=utils.parseNumber(a),utils.anyIsError(o,a))return error.value;for(var d=function(er,ar,Lr){for(var Mr=Lr+1,Br=er[0],Qr=1;Qr<er.length;Qr++)Br+=er[Qr]/Math.pow(Mr,(ar[Qr]-ar[0])/365);return Br},u=function(er,ar,Lr){for(var Mr=Lr+1,Br=0,Qr=1;Qr<er.length;Qr++){var ii=(ar[Qr]-ar[0])/365;Br-=ii*er[Qr]/Math.pow(Mr,ii+1)}return Br},f=[],h=!1,g=!1,b=0;b<o.length;b++)f[b]=b===0?0:f[b-1]+365,o[b]>0&&(h=!0),o[b]<0&&(g=!0);if(!h||!g)return error.num;a=a===void 0?.1:a;var m=a,_=1e-10,Ge,ot,rr,ir=!0;do rr=d(o,f,m),Ge=m-rr/u(o,f,m),ot=Math.abs(Ge-m),m=Ge,ir=ot>_&&Math.abs(rr)>_;while(ir);return m},r.ISPMT=function(o,a,d,u){return o=utils.parseNumber(o),a=utils.parseNumber(a),d=utils.parseNumber(d),u=utils.parseNumber(u),utils.anyIsError(o,a,d,u)?error.value:u*o*(a/d-1)},r.MDURATION=null,r.MIRR=function(o,a,d){if(o=utils.parseNumberArray(utils.flatten(o)),a=utils.parseNumber(a),d=utils.parseNumber(d),utils.anyIsError(o,a,d))return error.value;for(var u=o.length,f=[],h=[],g=0;g<u;g++)o[g]<0?f.push(o[g]):h.push(o[g]);var b=-r.NPV(d,h)*Math.pow(1+d,u-1),m=r.NPV(a,f)*(1+a);return Math.pow(b/m,1/(u-1))-1},r.NOMINAL=function(o,a){return o=utils.parseNumber(o),a=utils.parseNumber(a),utils.anyIsError(o,a)?error.value:o<=0||a<1?error.num:(a=parseInt(a,10),(Math.pow(o+1,1/a)-1)*a)},r.NPER=function(o,a,d,u,f){if(f=f===void 0?0:f,u=u===void 0?0:u,o=utils.parseNumber(o),a=utils.parseNumber(a),d=utils.parseNumber(d),u=utils.parseNumber(u),f=utils.parseNumber(f),utils.anyIsError(o,a,d,u,f))return error.value;var h=a*(1+o*f)-u*o,g=d*o+a*(1+o*f);return Math.log(h/g)/Math.log(1+o)},r.NPV=function(){var o=utils.parseNumberArray(utils.flatten(arguments));if(o instanceof Error)return o;for(var a=o[0],d=0,u=1;u<o.length;u++)d+=o[u]/Math.pow(1+a,u);return d},r.ODDFPRICE=null,r.ODDFYIELD=null,r.ODDLPRICE=null,r.ODDLYIELD=null,r.PDURATION=function(o,a,d){return o=utils.parseNumber(o),a=utils.parseNumber(a),d=utils.parseNumber(d),utils.anyIsError(o,a,d)?error.value:o<=0?error.num:(Math.log(d)-Math.log(a))/Math.log(1+o)},r.PMT=function(o,a,d,u,f){if(u=u||0,f=f||0,o=utils.parseNumber(o),a=utils.parseNumber(a),d=utils.parseNumber(d),u=utils.parseNumber(u),f=utils.parseNumber(f),utils.anyIsError(o,a,d,u,f))return error.value;var h;if(o===0)h=(d+u)/a;else{var g=Math.pow(1+o,a);f===1?h=(u*o/(g-1)+d*o/(1-1/g))/(1+o):h=u*o/(g-1)+d*o/(1-1/g)}return-h},r.PPMT=function(o,a,d,u,f,h){return f=f||0,h=h||0,o=utils.parseNumber(o),d=utils.parseNumber(d),u=utils.parseNumber(u),f=utils.parseNumber(f),h=utils.parseNumber(h),utils.anyIsError(o,d,u,f,h)?error.value:r.PMT(o,d,u,f,h)-r.IPMT(o,a,d,u,f,h)},r.PRICE=null,r.PRICEDISC=null,r.PRICEMAT=null,r.PV=function(o,a,d,u,f){return u=u||0,f=f||0,o=utils.parseNumber(o),a=utils.parseNumber(a),d=utils.parseNumber(d),u=utils.parseNumber(u),f=utils.parseNumber(f),utils.anyIsError(o,a,d,u,f)?error.value:o===0?-d*a-u:((1-Math.pow(1+o,a))/o*d*(1+o*f)-u)/Math.pow(1+o,a)},r.RATE=function(o,a,d,u,f,h){if(h=h===void 0?.01:h,u=u===void 0?0:u,f=f===void 0?0:f,o=utils.parseNumber(o),a=utils.parseNumber(a),d=utils.parseNumber(d),u=utils.parseNumber(u),f=utils.parseNumber(f),h=utils.parseNumber(h),utils.anyIsError(o,a,d,u,f,h))return error.value;for(var g=1e-6,b=100,m=0,_=!1,Ge=h;m<b&&!_;){var ot=Math.pow(Ge+1,o),rr=Math.pow(Ge+1,o-1),ir=u+ot*d+a*(ot-1)*(Ge*f+1)/Ge,er=o*rr*d-a*(ot-1)*(Ge*f+1)/Math.pow(Ge,2),ar=o*a*rr*(Ge*f+1)/Ge+a*(ot-1)*f/Ge,Lr=Ge-ir/(er+ar);Math.abs(Lr-Ge)<g&&(_=!0),m++,Ge=Lr}return _?Ge:Number.NaN+Ge},r.RECEIVED=null,r.RRI=function(o,a,d){return o=utils.parseNumber(o),a=utils.parseNumber(a),d=utils.parseNumber(d),utils.anyIsError(o,a,d)?error.value:o===0||a===0?error.num:Math.pow(d/a,1/o)-1},r.SLN=function(o,a,d){return o=utils.parseNumber(o),a=utils.parseNumber(a),d=utils.parseNumber(d),utils.anyIsError(o,a,d)?error.value:d===0?error.num:(o-a)/d},r.SYD=function(o,a,d,u){return o=utils.parseNumber(o),a=utils.parseNumber(a),d=utils.parseNumber(d),u=utils.parseNumber(u),utils.anyIsError(o,a,d,u)?error.value:d===0||u<1||u>d?error.num:(u=parseInt(u,10),(o-a)*(d-u+1)*2/(d*(d+1)))},r.TBILLEQ=function(o,a,d){return o=utils.parseDate(o),a=utils.parseDate(a),d=utils.parseNumber(d),utils.anyIsError(o,a,d)?error.value:d<=0||o>a||a-o>365*24*60*60*1e3?error.num:365*d/(360-d*DAYS360(o,a,!1))},r.TBILLPRICE=function(o,a,d){return o=utils.parseDate(o),a=utils.parseDate(a),d=utils.parseNumber(d),utils.anyIsError(o,a,d)?error.value:d<=0||o>a||a-o>365*24*60*60*1e3?error.num:100*(1-d*DAYS360(o,a,!1)/360)},r.TBILLYIELD=function(o,a,d){return o=utils.parseDate(o),a=utils.parseDate(a),d=utils.parseNumber(d),utils.anyIsError(o,a,d)?error.value:d<=0||o>a||a-o>365*24*60*60*1e3?error.num:(100-d)*360/(d*DAYS360(o,a,!1))},r.VDB=null,r.XIRR=function(o,a,d){if(o=utils.parseNumberArray(utils.flatten(o)),a=utils.parseDateArray(utils.flatten(a)),d=utils.parseNumber(d),utils.anyIsError(o,a,d))return error.value;for(var u=function(er,ar,Lr){for(var Mr=Lr+1,Br=er[0],Qr=1;Qr<er.length;Qr++)Br+=er[Qr]/Math.pow(Mr,DAYS(ar[Qr],ar[0])/365);return Br},f=function(er,ar,Lr){for(var Mr=Lr+1,Br=0,Qr=1;Qr<er.length;Qr++){var ii=DAYS(ar[Qr],ar[0])/365;Br-=ii*er[Qr]/Math.pow(Mr,ii+1)}return Br},h=!1,g=!1,b=0;b<o.length;b++)o[b]>0&&(h=!0),o[b]<0&&(g=!0);if(!h||!g)return error.num;d=d||.1;var m=d,_=1e-10,Ge,ot,rr,ir=!0;do rr=u(o,a,m),Ge=m-rr/f(o,a,m),ot=Math.abs(Ge-m),m=Ge,ir=ot>_&&Math.abs(rr)>_;while(ir);return m},r.XNPV=function(o,a,d){if(o=utils.parseNumber(o),a=utils.parseNumberArray(utils.flatten(a)),d=utils.parseDateArray(utils.flatten(d)),utils.anyIsError(o,a,d))return error.value;for(var u=0,f=0;f<a.length;f++)u+=a[f]/Math.pow(1+o,DAYS(d[f],d[0])/365);return u},r.YIELD=null,r.YIELDDISC=null,r.YIELDMAT=null,r}(),met.information=function(){var r={};return r.CELL=null,r.ERROR={},r.ERROR.TYPE=function(e){switch(e){case error.nil:return 1;case error.div0:return 2;case error.value:return 3;case error.ref:return 4;case error.name:return 5;case error.num:return 6;case error.na:return 7;case error.data:return 8}return error.na},r.INFO=null,r.ISBLANK=function(e){return e===null},r.ISBINARY=function(e){return/^[01]{1,10}$/.test(e)},r.ISERR=function(e){return[error.value,error.ref,error.div0,error.num,error.name,error.nil].indexOf(e)>=0||typeof e=="number"&&(isNaN(e)||!isFinite(e))},r.ISERROR=function(e){return r.ISERR(e)||e===error.na},r.ISEVEN=function(e){return!(Math.floor(Math.abs(e))&1)},r.ISFORMULA=null,r.ISLOGICAL=function(e){return e===!0||e===!1},r.ISNA=function(e){return e===error.na},r.ISNONTEXT=function(e){return typeof e!="string"},r.ISNUMBER=function(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)},r.ISODD=function(e){return!!(Math.floor(Math.abs(e))&1)},r.ISREF=null,r.ISTEXT=function(e){return typeof e=="string"},r.N=function(e){return this.ISNUMBER(e)?e:e instanceof Date?e.getTime():e===!0?1:e===!1?0:this.ISERROR(e)?e:0},r.NA=function(){return error.na},r.SHEET=null,r.SHEETS=null,r.TYPE=function(e){if(this.ISNUMBER(e))return 1;if(this.ISTEXT(e))return 2;if(this.ISLOGICAL(e))return 4;if(this.ISERROR(e))return 16;if(Array.isArray(e))return 64},r}(),met.logical=function(){var r={};return r.AND=function(){for(var e=utils.flatten(arguments),s=!0,o=0;o<e.length;o++)e[o]||(s=!1);return s},r.CHOOSE=function(){if(arguments.length<2)return error.na;var e=arguments[0];return e<1||e>254||arguments.length<e+1?error.value:arguments[e]},r.FALSE=function(){return!1},r.IF=function(e,s,o){return e?s:o},r.IFERROR=function(e,s){return ISERROR(e)?s:e},r.IFNA=function(e,s){return e===error.na?s:e},r.NOT=function(e){return!e},r.OR=function(){for(var e=utils.flatten(arguments),s=!1,o=0;o<e.length;o++)e[o]&&(s=!0);return s},r.TRUE=function(){return!0},r.XOR=function(){for(var e=utils.flatten(arguments),s=0,o=0;o<e.length;o++)e[o]&&s++;return!!(Math.floor(Math.abs(s))&1)},r.SWITCH=function(){var e;if(arguments.length>0){var s=arguments[0],o=arguments.length-1,a=Math.floor(o/2),d=!1,u=o%2==0?null:arguments[arguments.length-1];if(a){for(var f=0;f<a;f++)if(s===arguments[f*2+1]){e=arguments[f*2+2],d=!0;break}}!d&&u&&(e=u)}return e},r}(),met.math=function(){var exports={};exports.ABS=function(r){return r=utils.parseNumber(r),r instanceof Error?r:Math.abs(utils.parseNumber(r))},exports.ACOS=function(r){return r=utils.parseNumber(r),r instanceof Error?r:Math.acos(r)},exports.ACOSH=function(r){return r=utils.parseNumber(r),r instanceof Error?r:Math.log(r+Math.sqrt(r*r-1))},exports.ACOT=function(r){return r=utils.parseNumber(r),r instanceof Error?r:Math.atan(1/r)},exports.ACOTH=function(r){return r=utils.parseNumber(r),r instanceof Error?r:.5*Math.log((r+1)/(r-1))},exports.AGGREGATE=null,exports.ARABIC=function(r){if(!/^M*(?:D?C{0,3}|C[MD])(?:L?X{0,3}|X[CL])(?:V?I{0,3}|I[XV])$/.test(r))return error.value;var e=0;return r.replace(/[MDLV]|C[MD]?|X[CL]?|I[XV]?/g,function(s){e+={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1}[s]}),e},exports.ASIN=function(r){return r=utils.parseNumber(r),r instanceof Error?r:Math.asin(r)},exports.ASINH=function(r){return r=utils.parseNumber(r),r instanceof Error?r:Math.log(r+Math.sqrt(r*r+1))},exports.ATAN=function(r){return r=utils.parseNumber(r),r instanceof Error?r:Math.atan(r)},exports.ATAN2=function(r,e){return r=utils.parseNumber(r),e=utils.parseNumber(e),utils.anyIsError(r,e)?error.value:Math.atan2(r,e)},exports.ATANH=function(r){return r=utils.parseNumber(r),r instanceof Error?r:Math.log((1+r)/(1-r))/2},exports.BASE=function(r,e,s){if(s=s||0,r=utils.parseNumber(r),e=utils.parseNumber(e),s=utils.parseNumber(s),utils.anyIsError(r,e,s))return error.value;s=s===void 0?0:s;var o=r.toString(e);return new Array(Math.max(s+1-o.length,0)).join("0")+o},exports.CEILING=function(r,e,s){return e=e===void 0?1:e,s=s===void 0?0:s,r=utils.parseNumber(r),e=utils.parseNumber(e),s=utils.parseNumber(s),utils.anyIsError(r,e,s)?error.value:e===0?0:(e=Math.abs(e),r>=0?Math.ceil(r/e)*e:s===0?-1*Math.floor(Math.abs(r)/e)*e:-1*Math.ceil(Math.abs(r)/e)*e)},exports.CEILING.MATH=exports.CEILING,exports.CEILING.PRECISE=exports.CEILING,exports.COMBIN=function(r,e){return r=utils.parseNumber(r),e=utils.parseNumber(e),utils.anyIsError(r,e)?error.value:exports.FACT(r)/(exports.FACT(e)*exports.FACT(r-e))},exports.COMBINA=function(r,e){return r=utils.parseNumber(r),e=utils.parseNumber(e),utils.anyIsError(r,e)?error.value:r===0&&e===0?1:exports.COMBIN(r+e-1,r-1)},exports.COS=function(r){return r=utils.parseNumber(r),r instanceof Error?r:Math.cos(r)},exports.COSH=function(r){return r=utils.parseNumber(r),r instanceof Error?r:(Math.exp(r)+Math.exp(-r))/2},exports.COT=function(r){return r=utils.parseNumber(r),r instanceof Error?r:1/Math.tan(r)},exports.COTH=function(r){if(r=utils.parseNumber(r),r instanceof Error)return r;var e=Math.exp(2*r);return(e+1)/(e-1)},exports.CSC=function(r){return r=utils.parseNumber(r),r instanceof Error?r:1/Math.sin(r)},exports.CSCH=function(r){return r=utils.parseNumber(r),r instanceof Error?r:2/(Math.exp(r)-Math.exp(-r))},exports.DECIMAL=function(r,e){return arguments.length<1?error.value:parseInt(r,e)},exports.DEGREES=function(r){return r=utils.parseNumber(r),r instanceof Error?r:r*180/Math.PI},exports.EVEN=function(r){return r=utils.parseNumber(r),r instanceof Error?r:exports.CEILING(r,-2,-1)},exports.EXP=Math.exp;var MEMOIZED_FACT=[];return exports.FACT=function(r){if(r=utils.parseNumber(r),r instanceof Error)return r;var e=Math.floor(r);return e===0||e===1?1:(MEMOIZED_FACT[e]>0||(MEMOIZED_FACT[e]=exports.FACT(e-1)*e),MEMOIZED_FACT[e])},exports.FACTDOUBLE=function(r){if(r=utils.parseNumber(r),r instanceof Error)return r;var e=Math.floor(r);return e<=0?1:e*exports.FACTDOUBLE(e-2)},exports.FLOOR=function(r,e,s){return e=e===void 0?1:e,s=s===void 0?0:s,r=utils.parseNumber(r),e=utils.parseNumber(e),s=utils.parseNumber(s),utils.anyIsError(r,e,s)?error.value:e===0?0:(e=Math.abs(e),r>=0?Math.floor(r/e)*e:s===0?-1*Math.ceil(Math.abs(r)/e)*e:-1*Math.floor(Math.abs(r)/e)*e)},exports.FLOOR.MATH=exports.FLOOR,exports.GCD=null,exports.INT=function(r){return r=utils.parseNumber(r),r instanceof Error?r:Math.floor(r)},exports.LCM=function(){var r=utils.parseNumberArray(utils.flatten(arguments));if(r instanceof Error)return r;for(var e,s,o,a,d=1;(o=r.pop())!==void 0;)for(;o>1;){if(o%2){for(e=3,s=Math.floor(Math.sqrt(o));e<=s&&o%e;e+=2);a=e<=s?e:o}else a=2;for(o/=a,d*=a,e=r.length;e;r[--e]%a==0&&(r[e]/=a)==1&&r.splice(e,1));}return d},exports.LN=function(r){return r=utils.parseNumber(r),r instanceof Error?r:Math.log(r)},exports.LOG=function(r,e){return r=utils.parseNumber(r),e=e===void 0?10:utils.parseNumber(e),utils.anyIsError(r,e)?error.value:Math.log(r)/Math.log(e)},exports.LOG10=function(r){return r=utils.parseNumber(r),r instanceof Error?r:Math.log(r)/Math.log(10)},exports.MDETERM=null,exports.MINVERSE=null,exports.MMULT=null,exports.MOD=function(r,e){if(r=utils.parseNumber(r),e=utils.parseNumber(e),utils.anyIsError(r,e))return error.value;if(e===0)return error.div0;var s=Math.abs(r%e);return e>0?s:-s},exports.MROUND=function(r,e){return r=utils.parseNumber(r),e=utils.parseNumber(e),utils.anyIsError(r,e)?error.value:r*e<0?error.num:Math.round(r/e)*e},exports.MULTINOMIAL=function(){var r=utils.parseNumberArray(utils.flatten(arguments));if(r instanceof Error)return r;for(var e=0,s=1,o=0;o<r.length;o++)e+=r[o],s*=exports.FACT(r[o]);return exports.FACT(e)/s},exports.MUNIT=null,exports.ODD=function(r){if(r=utils.parseNumber(r),r instanceof Error)return r;var e=Math.ceil(Math.abs(r));return e=e&1?e:e+1,r>0?e:-e},exports.PI=function(){return Math.PI},exports.POWER=function(r,e){if(r=utils.parseNumber(r),e=utils.parseNumber(e),utils.anyIsError(r,e))return error.value;var s=Math.pow(r,e);return isNaN(s)?error.num:s},exports.PRODUCT=function(){var r=utils.parseNumberArray(utils.flatten(arguments));if(r instanceof Error)return r;for(var e=1,s=0;s<r.length;s++)e*=r[s];return e},exports.QUOTIENT=function(r,e){return r=utils.parseNumber(r),e=utils.parseNumber(e),utils.anyIsError(r,e)?error.value:parseInt(r/e,10)},exports.RADIANS=function(r){return r=utils.parseNumber(r),r instanceof Error?r:r*Math.PI/180},exports.RAND=function(){return Math.random()},exports.RANDBETWEEN=function(r,e){return r=utils.parseNumber(r),e=utils.parseNumber(e),utils.anyIsError(r,e)?error.value:r+Math.ceil((e-r+1)*Math.random())-1},exports.ROMAN=null,exports.ROUND=function(r,e){return r=utils.parseNumber(r),e=utils.parseNumber(e),utils.anyIsError(r,e)?error.value:Math.round(r*Math.pow(10,e))/Math.pow(10,e)},exports.ROUNDDOWN=function(r,e){if(r=utils.parseNumber(r),e=utils.parseNumber(e),utils.anyIsError(r,e))return error.value;var s=r>0?1:-1;return s*Math.floor(Math.abs(r)*Math.pow(10,e))/Math.pow(10,e)},exports.ROUNDUP=function(r,e){if(r=utils.parseNumber(r),e=utils.parseNumber(e),utils.anyIsError(r,e))return error.value;var s=r>0?1:-1;return s*Math.ceil(Math.abs(r)*Math.pow(10,e))/Math.pow(10,e)},exports.SEC=function(r){return r=utils.parseNumber(r),r instanceof Error?r:1/Math.cos(r)},exports.SECH=function(r){return r=utils.parseNumber(r),r instanceof Error?r:2/(Math.exp(r)+Math.exp(-r))},exports.SERIESSUM=function(r,e,s,o){if(r=utils.parseNumber(r),e=utils.parseNumber(e),s=utils.parseNumber(s),o=utils.parseNumberArray(o),utils.anyIsError(r,e,s,o))return error.value;for(var a=o[0]*Math.pow(r,e),d=1;d<o.length;d++)a+=o[d]*Math.pow(r,e+d*s);return a},exports.SIGN=function(r){return r=utils.parseNumber(r),r instanceof Error?r:r<0?-1:r===0?0:1},exports.SIN=function(r){return r=utils.parseNumber(r),r instanceof Error?r:Math.sin(r)},exports.SINH=function(r){return r=utils.parseNumber(r),r instanceof Error?r:(Math.exp(r)-Math.exp(-r))/2},exports.SQRT=function(r){return r=utils.parseNumber(r),r instanceof Error?r:r<0?error.num:Math.sqrt(r)},exports.SQRTPI=function(r){return r=utils.parseNumber(r),r instanceof Error?r:Math.sqrt(r*Math.PI)},exports.SUBTOTAL=null,exports.ADD=function(r,e){return arguments.length!==2?error.na:(r=utils.parseNumber(r),e=utils.parseNumber(e),utils.anyIsError(r,e)?error.value:r+e)},exports.MINUS=function(r,e){return arguments.length!==2?error.na:(r=utils.parseNumber(r),e=utils.parseNumber(e),utils.anyIsError(r,e)?error.value:r-e)},exports.DIVIDE=function(r,e){return arguments.length!==2?error.na:(r=utils.parseNumber(r),e=utils.parseNumber(e),utils.anyIsError(r,e)?error.value:e===0?error.div0:r/e)},exports.MULTIPLY=function(r,e){return arguments.length!==2?error.na:(r=utils.parseNumber(r),e=utils.parseNumber(e),utils.anyIsError(r,e)?error.value:r*e)},exports.GTE=function(r,e){return arguments.length!==2?error.na:(r=utils.parseNumber(r),e=utils.parseNumber(e),utils.anyIsError(r,e)?error.error:r>=e)},exports.LT=function(r,e){return arguments.length!==2?error.na:(r=utils.parseNumber(r),e=utils.parseNumber(e),utils.anyIsError(r,e)?error.error:r<e)},exports.LTE=function(r,e){return arguments.length!==2?error.na:(r=utils.parseNumber(r),e=utils.parseNumber(e),utils.anyIsError(r,e)?error.error:r<=e)},exports.EQ=function(r,e){return arguments.length!==2?error.na:r===e},exports.NE=function(r,e){return arguments.length!==2?error.na:r!==e},exports.POW=function(r,e){return arguments.length!==2?error.na:(r=utils.parseNumber(r),e=utils.parseNumber(e),utils.anyIsError(r,e)?error.error:exports.POWER(r,e))},exports.SUM=function(){for(var r=0,e=Object.keys(arguments),s=0;s<e.length;++s){var o=arguments[e[s]];if(typeof o=="number")r+=o;else if(typeof o=="string"){var a=parseFloat(o);!isNaN(a)&&(r+=a)}else Array.isArray(o)&&(r+=exports.SUM.apply(null,o))}return r},exports.SUMIF=function(){var args=utils.argsToArray(arguments),criteria=args.pop(),range=utils.parseNumberArray(utils.flatten(args));if(range instanceof Error)return range;for(var result=0,i=0;i<range.length;i++)result+=eval(range[i]+criteria)?range[i]:0;return result},exports.SUMIFS=function(){var args=utils.argsToArray(arguments),range=utils.parseNumberArray(utils.flatten(args.shift()));if(range instanceof Error)return range;for(var criteria=args,n_range_elements=range.length,n_criterias=criteria.length,result=0,i=0;i<n_range_elements;i++){for(var el=range[i],condition="",c=0;c<n_criterias;c+=2)isNaN(criteria[c][i])?condition+='"'+criteria[c][i]+'"'+criteria[c+1]:condition+=criteria[c][i]+criteria[c+1],c!==n_criterias-1&&(condition+=" && ");condition=condition.slice(0,-4),eval(condition)&&(result+=el)}return result},exports.SUMPRODUCT=null,exports.SUMSQ=function(){var r=utils.parseNumberArray(utils.flatten(arguments));if(r instanceof Error)return r;for(var e=0,s=r.length,o=0;o<s;o++)e+=ISNUMBER(r[o])?r[o]*r[o]:0;return e},exports.SUMX2MY2=function(r,e){if(r=utils.parseNumberArray(utils.flatten(r)),e=utils.parseNumberArray(utils.flatten(e)),utils.anyIsError(r,e))return error.value;for(var s=0,o=0;o<r.length;o++)s+=r[o]*r[o]-e[o]*e[o];return s},exports.SUMX2PY2=function(r,e){if(r=utils.parseNumberArray(utils.flatten(r)),e=utils.parseNumberArray(utils.flatten(e)),utils.anyIsError(r,e))return error.value;var s=0;r=utils.parseNumberArray(utils.flatten(r)),e=utils.parseNumberArray(utils.flatten(e));for(var o=0;o<r.length;o++)s+=r[o]*r[o]+e[o]*e[o];return s},exports.SUMXMY2=function(r,e){if(r=utils.parseNumberArray(utils.flatten(r)),e=utils.parseNumberArray(utils.flatten(e)),utils.anyIsError(r,e))return error.value;var s=0;r=utils.flatten(r),e=utils.flatten(e);for(var o=0;o<r.length;o++)s+=Math.pow(r[o]-e[o],2);return s},exports.TAN=function(r){return r=utils.parseNumber(r),r instanceof Error?r:Math.tan(r)},exports.TANH=function(r){if(r=utils.parseNumber(r),r instanceof Error)return r;var e=Math.exp(2*r);return(e-1)/(e+1)},exports.TRUNC=function(r,e){if(e=e===void 0?0:e,r=utils.parseNumber(r),e=utils.parseNumber(e),utils.anyIsError(r,e))return error.value;var s=r>0?1:-1;return s*Math.floor(Math.abs(r)*Math.pow(10,e))/Math.pow(10,e)},exports}(),met.misc=function(){var r={};return r.UNIQUE=function(){for(var e=[],s=0;s<arguments.length;++s){for(var o=!1,a=arguments[s],d=0;d<e.length&&(o=e[d]===a,!o);++d);o||e.push(a)}return e},r.FLATTEN=utils.flatten,r.ARGS2ARRAY=function(){return Array.prototype.slice.call(arguments,0)},r.REFERENCE=function(e,s){try{for(var o=s.split("."),a=e,d=0;d<o.length;++d){var u=o[d];if(u[u.length-1]==="]"){var f=u.indexOf("["),h=u.substring(f+1,u.length-1);a=a[u.substring(0,f)][h]}else a=a[u]}return a}catch{}},r.JOIN=function(e,s){return e.join(s)},r.NUMBERS=function(){var e=utils.flatten(arguments);return e.filter(function(s){return typeof s=="number"})},r.NUMERAL=null,r}(),met.text=function(){var r={};return r.ASC=null,r.BAHTTEXT=null,r.CHAR=function(e){return e=utils.parseNumber(e),e instanceof Error?e:String.fromCharCode(e)},r.CLEAN=function(e){e=e||"";var s=/[\0-\x1F]/g;return e.replace(s,"")},r.CODE=function(e){return e=e||"",e.charCodeAt(0)},r.CONCATENATE=function(){for(var e=utils.flatten(arguments),s=0;(s=e.indexOf(!0))>-1;)e[s]="TRUE";for(var o=0;(o=e.indexOf(!1))>-1;)e[o]="FALSE";return e.join("")},r.DBCS=null,r.DOLLAR=null,r.EXACT=function(e,s){return e===s},r.FIND=function(e,s,o){return o=o===void 0?0:o,s?s.indexOf(e,o-1)+1:null},r.FIXED=null,r.HTML2TEXT=function(e){var s="";return e&&(e instanceof Array?e.forEach(function(o){s!==""&&(s+=`
`),s+=o.replace(/<(?:.|\n)*?>/gm,"")}):s=e.replace(/<(?:.|\n)*?>/gm,"")),s},r.LEFT=function(e,s){return s=s===void 0?1:s,s=utils.parseNumber(s),s instanceof Error||typeof e!="string"?error.value:e?e.substring(0,s):null},r.LEN=function(e){return arguments.length===0?error.error:typeof e=="string"?e?e.length:0:e.length?e.length:error.value},r.LOWER=function(e){return typeof e!="string"?error.value:e&&e.toLowerCase()},r.MID=function(e,s,o){if(s=utils.parseNumber(s),o=utils.parseNumber(o),utils.anyIsError(s,o)||typeof e!="string")return o;var a=s-1,d=a+o;return e.substring(a,d)},r.NUMBERVALUE=null,r.PRONETIC=null,r.PROPER=function(e){return e===void 0||e.length===0||(e===!0&&(e="TRUE"),e===!1&&(e="FALSE"),isNaN(e)&&typeof e=="number")?error.value:(typeof e=="number"&&(e=""+e),e.replace(/\w\S*/g,function(s){return s.charAt(0).toUpperCase()+s.substr(1).toLowerCase()}))},r.REGEXEXTRACT=function(e,s){var o=e.match(new RegExp(s));return o?o[o.length>1?o.length-1:0]:null},r.REGEXMATCH=function(e,s,o){var a=e.match(new RegExp(s));return o?a:!!a},r.REGEXREPLACE=function(e,s,o){return e.replace(new RegExp(s),o)},r.REPLACE=function(e,s,o,a){return s=utils.parseNumber(s),o=utils.parseNumber(o),utils.anyIsError(s,o)||typeof e!="string"||typeof a!="string"?error.value:e.substr(0,s-1)+a+e.substr(s-1+o)},r.REPT=function(e,s){return s=utils.parseNumber(s),s instanceof Error?s:new Array(s+1).join(e)},r.RIGHT=function(e,s){return s=s===void 0?1:s,s=utils.parseNumber(s),s instanceof Error?s:e?e.substring(e.length-s):null},r.SEARCH=function(e,s,o){var a;return typeof e!="string"||typeof s!="string"?error.value:(o=o===void 0?0:o,a=s.toLowerCase().indexOf(e.toLowerCase(),o-1)+1,a===0?error.value:a)},r.SPLIT=function(e,s){return e.split(s)},r.SUBSTITUTE=function(e,s,o,a){if(!e||!s||!o)return e;if(a===void 0)return e.replace(new RegExp(s,"g"),o);for(var d=0,u=0;e.indexOf(s,d)>0;)if(d=e.indexOf(s,d+1),u++,u===a)return e.substring(0,d)+o+e.substring(d+s.length)},r.T=function(e){return typeof e=="string"?e:""},r.TEXT=null,r.TRIM=function(e){return typeof e!="string"?error.value:e.replace(/ +/g," ").trim()},r.UNICHAR=r.CHAR,r.UNICODE=r.CODE,r.UPPER=function(e){return typeof e!="string"?error.value:e.toUpperCase()},r.VALUE=null,r}(),met.stats=function(){var exports={},SQRT2PI=2.5066282746310002;return exports.AVEDEV=null,exports.AVERAGE=function(){for(var r=utils.numbers(utils.flatten(arguments)),e=r.length,s=0,o=0,a=0;a<e;a++)s+=r[a],o+=1;return s/o},exports.AVERAGEA=function(){for(var r=utils.flatten(arguments),e=r.length,s=0,o=0,a=0;a<e;a++){var d=r[a];typeof d=="number"&&(s+=d),d===!0&&s++,d!==null&&o++}return s/o},exports.AVERAGEIF=function(range,criteria,average_range){if(average_range=average_range||range,range=utils.flatten(range),average_range=utils.parseNumberArray(utils.flatten(average_range)),average_range instanceof Error)return average_range;for(var average_count=0,result=0,i=0;i<range.length;i++)eval(range[i]+criteria)&&(result+=average_range[i],average_count++);return result/average_count},exports.AVERAGEIFS=null,exports.COUNT=function(){return utils.numbers(utils.flatten(arguments)).length},exports.COUNTA=function(){var r=utils.flatten(arguments);return r.length-exports.COUNTBLANK(r)},exports.COUNTIN=function(r,e){for(var s=0,o=0;o<r.length;o++)r[o]===e&&s++;return s},exports.COUNTBLANK=function(){for(var r=utils.flatten(arguments),e=0,s,o=0;o<r.length;o++)s=r[o],(s===null||s==="")&&e++;return e},exports.COUNTIF=function(){var args=utils.argsToArray(arguments),criteria=args.pop(),range=utils.flatten(args);/[<>=!]/.test(criteria)||(criteria='=="'+criteria+'"');for(var matches=0,i=0;i<range.length;i++)typeof range[i]!="string"?eval(range[i]+criteria)&&matches++:eval('"'+range[i]+'"'+criteria)&&matches++;return matches},exports.COUNTIFS=function(){for(var args=utils.argsToArray(arguments),results=new Array(utils.flatten(args[0]).length),i=0;i<results.length;i++)results[i]=!0;for(i=0;i<args.length;i+=2){var range=utils.flatten(args[i]),criteria=args[i+1];/[<>=!]/.test(criteria)||(criteria='=="'+criteria+'"');for(var j=0;j<range.length;j++)typeof range[j]!="string"?results[j]=results[j]&&eval(range[j]+criteria):results[j]=results[j]&&eval('"'+range[j]+'"'+criteria)}var result=0;for(i=0;i<results.length;i++)results[i]&&result++;return result},exports.COUNTUNIQUE=function(){return UNIQUE.apply(null,utils.flatten(arguments)).length},exports.FISHER=function(r){return r=utils.parseNumber(r),r instanceof Error?r:Math.log((1+r)/(1-r))/2},exports.FISHERINV=function(r){if(r=utils.parseNumber(r),r instanceof Error)return r;var e=Math.exp(2*r);return(e-1)/(e+1)},exports.FREQUENCY=function(r,e){if(r=utils.parseNumberArray(utils.flatten(r)),e=utils.parseNumberArray(utils.flatten(e)),utils.anyIsError(r,e))return error.value;for(var s=r.length,o=e.length,a=[],d=0;d<=o;d++){a[d]=0;for(var u=0;u<s;u++)d===0?r[u]<=e[0]&&(a[0]+=1):d<o?r[u]>e[d-1]&&r[u]<=e[d]&&(a[d]+=1):d===o&&r[u]>e[o-1]&&(a[o]+=1)}return a},exports.LARGE=function(r,e){return r=utils.parseNumberArray(utils.flatten(r)),e=utils.parseNumber(e),utils.anyIsError(r,e)?r:r.sort(function(s,o){return o-s})[e-1]},exports.MAX=function(){var r=utils.numbers(utils.flatten(arguments));return r.length===0?0:Math.max.apply(Math,r)},exports.MAXA=function(){var r=utils.arrayValuesToNumbers(utils.flatten(arguments));return r.length===0?0:Math.max.apply(Math,r)},exports.MIN=function(){var r=utils.numbers(utils.flatten(arguments));return r.length===0?0:Math.min.apply(Math,r)},exports.MINA=function(){var r=utils.arrayValuesToNumbers(utils.flatten(arguments));return r.length===0?0:Math.min.apply(Math,r)},exports.MODE={},exports.MODE.MULT=function(){var r=utils.parseNumberArray(utils.flatten(arguments));if(r instanceof Error)return r;for(var e=r.length,s={},o=[],a=0,d,u=0;u<e;u++)d=r[u],s[d]=s[d]?s[d]+1:1,s[d]>a&&(a=s[d],o=[]),s[d]===a&&(o[o.length]=d);return o},exports.MODE.SNGL=function(){var r=utils.parseNumberArray(utils.flatten(arguments));return r instanceof Error?r:exports.MODE.MULT(r).sort(function(e,s){return e-s})[0]},exports.PERCENTILE={},exports.PERCENTILE.EXC=function(r,e){if(r=utils.parseNumberArray(utils.flatten(r)),e=utils.parseNumber(e),utils.anyIsError(r,e))return error.value;r=r.sort(function(d,u){return d-u});var s=r.length;if(e<1/(s+1)||e>1-1/(s+1))return error.num;var o=e*(s+1)-1,a=Math.floor(o);return utils.cleanFloat(o===a?r[o]:r[a]+(o-a)*(r[a+1]-r[a]))},exports.PERCENTILE.INC=function(r,e){if(r=utils.parseNumberArray(utils.flatten(r)),e=utils.parseNumber(e),utils.anyIsError(r,e))return error.value;r=r.sort(function(d,u){return d-u});var s=r.length,o=e*(s-1),a=Math.floor(o);return utils.cleanFloat(o===a?r[o]:r[a]+(o-a)*(r[a+1]-r[a]))},exports.PERCENTRANK={},exports.PERCENTRANK.EXC=function(r,e,s){if(s=s===void 0?3:s,r=utils.parseNumberArray(utils.flatten(r)),e=utils.parseNumber(e),s=utils.parseNumber(s),utils.anyIsError(r,e,s))return error.value;r=r.sort(function(b,m){return b-m});for(var o=UNIQUE.apply(null,r),a=r.length,d=o.length,u=Math.pow(10,s),f=0,h=!1,g=0;!h&&g<d;)e===o[g]?(f=(r.indexOf(o[g])+1)/(a+1),h=!0):e>=o[g]&&(e<o[g+1]||g===d-1)&&(f=(r.indexOf(o[g])+1+(e-o[g])/(o[g+1]-o[g]))/(a+1),h=!0),g++;return Math.floor(f*u)/u},exports.PERCENTRANK.INC=function(r,e,s){if(s=s===void 0?3:s,r=utils.parseNumberArray(utils.flatten(r)),e=utils.parseNumber(e),s=utils.parseNumber(s),utils.anyIsError(r,e,s))return error.value;r=r.sort(function(b,m){return b-m});for(var o=UNIQUE.apply(null,r),a=r.length,d=o.length,u=Math.pow(10,s),f=0,h=!1,g=0;!h&&g<d;)e===o[g]?(f=r.indexOf(o[g])/(a-1),h=!0):e>=o[g]&&(e<o[g+1]||g===d-1)&&(f=(r.indexOf(o[g])+(e-o[g])/(o[g+1]-o[g]))/(a-1),h=!0),g++;return Math.floor(f*u)/u},exports.PERMUT=function(r,e){return r=utils.parseNumber(r),e=utils.parseNumber(e),utils.anyIsError(r,e)?error.value:FACT(r)/FACT(r-e)},exports.PERMUTATIONA=function(r,e){return r=utils.parseNumber(r),e=utils.parseNumber(e),utils.anyIsError(r,e)?error.value:Math.pow(r,e)},exports.PHI=function(r){return r=utils.parseNumber(r),r instanceof Error?error.value:Math.exp(-.5*r*r)/SQRT2PI},exports.PROB=function(r,e,s,o){if(s===void 0)return 0;if(o=o===void 0?s:o,r=utils.parseNumberArray(utils.flatten(r)),e=utils.parseNumberArray(utils.flatten(e)),s=utils.parseNumber(s),o=utils.parseNumber(o),utils.anyIsError(r,e,s,o))return error.value;if(s===o)return r.indexOf(s)>=0?e[r.indexOf(s)]:0;for(var a=r.sort(function(h,g){return h-g}),d=a.length,u=0,f=0;f<d;f++)a[f]>=s&&a[f]<=o&&(u+=e[r.indexOf(a[f])]);return u},exports.QUARTILE={},exports.QUARTILE.EXC=function(r,e){if(r=utils.parseNumberArray(utils.flatten(r)),e=utils.parseNumber(e),utils.anyIsError(r,e))return error.value;switch(e){case 1:return exports.PERCENTILE.EXC(r,.25);case 2:return exports.PERCENTILE.EXC(r,.5);case 3:return exports.PERCENTILE.EXC(r,.75);default:return error.num}},exports.QUARTILE.INC=function(r,e){if(r=utils.parseNumberArray(utils.flatten(r)),e=utils.parseNumber(e),utils.anyIsError(r,e))return error.value;switch(e){case 1:return exports.PERCENTILE.INC(r,.25);case 2:return exports.PERCENTILE.INC(r,.5);case 3:return exports.PERCENTILE.INC(r,.75);default:return error.num}},exports.RANK={},exports.RANK.AVG=function(r,e,s){if(r=utils.parseNumber(r),e=utils.parseNumberArray(utils.flatten(e)),utils.anyIsError(r,e))return error.value;e=utils.flatten(e),s=s||!1;var o=s?function(f,h){return f-h}:function(f,h){return h-f};e=e.sort(o);for(var a=e.length,d=0,u=0;u<a;u++)e[u]===r&&d++;return d>1?(2*e.indexOf(r)+d+1)/2:e.indexOf(r)+1},exports.RANK.EQ=function(r,e,s){if(r=utils.parseNumber(r),e=utils.parseNumberArray(utils.flatten(e)),utils.anyIsError(r,e))return error.value;s=s||!1;var o=s?function(a,d){return a-d}:function(a,d){return d-a};return e=e.sort(o),e.indexOf(r)+1},exports.RSQ=function(r,e){return r=utils.parseNumberArray(utils.flatten(r)),e=utils.parseNumberArray(utils.flatten(e)),utils.anyIsError(r,e)?error.value:Math.pow(exports.PEARSON(r,e),2)},exports.SMALL=function(r,e){return r=utils.parseNumberArray(utils.flatten(r)),e=utils.parseNumber(e),utils.anyIsError(r,e)?r:r.sort(function(s,o){return s-o})[e-1]},exports.STANDARDIZE=function(r,e,s){return r=utils.parseNumber(r),e=utils.parseNumber(e),s=utils.parseNumber(s),utils.anyIsError(r,e,s)?error.value:(r-e)/s},exports.STDEV={},exports.STDEV.P=function(){var r=exports.VAR.P.apply(this,arguments);return Math.sqrt(r)},exports.STDEV.S=function(){var r=exports.VAR.S.apply(this,arguments);return Math.sqrt(r)},exports.STDEVA=function(){var r=exports.VARA.apply(this,arguments);return Math.sqrt(r)},exports.STDEVPA=function(){var r=exports.VARPA.apply(this,arguments);return Math.sqrt(r)},exports.VAR={},exports.VAR.P=function(){for(var r=utils.numbers(utils.flatten(arguments)),e=r.length,s=0,o=exports.AVERAGE(r),a=0;a<e;a++)s+=Math.pow(r[a]-o,2);return s/e},exports.VAR.S=function(){for(var r=utils.numbers(utils.flatten(arguments)),e=r.length,s=0,o=exports.AVERAGE(r),a=0;a<e;a++)s+=Math.pow(r[a]-o,2);return s/(e-1)},exports.VARA=function(){for(var r=utils.flatten(arguments),e=r.length,s=0,o=0,a=exports.AVERAGEA(r),d=0;d<e;d++){var u=r[d];typeof u=="number"?s+=Math.pow(u-a,2):u===!0?s+=Math.pow(1-a,2):s+=Math.pow(0-a,2),u!==null&&o++}return s/(o-1)},exports.VARPA=function(){for(var r=utils.flatten(arguments),e=r.length,s=0,o=0,a=exports.AVERAGEA(r),d=0;d<e;d++){var u=r[d];typeof u=="number"?s+=Math.pow(u-a,2):u===!0?s+=Math.pow(1-a,2):s+=Math.pow(0-a,2),u!==null&&o++}return s/o},exports.WEIBULL={},exports.WEIBULL.DIST=function(r,e,s,o){return r=utils.parseNumber(r),e=utils.parseNumber(e),s=utils.parseNumber(s),utils.anyIsError(r,e,s)?error.value:o?1-Math.exp(-Math.pow(r/s,e)):Math.pow(r,e-1)*Math.exp(-Math.pow(r/s,e))*e/Math.pow(s,e)},exports.Z={},exports.Z.TEST=function(r,e,s){if(r=utils.parseNumberArray(utils.flatten(r)),e=utils.parseNumber(e),utils.anyIsError(r,e))return error.value;s=s||exports.STDEV.S(r);var o=r.length;return 1-exports.NORM.S.DIST((exports.AVERAGE(r)-e)/(s/Math.sqrt(o)),!0)},exports}(),met.utils=function(){var r={};return r.PROGRESS=function(e,s){var o=s||"red",a=e||"0";return'<div style="width:'+a+"%;height:4px;background-color:"+o+';margin-top:1px;"></div>'},r.RATING=function(e){for(var s='<div class="jrating">',o=0;o<5;o++)o<e?s+='<div class="jrating-selected"></div>':s+="<div></div>";return s+="</div>",s},r}();for(var i=0;i<Object.keys(met).length;i++)for(var methods=met[Object.keys(met)[i]],keys=Object.keys(methods),j=0;j<keys.length;j++)if(!methods[keys[j]])window[keys[j]]=function(){return keys[j]+"Not implemented"};else if(typeof methods[keys[j]]=="function"||typeof methods[keys[j]]=="object"){if(window[keys[j]]=methods[keys[j]],window[keys[j]].toString=function(){return"#ERROR"},typeof methods[keys[j]]=="object")for(var tmp=Object.keys(methods[keys[j]]),z=0;z<tmp.length;z++)window[keys[j]][tmp[z]].toString=function(){return"#ERROR"}}else window[keys[j]]=function(){return keys[j]+"Not implemented"};var x=null,y=null,instance=null;window.TABLE=function(){return instance},window.COLUMN=window.COL=function(){return parseInt(x)+1},window.ROW=function(){return parseInt(y)+1},window.CELL=function(){return F.getColumnNameFromCoords(x,y)},window.VALUE=function(r,e,s){return instance.getValueFromCoords(parseInt(r)-1,parseInt(e)-1,s)},window.THISROWCELL=function(r){return instance.getValueFromCoords(parseInt(r)-1,parseInt(y))};var secureFormula=function(r,e){for(var s="",o=0,a=["=","!",">","<"],d=0;d<r.length;d++)r[d]=='"'&&(o==0?o=1:o=0),o==1?s+=r[d]:(s+=r[d].toUpperCase(),e==!0&&d>0&&r[d]=="="&&a.indexOf(r[d-1])==-1&&a.indexOf(r[d+1])==-1&&(s+="="));return s=s.replace(/\^/g,"**"),s=s.replace(/\<\>/g,"!="),s=s.replace(/\&/g,"+"),s=s.replace(/\$/g,""),s},tokensUpdate=function(r,e){for(var s=0;s<r.length;s++){var o=F.getTokensFromRange(r[s]);e=e.replace(r[s],"["+o.join(",")+"]")}return e},F=function(r,e,s,o,a){instance=a,x=s,y=o;var d="",u=Object.keys(e);if(u.length)for(var s=0;s<u.length;s++)u[s].indexOf(".")==-1&&u[s].indexOf("!")==-1?d+="var "+u[s]+" = "+e[u[s]]+`;
`:d+=u[s]+" = "+e[u[s]]+`;
`;r=r.replace(/\$/g,""),r=r.replace(/\!/g,"."),r=secureFormula(r,!0);var f=r.match(/([A-Z]+[0-9]*\.)?(\$?[A-Z]+\$?[0-9]+):(\$?[A-Z]+\$?[0-9]+)?/g);return f&&f.length&&(r=tokensUpdate(f,r)),new Function(d+"; return "+r)()},getColumnName=function(r){var e="";return r>701?(e+=String.fromCharCode(64+parseInt(r/676)),e+=String.fromCharCode(64+parseInt(r%676/26))):r>25&&(e+=String.fromCharCode(64+parseInt(r/26))),e+=String.fromCharCode(65+r%26),e};return F.getColumnNameFromCoords=function(r,e){return getColumnName(parseInt(r))+(parseInt(e)+1)},F.getCoordsFromColumnName=function(r){var e=/^[a-zA-Z]+/.exec(r);if(e){for(var s=0,o=0;o<e[0].length;o++)s+=parseInt(e[0].charCodeAt(o)-64)*Math.pow(26,e[0].length-1-o);s--,s<0&&(s=0);var a=parseInt(/[0-9]+$/.exec(r))||null;return a>0&&a--,[s,a]}},F.getRangeFromTokens=function(r){r=r.filter(function(a){return a!="#REF!"});for(var e="",s="",o=0;o<r.length;o++)r[o].indexOf(".")>=0?e=".":r[o].indexOf("!")>=0&&(e="!"),e&&(s=r[o].split(e),r[o]=s[1],s=s[0]+e);return r.sort(function(a,d){var u=Helpers.getCoordsFromColumnName(a),f=Helpers.getCoordsFromColumnName(d);return u[1]>f[1]?1:u[1]<f[1]?-1:u[0]>f[0]?1:u[0]<f[0]?-1:0}),r.length?s+(r[0]+":"+r[r.length-1]):"#REF!"},F.getTokensFromRange=function(r){if(r.indexOf(".")>0){var e=r.split(".");r=e[1],e=e[0]+"."}else if(r.indexOf("!")>0){var e=r.split("!");r=e[1],e=e[0]+"!"}else var e="";var r=r.split(":"),s=F.getCoordsFromColumnName(r[0]),o=F.getCoordsFromColumnName(r[1]);if(s[0]<=o[0])var a=s[0],d=o[0];else var a=o[0],d=s[0];if(s[1]===null&&o[1]==null)for(var u=null,f=null,h=Object.keys(vars),g=0;g<h.length;g++){var b=F.getCoordsFromColumnName(h[g]);b[0]===s[0]&&(u===null||b[1]<u)&&(u=b[1]),b[0]===o[0]&&(f===null||b[1]>f)&&(f=b[1])}else if(s[1]<=o[1])var u=s[1],f=o[1];else var u=o[1],f=s[1];for(var m=[],_=u;_<=f;_++){for(var Ge=[],g=a;g<=d;g++)Ge.push(e+F.getColumnNameFromCoords(g,_));m.push(Ge)}return m},F.setFormula=function(r){for(var e=Object.keys(r),s=0;s<e.length;s++)typeof r[e[s]]=="function"&&(window[e[s]]=r[e[s]])},F}();if(!jSuites&&typeof commonjsRequire=="function")var jSuites=jsuites.exports;(function(r,e){module.exports=e()})(commonjsGlobal$1,function(){var Version=function(){var r={title:"Jspreadsheet",version:"4.9.6",type:"CE",host:"https://bossanova.uk/jspreadsheet",license:"MIT",print:function(){return[this.title+" "+this.type+" "+this.version,this.host,this.license].join(`\r
`)}};return function(){return r}}(),isFormula=function(r){var e=(""+r)[0];return e=="="||e=="#"},getMask=function(r){if(r.format||r.mask||r.locale){var e={};return r.mask?e.mask=r.mask:r.format?e.mask=r.format:(e.locale=r.locale,e.options=r.options),r.decimal&&(e.options||(e.options={}),e.options={decimal:r.decimal}),e}return null},jexcel=function(el,options){var obj={};if(obj.options={},el instanceof Element||el instanceof HTMLDocument){if(el.tagName=="TABLE")if(options=jexcel.createFromTable(el,options)){var div=document.createElement("div");el.parentNode.insertBefore(div,el),el.remove(),el=div}else return console.error("Jspreadsheet: el is not a valid DOM element"),!1}else return console.error("Jspreadsheet: el is not a valid DOM element"),!1;var defaults={url:null,method:"GET",requestVariables:null,data:null,sorting:null,copyCompatibility:!1,root:null,rows:[],columns:[],colHeaders:[],colWidths:[],colAlignments:[],nestedHeaders:null,defaultColWidth:50,defaultColAlign:"center",defaultRowHeight:null,minSpareRows:0,minSpareCols:0,minDimensions:[0,0],allowExport:!0,includeHeadersOnDownload:!1,includeHeadersOnCopy:!1,columnSorting:!0,columnDrag:!1,columnResize:!0,rowResize:!1,rowDrag:!0,editable:!0,allowInsertRow:!0,allowManualInsertRow:!0,allowInsertColumn:!0,allowManualInsertColumn:!0,allowDeleteRow:!0,allowDeletingAllRows:!1,allowDeleteColumn:!0,allowRenameColumn:!0,allowComments:!1,wordWrap:!1,imageOptions:null,csv:null,csvFileName:"jspreadsheet",csvHeaders:!0,csvDelimiter:",",parseTableFirstRowAsHeader:!1,parseTableAutoCellType:!1,selectionCopy:!0,mergeCells:{},toolbar:null,search:!1,pagination:!1,paginationOptions:null,fullscreen:!1,lazyLoading:!1,loadingSpin:!1,tableOverflow:!1,tableHeight:"300px",tableWidth:null,textOverflow:!1,meta:null,style:null,classes:null,parseFormulas:!0,autoIncrement:!0,autoCasting:!0,secureFormulas:!0,stripHTML:!0,stripHTMLOnCopy:!1,filters:!1,footers:null,onundo:null,onredo:null,onload:null,onchange:null,oncomments:null,onbeforechange:null,onafterchanges:null,onbeforeinsertrow:null,oninsertrow:null,onbeforeinsertcolumn:null,oninsertcolumn:null,onbeforedeleterow:null,ondeleterow:null,onbeforedeletecolumn:null,ondeletecolumn:null,onmoverow:null,onmovecolumn:null,onresizerow:null,onresizecolumn:null,onsort:null,onselection:null,oncopy:null,onpaste:null,onbeforepaste:null,onmerge:null,onfocus:null,onblur:null,onchangeheader:null,oncreateeditor:null,oneditionstart:null,oneditionend:null,onchangestyle:null,onchangemeta:null,onchangepage:null,onbeforesave:null,onsave:null,onevent:null,persistance:!1,updateTable:null,detachForUpdates:!1,freezeColumns:null,text:{noRecordsFound:"No records found",showingPage:"Showing page {0} of {1} entries",show:"Show ",search:"Search",entries:" entries",columnName:"Column name",insertANewColumnBefore:"Insert a new column before",insertANewColumnAfter:"Insert a new column after",deleteSelectedColumns:"Delete selected columns",renameThisColumn:"Rename this column",orderAscending:"Order ascending",orderDescending:"Order descending",insertANewRowBefore:"Insert a new row before",insertANewRowAfter:"Insert a new row after",deleteSelectedRows:"Delete selected rows",editComments:"Edit comments",addComments:"Add comments",comments:"Comments",clearComments:"Clear comments",copy:"Copy...",paste:"Paste...",saveAs:"Save as...",about:"About",areYouSureToDeleteTheSelectedRows:"Are you sure to delete the selected rows?",areYouSureToDeleteTheSelectedColumns:"Are you sure to delete the selected columns?",thisActionWillDestroyAnyExistingMergedCellsAreYouSure:"This action will destroy any existing merged cells. Are you sure?",thisActionWillClearYourSearchResultsAreYouSure:"This action will clear your search results. Are you sure?",thereIsAConflictWithAnotherMergedCell:"There is a conflict with another merged cell",invalidMergeProperties:"Invalid merged properties",cellAlreadyMerged:"Cell already merged",noCellsSelected:"No cells selected"},about:!0};for(var property in defaults)if(options&&options.hasOwnProperty(property))if(property==="text"){obj.options[property]=defaults[property];for(var textKey in options[property])options[property].hasOwnProperty(textKey)&&(obj.options[property][textKey]=options[property][textKey])}else obj.options[property]=options[property];else obj.options[property]=defaults[property];obj.el=el,obj.corner=null,obj.contextMenu=null,obj.textarea=null,obj.ads=null,obj.content=null,obj.table=null,obj.thead=null,obj.tbody=null,obj.rows=[],obj.results=null,obj.searchInput=null,obj.toolbar=null,obj.pagination=null,obj.pageNumber=null,obj.headerContainer=null,obj.colgroupContainer=null,obj.headers=[],obj.records=[],obj.history=[],obj.formula=[],obj.colgroup=[],obj.selection=[],obj.highlighted=[],obj.selectedCell=null,obj.selectedContainer=null,obj.style=[],obj.data=null,obj.filter=null,obj.filters=[],obj.cursor=null,obj.historyIndex=-1,obj.ignoreEvents=!1,obj.ignoreHistory=!1,obj.edition=null,obj.hashString=null,obj.resizing=null,obj.dragging=null,obj.options.lazyLoading==!0&&obj.options.tableOverflow==!1&&obj.options.fullscreen==!1&&(console.error("Jspreadsheet: The lazyloading only works when tableOverflow = yes or fullscreen = yes"),obj.options.lazyLoading=!1),obj.fullscreen=function(r){r==null&&(r=!obj.options.fullscreen),obj.options.fullscreen!=r&&(obj.options.fullscreen=r,r==!0?el.classList.add("fullscreen"):el.classList.remove("fullscreen"))},obj.dispatch=function(r){if(!obj.ignoreEvents){if(typeof obj.options.onevent=="function")var e=obj.options.onevent.apply(this,arguments);if(typeof obj.options[r]=="function")var e=obj.options[r].apply(this,Array.prototype.slice.call(arguments,1))}if(r=="onafterchanges"&&obj.options.persistance){var s=obj.options.persistance==!0?obj.options.url:obj.options.persistance,o=obj.prepareJson(arguments[2]);obj.save(s,o)}return e},obj.prepareTable=function(){var r=obj.options.columns.length;if(obj.options.data&&typeof obj.options.data[0]!="undefined"){var e=Object.keys(obj.options.data[0]);e.length>r&&(r=e.length)}obj.options.minDimensions[0]>r&&(r=obj.options.minDimensions[0]);for(var s=[],o=0;o<r;o++)obj.options.colHeaders[o]||(obj.options.colHeaders[o]=""),obj.options.colWidths[o]||(obj.options.colWidths[o]=obj.options.defaultColWidth),obj.options.colAlignments[o]||(obj.options.colAlignments[o]=obj.options.defaultColAlign),obj.options.columns[o]?obj.options.columns[o].type||(obj.options.columns[o].type="text"):obj.options.columns[o]={type:"text"},obj.options.columns[o].name||(obj.options.columns[o].name=e&&e[o]?e[o]:o),obj.options.columns[o].source||(obj.options.columns[o].source=[]),obj.options.columns[o].options||(obj.options.columns[o].options=[]),obj.options.columns[o].editor||(obj.options.columns[o].editor=null),obj.options.columns[o].allowEmpty||(obj.options.columns[o].allowEmpty=!1),obj.options.columns[o].title||(obj.options.columns[o].title=obj.options.colHeaders[o]?obj.options.colHeaders[o]:""),obj.options.columns[o].width||(obj.options.columns[o].width=obj.options.colWidths[o]?obj.options.colWidths[o]:obj.options.defaultColWidth),obj.options.columns[o].align||(obj.options.columns[o].align=obj.options.colAlignments[o]?obj.options.colAlignments[o]:"center"),obj.options.columns[o].type=="autocomplete"||obj.options.columns[o].type=="dropdown"?obj.options.columns[o].url&&s.push({url:obj.options.columns[o].url,index:o,method:"GET",dataType:"json",success:function(a){for(var d=0;d<a.length;d++)obj.options.columns[this.index].source.push(a[d])}}):obj.options.columns[o].type=="calendar"&&(obj.options.columns[o].options.format||(obj.options.columns[o].options.format="DD/MM/YYYY"));s.length?jSuites.ajax(s,function(){obj.createTable()}):obj.createTable()},obj.createTable=function(){obj.table=document.createElement("table"),obj.thead=document.createElement("thead"),obj.tbody=document.createElement("tbody"),obj.headers=[],obj.colgroup=[],obj.content=document.createElement("div"),obj.content.classList.add("jexcel_content"),obj.content.onscroll=function(er){obj.scrollControls(er)},obj.content.onwheel=function(er){obj.wheelControls(er)},obj.toolbar=document.createElement("div"),obj.toolbar.classList.add("jexcel_toolbar");var r=document.createElement("div"),e=document.createTextNode(obj.options.text.search+": ");obj.searchInput=document.createElement("input"),obj.searchInput.classList.add("jexcel_search"),r.appendChild(e),r.appendChild(obj.searchInput),obj.searchInput.onfocus=function(){obj.resetSelection()};var s=document.createElement("div");if(obj.options.pagination>0&&obj.options.paginationOptions&&obj.options.paginationOptions.length>0){obj.paginationDropdown=document.createElement("select"),obj.paginationDropdown.classList.add("jexcel_pagination_dropdown"),obj.paginationDropdown.onchange=function(){obj.options.pagination=parseInt(this.value),obj.page(0)};for(var o=0;o<obj.options.paginationOptions.length;o++){var a=document.createElement("option");a.value=obj.options.paginationOptions[o],a.innerHTML=obj.options.paginationOptions[o],obj.paginationDropdown.appendChild(a)}obj.paginationDropdown.value=obj.options.pagination,s.appendChild(document.createTextNode(obj.options.text.show)),s.appendChild(obj.paginationDropdown),s.appendChild(document.createTextNode(obj.options.text.entries))}var d=document.createElement("div");d.classList.add("jexcel_filter"),d.appendChild(s),d.appendChild(r),obj.colgroupContainer=document.createElement("colgroup");var u=document.createElement("col");if(u.setAttribute("width","50"),obj.colgroupContainer.appendChild(u),obj.options.nestedHeaders&&obj.options.nestedHeaders.length>0)if(obj.options.nestedHeaders[0]&&obj.options.nestedHeaders[0][0])for(var f=0;f<obj.options.nestedHeaders.length;f++)obj.thead.appendChild(obj.createNestedHeader(obj.options.nestedHeaders[f]));else obj.thead.appendChild(obj.createNestedHeader(obj.options.nestedHeaders));obj.headerContainer=document.createElement("tr");var u=document.createElement("td");u.classList.add("jexcel_selectall"),obj.headerContainer.appendChild(u);for(var o=0;o<obj.options.columns.length;o++)obj.createCellHeader(o),obj.headerContainer.appendChild(obj.headers[o]),obj.colgroupContainer.appendChild(obj.colgroup[o]);if(obj.thead.appendChild(obj.headerContainer),obj.options.filters==!0){obj.filter=document.createElement("tr");var h=document.createElement("td");obj.filter.appendChild(h);for(var o=0;o<obj.options.columns.length;o++){var h=document.createElement("td");h.innerHTML="&nbsp;",h.setAttribute("data-x",o),h.className="jexcel_column_filter",obj.options.columns[o].type=="hidden"&&(h.style.display="none"),obj.filter.appendChild(h)}obj.thead.appendChild(obj.filter)}obj.table=document.createElement("table"),obj.table.classList.add("jexcel"),obj.table.setAttribute("cellpadding","0"),obj.table.setAttribute("cellspacing","0"),obj.table.setAttribute("unselectable","yes"),obj.table.appendChild(obj.colgroupContainer),obj.table.appendChild(obj.thead),obj.table.appendChild(obj.tbody),obj.options.textOverflow||obj.table.classList.add("jexcel_overflow"),obj.corner=document.createElement("div"),obj.corner.className="jexcel_corner",obj.corner.setAttribute("unselectable","on"),obj.corner.setAttribute("onselectstart","return false"),obj.options.selectionCopy==!1&&(obj.corner.style.display="none"),obj.textarea=document.createElement("textarea"),obj.textarea.className="jexcel_textarea",obj.textarea.id="jexcel_textarea",obj.textarea.tabIndex="-1",obj.contextMenu=document.createElement("div"),obj.contextMenu.className="jexcel_contextmenu",jSuites.contextmenu(obj.contextMenu,{onclick:function(){obj.contextMenu.contextmenu.close(!1)}});var g=document.createElement("a");g.setAttribute("href","https://bossanova.uk/jspreadsheet/"),obj.ads=document.createElement("div"),obj.ads.className="jexcel_about";try{if(typeof sessionStorage!="undefined"&&!sessionStorage.getItem("jexcel")){sessionStorage.setItem("jexcel",!0);var b=document.createElement("img");b.src="//bossanova.uk/jspreadsheet/logo.png",g.appendChild(b)}}catch{}var m=document.createElement("span");m.innerHTML="Jspreadsheet CE",g.appendChild(m),obj.ads.appendChild(g);var _=document.createElement("div");_.classList.add("jexcel_table"),obj.pagination=document.createElement("div"),obj.pagination.classList.add("jexcel_pagination");var Ge=document.createElement("div"),ot=document.createElement("div");if(obj.pagination.appendChild(Ge),obj.pagination.appendChild(ot),obj.options.pagination||(obj.pagination.style.display="none"),obj.options.search==!0&&el.appendChild(d),obj.content.appendChild(obj.table),obj.content.appendChild(obj.corner),obj.content.appendChild(obj.textarea),el.appendChild(obj.toolbar),el.appendChild(obj.content),el.appendChild(obj.pagination),el.appendChild(obj.contextMenu),el.appendChild(obj.ads),el.classList.add("jexcel_container"),obj.options.toolbar&&obj.options.toolbar.length&&obj.createToolbar(),obj.options.fullscreen==!0?el.classList.add("fullscreen"):obj.options.tableOverflow==!0&&(obj.options.tableHeight&&(obj.content.style["overflow-y"]="auto",obj.content.style["box-shadow"]="rgb(221 221 221) 2px 2px 5px 0.1px",obj.content.style.maxHeight=obj.options.tableHeight),obj.options.tableWidth&&(obj.content.style["overflow-x"]="auto",obj.content.style.width=obj.options.tableWidth)),obj.options.tableOverflow!=!0&&obj.options.toolbar&&el.classList.add("with-toolbar"),obj.options.columnDrag==!0&&obj.thead.classList.add("draggable"),obj.options.columnResize==!0&&obj.thead.classList.add("resizable"),obj.options.rowDrag==!0&&obj.tbody.classList.add("draggable"),obj.options.rowResize==!0&&obj.tbody.classList.add("resizable"),obj.setData(),obj.options.style&&obj.setStyle(obj.options.style,null,null,1,1),obj.options.classes)for(var rr=Object.keys(obj.options.classes),o=0;o<rr.length;o++){var ir=jexcel.getIdFromColumnName(rr[o],!0);obj.records[ir[1]][ir[0]].classList.add(obj.options.classes[rr[o]])}},obj.refresh=function(){obj.options.url?(obj.options.loadingSpin==!0&&jSuites.loading.show(),jSuites.ajax({url:obj.options.url,method:obj.options.method,data:obj.options.requestVariables,dataType:"json",success:function(r){obj.options.data=r.data?r.data:r,obj.setData(),obj.options.loadingSpin==!0&&jSuites.loading.hide()}})):obj.setData()},obj.setData=function(r){if(r&&(typeof r=="string"&&(r=JSON.parse(r)),obj.options.data=r),obj.options.data||(obj.options.data=[]),obj.options.data&&obj.options.data[0]&&!Array.isArray(obj.options.data[0])){for(var r=[],s=0;s<obj.options.data.length;s++){for(var e=[],o=0;o<obj.options.columns.length;o++)e[o]=obj.options.data[s][obj.options.columns[o].name];r.push(e)}obj.options.data=r}var s=0,o=0,a=obj.options.columns.length,d=obj.options.data.length,u=obj.options.minDimensions[0],f=obj.options.minDimensions[1],h=u>a?u:a,g=f>d?f:d;for(s=0;s<g;s++)for(o=0;o<h;o++)obj.options.data[s]==null&&(obj.options.data[s]=[]),obj.options.data[s][o]==null&&(obj.options.data[s][o]="");if(obj.rows=[],obj.results=null,obj.records=[],obj.history=[],obj.historyIndex=-1,obj.tbody.innerHTML="",obj.options.lazyLoading==!0){var b=0,m=obj.options.data.length<100?obj.options.data.length:100;obj.options.pagination&&(obj.options.pagination=!1,console.error("Jspreadsheet: Pagination will be disable due the lazyLoading"))}else if(obj.options.pagination)obj.pageNumber||(obj.pageNumber=0),obj.options.pagination,b=obj.options.pagination*obj.pageNumber,m=obj.options.pagination*obj.pageNumber+obj.options.pagination,obj.options.data.length<m&&(m=obj.options.data.length);else var b=0,m=obj.options.data.length;for(s=0;s<obj.options.data.length;s++){var _=obj.createRow(s,obj.options.data[s]);s>=b&&s<m&&obj.tbody.appendChild(_)}if(obj.options.lazyLoading==!0||obj.options.pagination&&obj.updatePagination(),obj.options.mergeCells)for(var Ge=Object.keys(obj.options.mergeCells),o=0;o<Ge.length;o++){var ot=obj.options.mergeCells[Ge[o]];obj.setMerge(Ge[o],ot[0],ot[1],1)}obj.updateTable(),obj.dispatch("onload",el,obj)},obj.getData=function(r,e){for(var s=[],o=0,a=0,d=e==!0||obj.options.copyCompatibility==!1,u=obj.options.columns.length,f=obj.options.data.length,h=0;h<f;h++){o=0;for(var g=0;g<u;g++)(!r||obj.records[h][g].classList.contains("highlight"))&&(s[a]||(s[a]=[]),d?s[a][o]=obj.options.data[h][g]:s[a][o]=obj.records[h][g].innerHTML,o++);o>0&&a++}return s},obj.getJsonRow=function(r){for(var e=obj.options.data[r],s=obj.options.columns.length,o={},a=0;a<s;a++)obj.options.columns[a].name||(obj.options.columns[a].name=a),o[obj.options.columns[a].name]=e[a];return o},obj.getJson=function(r){for(var e=[],s=obj.options.columns.length,o=obj.options.data.length,a=0;a<o;a++){for(var d=null,u=0;u<s;u++)(!r||obj.records[a][u].classList.contains("highlight"))&&(d==null&&(d={}),obj.options.columns[u].name||(obj.options.columns[u].name=u),d[obj.options.columns[u].name]=obj.options.data[a][u]);d!=null&&e.push(d)}return e},obj.prepareJson=function(r){for(var e=[],s=0;s<r.length;s++){var o=r[s].x,a=r[s].y,d=obj.options.columns[o].name?obj.options.columns[o].name:o;e[a]||(e[a]={row:a,data:{}}),e[a].data[d]=r[s].newValue}return e.filter(function(u){return u!=null})},obj.save=function(r,e){var s=obj.dispatch("onbeforesave",el,obj,e);if(s)var e=s;else if(s===!1)return!1;jSuites.ajax({url:r,method:"POST",dataType:"json",data:{data:JSON.stringify(e)},success:function(o){obj.dispatch("onsave",el,obj,e)}})},obj.getRowData=function(r){return obj.options.data[r]},obj.setRowData=function(r,e){for(var s=0;s<obj.headers.length;s++){var o=jexcel.getColumnNameFromId([s,r]);e[s]!=null&&obj.setValue(o,e[s])}},obj.getColumnData=function(r){for(var e=[],s=0;s<obj.options.data.length;s++)e.push(obj.options.data[s][r]);return e},obj.setColumnData=function(r,e){for(var s=0;s<obj.rows.length;s++){var o=jexcel.getColumnNameFromId([r,s]);e[s]!=null&&obj.setValue(o,e[s])}},obj.createRow=function(r,e){if(obj.records[r]||(obj.records[r]=[]),!e)var e=obj.options.data[r];obj.rows[r]=document.createElement("tr"),obj.rows[r].setAttribute("data-y",r);var s=null;obj.options.defaultRowHeight&&(obj.rows[r].style.height=obj.options.defaultRowHeight+"px"),obj.options.rows[r]&&(obj.options.rows[r].height&&(obj.rows[r].style.height=obj.options.rows[r].height),obj.options.rows[r].title&&(s=obj.options.rows[r].title)),s||(s=parseInt(r+1));var o=document.createElement("td");o.innerHTML=s,o.setAttribute("data-y",r),o.className="jexcel_row",obj.rows[r].appendChild(o);for(var a=0;a<obj.options.columns.length;a++)obj.records[r][a]=obj.createCell(a,r,e[a]),obj.rows[r].appendChild(obj.records[r][a]);return obj.rows[r]},obj.parseValue=function(r,e,s,o){(""+s).substr(0,1)=="="&&obj.options.parseFormulas==!0&&(s=obj.executeFormula(s,r,e));var a=obj.options.columns[r];if(a&&!isFormula(s)){var d=null;if(d=getMask(a)){s&&s==Number(s)&&(s=Number(s));var u=jSuites.mask.render(s,d,!0);if(o&&d.mask){var f=d.mask.split(";");if(f[1]){var h=f[1].match(new RegExp("\\[Red\\]","gi"));h&&(s<0?o.classList.add("red"):o.classList.remove("red"));var g=f[1].match(new RegExp("\\(","gi"));g&&s<0&&(u="("+u+")")}}u&&(s=u)}}return s};var validDate=function(r){return r=""+r,r.substr(4,1)=="-"&&r.substr(7,1)=="-"?!0:(r=r.split("-"),r[0].length==4&&r[0]==Number(r[0])&&r[1].length==2&&r[1]==Number(r[1]))};obj.createCell=function(r,e,s){var o=document.createElement("td");if(o.setAttribute("data-x",r),o.setAttribute("data-y",e),(""+s).substr(0,1)=="="&&obj.options.secureFormulas==!0){var a=secureFormula(s);a!=s&&(s=a)}if(obj.options.columns[r].editor)obj.options.stripHTML===!1||obj.options.columns[r].stripHTML===!1?o.innerHTML=s:o.innerText=s,typeof obj.options.columns[r].editor.createCell=="function"&&(o=obj.options.columns[r].editor.createCell(o));else if(obj.options.columns[r].type=="hidden")o.style.display="none",o.innerText=s;else if(obj.options.columns[r].type=="checkbox"||obj.options.columns[r].type=="radio"){var d=document.createElement("input");d.type=obj.options.columns[r].type,d.name="c"+r,d.checked=s==1||s==!0||s=="true",d.onclick=function(){obj.setValue(o,this.checked)},(obj.options.columns[r].readOnly==!0||obj.options.editable==!1)&&d.setAttribute("disabled","disabled"),o.appendChild(d),obj.options.data[e][r]=d.checked}else if(obj.options.columns[r].type=="calendar"){var u=null;if(!validDate(s)){var f=jSuites.calendar.extractDateFromString(s,obj.options.columns[r].options.format);f&&(u=f)}o.innerText=jSuites.calendar.getDateString(u||s,obj.options.columns[r].options.format)}else if(obj.options.columns[r].type=="dropdown"||obj.options.columns[r].type=="autocomplete")o.classList.add("jexcel_dropdown"),o.innerText=obj.getDropDownValue(r,s);else if(obj.options.columns[r].type=="color")if(obj.options.columns[r].render=="square"){var h=document.createElement("div");h.className="color",h.style.backgroundColor=s,o.appendChild(h)}else o.style.color=s,o.innerText=s;else if(obj.options.columns[r].type=="image"){if(s&&s.substr(0,10)=="data:image"){var g=document.createElement("img");g.src=s,o.appendChild(g)}}else obj.options.columns[r].type=="html"||obj.options.stripHTML===!1||obj.options.columns[r].stripHTML===!1?o.innerHTML=stripScript(obj.parseValue(r,e,s,o)):o.innerText=obj.parseValue(r,e,s,o);obj.options.columns[r].readOnly==!0&&(o.className="readonly");var b=obj.options.columns[r].align?obj.options.columns[r].align:"center";return o.style.textAlign=b,obj.options.columns[r].wordWrap!=!1&&(obj.options.wordWrap==!0||obj.options.columns[r].wordWrap==!0||o.innerHTML.length>200)&&(o.style.whiteSpace="pre-wrap"),r>0&&this.options.textOverflow==!0&&(s||o.innerHTML?obj.records[e][r-1].style.overflow="hidden":r==obj.options.columns.length-1&&(o.style.overflow="hidden")),o},obj.createCellHeader=function(r){var e=obj.options.columns[r].width?obj.options.columns[r].width:obj.options.defaultColWidth,s=obj.options.columns[r].align?obj.options.columns[r].align:obj.options.defaultColAlign;obj.headers[r]=document.createElement("td"),obj.options.stripHTML?obj.headers[r].innerText=obj.options.columns[r].title?obj.options.columns[r].title:jexcel.getColumnName(r):obj.headers[r].innerHTML=obj.options.columns[r].title?obj.options.columns[r].title:jexcel.getColumnName(r),obj.headers[r].setAttribute("data-x",r),obj.headers[r].style.textAlign=s,obj.options.columns[r].title&&obj.headers[r].setAttribute("title",obj.options.columns[r].title),obj.options.columns[r].id&&obj.headers[r].setAttribute("id",obj.options.columns[r].id),obj.colgroup[r]=document.createElement("col"),obj.colgroup[r].setAttribute("width",e),obj.options.columns[r].type=="hidden"&&(obj.headers[r].style.display="none",obj.colgroup[r].style.display="none")},obj.updateNestedHeader=function(r,e,s){obj.options.nestedHeaders[e][r].title&&(obj.options.nestedHeaders[e][r].title=s,obj.options.nestedHeaders[e].element.children[r+1].innerText=s)},obj.createNestedHeader=function(r){var e=document.createElement("tr");e.classList.add("jexcel_nested");var s=document.createElement("td");e.appendChild(s),r.element=e;for(var o=0,a=0;a<r.length;a++){r[a].colspan||(r[a].colspan=1),r[a].align||(r[a].align="center"),r[a].title||(r[a].title="");for(var d=r[a].colspan,u=[],f=0;f<d;f++)obj.options.columns[o]&&obj.options.columns[o].type=="hidden"&&d++,u.push(o),o++;var s=document.createElement("td");s.setAttribute("data-column",u.join(",")),s.setAttribute("colspan",r[a].colspan),s.setAttribute("align",r[a].align),s.innerText=r[a].title,e.appendChild(s)}return e},obj.createToolbar=function(r){if(r)obj.options.toolbar=r;else var r=obj.options.toolbar;for(var e=0;e<r.length;e++)if(r[e].type=="i"){var s=document.createElement("i");s.classList.add("jexcel_toolbar_item"),s.classList.add("material-icons"),s.setAttribute("data-k",r[e].k),s.setAttribute("data-v",r[e].v),s.setAttribute("id",r[e].id),r[e].tooltip&&s.setAttribute("title",r[e].tooltip),r[e].onclick&&typeof r[e].onclick?s.onclick=function(d){var u=d;return function(){r[u].onclick(el,obj,this)}}(e):s.onclick=function(){var d=this.getAttribute("data-k"),u=this.getAttribute("data-v");obj.setStyle(obj.highlighted,d,u)},s.innerText=r[e].content,obj.toolbar.appendChild(s)}else if(r[e].type=="select"){var s=document.createElement("select");s.classList.add("jexcel_toolbar_item"),s.setAttribute("data-k",r[e].k),r[e].tooltip&&s.setAttribute("title",r[e].tooltip),r[e].onchange&&typeof r[e].onchange?s.onchange=r[e].onchange:s.onchange=function(){var u=this.getAttribute("data-k");obj.setStyle(obj.highlighted,u,this.value)};for(var o=0;o<r[e].v.length;o++){var a=document.createElement("option");a.value=r[e].v[o],a.innerText=r[e].v[o],s.appendChild(a)}obj.toolbar.appendChild(s)}else if(r[e].type=="color"){var s=document.createElement("i");s.classList.add("jexcel_toolbar_item"),s.classList.add("material-icons"),s.setAttribute("data-k",r[e].k),s.setAttribute("data-v",""),r[e].tooltip&&s.setAttribute("title",r[e].tooltip),obj.toolbar.appendChild(s),s.innerText=r[e].content,jSuites.color(s,{onchange:function(u,f){var h=u.getAttribute("data-k");obj.setStyle(obj.highlighted,h,f)}})}},obj.setMerge=function(r,e,s,o){var a=!1;if(!r)if(obj.highlighted.length)var d=parseInt(obj.highlighted[0].getAttribute("data-x")),u=parseInt(obj.highlighted[0].getAttribute("data-y")),f=parseInt(obj.highlighted[obj.highlighted.length-1].getAttribute("data-x")),h=parseInt(obj.highlighted[obj.highlighted.length-1].getAttribute("data-y")),r=jexcel.getColumnNameFromId([d,u]),e=f-d+1,s=h-u+1;else return alert(obj.options.text.noCellsSelected),null;var g=jexcel.getIdFromColumnName(r,!0);if(obj.options.mergeCells[r])obj.records[g[1]][g[0]].getAttribute("data-merged")&&(a=obj.options.text.cellAlreadyMerged);else if((!e||e<2)&&(!s||s<2))a=obj.options.text.invalidMergeProperties;else for(var b=g[1];b<g[1]+s;b++)for(var m=g[0];m<g[0]+e;m++)jexcel.getColumnNameFromId([m,b]),obj.records[b][m].getAttribute("data-merged")&&(a=obj.options.text.thereIsAConflictWithAnotherMergedCell);if(a)alert(a);else{e>1?obj.records[g[1]][g[0]].setAttribute("colspan",e):e=1,s>1?obj.records[g[1]][g[0]].setAttribute("rowspan",s):s=1,obj.options.mergeCells[r]=[e,s,[]],obj.records[g[1]][g[0]].setAttribute("data-merged","true"),obj.records[g[1]][g[0]].style.overflow="hidden";for(var _=[],Ge=g[1];Ge<g[1]+s;Ge++)for(var ot=g[0];ot<g[0]+e;ot++)g[0]==ot&&g[1]==Ge||(_.push(obj.options.data[Ge][ot]),obj.updateCell(ot,Ge,"",!0),obj.options.mergeCells[r][2].push(obj.records[Ge][ot]),obj.records[Ge][ot].style.display="none",obj.records[Ge][ot]=obj.records[g[1]][g[0]]);obj.updateSelection(obj.records[g[1]][g[0]]),o||(obj.setHistory({action:"setMerge",column:r,colspan:e,rowspan:s,data:_}),obj.dispatch("onmerge",el,r,e,s))}},obj.getMerge=function(r){var e={};if(r)obj.options.mergeCells[r]?e=[obj.options.mergeCells[r][0],obj.options.mergeCells[r][1]]:e=null;else if(obj.options.mergeCells){obj.options.mergeCells;for(var s=Object.keys(obj.options.mergeCells),o=0;o<s.length;o++)e[s[o]]=[obj.options.mergeCells[s[o]][0],obj.options.mergeCells[s[o]][1]]}return e},obj.removeMerge=function(r,e,s){if(obj.options.mergeCells[r]){var o=jexcel.getIdFromColumnName(r,!0);obj.records[o[1]][o[0]].removeAttribute("colspan"),obj.records[o[1]][o[0]].removeAttribute("rowspan"),obj.records[o[1]][o[0]].removeAttribute("data-merged");for(var a=obj.options.mergeCells[r],d=0,u=0;u<a[1];u++)for(var f=0;f<a[0];f++)(u>0||f>0)&&(obj.records[o[1]+u][o[0]+f]=a[2][d],obj.records[o[1]+u][o[0]+f].style.display="",e&&e[d]&&obj.updateCell(o[0]+f,o[1]+u,e[d]),d++);obj.updateSelection(obj.records[o[1]][o[0]],obj.records[o[1]+u-1][o[0]+f-1]),s||delete obj.options.mergeCells[r]}},obj.destroyMerged=function(r){if(obj.options.mergeCells){obj.options.mergeCells;for(var e=Object.keys(obj.options.mergeCells),s=0;s<e.length;s++)obj.removeMerge(e[s],null,r)}},obj.isColMerged=function(r,e){var s=[];if(obj.options.mergeCells)for(var o=Object.keys(obj.options.mergeCells),a=0;a<o.length;a++){var d=jexcel.getIdFromColumnName(o[a],!0),u=obj.options.mergeCells[o[a]][0],f=d[0],h=d[0]+(u>1?u-1:0);e==null?f<=r&&h>=r&&s.push(o[a]):e?f<r&&h>=r&&s.push(o[a]):f<=r&&h>r&&s.push(o[a])}return s},obj.isRowMerged=function(r,e){var s=[];if(obj.options.mergeCells)for(var o=Object.keys(obj.options.mergeCells),a=0;a<o.length;a++){var d=jexcel.getIdFromColumnName(o[a],!0),u=obj.options.mergeCells[o[a]][1],f=d[1],h=d[1]+(u>1?u-1:0);e==null?f<=r&&h>=r&&s.push(o[a]):e?f<r&&h>=r&&s.push(o[a]):f<=r&&h>r&&s.push(o[a])}return s},obj.openFilter=function(r){if(!obj.options.filters)console.log("Jspreadsheet: filters not enabled.");else{r=parseInt(r),obj.resetSelection();var e=[];if(obj.options.columns[r].type=="checkbox")e.push({id:"true",name:"True"}),e.push({id:"false",name:"False"});else{for(var s=[],o=!1,a=0;a<obj.options.data.length;a++){var d=obj.options.data[a][r],u=obj.records[a][r].innerHTML;if(d&&u)s[d]=u;else var o=!0}for(var f=Object.keys(s),e=[],a=0;a<f.length;a++)e.push({id:f[a],name:s[f[a]]});o&&e.push({value:"",id:"",name:"(Blanks)"})}var h=document.createElement("div");obj.filter.children[r+1].innerHTML="",obj.filter.children[r+1].appendChild(h),obj.filter.children[r+1].style.paddingLeft="0px",obj.filter.children[r+1].style.paddingRight="0px",obj.filter.children[r+1].style.overflow="initial";var g={data:e,multiple:!0,autocomplete:!0,opened:!0,value:obj.filters[r]!==void 0?obj.filters[r]:null,width:"100%",position:obj.options.tableOverflow==!0||obj.options.fullscreen==!0,onclose:function(b){obj.resetFilters(),obj.filters[r]=b.dropdown.getValue(!0),obj.filter.children[r+1].innerHTML=b.dropdown.getText(),obj.filter.children[r+1].style.paddingLeft="",obj.filter.children[r+1].style.paddingRight="",obj.filter.children[r+1].style.overflow="",obj.closeFilter(r),obj.refreshSelection()}};jSuites.dropdown(h,g)}},obj.resetFilters=function(){if(obj.options.filters)for(var r=0;r<obj.filter.children.length;r++)obj.filter.children[r].innerHTML="&nbsp;",obj.filters[r]=null},obj.closeFilter=function(r){if(!r)for(var e=0;e<obj.filter.children.length;e++)obj.filters[e]&&(r=e);var s=function(d,u,f){for(var h=0;h<d.length;h++)if(d[h]==""&&(obj.options.data[f][u]===!1||""+obj.options.data[f][u]=="")||d[h]!=""&&((""+obj.options.data[f][u]).search(d[h])>=0||(""+obj.records[f][u].innerHTML).search(d[h])>=0))return!0;return!1},o=obj.filters[r];obj.results=[];for(var a=0;a<obj.options.data.length;a++)s(o,r,a)&&obj.results.push(a);obj.results.length||(obj.results=null),obj.updateResult()},obj.openEditor=function(r,e,s){var o=r.getAttribute("data-y"),a=r.getAttribute("data-x");obj.dispatch("oneditionstart",el,r,a,o),a>0&&(obj.records[o][a-1].style.overflow="hidden");var d=function(ar){var Lr=r.getBoundingClientRect(),Mr=document.createElement(ar);return Mr.style.width=Lr.width+"px",Mr.style.height=Lr.height-2+"px",Mr.style.minHeight=Lr.height-2+"px",r.classList.add("editor"),r.innerHTML="",r.appendChild(Mr),obj.dispatch("oncreateeditor",el,r,a,o,Mr),Mr};if(r.classList.contains("readonly")!=!0){if(obj.edition=[obj.records[o][a],obj.records[o][a].innerHTML,a,o],obj.options.columns[a].editor)obj.options.columns[a].editor.openEditor(r,el,e,s);else if(obj.options.columns[a].type!="hidden")if(obj.options.columns[a].type=="checkbox"||obj.options.columns[a].type=="radio"){var u=!r.children[0].checked;obj.setValue(r,u),obj.edition=null}else if(obj.options.columns[a].type=="dropdown"||obj.options.columns[a].type=="autocomplete"){var u=obj.options.data[o][a];if(obj.options.columns[a].multiple&&!Array.isArray(u)&&(u=u.split(";")),typeof obj.options.columns[a].filter=="function")var f=obj.options.columns[a].filter(el,r,a,o,obj.options.columns[a].source);else var f=obj.options.columns[a].source;for(var h=[],g=0;g<f.length;g++)h.push(f[g]);var b=d("div"),m={data:h,multiple:!!obj.options.columns[a].multiple,autocomplete:!!(obj.options.columns[a].autocomplete||obj.options.columns[a].type=="autocomplete"),opened:!0,value:u,width:"100%",height:b.style.minHeight,position:obj.options.tableOverflow==!0||obj.options.fullscreen==!0,onclose:function(){obj.closeEditor(r,!0)}};obj.options.columns[a].options&&obj.options.columns[a].options.type&&(m.type=obj.options.columns[a].options.type),jSuites.dropdown(b,m)}else if(obj.options.columns[a].type=="calendar"||obj.options.columns[a].type=="color"){var u=obj.options.data[o][a],b=d("input");b.value=u,(obj.options.tableOverflow==!0||obj.options.fullscreen==!0)&&(obj.options.columns[a].options.position=!0),obj.options.columns[a].options.value=obj.options.data[o][a],obj.options.columns[a].options.opened=!0,obj.options.columns[a].options.onclose=function(Mr,Br){obj.closeEditor(r,!0)},obj.options.columns[a].type=="color"?jSuites.color(b,obj.options.columns[a].options):jSuites.calendar(b,obj.options.columns[a].options),b.focus()}else if(obj.options.columns[a].type=="html"){var u=obj.options.data[o][a],b=d("div");b.style.position="relative";var _=document.createElement("div");_.classList.add("jexcel_richtext"),b.appendChild(_),jSuites.editor(_,{focus:!0,value:u});var Ge=r.getBoundingClientRect(),ot=_.getBoundingClientRect();window.innerHeight<Ge.bottom+ot.height?_.style.top=Ge.top-(ot.height+2)+"px":_.style.top=Ge.top+"px"}else if(obj.options.columns[a].type=="image"){var rr=r.children[0],b=d("div");b.style.position="relative";var _=document.createElement("div");_.classList.add("jclose"),rr&&rr.src&&_.appendChild(rr),b.appendChild(_),jSuites.image(_,obj.options.imageOptions);var Ge=r.getBoundingClientRect(),ot=_.getBoundingClientRect();window.innerHeight<Ge.bottom+ot.height?_.style.top=Ge.top-(ot.height+2)+"px":_.style.top=Ge.top+"px"}else{var u=e==!0?"":obj.options.data[o][a];if(obj.options.columns[a].wordWrap!=!1&&(obj.options.wordWrap==!0||obj.options.columns[a].wordWrap==!0))var b=d("textarea");else var b=d("input");b.focus(),b.value=u;var m=obj.options.columns[a],ir=null;if(!isFormula(u)&&(ir=getMask(m))){if(!m.disabledMaskOnEdition)if(m.mask){var er=m.mask.split(";");b.setAttribute("data-mask",er[0])}else m.locale&&b.setAttribute("data-locale",m.locale);ir.input=b,b.mask=ir,jSuites.mask.render(u,ir,!1)}b.onblur=function(){obj.closeEditor(r,!0)},b.scrollLeft=b.scrollWidth}}},obj.closeEditor=function(r,e){var s=parseInt(r.getAttribute("data-x")),o=parseInt(r.getAttribute("data-y"));if(e==!0){if(obj.options.columns[s].editor)var a=obj.options.columns[s].editor.closeEditor(r,e);else if(!(obj.options.columns[s].type=="checkbox"||obj.options.columns[s].type=="radio"||obj.options.columns[s].type=="hidden"))if(obj.options.columns[s].type=="dropdown"||obj.options.columns[s].type=="autocomplete")var a=r.children[0].dropdown.close(!0);else if(obj.options.columns[s].type=="calendar")var a=r.children[0].calendar.close(!0);else if(obj.options.columns[s].type=="color")var a=r.children[0].color.close(!0);else if(obj.options.columns[s].type=="html")var a=r.children[0].children[0].editor.getData();else if(obj.options.columns[s].type=="image")var d=r.children[0].children[0].children[0],a=d&&d.tagName=="IMG"?d.src:"";else if(obj.options.columns[s].type=="numeric"){var a=r.children[0].value;(""+a).substr(0,1)!="="&&a==""&&(a=obj.options.columns[s].allowEmpty?"":0),r.children[0].onblur=null}else{var a=r.children[0].value;r.children[0].onblur=null;var u=obj.options.columns[s],f=null;if((f=getMask(u))&&a!==""&&!isFormula(a)&&typeof a!="number"){var h=jSuites.mask.extract(a,f,!0);h&&h.value!==""&&(a=h.value)}}obj.options.data[o][s]==a?r.innerHTML=obj.edition[1]:obj.setValue(r,a)}else obj.options.columns[s].editor?obj.options.columns[s].editor.closeEditor(r,e):obj.options.columns[s].type=="dropdown"||obj.options.columns[s].type=="autocomplete"?r.children[0].dropdown.close(!0):obj.options.columns[s].type=="calendar"?r.children[0].calendar.close(!0):obj.options.columns[s].type=="color"?r.children[0].color.close(!0):r.children[0].onblur=null,r.innerHTML=obj.edition&&obj.edition[1]?obj.edition[1]:"";obj.dispatch("oneditionend",el,r,s,o,a,e),r.classList.remove("editor"),obj.edition=null},obj.getCell=function(r){r=jexcel.getIdFromColumnName(r,!0);var e=r[0],s=r[1];return obj.records[s][e]},obj.getColumnOptions=function(r,e){var s=obj.options.columns[r];return s||(s={type:"text"}),s},obj.getCellFromCoords=function(r,e){return obj.records[e][r]},obj.getLabel=function(r){r=jexcel.getIdFromColumnName(r,!0);var e=r[0],s=r[1];return obj.records[s][e].innerHTML},obj.getLabelFromCoords=function(r,e){return obj.records[e][r].innerHTML},obj.getValue=function(r,e){if(typeof r=="object")var s=r.getAttribute("data-x"),o=r.getAttribute("data-y");else{r=jexcel.getIdFromColumnName(r,!0);var s=r[0],o=r[1]}var a=null;return s!=null&&o!=null&&(obj.records[o]&&obj.records[o][s]&&(e||obj.options.copyCompatibility==!0)?a=obj.records[o][s].innerHTML:obj.options.data[o]&&obj.options.data[o][s]!="undefined"&&(a=obj.options.data[o][s])),a},obj.getValueFromCoords=function(r,e,s){var o=null;return r!=null&&e!=null&&(obj.records[e]&&obj.records[e][r]&&s||obj.options.copyCompatibility==!0?o=obj.records[e][r].innerHTML:obj.options.data[e]&&obj.options.data[e][r]!="undefined"&&(o=obj.options.data[e][r])),o},obj.setValue=function(r,e,s){var o=[];if(typeof r=="string"){var a=jexcel.getIdFromColumnName(r,!0),d=a[0],u=a[1];o.push(obj.updateCell(d,u,e,s)),obj.updateFormulaChain(d,u,o)}else{var d=null,u=null;if(r&&r.getAttribute)var d=r.getAttribute("data-x"),u=r.getAttribute("data-y");if(d!=null&&u!=null)o.push(obj.updateCell(d,u,e,s)),obj.updateFormulaChain(d,u,o);else{var f=Object.keys(r);if(f.length>0)for(var h=0;h<f.length;h++){if(typeof r[h]=="string")var a=jexcel.getIdFromColumnName(r[h],!0),d=a[0],u=a[1];else if(r[h].x!=null&&r[h].y!=null){var d=r[h].x,u=r[h].y;r[h].newValue!=null?e=r[h].newValue:r[h].value!=null&&(e=r[h].value)}else var d=r[h].getAttribute("data-x"),u=r[h].getAttribute("data-y");d!=null&&u!=null&&(o.push(obj.updateCell(d,u,e,s)),obj.updateFormulaChain(d,u,o))}}}obj.setHistory({action:"setValue",records:o,selection:obj.selectedCell}),obj.updateTable(),obj.onafterchanges(el,o)},obj.setValueFromCoords=function(r,e,s,o){var a=[];a.push(obj.updateCell(r,e,s,o)),obj.updateFormulaChain(r,e,a),obj.setHistory({action:"setValue",records:a,selection:obj.selectedCell}),obj.updateTable(),obj.onafterchanges(el,a)},obj.setCheckRadioValue=function(){for(var r=[],e=Object.keys(obj.highlighted),s=0;s<e.length;s++){var o=obj.highlighted[s].getAttribute("data-x"),a=obj.highlighted[s].getAttribute("data-y");(obj.options.columns[o].type=="checkbox"||obj.options.columns[o].type=="radio")&&r.push(obj.updateCell(o,a,!obj.options.data[a][o]))}r.length&&(obj.setHistory({action:"setValue",records:r,selection:obj.selectedCell}),obj.onafterchanges(el,r))};var stripScript=function(r){var e=new Option;e.innerHTML=r;var s=null;for(r=e.getElementsByTagName("script");s=r[0];)s.parentNode.removeChild(s);return e.innerHTML};obj.updateCell=function(r,e,s,o){if(obj.records[e][r].classList.contains("readonly")==!0&&!o)var a={x:r,y:e,col:r,row:e};else{if((""+s).substr(0,1)=="="&&obj.options.secureFormulas==!0){var d=secureFormula(s);d!=s&&(s=d)}var d=obj.dispatch("onbeforechange",el,obj.records[e][r],r,e,s);d!=null&&(s=d),obj.options.columns[r].editor&&typeof obj.options.columns[r].editor.updateCell=="function"&&(s=obj.options.columns[r].editor.updateCell(obj.records[e][r],s,o));var a={x:r,y:e,col:r,row:e,newValue:s,oldValue:obj.options.data[e][r]};if(obj.options.columns[r].editor)obj.options.data[e][r]=s;else if(obj.options.columns[r].type=="checkbox"||obj.options.columns[r].type=="radio"){if(obj.options.columns[r].type=="radio")for(var u=0;u<obj.options.data.length;u++)obj.options.data[u][r]=!1;obj.records[e][r].children[0].checked=s==1||s==!0||s=="true"||s=="TRUE",obj.options.data[e][r]=obj.records[e][r].children[0].checked}else if(obj.options.columns[r].type=="dropdown"||obj.options.columns[r].type=="autocomplete")obj.options.data[e][r]=s,obj.records[e][r].innerText=obj.getDropDownValue(r,s);else if(obj.options.columns[r].type=="calendar"){var f=null;if(!validDate(s)){var h=jSuites.calendar.extractDateFromString(s,obj.options.columns[r].options.format);h&&(f=h)}obj.options.data[e][r]=s,obj.records[e][r].innerText=jSuites.calendar.getDateString(f||s,obj.options.columns[r].options.format)}else if(obj.options.columns[r].type=="color")if(obj.options.data[e][r]=s,obj.options.columns[r].render=="square"){var g=document.createElement("div");g.className="color",g.style.backgroundColor=s,obj.records[e][r].innerText="",obj.records[e][r].appendChild(g)}else obj.records[e][r].style.color=s,obj.records[e][r].innerText=s;else if(obj.options.columns[r].type=="image"){if(s=""+s,obj.options.data[e][r]=s,obj.records[e][r].innerHTML="",s&&s.substr(0,10)=="data:image"){var b=document.createElement("img");b.src=s,obj.records[e][r].appendChild(b)}}else obj.options.data[e][r]=s,obj.options.columns[r].type=="html"?obj.records[e][r].innerHTML=stripScript(obj.parseValue(r,e,s)):obj.options.stripHTML===!1||obj.options.columns[r].stripHTML===!1?obj.records[e][r].innerHTML=stripScript(obj.parseValue(r,e,s,obj.records[e][r])):obj.records[e][r].innerText=obj.parseValue(r,e,s,obj.records[e][r]),obj.options.columns[r].wordWrap!=!1&&(obj.options.wordWrap==!0||obj.options.columns[r].wordWrap==!0||obj.records[e][r].innerHTML.length>200)?obj.records[e][r].style.whiteSpace="pre-wrap":obj.records[e][r].style.whiteSpace="";r>0&&(s?obj.records[e][r-1].style.overflow="hidden":obj.records[e][r-1].style.overflow=""),obj.dispatch("onchange",el,obj.records[e]&&obj.records[e][r]?obj.records[e][r]:null,r,e,s,a.oldValue)}return a},obj.copyData=function(r,e){var s=obj.getData(!0,!0),o=obj.selectedContainer,a=parseInt(r.getAttribute("data-x")),d=parseInt(r.getAttribute("data-y")),u=parseInt(e.getAttribute("data-x")),f=parseInt(e.getAttribute("data-y")),h=[],g=!1;if(o[0]==a){if(d<o[1])var b=d-o[1];else var b=1;var m=0}else{if(a<o[0])var m=a-o[0];else var m=1;var b=0}for(var _=0,Ge=0,ot=d;ot<=f;ot++)if(!(obj.rows[ot]&&obj.rows[ot].style.display=="none")){if(s[Ge]==null&&(Ge=0),_=0,o[0]!=a)if(a<o[0])var m=a-o[0];else var m=1;for(var rr=a;rr<=u;rr++){if(obj.records[ot][rr]&&!obj.records[ot][rr].classList.contains("readonly")&&obj.records[ot][rr].style.display!="none"&&g==!1){if(!obj.selection.length&&obj.options.data[ot][rr]!=""){g=!0;continue}(s[Ge]==null||s[Ge][_]==null)&&(_=0);var ir=s[Ge][_];if(ir&&!s[1]&&obj.options.autoIncrement==!0){if(obj.options.columns[rr].type=="text"||obj.options.columns[rr].type=="number")if((""+ir).substr(0,1)=="="){var er=ir.match(/([A-Z]+[0-9]+)/g);if(er){for(var ar=[],Lr=0;Lr<er.length;Lr++){var Mr=jexcel.getIdFromColumnName(er[Lr],1);Mr[0]+=m,Mr[1]+=b,Mr[1]<0&&(Mr[1]=0);var Br=jexcel.getColumnNameFromId([Mr[0],Mr[1]]);Br!=er[Lr]&&(ar[er[Lr]]=Br)}ar&&(ir=obj.updateFormula(ir,ar))}}else ir==Number(ir)&&(ir=Number(ir)+b);else if(obj.options.columns[rr].type=="calendar"){var Qr=new Date(ir);Qr.setDate(Qr.getDate()+b),ir=Qr.getFullYear()+"-"+jexcel.doubleDigitFormat(parseInt(Qr.getMonth()+1))+"-"+jexcel.doubleDigitFormat(Qr.getDate())+" 00:00:00"}}h.push(obj.updateCell(rr,ot,ir)),obj.updateFormulaChain(rr,ot,h)}_++,o[0]!=a&&m++}Ge++,b++}obj.setHistory({action:"setValue",records:h,selection:obj.selectedCell}),obj.updateTable(),obj.onafterchanges(el,h)},obj.refreshSelection=function(){obj.selectedCell&&obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3])},obj.conditionalSelectionUpdate=function(r,e,s){if(r==1){if(obj.selectedCell&&(e>=obj.selectedCell[1]&&e<=obj.selectedCell[3]||s>=obj.selectedCell[1]&&s<=obj.selectedCell[3])){obj.resetSelection();return}}else if(obj.selectedCell&&(e>=obj.selectedCell[0]&&e<=obj.selectedCell[2]||s>=obj.selectedCell[0]&&s<=obj.selectedCell[2])){obj.resetSelection();return}},obj.resetSelection=function(r){if(obj.highlighted.length)for(var e=1,s=0;s<obj.highlighted.length;s++){obj.highlighted[s].classList.remove("highlight"),obj.highlighted[s].classList.remove("highlight-left"),obj.highlighted[s].classList.remove("highlight-right"),obj.highlighted[s].classList.remove("highlight-top"),obj.highlighted[s].classList.remove("highlight-bottom"),obj.highlighted[s].classList.remove("highlight-selected");var o=parseInt(obj.highlighted[s].getAttribute("data-x")),a=parseInt(obj.highlighted[s].getAttribute("data-y"));if(obj.highlighted[s].getAttribute("data-merged"))var d=parseInt(obj.highlighted[s].getAttribute("colspan")),u=parseInt(obj.highlighted[s].getAttribute("rowspan")),f=d>0?o+(d-1):o,h=u>0?a+(u-1):a;else var f=o,h=a;for(var g=o;g<=f;g++)obj.headers[g]&&obj.headers[g].classList.remove("selected");for(var g=a;g<=h;g++)obj.rows[g]&&obj.rows[g].classList.remove("selected")}else var e=0;return obj.highlighted=[],obj.selectedCell=null,obj.corner.style.top="-2000px",obj.corner.style.left="-2000px",r==!0&&e==1&&obj.dispatch("onblur",el),e},obj.updateSelection=function(r,e,s){var o=r.getAttribute("data-x"),a=r.getAttribute("data-y");if(e)var d=e.getAttribute("data-x"),u=e.getAttribute("data-y");else var d=o,u=a;obj.updateSelectionFromCoords(o,a,d,u,s)},obj.updateSelectionFromCoords=function(r,e,s,o,a){var d=obj.resetSelection();if(e==null&&(e=0,o=obj.rows.length-1),s==null&&(s=r),o==null&&(o=e),r>=obj.headers.length&&(r=obj.headers.length-1),e>=obj.rows.length&&(e=obj.rows.length-1),s>=obj.headers.length&&(s=obj.headers.length-1),o>=obj.rows.length&&(o=obj.rows.length-1),obj.selectedCell=[r,e,s,o],r!=null){if(obj.records[e][r]&&obj.records[e][r].classList.add("highlight-selected"),parseInt(r)<parseInt(s))var u=parseInt(r),f=parseInt(s);else var u=parseInt(s),f=parseInt(r);if(parseInt(e)<parseInt(o))var h=parseInt(e),g=parseInt(o);else var h=parseInt(o),g=parseInt(e);for(var b=u;b<=f;b++)for(var m=h;m<=g;m++)if(obj.records[m][b]&&obj.records[m][b].getAttribute("data-merged")){var _=parseInt(obj.records[m][b].getAttribute("data-x")),Ge=parseInt(obj.records[m][b].getAttribute("data-y")),ot=parseInt(obj.records[m][b].getAttribute("colspan")),rr=parseInt(obj.records[m][b].getAttribute("rowspan"));ot>1&&(_<u&&(u=_),_+ot>f&&(f=_+ot-1)),rr&&(Ge<h&&(h=Ge),Ge+rr>g&&(g=Ge+rr-1))}for(var ir=null,er=null,ar=null,Lr=null,m=h;m<=g;m++)obj.rows[m].style.display!="none"&&(ar==null&&(ar=m),Lr=m);for(var b=u;b<=f;b++){for(var m=h;m<=g;m++)obj.rows[m].style.display!="none"&&obj.records[m][b].style.display!="none"&&(obj.records[m][b].classList.add("highlight"),obj.highlighted.push(obj.records[m][b]));obj.options.columns[b].type!="hidden"&&(ir==null&&(ir=b),er=b)}ir||(ir=0),er||(er=0);for(var b=ir;b<=er;b++)obj.options.columns[b].type!="hidden"&&(obj.records[ar]&&obj.records[ar][b]&&obj.records[ar][b].classList.add("highlight-top"),obj.records[Lr]&&obj.records[Lr][b]&&obj.records[Lr][b].classList.add("highlight-bottom"),obj.headers[b].classList.add("selected"));for(var m=ar;m<=Lr;m++)obj.rows[m]&&obj.rows[m].style.display!="none"&&(obj.records[m][ir].classList.add("highlight-left"),obj.records[m][er].classList.add("highlight-right"),obj.rows[m].classList.add("selected"));obj.selectedContainer=[ir,ar,er,Lr]}d==0&&(obj.dispatch("onfocus",el),obj.removeCopyingSelection()),obj.dispatch("onselection",el,ir,ar,er,Lr,a),obj.updateCornerPosition()},obj.removeCopySelection=function(){for(var r=0;r<obj.selection.length;r++)obj.selection[r].classList.remove("selection"),obj.selection[r].classList.remove("selection-left"),obj.selection[r].classList.remove("selection-right"),obj.selection[r].classList.remove("selection-top"),obj.selection[r].classList.remove("selection-bottom");obj.selection=[]},obj.updateCopySelection=function(r,e){obj.removeCopySelection();var s=obj.selectedContainer[0],o=obj.selectedContainer[1],a=obj.selectedContainer[2],d=obj.selectedContainer[3];if(r!=null&&e!=null){if(r-a>0)var u=parseInt(a)+1,f=parseInt(r);else var u=parseInt(r),f=parseInt(s)-1;if(e-d>0)var h=parseInt(d)+1,g=parseInt(e);else var h=parseInt(e),g=parseInt(o)-1;if(f-u<=g-h)var u=parseInt(s),f=parseInt(a);else var h=parseInt(o),g=parseInt(d);for(var b=h;b<=g;b++)for(var m=u;m<=f;m++)obj.records[b][m]&&obj.rows[b].style.display!="none"&&obj.records[b][m].style.display!="none"&&(obj.records[b][m].classList.add("selection"),obj.records[h][m].classList.add("selection-top"),obj.records[g][m].classList.add("selection-bottom"),obj.records[b][u].classList.add("selection-left"),obj.records[b][f].classList.add("selection-right"),obj.selection.push(obj.records[b][m]))}},obj.updateCornerPosition=function(){if(!obj.highlighted.length)obj.corner.style.top="-2000px",obj.corner.style.left="-2000px";else{var r=obj.highlighted[obj.highlighted.length-1],e=obj.content.getBoundingClientRect(),s=e.left,o=e.top,a=r.getBoundingClientRect(),d=a.left,u=a.top,f=a.width,h=a.height,g=d-s+obj.content.scrollLeft+f-4,b=u-o+obj.content.scrollTop+h-4;if(obj.corner.style.top=b+"px",obj.corner.style.left=g+"px",obj.options.freezeColumns){var m=obj.getFreezeWidth();d-s+f<m?obj.corner.style.display="none":obj.options.selectionCopy==!0&&(obj.corner.style.display="")}else obj.options.selectionCopy==!0&&(obj.corner.style.display="")}},obj.updateScroll=function(r){var e=obj.content.getBoundingClientRect(),s=e.left,o=e.top,a=e.width,d=e.height,u=obj.records[obj.selectedCell[3]][obj.selectedCell[2]],f=u.getBoundingClientRect(),h=f.left,g=f.top,b=f.width,m=f.height;if(r==0||r==1)var _=h-s+obj.content.scrollLeft,Ge=g-o+obj.content.scrollTop-2;else var _=h-s+obj.content.scrollLeft+b,Ge=g-o+obj.content.scrollTop+m;Ge>obj.content.scrollTop+30&&Ge<obj.content.scrollTop+d||(Ge<obj.content.scrollTop+30?obj.content.scrollTop=Ge-m:obj.content.scrollTop=Ge-(d-2));var ot=obj.getFreezeWidth();_>obj.content.scrollLeft+ot&&_<obj.content.scrollLeft+a||(_<obj.content.scrollLeft+30?(obj.content.scrollLeft=_,obj.content.scrollLeft<50&&(obj.content.scrollLeft=0)):_<obj.content.scrollLeft+ot?obj.content.scrollLeft=_-ot-1:obj.content.scrollLeft=_-(a-20))},obj.getWidth=function(r){if(r)typeof r=="object"&&(r=$(r).getAttribute("data-x")),e=obj.colgroup[r].getAttribute("width");else for(var e=[],s=0;s<obj.headers.length;s++)e.push(obj.options.columns[s].width);return e},obj.setWidth=function(r,e,s){if(e){if(Array.isArray(r)){if(!s)var s=[];for(var o=0;o<r.length;o++){s[o]||(s[o]=obj.colgroup[r[o]].getAttribute("width"));var a=Array.isArray(e)&&e[o]?e[o]:e;obj.colgroup[r[o]].setAttribute("width",a),obj.options.columns[r[o]].width=a}}else s||(s=obj.colgroup[r].getAttribute("width")),obj.colgroup[r].setAttribute("width",e),obj.options.columns[r].width=e;obj.setHistory({action:"setWidth",column:r,oldValue:s,newValue:e}),obj.dispatch("onresizecolumn",el,r,e,s),obj.updateCornerPosition()}},obj.setHeight=function(r,e,s){if(e>0){if(typeof r=="object"&&(r=r.getAttribute("data-y")),!s&&(s=obj.rows[r].getAttribute("height"),!s)){var o=obj.rows[r].getBoundingClientRect();s=o.height}e=parseInt(e),obj.rows[r].style.height=e+"px",obj.options.rows[r]||(obj.options.rows[r]={}),obj.options.rows[r].height=e,obj.setHistory({action:"setHeight",row:r,oldValue:s,newValue:e}),obj.dispatch("onresizerow",el,r,e,s),obj.updateCornerPosition()}},obj.getHeight=function(r){if(r){typeof r=="object"&&(r=$(r).getAttribute("data-y"));var e=obj.rows[r].style.height}else for(var e=[],s=0;s<obj.rows.length;s++){var o=obj.rows[s].style.height;o&&(e[s]=o)}return e},obj.setFooter=function(r){if(r&&(obj.options.footers=r),obj.options.footers){obj.tfoot||(obj.tfoot=document.createElement("tfoot"),obj.table.appendChild(obj.tfoot));for(var e=0;e<obj.options.footers.length;e++){if(obj.tfoot.children[e])var s=obj.tfoot.children[e];else{var s=document.createElement("tr"),o=document.createElement("td");s.appendChild(o),obj.tfoot.appendChild(s)}for(var a=0;a<obj.headers.length;a++){if(obj.options.footers[e][a]||(obj.options.footers[e][a]=""),obj.tfoot.children[e].children[a+1])var o=obj.tfoot.children[e].children[a+1];else{var o=document.createElement("td");s.appendChild(o);var d=obj.options.columns[a].align?obj.options.columns[a].align:"center";o.style.textAlign=d}o.innerText=obj.parseValue(a,e,obj.options.footers[e][a])}}}},obj.getHeader=function(r){return obj.headers[r].innerText},obj.setHeader=function(r,e){if(obj.headers[r]){var s=obj.headers[r].innerText;e||(e=prompt(obj.options.text.columnName,s)),e&&(obj.headers[r].innerText=e,obj.headers[r].setAttribute("title",e),obj.options.columns[r].title=e),obj.setHistory({action:"setHeader",column:r,oldValue:s,newValue:e}),obj.dispatch("onchangeheader",el,r,s,e)}},obj.getHeaders=function(r){for(var e=[],s=0;s<obj.headers.length;s++)e.push(obj.getHeader(s));return r?e:e.join(obj.options.csvDelimiter)},obj.getMeta=function(r,e){return r?e?obj.options.meta[r]&&obj.options.meta[r][e]?obj.options.meta[r][e]:null:obj.options.meta[r]?obj.options.meta[r]:null:obj.options.meta},obj.setMeta=function(r,e,s){if(obj.options.meta||(obj.options.meta={}),e&&s)obj.options.meta[r]||(obj.options.meta[r]={}),obj.options.meta[r][e]=s;else for(var o=Object.keys(r),a=0;a<o.length;a++){obj.options.meta[o[a]]||(obj.options.meta[o[a]]={});for(var d=Object.keys(r[o[a]]),u=0;u<d.length;u++)obj.options.meta[o[a]][d[u]]=r[o[a]][d[u]]}obj.dispatch("onchangemeta",el,r,e,s)},obj.updateMeta=function(r){if(obj.options.meta){for(var e={},s=Object.keys(obj.options.meta),o=0;o<s.length;o++)r[s[o]]?e[r[s[o]]]=obj.options.meta[s[o]]:e[s[o]]=obj.options.meta[s[o]];obj.options.meta=e}},obj.getStyle=function(r,e){if(r)return r=jexcel.getIdFromColumnName(r,!0),e?obj.records[r[1]][r[0]].style[e]:obj.records[r[1]][r[0]].getAttribute("style");for(var s={},o=obj.options.data[0].length,a=obj.options.data.length,d=0;d<a;d++)for(var u=0;u<o;u++){var f=e?obj.records[d][u].style[e]:obj.records[d][u].getAttribute("style");if(f){var h=jexcel.getColumnNameFromId([u,d]);s[h]=f}}return s},obj.resetStyle=function(r,e){for(var s=Object.keys(r),o=0;o<s.length;o++){var a=jexcel.getIdFromColumnName(s[o],!0);obj.records[a[1]]&&obj.records[a[1]][a[0]]&&obj.records[a[1]][a[0]].setAttribute("style","")}obj.setStyle(r,null,null,null,e)},obj.setStyle=function(r,e,s,o,a){var d={},u={},f=function(ir,er,ar){var Lr=jexcel.getIdFromColumnName(ir,!0);if(obj.records[Lr[1]]&&obj.records[Lr[1]][Lr[0]]&&(obj.records[Lr[1]][Lr[0]].classList.contains("readonly")==!1||o)){var Mr=obj.records[Lr[1]][Lr[0]].style[er];Mr==ar&&!o?(ar="",obj.records[Lr[1]][Lr[0]].style[er]=""):obj.records[Lr[1]][Lr[0]].style[er]=ar,u[ir]||(u[ir]=[]),d[ir]||(d[ir]=[]),u[ir].push([er+":"+Mr]),d[ir].push([er+":"+ar])}};if(e&&s)if(typeof r=="string")f(r,e,s);else for(var h=[],g=0;g<r.length;g++){var b=r[g].getAttribute("data-x"),m=r[g].getAttribute("data-y"),_=jexcel.getColumnNameFromId([b,m]);h[_]||(f(_,e,s),h[_]=!0)}else for(var rr=Object.keys(r),g=0;g<rr.length;g++){var Ge=r[rr[g]];typeof Ge=="string"&&(Ge=Ge.split(";"));for(var ot=0;ot<Ge.length;ot++)typeof Ge[ot]=="string"&&(Ge[ot]=Ge[ot].split(":")),Ge[ot][0].trim()&&f(rr[g],Ge[ot][0].trim(),Ge[ot][1])}for(var rr=Object.keys(u),g=0;g<rr.length;g++)u[rr[g]]=u[rr[g]].join(";");for(var rr=Object.keys(d),g=0;g<rr.length;g++)d[rr[g]]=d[rr[g]].join(";");a||obj.setHistory({action:"setStyle",oldValue:u,newValue:d}),obj.dispatch("onchangestyle",el,r,e,s)},obj.getComments=function(r,e){if(r){if(typeof r=="string")var r=jexcel.getIdFromColumnName(r,!0);return e?[obj.records[r[1]][r[0]].getAttribute("title"),obj.records[r[1]][r[0]].getAttribute("author")]:obj.records[r[1]][r[0]].getAttribute("title")||""}else{for(var s={},o=0;o<obj.options.data.length;o++)for(var a=0;a<obj.options.columns.length;a++){var d=obj.records[o][a].getAttribute("title");if(d){var r=jexcel.getColumnNameFromId([a,o]);s[r]=d}}return s}},obj.setComments=function(r,e,s){if(typeof r=="string")var o=jexcel.getIdFromColumnName(r,!0);else var o=r;var a=obj.records[o[1]][o[0]].getAttribute("title"),s=obj.records[o[1]][o[0]].getAttribute("data-author"),d=[a,s];obj.records[o[1]][o[0]].setAttribute("title",e||""),obj.records[o[1]][o[0]].setAttribute("data-author",s||""),e?obj.records[o[1]][o[0]].classList.add("jexcel_comments"):obj.records[o[1]][o[0]].classList.remove("jexcel_comments"),obj.setHistory({action:"setComments",column:r,newValue:[e,s],oldValue:d}),obj.dispatch("oncomments",el,e,a,o,o[0],o[1])},obj.getConfig=function(){var r=obj.options;return r.style=obj.getStyle(),r.mergeCells=obj.getMerge(),r.comments=obj.getComments(),r},obj.orderBy=function(r,e){if(r>=0){if(Object.keys(obj.options.mergeCells).length>0)if(confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))obj.destroyMerged();else return!1;e==null?e=obj.headers[r].classList.contains("arrow-down")?1:0:e=e?1:0;var s=[];if(obj.options.columns[r].type=="number"||obj.options.columns[r].type=="percentage"||obj.options.columns[r].type=="autonumber"||obj.options.columns[r].type=="color")for(var o=0;o<obj.options.data.length;o++)s[o]=[o,Number(obj.options.data[o][r])];else if(obj.options.columns[r].type=="calendar"||obj.options.columns[r].type=="checkbox"||obj.options.columns[r].type=="radio")for(var o=0;o<obj.options.data.length;o++)s[o]=[o,obj.options.data[o][r]];else for(var o=0;o<obj.options.data.length;o++)s[o]=[o,obj.records[o][r].innerText.toLowerCase()];typeof obj.options.sorting!="function"&&(obj.options.sorting=function(d){return function(u,f){var h=u[1],g=f[1];return d?h===""&&g!==""?1:h!==""&&g===""||h>g?-1:h<g?1:0:h===""&&g!==""?1:h!==""&&g===""?-1:h>g?1:h<g?-1:0}}),s=s.sort(obj.options.sorting(e));for(var a=[],o=0;o<s.length;o++)a[o]=s[o][0];return obj.setHistory({action:"orderBy",rows:a,column:r,order:e}),obj.updateOrderArrow(r,e),obj.updateOrder(a),obj.dispatch("onsort",el,r,e),!0}},obj.updateOrderArrow=function(r,e){for(var s=0;s<obj.headers.length;s++)obj.headers[s].classList.remove("arrow-up"),obj.headers[s].classList.remove("arrow-down");e?obj.headers[r].classList.add("arrow-up"):obj.headers[r].classList.add("arrow-down")},obj.updateOrder=function(r){for(var e=[],s=0;s<r.length;s++)e[s]=obj.options.data[r[s]];obj.options.data=e;for(var e=[],s=0;s<r.length;s++)e[s]=obj.records[r[s]];obj.records=e;for(var e=[],s=0;s<r.length;s++)e[s]=obj.rows[r[s]];if(obj.rows=e,obj.updateTableReferences(),obj.results&&obj.results.length)obj.searchInput.value?obj.search(obj.searchInput.value):obj.closeFilter();else if(obj.results=null,obj.pageNumber=0,obj.options.pagination>0)obj.page(0);else if(obj.options.lazyLoading==!0)obj.loadPage(0);else for(var s=0;s<obj.rows.length;s++)obj.tbody.appendChild(obj.rows[s])},obj.moveRow=function(r,e,s){if(Object.keys(obj.options.mergeCells).length>0){if(r>e)var o=1;else var o=0;if(obj.isRowMerged(r).length||obj.isRowMerged(e,o).length)if(confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))obj.destroyMerged();else return!1}if(obj.options.search==!0){if(obj.results&&obj.results.length!=obj.rows.length)if(confirm(obj.options.text.thisActionWillClearYourSearchResultsAreYouSure))obj.resetSearch();else return!1;obj.results=null}s||(Array.prototype.indexOf.call(obj.tbody.children,obj.rows[e])>=0?r>e?obj.tbody.insertBefore(obj.rows[r],obj.rows[e]):obj.tbody.insertBefore(obj.rows[r],obj.rows[e].nextSibling):obj.tbody.removeChild(obj.rows[r])),obj.rows.splice(e,0,obj.rows.splice(r,1)[0]),obj.records.splice(e,0,obj.records.splice(r,1)[0]),obj.options.data.splice(e,0,obj.options.data.splice(r,1)[0]),obj.options.pagination>0&&obj.tbody.children.length!=obj.options.pagination&&obj.page(obj.pageNumber),obj.setHistory({action:"moveRow",oldValue:r,newValue:e}),obj.updateTableReferences(),obj.dispatch("onmoverow",el,r,e)},obj.insertRow=function(r,e,s){if(obj.options.allowInsertRow==!0){var o=[];if(r>0)var a=r;else{var a=1;r&&(o=r)}var s=!!s,d=obj.options.data.length-1;if((e==null||e>=parseInt(d)||e<0)&&(e=d),obj.dispatch("onbeforeinsertrow",el,e,a,s)===!1)return!1;if(Object.keys(obj.options.mergeCells).length>0&&obj.isRowMerged(e,s).length)if(confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))obj.destroyMerged();else return!1;if(obj.options.search==!0){if(obj.results&&obj.results.length!=obj.rows.length)if(confirm(obj.options.text.thisActionWillClearYourSearchResultsAreYouSure))obj.resetSearch();else return!1;obj.results=null}for(var u=s?e:e+1,f=obj.records.splice(u),h=obj.options.data.splice(u),g=obj.rows.splice(u),b=[],m=[],_=[],Ge=u;Ge<a+u;Ge++){obj.options.data[Ge]=[];for(var ot=0;ot<obj.options.columns.length;ot++)obj.options.data[Ge][ot]=o[ot]?o[ot]:"";var rr=obj.createRow(Ge,obj.options.data[Ge]);g[0]?Array.prototype.indexOf.call(obj.tbody.children,g[0])>=0&&obj.tbody.insertBefore(rr,g[0]):Array.prototype.indexOf.call(obj.tbody.children,obj.rows[e])>=0&&obj.tbody.appendChild(rr),b.push(obj.records[Ge]),m.push(obj.options.data[Ge]),_.push(rr)}Array.prototype.push.apply(obj.records,f),Array.prototype.push.apply(obj.options.data,h),Array.prototype.push.apply(obj.rows,g),obj.options.pagination>0&&obj.page(obj.pageNumber),obj.setHistory({action:"insertRow",rowNumber:e,numOfRows:a,insertBefore:s,rowRecords:b,rowData:m,rowNode:_}),obj.updateTableReferences(),obj.dispatch("oninsertrow",el,e,a,b,s)}},obj.deleteRow=function(r,e){if(obj.options.allowDeleteRow==!0)if(obj.options.allowDeletingAllRows==!0||obj.options.data.length>1){if(r==null){var s=obj.getSelectedRows();s[0]?(r=parseInt(s[0].getAttribute("data-y")),e=s.length):(r=obj.options.data.length-1,e=1)}var o=obj.options.data.length-1;if((r==null||r>o||r<0)&&(r=o),e||(e=1),r+e>=obj.options.data.length&&(e=obj.options.data.length-r),obj.dispatch("onbeforedeleterow",el,r,e)===!1)return!1;if(parseInt(r)>-1){var a=!1;if(Object.keys(obj.options.mergeCells).length>0)for(var d=r;d<r+e;d++)obj.isRowMerged(d,!1).length&&(a=!0);if(a)if(confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))obj.destroyMerged();else return!1;if(obj.options.search==!0){if(obj.results&&obj.results.length!=obj.rows.length)if(confirm(obj.options.text.thisActionWillClearYourSearchResultsAreYouSure))obj.resetSearch();else return!1;obj.results=null}obj.options.allowDeletingAllRows==!1&&o+1===e&&(e--,console.error("Jspreadsheet: It is not possible to delete the last row"));for(var d=r;d<r+e;d++)Array.prototype.indexOf.call(obj.tbody.children,obj.rows[d])>=0&&(obj.rows[d].className="",obj.rows[d].parentNode.removeChild(obj.rows[d]));var u=obj.records.splice(r,e),f=obj.options.data.splice(r,e),h=obj.rows.splice(r,e);obj.options.pagination>0&&obj.tbody.children.length!=obj.options.pagination&&obj.page(obj.pageNumber),obj.conditionalSelectionUpdate(1,r,r+e-1),obj.setHistory({action:"deleteRow",rowNumber:r,numOfRows:e,insertBefore:1,rowRecords:u,rowData:f,rowNode:h}),obj.updateTableReferences(),obj.dispatch("ondeleterow",el,r,e,u)}}else console.error("Jspreadsheet: It is not possible to delete the last row")},obj.moveColumn=function(r,e){if(Object.keys(obj.options.mergeCells).length>0){if(r>e)var s=1;else var s=0;if(obj.isColMerged(r).length||obj.isColMerged(e,s).length)if(confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))obj.destroyMerged();else return!1}var r=parseInt(r),e=parseInt(e);if(r>e){obj.headerContainer.insertBefore(obj.headers[r],obj.headers[e]),obj.colgroupContainer.insertBefore(obj.colgroup[r],obj.colgroup[e]);for(var o=0;o<obj.rows.length;o++)obj.rows[o].insertBefore(obj.records[o][r],obj.records[o][e])}else{obj.headerContainer.insertBefore(obj.headers[r],obj.headers[e].nextSibling),obj.colgroupContainer.insertBefore(obj.colgroup[r],obj.colgroup[e].nextSibling);for(var o=0;o<obj.rows.length;o++)obj.rows[o].insertBefore(obj.records[o][r],obj.records[o][e].nextSibling)}obj.options.columns.splice(e,0,obj.options.columns.splice(r,1)[0]),obj.headers.splice(e,0,obj.headers.splice(r,1)[0]),obj.colgroup.splice(e,0,obj.colgroup.splice(r,1)[0]);for(var o=0;o<obj.rows.length;o++)obj.options.data[o].splice(e,0,obj.options.data[o].splice(r,1)[0]),obj.records[o].splice(e,0,obj.records[o].splice(r,1)[0]);if(obj.options.footers)for(var o=0;o<obj.options.footers.length;o++)obj.options.footers[o].splice(e,0,obj.options.footers[o].splice(r,1)[0]);obj.setHistory({action:"moveColumn",oldValue:r,newValue:e}),obj.updateTableReferences(),obj.dispatch("onmovecolumn",el,r,e)},obj.insertColumn=function(r,e,s,o){if(obj.options.allowInsertColumn==!0){var a=[];if(r>0)var d=r;else{var d=1;r&&(a=r)}var s=!!s,u=obj.options.columns.length-1;if((e==null||e>=parseInt(u)||e<0)&&(e=u),obj.dispatch("onbeforeinsertcolumn",el,e,d,s)===!1)return!1;if(Object.keys(obj.options.mergeCells).length>0&&obj.isColMerged(e,s).length)if(confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))obj.destroyMerged();else return!1;o||(o=[]);for(var f=0;f<d;f++)o[f]||(o[f]={type:"text",source:[],options:[],width:obj.options.defaultColWidth,align:obj.options.defaultColAlign});var h=s?e:e+1;obj.options.columns=jexcel.injectArray(obj.options.columns,h,o);for(var g=obj.headers.splice(h),b=obj.colgroup.splice(h),m=[],_=[],Ge=[],ot=[],rr=[],ir=h;ir<d+h;ir++)obj.createCellHeader(ir),obj.headerContainer.insertBefore(obj.headers[ir],obj.headerContainer.children[ir+1]),obj.colgroupContainer.insertBefore(obj.colgroup[ir],obj.colgroupContainer.children[ir+1]),m.push(obj.headers[ir]),_.push(obj.colgroup[ir]);if(obj.options.footers)for(var er=0;er<obj.options.footers.length;er++){rr[er]=[];for(var f=0;f<d;f++)rr[er].push("");obj.options.footers[er].splice(h,0,rr[er])}for(var ar=0;ar<obj.options.data.length;ar++){var Lr=obj.options.data[ar].splice(h),Mr=obj.records[ar].splice(h);ot[ar]=[],Ge[ar]=[];for(var ir=h;ir<d+h;ir++){var Br=a[ar]?a[ar]:"";obj.options.data[ar][ir]=Br;var Qr=obj.createCell(ir,ar,obj.options.data[ar][ir]);obj.records[ar][ir]=Qr,obj.rows[ar]&&obj.rows[ar].insertBefore(Qr,obj.rows[ar].children[ir+1]),ot[ar].push(Br),Ge[ar].push(Qr)}Array.prototype.push.apply(obj.options.data[ar],Lr),Array.prototype.push.apply(obj.records[ar],Mr)}if(Array.prototype.push.apply(obj.headers,g),Array.prototype.push.apply(obj.colgroup,b),obj.options.nestedHeaders&&obj.options.nestedHeaders.length>0)if(obj.options.nestedHeaders[0]&&obj.options.nestedHeaders[0][0])for(var er=0;er<obj.options.nestedHeaders.length;er++){var ii=parseInt(obj.options.nestedHeaders[er][obj.options.nestedHeaders[er].length-1].colspan)+d;obj.options.nestedHeaders[er][obj.options.nestedHeaders[er].length-1].colspan=ii,obj.thead.children[er].children[obj.thead.children[er].children.length-1].setAttribute("colspan",ii);var Ir=obj.thead.children[er].children[obj.thead.children[er].children.length-1].getAttribute("data-column");Ir=Ir.split(",");for(var ir=h;ir<d+h;ir++)Ir.push(ir);obj.thead.children[er].children[obj.thead.children[er].children.length-1].setAttribute("data-column",Ir)}else{var ii=parseInt(obj.options.nestedHeaders[0].colspan)+d;obj.options.nestedHeaders[0].colspan=ii,obj.thead.children[0].children[obj.thead.children[0].children.length-1].setAttribute("colspan",ii)}obj.setHistory({action:"insertColumn",columnNumber:e,numOfColumns:d,insertBefore:s,columns:o,headers:m,colgroup:_,records:Ge,footers:rr,data:ot}),obj.updateTableReferences(),obj.dispatch("oninsertcolumn",el,e,d,Ge,s)}},obj.deleteColumn=function(r,e){if(obj.options.allowDeleteColumn==!0)if(obj.headers.length>1){if(r==null){var s=obj.getSelectedColumns(!0);s.length?(r=parseInt(s[0]),e=parseInt(s.length)):(r=obj.headers.length-1,e=1)}var o=obj.options.data[0].length-1;if((r==null||r>o||r<0)&&(r=o),e||(e=1),e>obj.options.data[0].length-r&&(e=obj.options.data[0].length-r),obj.dispatch("onbeforedeletecolumn",el,r,e)===!1)return!1;if(parseInt(r)>-1){var a=!1;if(Object.keys(obj.options.mergeCells).length>0)for(var d=r;d<r+e;d++)obj.isColMerged(d,!1).length&&(a=!0);if(a)if(confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))obj.destroyMerged();else return!1;for(var u=obj.options.columns.splice(r,e),d=r;d<r+e;d++)obj.colgroup[d].className="",obj.headers[d].className="",obj.colgroup[d].parentNode.removeChild(obj.colgroup[d]),obj.headers[d].parentNode.removeChild(obj.headers[d]);for(var f=obj.headers.splice(r,e),h=obj.colgroup.splice(r,e),g=[],b=[],m=[],_=0;_<obj.options.data.length;_++)for(var d=r;d<r+e;d++)obj.records[_][d].className="",obj.records[_][d].parentNode.removeChild(obj.records[_][d]);for(var _=0;_<obj.options.data.length;_++)b[_]=obj.options.data[_].splice(r,e),g[_]=obj.records[_].splice(r,e);if(obj.options.footers)for(var _=0;_<obj.options.footers.length;_++)m[_]=obj.options.footers[_].splice(r,e);if(obj.conditionalSelectionUpdate(0,r,r+e-1),obj.options.nestedHeaders&&obj.options.nestedHeaders.length>0)if(obj.options.nestedHeaders[0]&&obj.options.nestedHeaders[0][0])for(var Ge=0;Ge<obj.options.nestedHeaders.length;Ge++){var ot=parseInt(obj.options.nestedHeaders[Ge][obj.options.nestedHeaders[Ge].length-1].colspan)-e;obj.options.nestedHeaders[Ge][obj.options.nestedHeaders[Ge].length-1].colspan=ot,obj.thead.children[Ge].children[obj.thead.children[Ge].children.length-1].setAttribute("colspan",ot)}else{var ot=parseInt(obj.options.nestedHeaders[0].colspan)-e;obj.options.nestedHeaders[0].colspan=ot,obj.thead.children[0].children[obj.thead.children[0].children.length-1].setAttribute("colspan",ot)}obj.setHistory({action:"deleteColumn",columnNumber:r,numOfColumns:e,insertBefore:1,columns:u,headers:f,colgroup:h,records:g,footers:m,data:b}),obj.updateTableReferences(),obj.dispatch("ondeletecolumn",el,r,e,g)}}else console.error("Jspreadsheet: It is not possible to delete the last column")},obj.getSelectedRows=function(r){for(var e=[],s=0;s<obj.rows.length;s++)obj.rows[s].classList.contains("selected")&&(r?e.push(s):e.push(obj.rows[s]));return e},obj.getSelectedColumns=function(){for(var r=[],e=0;e<obj.headers.length;e++)obj.headers[e].classList.contains("selected")&&r.push(e);return r},obj.getHighlighted=function(){return obj.highlighted},obj.updateTableReferences=function(){for(var r=0;r<obj.headers.length;r++){var e=obj.headers[r].getAttribute("data-x");e!=r&&(obj.headers[r].setAttribute("data-x",r),obj.headers[r].getAttribute("title")||(obj.headers[r].innerHTML=jexcel.getColumnName(r)))}for(var s=0;s<obj.rows.length;s++)if(obj.rows[s]){var o=obj.rows[s].getAttribute("data-y");o!=s&&(obj.rows[s].setAttribute("data-y",s),obj.rows[s].children[0].setAttribute("data-y",s),obj.rows[s].children[0].innerHTML=s+1)}for(var a=[],d=[],u=function(Ge,ot,rr,ir){if(Ge!=rr&&obj.records[ir][rr].setAttribute("data-x",rr),ot!=ir&&obj.records[ir][rr].setAttribute("data-y",ir),Ge!=rr||ot!=ir){var er=jexcel.getColumnNameFromId([Ge,ot]),ar=jexcel.getColumnNameFromId([rr,ir]);a[er]=ar}},s=0;s<obj.records.length;s++)for(var r=0;r<obj.records[0].length;r++)if(obj.records[s][r]){var e=obj.records[s][r].getAttribute("data-x"),o=obj.records[s][r].getAttribute("data-y");if(obj.records[s][r].getAttribute("data-merged")){var f=jexcel.getColumnNameFromId([e,o]),h=jexcel.getColumnNameFromId([r,s]);if(d[f]==null)if(f==h)d[f]=!1;else{var g=parseInt(r-e),b=parseInt(s-o);d[f]=[h,g,b]}}else u(e,o,r,s)}var m=Object.keys(d);if(m.length){for(var r=0;r<m.length;r++)if(d[m[r]]){var _=jexcel.getIdFromColumnName(m[r],!0),e=_[0],o=_[1];u(e,o,e+d[m[r]][1],o+d[m[r]][2]);for(var f=m[r],h=d[m[r]][0],s=0;s<obj.options.mergeCells[f][2].length;s++){var e=parseInt(obj.options.mergeCells[f][2][s].getAttribute("data-x")),o=parseInt(obj.options.mergeCells[f][2][s].getAttribute("data-y"));obj.options.mergeCells[f][2][s].setAttribute("data-x",e+d[m[r]][1]),obj.options.mergeCells[f][2][s].setAttribute("data-y",o+d[m[r]][2])}obj.options.mergeCells[h]=obj.options.mergeCells[f],delete obj.options.mergeCells[f]}}obj.updateFormulas(a),obj.updateMeta(a),obj.refreshSelection(),obj.updateTable()},obj.updateTable=function(){if(obj.options.minSpareRows>0){for(var r=0,e=obj.rows.length-1;e>=0;e--){for(var s=!1,o=0;o<obj.headers.length;o++)obj.options.data[e][o]&&(s=!0);if(s)break;r++}obj.options.minSpareRows-r>0&&obj.insertRow(obj.options.minSpareRows-r)}if(obj.options.minSpareCols>0){for(var a=0,o=obj.headers.length-1;o>=0;o--){for(var s=!1,e=0;e<obj.rows.length;e++)obj.options.data[e][o]&&(s=!0);if(s)break;a++}obj.options.minSpareCols-a>0&&obj.insertColumn(obj.options.minSpareCols-a)}if(typeof obj.options.updateTable=="function"){obj.options.detachForUpdates&&el.removeChild(obj.content);for(var e=0;e<obj.rows.length;e++)for(var o=0;o<obj.headers.length;o++)obj.options.updateTable(el,obj.records[e][o],o,e,obj.options.data[e][o],obj.records[e][o].innerText,jexcel.getColumnNameFromId([o,e]));obj.options.detachForUpdates&&el.insertBefore(obj.content,obj.pagination)}obj.options.footers&&obj.setFooter(),setTimeout(function(){obj.updateCornerPosition()},0)},obj.isReadOnly=function(r){if(r=obj.getCell(r))return!!r.classList.contains("readonly")},obj.setReadOnly=function(r,e){(r=obj.getCell(r))&&(e?r.classList.add("readonly"):r.classList.remove("readonly"))},obj.showRow=function(r){obj.rows[r].style.display=""},obj.hideRow=function(r){obj.rows[r].style.display="none"},obj.showColumn=function(r){obj.headers[r].style.display="",obj.colgroup[r].style.display="";for(var e=0;e<obj.options.data.length;e++)obj.records[e][r].style.display=""},obj.hideColumn=function(r){obj.headers[r].style.display="none",obj.colgroup[r].style.display="none";for(var e=0;e<obj.options.data.length;e++)obj.records[e][r].style.display="none"},obj.showIndex=function(){obj.table.classList.remove("jexcel_hidden_index")},obj.hideIndex=function(){obj.table.classList.add("jexcel_hidden_index")};var chainLoopProtection=[];obj.updateFormulaChain=function(r,e,s){var o=jexcel.getColumnNameFromId([r,e]);if(obj.formula[o]&&obj.formula[o].length>0)if(chainLoopProtection[o])obj.records[e][r].innerHTML="#ERROR",obj.formula[o]="";else{chainLoopProtection[o]=!0;for(var a=0;a<obj.formula[o].length;a++){var d=jexcel.getIdFromColumnName(obj.formula[o][a],!0),u=""+obj.options.data[d[1]][d[0]];u.substr(0,1)=="="?s.push(obj.updateCell(d[0],d[1],u,!0)):Object.keys(obj.formula)[a]=null,obj.updateFormulaChain(d[0],d[1],s)}}chainLoopProtection=[]},obj.updateFormulas=function(r){for(var e=0;e<obj.options.data.length;e++)for(var s=0;s<obj.options.data[0].length;s++){var o=""+obj.options.data[e][s];if(o.substr(0,1)=="="){var a=obj.updateFormula(o,r);a!=o&&(obj.options.data[e][s]=a)}}for(var d=[],u=Object.keys(obj.formula),e=0;e<u.length;e++){var f=u[e],o=obj.formula[f];r[f]&&(f=r[f]),d[f]=[];for(var s=0;s<o.length;s++){var h=o[s];r[h]&&(h=r[h]),d[f].push(h)}}obj.formula=d},obj.updateFormula=function(r,e){for(var s=/[A-Z]/,o=/[0-9]/,a="",d=null,u=null,f="",h=0;h<r.length;h++)s.exec(r[h])?(d=1,u=0,f+=r[h]):o.exec(r[h])?(u=d?1:0,f+=r[h]):(d&&u&&(f=e[f]?e[f]:f),a+=f,a+=r[h],d=0,u=0,f="");return f&&(d&&u&&(f=e[f]?e[f]:f),a+=f),a};var secureFormula=function(r){for(var e="",s=0,o=0;o<r.length;o++)r[o]=='"'&&(s==0?s=1:s=0),s==1?e+=r[o]:e+=r[o].toUpperCase();return e};obj.executeFormula=function(expression,x,y){var formulaResults=[],formulaLoopProtection=[],execute=function(expression,x,y){var parentId=jexcel.getColumnNameFromId([x,y]);if(formulaLoopProtection[parentId])return console.error("Reference loop detected"),"#ERROR";formulaLoopProtection[parentId]=!0;var tokensUpdate=function(r){for(var e=0;e<r.length;e++){var s=[],o=r[e].split(":"),a=jexcel.getIdFromColumnName(o[0],!0),d=jexcel.getIdFromColumnName(o[1],!0);if(a[0]<=d[0])var u=a[0],f=d[0];else var u=d[0],f=a[0];if(a[1]<=d[1])var h=a[1],g=d[1];else var h=d[1],g=a[1];for(var b=h;b<=g;b++)for(var m=u;m<=f;m++)s.push(jexcel.getColumnNameFromId([m,b]));expression=expression.replace(r[e],s.join(","))}};expression=expression.replace(/\$?([A-Z]+)\$?([0-9]+)/g,"$1$2");var tokens=expression.match(/([A-Z]+[0-9]+)\:([A-Z]+[0-9]+)/g);tokens&&tokens.length&&tokensUpdate(tokens);var tokens=expression.match(/([A-Z]+[0-9]+)/g);if(tokens&&tokens.indexOf(parentId)>-1)return console.error("Self Reference detected"),"#ERROR";var formulaExpressions={};if(tokens){for(var i=0;i<tokens.length;i++)if(obj.formula[tokens[i]]||(obj.formula[tokens[i]]=[]),obj.formula[tokens[i]].indexOf(parentId)<0&&obj.formula[tokens[i]].push(parentId),eval("typeof("+tokens[i]+') == "undefined"')){var position=jexcel.getIdFromColumnName(tokens[i],1);if(typeof obj.options.data[position[1]]!="undefined"&&typeof obj.options.data[position[1]][position[0]]!="undefined")var value=obj.options.data[position[1]][position[0]];else var value="";if((""+value).substr(0,1)=="="&&(formulaResults[tokens[i]]?value=formulaResults[tokens[i]]:(value=execute(value,position[0],position[1]),formulaResults[tokens[i]]=value)),(""+value).trim()=="")formulaExpressions[tokens[i]]=null;else if(value==Number(value)&&obj.options.autoCasting==!0)formulaExpressions[tokens[i]]=Number(value);else{var number=obj.parseNumber(value,position[0]);obj.options.autoCasting==!0&&number?formulaExpressions[tokens[i]]=number:formulaExpressions[tokens[i]]='"'+value+'"'}}}try{var res=jexcel.formula(expression.substr(1),formulaExpressions,x,y,obj)}catch(r){var res="#ERROR";console.log(r)}return res};return execute(expression,x,y)},obj.parseNumber=function(r,e){var s=e&&obj.options.columns[e].decimal?obj.options.columns[e].decimal:".",o=""+r;if(o=o.split(s),o[0]=o[0].match(/[+-]?[0-9]/g),o[0]&&(o[0]=o[0].join("")),o[1]&&(o[1]=o[1].match(/[0-9]*/g).join("")),o[0]&&Number(o[0])>=0)if(o[1])var r=Number(o[0]+"."+o[1]);else var r=Number(o[0]+".00");else var r=null;return r},obj.row=function(r){},obj.col=function(r){},obj.up=function(r,e){if(r?obj.selectedCell[3]>0&&obj.up.visible(1,e?0:1):(obj.selectedCell[1]>0&&obj.up.visible(0,e?0:1),obj.selectedCell[2]=obj.selectedCell[0],obj.selectedCell[3]=obj.selectedCell[1]),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]),obj.options.lazyLoading==!0)if(obj.selectedCell[1]==0||obj.selectedCell[3]==0)obj.loadPage(0),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]);else if(obj.loadValidation())obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]);else{var s=parseInt(obj.tbody.firstChild.getAttribute("data-y"));obj.selectedCell[1]-s<30&&(obj.loadUp(),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]))}else if(obj.options.pagination>0){var o=obj.whichPage(obj.selectedCell[3]);o!=obj.pageNumber&&obj.page(o)}obj.updateScroll(1)},obj.up.visible=function(r,e){if(r==0)var s=parseInt(obj.selectedCell[0]),o=parseInt(obj.selectedCell[1]);else var s=parseInt(obj.selectedCell[2]),o=parseInt(obj.selectedCell[3]);if(e==0){for(var a=0;a<o;a++)if(obj.records[a][s].style.display!="none"&&obj.rows[a].style.display!="none"){o=a;break}}else o=obj.up.get(s,o);r==0?(obj.selectedCell[0]=s,obj.selectedCell[1]=o):(obj.selectedCell[2]=s,obj.selectedCell[3]=o)},obj.up.get=function(r,e){for(var r=parseInt(r),e=parseInt(e),s=e-1;s>=0;s--)if(obj.records[s][r].style.display!="none"&&obj.rows[s].style.display!="none"){if(obj.records[s][r].getAttribute("data-merged")&&obj.records[s][r]==obj.records[e][r])continue;e=s;break}return e},obj.down=function(r,e){if(r?obj.selectedCell[3]<obj.records.length-1&&obj.down.visible(1,e?0:1):(obj.selectedCell[1]<obj.records.length-1&&obj.down.visible(0,e?0:1),obj.selectedCell[2]=obj.selectedCell[0],obj.selectedCell[3]=obj.selectedCell[1]),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]),obj.options.lazyLoading==!0)if(obj.selectedCell[1]==obj.records.length-1||obj.selectedCell[3]==obj.records.length-1)obj.loadPage(-1),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]);else if(obj.loadValidation())obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]);else{var s=parseInt(obj.tbody.lastChild.getAttribute("data-y"));s-obj.selectedCell[3]<30&&(obj.loadDown(),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]))}else if(obj.options.pagination>0){var o=obj.whichPage(obj.selectedCell[3]);o!=obj.pageNumber&&obj.page(o)}obj.updateScroll(3)},obj.down.visible=function(r,e){if(r==0)var s=parseInt(obj.selectedCell[0]),o=parseInt(obj.selectedCell[1]);else var s=parseInt(obj.selectedCell[2]),o=parseInt(obj.selectedCell[3]);if(e==0){for(var a=obj.rows.length-1;a>o;a--)if(obj.records[a][s].style.display!="none"&&obj.rows[a].style.display!="none"){o=a;break}}else o=obj.down.get(s,o);r==0?(obj.selectedCell[0]=s,obj.selectedCell[1]=o):(obj.selectedCell[2]=s,obj.selectedCell[3]=o)},obj.down.get=function(r,e){for(var r=parseInt(r),e=parseInt(e),s=e+1;s<obj.rows.length;s++)if(obj.records[s][r].style.display!="none"&&obj.rows[s].style.display!="none"){if(obj.records[s][r].getAttribute("data-merged")&&obj.records[s][r]==obj.records[e][r])continue;e=s;break}return e},obj.right=function(r,e){r?obj.selectedCell[2]<obj.headers.length-1&&obj.right.visible(1,e?0:1):(obj.selectedCell[0]<obj.headers.length-1&&obj.right.visible(0,e?0:1),obj.selectedCell[2]=obj.selectedCell[0],obj.selectedCell[3]=obj.selectedCell[1]),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]),obj.updateScroll(2)},obj.right.visible=function(r,e){if(r==0)var s=parseInt(obj.selectedCell[0]),o=parseInt(obj.selectedCell[1]);else var s=parseInt(obj.selectedCell[2]),o=parseInt(obj.selectedCell[3]);if(e==0){for(var a=obj.headers.length-1;a>s;a--)if(obj.records[o][a].style.display!="none"){s=a;break}}else s=obj.right.get(s,o);r==0?(obj.selectedCell[0]=s,obj.selectedCell[1]=o):(obj.selectedCell[2]=s,obj.selectedCell[3]=o)},obj.right.get=function(r,e){for(var r=parseInt(r),e=parseInt(e),s=r+1;s<obj.headers.length;s++)if(obj.records[e][s].style.display!="none"){if(obj.records[e][s].getAttribute("data-merged")&&obj.records[e][s]==obj.records[e][r])continue;r=s;break}return r},obj.left=function(r,e){r?obj.selectedCell[2]>0&&obj.left.visible(1,e?0:1):(obj.selectedCell[0]>0&&obj.left.visible(0,e?0:1),obj.selectedCell[2]=obj.selectedCell[0],obj.selectedCell[3]=obj.selectedCell[1]),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]),obj.updateScroll(0)},obj.left.visible=function(r,e){if(r==0)var s=parseInt(obj.selectedCell[0]),o=parseInt(obj.selectedCell[1]);else var s=parseInt(obj.selectedCell[2]),o=parseInt(obj.selectedCell[3]);if(e==0){for(var a=0;a<s;a++)if(obj.records[o][a].style.display!="none"){s=a;break}}else s=obj.left.get(s,o);r==0?(obj.selectedCell[0]=s,obj.selectedCell[1]=o):(obj.selectedCell[2]=s,obj.selectedCell[3]=o)},obj.left.get=function(r,e){for(var r=parseInt(r),e=parseInt(e),s=r-1;s>=0;s--)if(obj.records[e][s].style.display!="none"){if(obj.records[e][s].getAttribute("data-merged")&&obj.records[e][s]==obj.records[e][r])continue;r=s;break}return r},obj.first=function(r,e){if(r?e?obj.selectedCell[3]=0:obj.left.visible(1,0):(e?obj.selectedCell[1]=0:obj.left.visible(0,0),obj.selectedCell[2]=obj.selectedCell[0],obj.selectedCell[3]=obj.selectedCell[1]),obj.options.lazyLoading==!0&&(obj.selectedCell[1]==0||obj.selectedCell[3]==0))obj.loadPage(0);else if(obj.options.pagination>0){var s=obj.whichPage(obj.selectedCell[3]);s!=obj.pageNumber&&obj.page(s)}obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]),obj.updateScroll(1)},obj.last=function(r,e){if(r?e?obj.selectedCell[3]=obj.records.length-1:obj.right.visible(1,0):(e?obj.selectedCell[1]=obj.records.length-1:obj.right.visible(0,0),obj.selectedCell[2]=obj.selectedCell[0],obj.selectedCell[3]=obj.selectedCell[1]),obj.options.lazyLoading==!0&&(obj.selectedCell[1]==obj.records.length-1||obj.selectedCell[3]==obj.records.length-1))obj.loadPage(-1);else if(obj.options.pagination>0){var s=obj.whichPage(obj.selectedCell[3]);s!=obj.pageNumber&&obj.page(s)}obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]),obj.updateScroll(3)},obj.selectAll=function(){obj.selectedCell||(obj.selectedCell=[]),obj.selectedCell[0]=0,obj.selectedCell[1]=0,obj.selectedCell[2]=obj.headers.length-1,obj.selectedCell[3]=obj.records.length-1,obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3])},obj.loadPage=function(r){if(obj.options.search==!0&&obj.results)var e=obj.results;else var e=obj.rows;var s=100;(r==null||r==-1)&&(r=Math.ceil(e.length/s)-1);var o=r*s,a=r*s+s;a>e.length&&(a=e.length),o=a-100,o<0&&(o=0);for(var d=o;d<a;d++)obj.options.search==!0&&obj.results?obj.tbody.appendChild(obj.rows[e[d]]):obj.tbody.appendChild(obj.rows[d]),obj.tbody.children.length>s&&obj.tbody.removeChild(obj.tbody.firstChild)},obj.loadUp=function(){if(obj.options.search==!0&&obj.results)var r=obj.results;else var r=obj.rows;var e=0;if(r.length>100){var s=parseInt(obj.tbody.firstChild.getAttribute("data-y"));if(obj.options.search==!0&&obj.results&&(s=r.indexOf(s)),s>0)for(var o=0;o<30;o++)s=s-1,s>-1&&(obj.options.search==!0&&obj.results?obj.tbody.insertBefore(obj.rows[r[s]],obj.tbody.firstChild):obj.tbody.insertBefore(obj.rows[s],obj.tbody.firstChild),obj.tbody.children.length>100&&(obj.tbody.removeChild(obj.tbody.lastChild),e=1))}return e},obj.loadDown=function(){if(obj.options.search==!0&&obj.results)var r=obj.results;else var r=obj.rows;var e=0;if(r.length>100){var s=parseInt(obj.tbody.lastChild.getAttribute("data-y"));if(obj.options.search==!0&&obj.results&&(s=r.indexOf(s)),s<obj.rows.length-1)for(var o=0;o<=30;o++)s<r.length&&(obj.options.search==!0&&obj.results?obj.tbody.appendChild(obj.rows[r[s]]):obj.tbody.appendChild(obj.rows[s]),obj.tbody.children.length>100&&(obj.tbody.removeChild(obj.tbody.firstChild),e=1)),s=s+1}return e},obj.loadValidation=function(){if(obj.selectedCell){var r=parseInt(obj.tbody.firstChild.getAttribute("data-y"))/100,e=parseInt(obj.selectedCell[3]/100),s=parseInt(obj.rows.length/100);if(r!=e&&e<=s&&!Array.prototype.indexOf.call(obj.tbody.children,obj.rows[obj.selectedCell[3]]))return obj.loadPage(e),!0}return!1},obj.resetSearch=function(){obj.searchInput.value="",obj.search(""),obj.results=null},obj.search=function(r){if(r)var r=r.toLowerCase();if(obj.options.filters&&obj.resetFilters(),obj.resetSelection(),obj.pageNumber=0,obj.results=[],r){var e=function(o,a,d){for(var u=0;u<o.length;u++)if((""+o[u]).toLowerCase().search(a)>=0||(""+obj.records[d][u].innerHTML).toLowerCase().search(a)>=0)return!0;return!1},s=function(o){obj.results.indexOf(o)==-1&&obj.results.push(o)};obj.options.data.filter(function(o,a){if(e(o,r,a)){var d=obj.isRowMerged(a);if(d.length)for(var u=0;u<d.length;u++)for(var f=jexcel.getIdFromColumnName(d[u],!0),h=0;h<obj.options.mergeCells[d[u]][1];h++)s(f[1]+h);else s(a);return!0}else return!1})}else obj.results=null;return obj.updateResult()},obj.updateResult=function(){var r=0,e=0;for(obj.options.lazyLoading==!0?r=100:obj.options.pagination>0?r=obj.options.pagination:obj.results?r=obj.results.length:r=obj.rows.length;obj.tbody.firstChild;)obj.tbody.removeChild(obj.tbody.firstChild);for(var s=0;s<obj.rows.length;s++)!obj.results||obj.results.indexOf(s)>-1?(e<r&&(obj.tbody.appendChild(obj.rows[s]),e++),obj.rows[s].style.display=""):obj.rows[s].style.display="none";return obj.options.pagination>0&&obj.updatePagination(),obj.updateCornerPosition(),r},obj.whichPage=function(r){return obj.options.search==!0&&obj.results&&(r=obj.results.indexOf(r)),Math.ceil((parseInt(r)+1)/parseInt(obj.options.pagination))-1},obj.page=function(r){var e=obj.pageNumber;if(obj.options.search==!0&&obj.results)var s=obj.results;else var s=obj.rows;var o=parseInt(obj.options.pagination);(r==null||r==-1)&&(r=Math.ceil(s.length/o)-1),obj.pageNumber=r;var a=r*o,d=r*o+o;for(d>s.length&&(d=s.length),a<0&&(a=0);obj.tbody.firstChild;)obj.tbody.removeChild(obj.tbody.firstChild);for(var u=a;u<d;u++)obj.options.search==!0&&obj.results?obj.tbody.appendChild(obj.rows[s[u]]):obj.tbody.appendChild(obj.rows[u]);obj.options.pagination>0&&obj.updatePagination(),obj.updateCornerPosition(),obj.dispatch("onchangepage",el,r,e)},obj.updatePagination=function(){if(obj.pagination.children[0].innerHTML="",obj.pagination.children[1].innerHTML="",obj.options.pagination){if(obj.options.search==!0&&obj.results)var r=obj.results.length;else var r=obj.rows.length;if(!r)obj.pagination.children[0].innerHTML=obj.options.text.noRecordsFound;else{var e=Math.ceil(r/obj.options.pagination);if(obj.pageNumber<6)var s=1,o=e<10?e:10;else if(e-obj.pageNumber<5){var s=e-9,o=e;s<1&&(s=1)}else var s=obj.pageNumber-4,o=obj.pageNumber+5;if(s>1){var a=document.createElement("div");a.className="jexcel_page",a.innerHTML="<",a.title=1,obj.pagination.children[1].appendChild(a)}for(var d=s;d<=o;d++){var a=document.createElement("div");a.className="jexcel_page",a.innerHTML=d,obj.pagination.children[1].appendChild(a),obj.pageNumber==d-1&&a.classList.add("jexcel_page_selected")}if(o<e){var a=document.createElement("div");a.className="jexcel_page",a.innerHTML=">",a.title=e,obj.pagination.children[1].appendChild(a)}var u=function(f){var h=Array.prototype.slice.call(arguments,1);return f.replace(/{(\d+)}/g,function(g,b){return typeof h[b]!="undefined"?h[b]:g})};obj.pagination.children[0].innerHTML=u(obj.options.text.showingPage,obj.pageNumber+1,e)}}},obj.download=function(r){if(obj.options.allowExport==!1)console.error("Export not allowed");else{var e="";e+=obj.copy(!1,obj.options.csvDelimiter,!0,r,!0);var s=new Blob(["\uFEFF"+e],{type:"text/csv;charset=utf-8;"});if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(s,obj.options.csvFileName+".csv");else{var o=document.createElement("a"),a=URL.createObjectURL(s);o.href=a,o.setAttribute("download",obj.options.csvFileName+".csv"),document.body.appendChild(o),o.click(),o.parentNode.removeChild(o)}}},obj.setHistory=function(r){if(obj.ignoreHistory!=!0){var e=++obj.historyIndex;obj.history=obj.history=obj.history.slice(0,e+1),obj.history[e]=r}},obj.copy=function(r,e,s,o,a){e||(e="	");var d=new RegExp(e,"ig"),u=[],f=[],h=[],g=[],b=[],m=obj.options.data[0].length,_=obj.options.data.length,Ge="",ot=!1,rr="",ir="",er=0,ar=0;if(a&&obj.options.includeHeadersOnDownload==!0||!a&&obj.options.includeHeadersOnCopy==!0||o){if(obj.options.nestedHeaders&&obj.options.nestedHeaders.length>0){obj.options.nestedHeaders[0]&&obj.options.nestedHeaders[0][0]?Ge=obj.options.nestedHeaders:Ge=[obj.options.nestedHeaders];for(var Lr=0;Lr<Ge.length;Lr++){for(var Mr=[],Br=0;Br<Ge[Lr].length;Br++){var Qr=parseInt(Ge[Lr][Br].colspan);Mr.push(Ge[Lr][Br].title);for(var ii=0;ii<Qr-1;ii++)Mr.push("")}ir+=Mr.join(e)+`\r
`}}ot=!0}obj.style=[];for(var Lr=0;Lr<_;Lr++){f=[],h=[];for(var Br=0;Br<m;Br++)if(!r||obj.records[Lr][Br].classList.contains("highlight")){ot==!0&&u.push(obj.headers[Br].innerText);var Ir=obj.options.data[Lr][Br];if(Ir.match&&(Ir.match(d)||Ir.match(/,/g)||Ir.match(/\n/)||Ir.match(/\"/))&&(Ir=Ir.replace(new RegExp('"',"g"),'""'),Ir='"'+Ir+'"'),f.push(Ir),obj.options.columns[Br].type=="checkbox"||obj.options.columns[Br].type=="radio")var gt=Ir;else{if(obj.options.stripHTMLOnCopy==!0)var gt=obj.records[Lr][Br].innerText;else var gt=obj.records[Lr][Br].innerHTML;gt.match&&(gt.match(d)||gt.match(/,/g)||gt.match(/\n/)||gt.match(/\"/))&&(gt=gt.replace(new RegExp('"',"g"),'""'),gt='"'+gt+'"')}h.push(gt),Ge=obj.records[Lr][Br].getAttribute("style"),Ge=Ge.replace("display: none;",""),obj.style.push(Ge||"")}f.length&&(ot&&(er=f.length,g.push(u.join(e))),g.push(f.join(e))),h.length&&(ar++,ot&&(b.push(u.join(e)),ot=!1),b.push(h.join(e)))}m==er&&_==ar&&(rr=ir);var tr=rr+g.join(`\r
`),br=rr+b.join(`\r
`);if(s||(obj.options.copyCompatibility==!0?obj.textarea.value=br:obj.textarea.value=tr,obj.textarea.select(),document.execCommand("copy")),obj.options.copyCompatibility==!0?obj.data=br:obj.data=tr,obj.hashString=obj.hash(obj.data),!s){if(obj.removeCopyingSelection(),obj.highlighted)for(var Br=0;Br<obj.highlighted.length;Br++)obj.highlighted[Br].classList.add("copying"),obj.highlighted[Br].classList.contains("highlight-left")&&obj.highlighted[Br].classList.add("copying-left"),obj.highlighted[Br].classList.contains("highlight-right")&&obj.highlighted[Br].classList.add("copying-right"),obj.highlighted[Br].classList.contains("highlight-top")&&obj.highlighted[Br].classList.add("copying-top"),obj.highlighted[Br].classList.contains("highlight-bottom")&&obj.highlighted[Br].classList.add("copying-bottom");obj.dispatch("oncopy",el,obj.options.copyCompatibility==!0?b:g,obj.hashString)}return obj.data},obj.paste=function(r,e,s){var o=obj.dispatch("onbeforepaste",el,s,r,e);if(o===!1)return!1;if(o)var s=o;var a=obj.hash(s),d=a==obj.hashString?obj.style:null;if(obj.options.copyCompatibility==!0&&a==obj.hashString)var s=obj.data;var s=obj.parseCSV(s,"	");if(r!=null&&e!=null&&s){for(var u=0,f=0,h=[],g={},b={},m=0,_=parseInt(r),Ge=parseInt(e),ot=null;ot=s[f];){for(u=0,_=parseInt(r);ot[u]!=null;){var rr=obj.updateCell(_,Ge,ot[u]);if(h.push(rr),obj.updateFormulaChain(_,Ge,h),d&&d[m]){var ir=jexcel.getColumnNameFromId([_,Ge]);g[ir]=d[m],b[ir]=obj.getStyle(ir),obj.records[Ge][_].setAttribute("style",d[m]),m++}if(u++,ot[u]!=null){if(_>=obj.headers.length-1)if(obj.options.allowInsertColumn==!0)obj.insertColumn();else break;_=obj.right.get(_,Ge)}}if(f++,s[f]){if(Ge>=obj.rows.length-1)if(obj.options.allowInsertRow==!0)obj.insertRow();else break;Ge=obj.down.get(r,Ge)}}obj.updateSelectionFromCoords(r,e,_,Ge),obj.setHistory({action:"setValue",records:h,selection:obj.selectedCell,newStyle:g,oldStyle:b}),obj.updateTable(),obj.dispatch("onpaste",el,s),obj.onafterchanges(el,h)}obj.removeCopyingSelection()},obj.removeCopyingSelection=function(){for(var r=document.querySelectorAll(".jexcel .copying"),e=0;e<r.length;e++)r[e].classList.remove("copying"),r[e].classList.remove("copying-left"),r[e].classList.remove("copying-right"),r[e].classList.remove("copying-top"),r[e].classList.remove("copying-bottom")},obj.historyProcessRow=function(r,e){var s=e.insertBefore?+e.rowNumber:e.rowNumber+1;if(obj.options.search==!0&&obj.results&&obj.results.length!=obj.rows.length&&obj.resetSearch(),r==1){for(var o=e.numOfRows,a=s;a<o+s;a++)obj.rows[a].parentNode.removeChild(obj.rows[a]);obj.records.splice(s,o),obj.options.data.splice(s,o),obj.rows.splice(s,o),obj.conditionalSelectionUpdate(1,s,o+s-1)}else{obj.records=jexcel.injectArray(obj.records,s,e.rowRecords),obj.options.data=jexcel.injectArray(obj.options.data,s,e.rowData),obj.rows=jexcel.injectArray(obj.rows,s,e.rowNode);for(var d=0,a=s;a<e.numOfRows+s;a++)obj.tbody.insertBefore(e.rowNode[d],obj.tbody.children[a]),d++}obj.options.pagination>0&&obj.page(obj.pageNumber),obj.updateTableReferences()},obj.historyProcessColumn=function(r,e){var s=e.insertBefore?e.columnNumber:e.columnNumber+1;if(r==1){var o=e.numOfColumns;obj.options.columns.splice(s,o);for(var a=s;a<o+s;a++)obj.headers[a].parentNode.removeChild(obj.headers[a]),obj.colgroup[a].parentNode.removeChild(obj.colgroup[a]);obj.headers.splice(s,o),obj.colgroup.splice(s,o);for(var d=0;d<e.data.length;d++){for(var a=s;a<o+s;a++)obj.records[d][a].parentNode.removeChild(obj.records[d][a]);obj.records[d].splice(s,o),obj.options.data[d].splice(s,o)}if(obj.options.footers)for(var d=0;d<obj.options.footers.length;d++)obj.options.footers[d].splice(s,o)}else{obj.options.columns=jexcel.injectArray(obj.options.columns,s,e.columns),obj.headers=jexcel.injectArray(obj.headers,s,e.headers),obj.colgroup=jexcel.injectArray(obj.colgroup,s,e.colgroup);for(var u=0,a=s;a<e.numOfColumns+s;a++)obj.headerContainer.insertBefore(e.headers[u],obj.headerContainer.children[a+1]),obj.colgroupContainer.insertBefore(e.colgroup[u],obj.colgroupContainer.children[a+1]),u++;for(var d=0;d<e.data.length;d++){obj.options.data[d]=jexcel.injectArray(obj.options.data[d],s,e.data[d]),obj.records[d]=jexcel.injectArray(obj.records[d],s,e.records[d]);for(var u=0,a=s;a<e.numOfColumns+s;a++)obj.rows[d].insertBefore(e.records[d][u],obj.rows[d].children[a+1]),u++}if(obj.options.footers)for(var d=0;d<obj.options.footers.length;d++)obj.options.footers[d]=jexcel.injectArray(obj.options.footers[d],s,e.footers[d])}if(obj.options.nestedHeaders&&obj.options.nestedHeaders.length>0)if(obj.options.nestedHeaders[0]&&obj.options.nestedHeaders[0][0])for(var d=0;d<obj.options.nestedHeaders.length;d++){if(r==1)var f=parseInt(obj.options.nestedHeaders[d][obj.options.nestedHeaders[d].length-1].colspan)-e.numOfColumns;else var f=parseInt(obj.options.nestedHeaders[d][obj.options.nestedHeaders[d].length-1].colspan)+e.numOfColumns;obj.options.nestedHeaders[d][obj.options.nestedHeaders[d].length-1].colspan=f,obj.thead.children[d].children[obj.thead.children[d].children.length-1].setAttribute("colspan",f)}else{if(r==1)var f=parseInt(obj.options.nestedHeaders[0].colspan)-e.numOfColumns;else var f=parseInt(obj.options.nestedHeaders[0].colspan)+e.numOfColumns;obj.options.nestedHeaders[0].colspan=f,obj.thead.children[0].children[obj.thead.children[0].children.length-1].setAttribute("colspan",f)}obj.updateTableReferences()},obj.undo=function(){var r=!!obj.ignoreEvents,e=!!obj.ignoreHistory;obj.ignoreEvents=!0,obj.ignoreHistory=!0;var s=[];if(obj.historyIndex>=0){var o=obj.history[obj.historyIndex--];if(o.action=="insertRow")obj.historyProcessRow(1,o);else if(o.action=="deleteRow")obj.historyProcessRow(0,o);else if(o.action=="insertColumn")obj.historyProcessColumn(1,o);else if(o.action=="deleteColumn")obj.historyProcessColumn(0,o);else if(o.action=="moveRow")obj.moveRow(o.newValue,o.oldValue);else if(o.action=="moveColumn")obj.moveColumn(o.newValue,o.oldValue);else if(o.action=="setMerge")obj.removeMerge(o.column,o.data);else if(o.action=="setStyle")obj.setStyle(o.oldValue,null,null,1);else if(o.action=="setWidth")obj.setWidth(o.column,o.oldValue);else if(o.action=="setHeight")obj.setHeight(o.row,o.oldValue);else if(o.action=="setHeader")obj.setHeader(o.column,o.oldValue);else if(o.action=="setComments")obj.setComments(o.column,o.oldValue[0],o.oldValue[1]);else if(o.action=="orderBy"){for(var a=[],d=0;d<o.rows.length;d++)a[o.rows[d]]=d;obj.updateOrderArrow(o.column,o.order?0:1),obj.updateOrder(a)}else if(o.action=="setValue"){for(var u=0;u<o.records.length;u++)s.push({x:o.records[u].x,y:o.records[u].y,newValue:o.records[u].oldValue}),o.oldStyle&&obj.resetStyle(o.oldStyle);obj.setValue(s),o.selection&&obj.updateSelectionFromCoords(o.selection[0],o.selection[1],o.selection[2],o.selection[3])}}obj.ignoreEvents=r,obj.ignoreHistory=e,obj.dispatch("onundo",el,o)},obj.redo=function(){var r=!!obj.ignoreEvents,e=!!obj.ignoreHistory;if(obj.ignoreEvents=!0,obj.ignoreHistory=!0,obj.historyIndex<obj.history.length-1){var s=obj.history[++obj.historyIndex];if(s.action=="insertRow")obj.historyProcessRow(0,s);else if(s.action=="deleteRow")obj.historyProcessRow(1,s);else if(s.action=="insertColumn")obj.historyProcessColumn(0,s);else if(s.action=="deleteColumn")obj.historyProcessColumn(1,s);else if(s.action=="moveRow")obj.moveRow(s.oldValue,s.newValue);else if(s.action=="moveColumn")obj.moveColumn(s.oldValue,s.newValue);else if(s.action=="setMerge")obj.setMerge(s.column,s.colspan,s.rowspan,1);else if(s.action=="setStyle")obj.setStyle(s.newValue,null,null,1);else if(s.action=="setWidth")obj.setWidth(s.column,s.newValue);else if(s.action=="setHeight")obj.setHeight(s.row,s.newValue);else if(s.action=="setHeader")obj.setHeader(s.column,s.newValue);else if(s.action=="setComments")obj.setComments(s.column,s.newValue[0],s.newValue[1]);else if(s.action=="orderBy")obj.updateOrderArrow(s.column,s.order),obj.updateOrder(s.rows);else if(s.action=="setValue"){obj.setValue(s.records);for(var o=0;o<s.records.length;o++)s.oldStyle&&obj.resetStyle(s.newStyle);s.selection&&obj.updateSelectionFromCoords(s.selection[0],s.selection[1],s.selection[2],s.selection[3])}}obj.ignoreEvents=r,obj.ignoreHistory=e,obj.dispatch("onredo",el,s)},obj.getDropDownValue=function(r,e){var s=[];if(obj.options.columns[r]&&obj.options.columns[r].source){for(var o=[],a=obj.options.columns[r].source,d=0;d<a.length;d++)typeof a[d]=="object"?o[a[d].id]=a[d].name:o[a[d]]=a[d];for(var u=Array.isArray(e)?e:(""+e).split(";"),d=0;d<u.length;d++)typeof u[d]=="object"?s.push(o[u[d].id]):o[u[d]]&&s.push(o[u[d]])}else console.error("Invalid column");return s.length>0?s.join("; "):""},obj.parseCSV=function(r,e){r=r.replace(/\r?\n$|\r$|\n$/g,""),r.charCodeAt(r.length-1)==9&&(r+="\0"),e=e||",";for(var s=[],o=!1,a=0,d=0,u=0;u<r.length;u++){var f=r[u],h=r[u+1];if(s[a]=s[a]||[],s[a][d]=s[a][d]||"",f=='"'&&o&&h=='"'){s[a][d]+=f,++u;continue}if(f=='"'){o=!o;continue}if(f==e&&!o){++d;continue}if(f=="\r"&&h==`
`&&!o){++a,d=0,++u;continue}if(f==`
`&&!o){++a,d=0;continue}if(f=="\r"&&!o){++a,d=0;continue}s[a][d]+=f}return s},obj.hash=function(r){var e=0,s,o;if(r.length===0)return e;for(s=0;s<r.length;s++)o=r.charCodeAt(s),e=(e<<5)-e+o,e|=0;return e},obj.onafterchanges=function(r,e){obj.dispatch("onafterchanges",r,e)},obj.destroy=function(){jexcel.destroy(el)},obj.init=function(){jexcel.current=obj,typeof jexcel.build=="function"&&(obj.options.root?jexcel.build(obj.options.root):(jexcel.build(document),jexcel.build=null)),el.setAttribute("tabindex",1),el.addEventListener("focus",function(r){jexcel.current&&!obj.selectedCell&&(obj.updateSelectionFromCoords(0,0,0,0),obj.left())}),obj.options.csv?(obj.options.loadingSpin==!0&&jSuites.loading.show(),jSuites.ajax({url:obj.options.csv,method:obj.options.method,data:obj.options.requestVariables,dataType:"text",success:function(r){var e=obj.parseCSV(r,obj.options.csvDelimiter);if(obj.options.csvHeaders==!0&&e.length>0)for(var s=e.shift(),o=0;o<s.length;o++)obj.options.columns[o]||(obj.options.columns[o]={type:"text",align:obj.options.defaultColAlign,width:obj.options.defaultColWidth}),typeof obj.options.columns[o].title=="undefined"&&(obj.options.columns[o].title=s[o]);obj.options.data=e,obj.prepareTable(),obj.options.loadingSpin==!0&&jSuites.loading.hide()}})):obj.options.url?(obj.options.loadingSpin==!0&&jSuites.loading.show(),jSuites.ajax({url:obj.options.url,method:obj.options.method,data:obj.options.requestVariables,dataType:"json",success:function(r){obj.options.data=r.data?r.data:r,obj.prepareTable(),obj.options.loadingSpin==!0&&jSuites.loading.hide()}})):obj.prepareTable()},options&&options.contextMenu!=null?obj.options.contextMenu=options.contextMenu:obj.options.contextMenu=function(r,e,s,o){var a=[];if(s==null)obj.options.allowInsertColumn==!0&&a.push({title:obj.options.text.insertANewColumnBefore,onclick:function(){obj.insertColumn(1,parseInt(e),1)}}),obj.options.allowInsertColumn==!0&&a.push({title:obj.options.text.insertANewColumnAfter,onclick:function(){obj.insertColumn(1,parseInt(e),0)}}),obj.options.allowDeleteColumn==!0&&a.push({title:obj.options.text.deleteSelectedColumns,onclick:function(){obj.deleteColumn(obj.getSelectedColumns().length?void 0:parseInt(e))}}),obj.options.allowRenameColumn==!0&&a.push({title:obj.options.text.renameThisColumn,onclick:function(){obj.setHeader(e)}}),obj.options.columnSorting==!0&&(a.push({type:"line"}),a.push({title:obj.options.text.orderAscending,onclick:function(){obj.orderBy(e,0)}}),a.push({title:obj.options.text.orderDescending,onclick:function(){obj.orderBy(e,1)}}));else if(obj.options.allowInsertRow==!0&&(a.push({title:obj.options.text.insertANewRowBefore,onclick:function(){obj.insertRow(1,parseInt(s),1)}}),a.push({title:obj.options.text.insertANewRowAfter,onclick:function(){obj.insertRow(1,parseInt(s))}})),obj.options.allowDeleteRow==!0&&a.push({title:obj.options.text.deleteSelectedRows,onclick:function(){obj.deleteRow(obj.getSelectedRows().length?void 0:parseInt(s))}}),e&&obj.options.allowComments==!0){a.push({type:"line"});var d=obj.records[s][e].getAttribute("title")||"";a.push({title:d?obj.options.text.editComments:obj.options.text.addComments,onclick:function(){var u=prompt(obj.options.text.comments,d);u&&obj.setComments([e,s],u)}}),d&&a.push({title:obj.options.text.clearComments,onclick:function(){obj.setComments([e,s],"")}})}return a.push({type:"line"}),a.push({title:obj.options.text.copy,shortcut:"Ctrl + C",onclick:function(){obj.copy(!0)}}),navigator&&navigator.clipboard&&a.push({title:obj.options.text.paste,shortcut:"Ctrl + V",onclick:function(){obj.selectedCell&&navigator.clipboard.readText().then(function(u){u&&jexcel.current.paste(obj.selectedCell[0],obj.selectedCell[1],u)})}}),obj.options.allowExport&&a.push({title:obj.options.text.saveAs,shortcut:"Ctrl + S",onclick:function(){obj.download()}}),obj.options.about&&a.push({title:obj.options.text.about,onclick:function(){obj.options.about===!0?alert(Version().print()):alert(obj.options.about)}}),a},obj.scrollControls=function(r){obj.wheelControls(),obj.options.freezeColumns>0&&obj.content.scrollLeft!=scrollLeft&&obj.updateFreezePosition(),(obj.options.lazyLoading==!0||obj.options.tableOverflow==!0)&&obj.edition&&r.target.className.substr(0,9)!="jdropdown"&&obj.closeEditor(obj.edition[0],!0)},obj.wheelControls=function(r){obj.options.lazyLoading==!0&&jexcel.timeControlLoading==null&&(jexcel.timeControlLoading=setTimeout(function(){obj.content.scrollTop+obj.content.clientHeight>=obj.content.scrollHeight-10?obj.loadDown()&&(obj.content.scrollTop+obj.content.clientHeight>obj.content.scrollHeight-10&&(obj.content.scrollTop=obj.content.scrollTop-obj.content.clientHeight),obj.updateCornerPosition()):obj.content.scrollTop<=obj.content.clientHeight&&obj.loadUp()&&(obj.content.scrollTop<10&&(obj.content.scrollTop=obj.content.scrollTop+obj.content.clientHeight),obj.updateCornerPosition()),jexcel.timeControlLoading=null},100))},obj.getFreezeWidth=function(){var r=0;if(obj.options.freezeColumns>0)for(var e=0;e<obj.options.freezeColumns;e++)r+=parseInt(obj.options.columns[e].width);return r};var scrollLeft=0;return obj.updateFreezePosition=function(){scrollLeft=obj.content.scrollLeft;var r=0;if(scrollLeft>50)for(var e=0;e<obj.options.freezeColumns;e++){e>0&&(r+=parseInt(obj.options.columns[e-1].width)),obj.headers[e].classList.add("jexcel_freezed"),obj.headers[e].style.left=r+"px";for(var s=0;s<obj.rows.length;s++)if(obj.rows[s]&&obj.records[s][e]){var o=scrollLeft+(e>0?obj.records[s][e-1].style.width:0)-51+"px";obj.records[s][e].classList.add("jexcel_freezed"),obj.records[s][e].style.left=o}}else for(var e=0;e<obj.options.freezeColumns;e++){obj.headers[e].classList.remove("jexcel_freezed"),obj.headers[e].style.left="";for(var s=0;s<obj.rows.length;s++)obj.records[s][e]&&(obj.records[s][e].classList.remove("jexcel_freezed"),obj.records[s][e].style.left="")}obj.updateCornerPosition()},el.addEventListener("DOMMouseScroll",obj.wheelControls),el.addEventListener("mousewheel",obj.wheelControls),el.jexcel=obj,el.jspreadsheet=obj,obj.init(),obj};return jexcel.setDictionary=function(r){jSuites.setDictionary(r)},jexcel.setExtensions=function(r){for(var e=Object.keys(r),s=0;s<e.length;s++)typeof r[e[s]]=="function"&&(jexcel[e[s]]=r[e[s]],jexcel.license&&typeof r[e[s]].license=="function"&&r[e[s]].license(jexcel.license))},typeof formula!="undefined"&&(jexcel.formula=formula),jexcel.version=Version,jexcel.current=null,jexcel.timeControl=null,jexcel.timeControlLoading=null,jexcel.destroy=function(r,e){if(r.jexcel){var s=r.jexcel.options.root?r.jexcel.options.root:document;r.removeEventListener("DOMMouseScroll",r.jexcel.scrollControls),r.removeEventListener("mousewheel",r.jexcel.scrollControls),r.jexcel=null,r.innerHTML="",e&&(s.removeEventListener("mouseup",jexcel.mouseUpControls),s.removeEventListener("mousedown",jexcel.mouseDownControls),s.removeEventListener("mousemove",jexcel.mouseMoveControls),s.removeEventListener("mouseover",jexcel.mouseOverControls),s.removeEventListener("dblclick",jexcel.doubleClickControls),s.removeEventListener("paste",jexcel.pasteControls),s.removeEventListener("contextmenu",jexcel.contextMenuControls),s.removeEventListener("touchstart",jexcel.touchStartControls),s.removeEventListener("touchend",jexcel.touchEndControls),s.removeEventListener("touchcancel",jexcel.touchEndControls),document.removeEventListener("keydown",jexcel.keyDownControls),jexcel=null)}},jexcel.build=function(r){r.addEventListener("mouseup",jexcel.mouseUpControls),r.addEventListener("mousedown",jexcel.mouseDownControls),r.addEventListener("mousemove",jexcel.mouseMoveControls),r.addEventListener("mouseover",jexcel.mouseOverControls),r.addEventListener("dblclick",jexcel.doubleClickControls),r.addEventListener("paste",jexcel.pasteControls),r.addEventListener("contextmenu",jexcel.contextMenuControls),r.addEventListener("touchstart",jexcel.touchStartControls),r.addEventListener("touchend",jexcel.touchEndControls),r.addEventListener("touchcancel",jexcel.touchEndControls),r.addEventListener("touchmove",jexcel.touchEndControls),document.addEventListener("keydown",jexcel.keyDownControls)},jexcel.keyDownControls=function(r){if(jexcel.current){if(jexcel.current.edition)if(r.which==27)jexcel.current.edition&&jexcel.current.closeEditor(jexcel.current.edition[0],!1),r.preventDefault();else if(r.which==13){if(jexcel.current.options.columns[jexcel.current.edition[2]].type=="calendar")jexcel.current.closeEditor(jexcel.current.edition[0],!0);else if(!(jexcel.current.options.columns[jexcel.current.edition[2]].type=="dropdown"||jexcel.current.options.columns[jexcel.current.edition[2]].type=="autocomplete"))if((jexcel.current.options.wordWrap==!0||jexcel.current.options.columns[jexcel.current.edition[2]].wordWrap==!0||jexcel.current.options.data[jexcel.current.edition[3]][jexcel.current.edition[2]].length>200)&&r.altKey){var e=jexcel.current.edition[0].children[0],s=jexcel.current.edition[0].children[0].value,o=e.selectionStart;s=s.slice(0,o)+`
`+s.slice(o),e.value=s,e.focus(),e.selectionStart=o+1,e.selectionEnd=o+1}else jexcel.current.edition[0].children[0].blur()}else r.which==9&&(jexcel.current.options.columns[jexcel.current.edition[2]].type=="calendar"?jexcel.current.closeEditor(jexcel.current.edition[0],!0):jexcel.current.edition[0].children[0].blur());if(!jexcel.current.edition&&jexcel.current.selectedCell){if(r.which==37)jexcel.current.left(r.shiftKey,r.ctrlKey),r.preventDefault();else if(r.which==39)jexcel.current.right(r.shiftKey,r.ctrlKey),r.preventDefault();else if(r.which==38)jexcel.current.up(r.shiftKey,r.ctrlKey),r.preventDefault();else if(r.which==40)jexcel.current.down(r.shiftKey,r.ctrlKey),r.preventDefault();else if(r.which==36)jexcel.current.first(r.shiftKey,r.ctrlKey),r.preventDefault();else if(r.which==35)jexcel.current.last(r.shiftKey,r.ctrlKey),r.preventDefault();else if(r.which==32)jexcel.current.options.editable==!0&&jexcel.current.setCheckRadioValue(),r.preventDefault();else if(r.which==46)jexcel.current.options.editable==!0&&(jexcel.current.selectedRow?jexcel.current.options.allowDeleteRow==!0&&confirm(jexcel.current.options.text.areYouSureToDeleteTheSelectedRows)&&jexcel.current.deleteRow():jexcel.current.selectedHeader?jexcel.current.options.allowDeleteColumn==!0&&confirm(jexcel.current.options.text.areYouSureToDeleteTheSelectedColumns)&&jexcel.current.deleteColumn():jexcel.current.setValue(jexcel.current.highlighted,""));else if(r.which==13)r.shiftKey?jexcel.current.up():(jexcel.current.options.allowInsertRow==!0&&jexcel.current.options.allowManualInsertRow==!0&&jexcel.current.selectedCell[1]==jexcel.current.options.data.length-1&&jexcel.current.insertRow(),jexcel.current.down()),r.preventDefault();else if(r.which==9)r.shiftKey?jexcel.current.left():(jexcel.current.options.allowInsertColumn==!0&&jexcel.current.options.allowManualInsertColumn==!0&&jexcel.current.selectedCell[0]==jexcel.current.options.data[0].length-1&&jexcel.current.insertColumn(),jexcel.current.right()),r.preventDefault();else if((r.ctrlKey||r.metaKey)&&!r.shiftKey)r.which==65?(jexcel.current.selectAll(),r.preventDefault()):r.which==83?(jexcel.current.download(),r.preventDefault()):r.which==89?(jexcel.current.redo(),r.preventDefault()):r.which==90?(jexcel.current.undo(),r.preventDefault()):r.which==67?(jexcel.current.copy(!0),r.preventDefault()):r.which==88?(jexcel.current.options.editable==!0?jexcel.cutControls():jexcel.copyControls(),r.preventDefault()):r.which==86&&jexcel.pasteControls();else if(jexcel.current.selectedCell&&jexcel.current.options.editable==!0){var a=jexcel.current.selectedCell[1],d=jexcel.current.selectedCell[0];jexcel.current.options.columns[d].type!="readonly"&&(r.keyCode==32?jexcel.current.options.columns[d].type=="checkbox"||jexcel.current.options.columns[d].type=="radio"?r.preventDefault():jexcel.current.openEditor(jexcel.current.records[a][d],!0):r.keyCode==113?jexcel.current.openEditor(jexcel.current.records[a][d],!1):(r.keyCode==8||r.keyCode>=48&&r.keyCode<=57||r.keyCode>=96&&r.keyCode<=111||r.keyCode>=187&&r.keyCode<=190||(String.fromCharCode(r.keyCode)==r.key||String.fromCharCode(r.keyCode).toLowerCase()==r.key.toLowerCase())&&jexcel.validLetter(String.fromCharCode(r.keyCode)))&&(jexcel.current.openEditor(jexcel.current.records[a][d],!0),jexcel.current.options.columns[d].type=="calendar"&&r.preventDefault()))}}else r.target.classList.contains("jexcel_search")&&(jexcel.timeControl&&clearTimeout(jexcel.timeControl),jexcel.timeControl=setTimeout(function(){jexcel.current.search(r.target.value)},200))}},jexcel.isMouseAction=!1,jexcel.mouseDownControls=function(r){if(r=r||window.event,r.buttons)var e=r.buttons;else if(r.button)var e=r.button;else var e=r.which;var s=jexcel.getElement(r.target);if(s[0]?jexcel.current!=s[0].jexcel&&(jexcel.current&&(jexcel.current.edition&&jexcel.current.closeEditor(jexcel.current.edition[0],!0),jexcel.current.resetSelection()),jexcel.current=s[0].jexcel):jexcel.current&&(jexcel.current.edition&&jexcel.current.closeEditor(jexcel.current.edition[0],!0),jexcel.current.resetSelection(!0),jexcel.current=null),jexcel.current&&e==1){if(r.target.classList.contains("jexcel_selectall"))jexcel.current&&jexcel.current.selectAll();else if(r.target.classList.contains("jexcel_corner"))jexcel.current.options.editable==!0&&(jexcel.current.selectedCorner=!0);else{if(s[1]==1){var o=r.target.getAttribute("data-x");if(o){var a=r.target.getBoundingClientRect();if(jexcel.current.options.columnResize==!0&&a.width-r.offsetX<6){jexcel.current.resizing={mousePosition:r.pageX,column:o,width:a.width},jexcel.current.headers[o].classList.add("resizing");for(var d=0;d<jexcel.current.records.length;d++)jexcel.current.records[d][o]&&jexcel.current.records[d][o].classList.add("resizing")}else if(jexcel.current.options.columnDrag==!0&&a.height-r.offsetY<6)if(jexcel.current.isColMerged(o).length)console.error("Jspreadsheet: This column is part of a merged cell.");else{jexcel.current.resetSelection(),jexcel.current.dragging={element:r.target,column:o,destination:o},jexcel.current.headers[o].classList.add("dragging");for(var d=0;d<jexcel.current.records.length;d++)jexcel.current.records[d][o]&&jexcel.current.records[d][o].classList.add("dragging")}else{if(jexcel.current.selectedHeader&&(r.shiftKey||r.ctrlKey))var u=jexcel.current.selectedHeader,f=o;else{jexcel.current.selectedHeader==o&&jexcel.current.options.allowRenameColumn==!0&&(jexcel.timeControl=setTimeout(function(){jexcel.current.setHeader(o)},800)),jexcel.current.selectedHeader=o;var u=o,f=o}jexcel.current.updateSelectionFromCoords(u,0,f,jexcel.current.options.data.length-1)}}else if(r.target.parentNode.classList.contains("jexcel_nested")){if(r.target.getAttribute("data-column"))var h=r.target.getAttribute("data-column").split(","),g=parseInt(h[0]),b=parseInt(h[h.length-1]);else var g=0,b=jexcel.current.options.columns.length-1;jexcel.current.updateSelectionFromCoords(g,0,b,jexcel.current.options.data.length-1)}}else jexcel.current.selectedHeader=!1;if(s[1]==2){var m=r.target.getAttribute("data-y");if(r.target.classList.contains("jexcel_row")){var a=r.target.getBoundingClientRect();if(jexcel.current.options.rowResize==!0&&a.height-r.offsetY<6)jexcel.current.resizing={element:r.target.parentNode,mousePosition:r.pageY,row:m,height:a.height},r.target.parentNode.classList.add("resizing");else if(jexcel.current.options.rowDrag==!0&&a.width-r.offsetX<6)jexcel.current.isRowMerged(m).length?console.error("Jspreadsheet: This row is part of a merged cell"):jexcel.current.options.search==!0&&jexcel.current.results?console.error("Jspreadsheet: Please clear your search before perform this action"):(jexcel.current.resetSelection(),jexcel.current.dragging={element:r.target.parentNode,row:m,destination:m},r.target.parentNode.classList.add("dragging"));else{if(jexcel.current.selectedRow&&(r.shiftKey||r.ctrlKey))var u=jexcel.current.selectedRow,f=m;else{jexcel.current.selectedRow=m;var u=m,f=m}jexcel.current.updateSelectionFromCoords(0,u,jexcel.current.options.data[0].length-1,f)}}else if(r.target.classList.contains("jclose")&&r.target.clientWidth-r.offsetX<50&&r.offsetY<50)jexcel.current.closeEditor(jexcel.current.edition[0],!0);else{var _=function(ot){var rr=ot.getAttribute("data-x"),ir=ot.getAttribute("data-y");if(rr&&ir)return[rr,ir];if(ot.parentNode)return _(ot.parentNode)},Ge=_(r.target);if(Ge){var o=Ge[0],m=Ge[1];jexcel.current.edition&&(jexcel.current.edition[2]!=o||jexcel.current.edition[3]!=m)&&jexcel.current.closeEditor(jexcel.current.edition[0],!0),jexcel.current.edition||(r.shiftKey?jexcel.current.updateSelectionFromCoords(jexcel.current.selectedCell[0],jexcel.current.selectedCell[1],o,m):jexcel.current.updateSelectionFromCoords(o,m)),jexcel.current.selectedHeader=null,jexcel.current.selectedRow=null}}}else jexcel.current.selectedRow=!1;r.target.classList.contains("jexcel_page")&&(r.target.innerText=="<"?jexcel.current.page(0):r.target.innerText==">"?jexcel.current.page(r.target.getAttribute("title")-1):jexcel.current.page(r.target.innerText-1))}jexcel.current.edition?jexcel.isMouseAction=!1:jexcel.isMouseAction=!0}else jexcel.isMouseAction=!1},jexcel.mouseUpControls=function(r){if(jexcel.current)if(jexcel.current.resizing){if(jexcel.current.resizing.column){var e=jexcel.current.colgroup[jexcel.current.resizing.column].getAttribute("width"),s=jexcel.current.getSelectedColumns();if(s.length>1){for(var o=[],a=0;a<s.length;a++)o.push(parseInt(jexcel.current.colgroup[s[a]].getAttribute("width")));var d=s.indexOf(parseInt(jexcel.current.resizing.column));o[d]=jexcel.current.resizing.width,jexcel.current.setWidth(s,e,o)}else jexcel.current.setWidth(jexcel.current.resizing.column,e,jexcel.current.resizing.width);jexcel.current.headers[jexcel.current.resizing.column].classList.remove("resizing");for(var u=0;u<jexcel.current.records.length;u++)jexcel.current.records[u][jexcel.current.resizing.column]&&jexcel.current.records[u][jexcel.current.resizing.column].classList.remove("resizing")}else{jexcel.current.rows[jexcel.current.resizing.row].children[0].classList.remove("resizing");var f=jexcel.current.rows[jexcel.current.resizing.row].getAttribute("height");jexcel.current.setHeight(jexcel.current.resizing.row,f,jexcel.current.resizing.height),jexcel.current.resizing.element.classList.remove("resizing")}jexcel.current.resizing=null}else if(jexcel.current.dragging){if(jexcel.current.dragging){if(jexcel.current.dragging.column){var h=r.target.getAttribute("data-x");jexcel.current.headers[jexcel.current.dragging.column].classList.remove("dragging");for(var u=0;u<jexcel.current.rows.length;u++)jexcel.current.records[u][jexcel.current.dragging.column]&&jexcel.current.records[u][jexcel.current.dragging.column].classList.remove("dragging");for(var a=0;a<jexcel.current.headers.length;a++)jexcel.current.headers[a].classList.remove("dragging-left"),jexcel.current.headers[a].classList.remove("dragging-right");h&&jexcel.current.dragging.column!=jexcel.current.dragging.destination&&jexcel.current.moveColumn(jexcel.current.dragging.column,jexcel.current.dragging.destination)}else{if(jexcel.current.dragging.element.nextSibling){var g=parseInt(jexcel.current.dragging.element.nextSibling.getAttribute("data-y"));jexcel.current.dragging.row<g&&(g-=1)}else var g=parseInt(jexcel.current.dragging.element.previousSibling.getAttribute("data-y"));jexcel.current.dragging.row!=jexcel.current.dragging.destination&&jexcel.current.moveRow(jexcel.current.dragging.row,g,!0),jexcel.current.dragging.element.classList.remove("dragging")}jexcel.current.dragging=null}}else jexcel.current.selectedCorner&&(jexcel.current.selectedCorner=!1,jexcel.current.selection.length>0&&(jexcel.current.copyData(jexcel.current.selection[0],jexcel.current.selection[jexcel.current.selection.length-1]),jexcel.current.removeCopySelection()));jexcel.timeControl&&(clearTimeout(jexcel.timeControl),jexcel.timeControl=null),jexcel.isMouseAction=!1},jexcel.mouseMoveControls=function(r){if(r=r||window.event,r.buttons)var e=r.buttons;else if(r.button)var e=r.button;else var e=r.which;if(e||(jexcel.isMouseAction=!1),jexcel.current)if(jexcel.isMouseAction==!0){if(jexcel.current.resizing)if(jexcel.current.resizing.column){var s=r.pageX-jexcel.current.resizing.mousePosition;if(jexcel.current.resizing.width+s>0){var o=jexcel.current.resizing.width+s;jexcel.current.colgroup[jexcel.current.resizing.column].setAttribute("width",o),jexcel.current.updateCornerPosition()}}else{var a=r.pageY-jexcel.current.resizing.mousePosition;if(jexcel.current.resizing.height+a>0){var d=jexcel.current.resizing.height+a;jexcel.current.rows[jexcel.current.resizing.row].setAttribute("height",d),jexcel.current.updateCornerPosition()}}}else{var u=r.target.getAttribute("data-x"),f=r.target.getAttribute("data-y"),h=r.target.getBoundingClientRect();jexcel.current.cursor&&(jexcel.current.cursor.style.cursor="",jexcel.current.cursor=null),r.target.parentNode.parentNode&&r.target.parentNode.parentNode.className&&(r.target.parentNode.parentNode.classList.contains("resizable")&&(r.target&&u&&!f&&h.width-(r.clientX-h.left)<6?(jexcel.current.cursor=r.target,jexcel.current.cursor.style.cursor="col-resize"):r.target&&!u&&f&&h.height-(r.clientY-h.top)<6&&(jexcel.current.cursor=r.target,jexcel.current.cursor.style.cursor="row-resize")),r.target.parentNode.parentNode.classList.contains("draggable")&&(r.target&&!u&&f&&h.width-(r.clientX-h.left)<6||r.target&&u&&!f&&h.height-(r.clientY-h.top)<6)&&(jexcel.current.cursor=r.target,jexcel.current.cursor.style.cursor="move"))}},jexcel.mouseOverControls=function(r){if(r=r||window.event,r.buttons)var e=r.buttons;else if(r.button)var e=r.button;else var e=r.which;if(e||(jexcel.isMouseAction=!1),jexcel.current&&jexcel.isMouseAction==!0){var s=jexcel.getElement(r.target);if(s[0]){if(jexcel.current!=s[0].jexcel&&jexcel.current)return!1;var o=r.target.getAttribute("data-x"),a=r.target.getAttribute("data-y");if(jexcel.current.dragging){if(jexcel.current.dragging.column){if(o)if(jexcel.current.isColMerged(o).length)console.error("Jspreadsheet: This column is part of a merged cell.");else{for(var d=0;d<jexcel.current.headers.length;d++)jexcel.current.headers[d].classList.remove("dragging-left"),jexcel.current.headers[d].classList.remove("dragging-right");jexcel.current.dragging.column==o?jexcel.current.dragging.destination=parseInt(o):r.target.clientWidth/2>r.offsetX?(jexcel.current.dragging.column<o?jexcel.current.dragging.destination=parseInt(o)-1:jexcel.current.dragging.destination=parseInt(o),jexcel.current.headers[o].classList.add("dragging-left")):(jexcel.current.dragging.column<o?jexcel.current.dragging.destination=parseInt(o):jexcel.current.dragging.destination=parseInt(o)+1,jexcel.current.headers[o].classList.add("dragging-right"))}}else if(a)if(jexcel.current.isRowMerged(a).length)console.error("Jspreadsheet: This row is part of a merged cell.");else{var u=r.target.clientHeight/2>r.offsetY?r.target.parentNode.nextSibling:r.target.parentNode;jexcel.current.dragging.element!=u&&(r.target.parentNode.parentNode.insertBefore(jexcel.current.dragging.element,u),jexcel.current.dragging.destination=Array.prototype.indexOf.call(jexcel.current.dragging.element.parentNode.children,jexcel.current.dragging.element))}}else if(!jexcel.current.resizing){if(s[1]==1&&jexcel.current.selectedHeader){var o=r.target.getAttribute("data-x"),f=jexcel.current.selectedHeader,h=o;jexcel.current.updateSelectionFromCoords(f,0,h,jexcel.current.options.data.length-1)}if(s[1]==2)if(r.target.classList.contains("jexcel_row")){if(jexcel.current.selectedRow){var f=jexcel.current.selectedRow,h=a;jexcel.current.updateSelectionFromCoords(0,f,jexcel.current.options.data[0].length-1,h)}}else jexcel.current.edition||o&&a&&(jexcel.current.selectedCorner?jexcel.current.updateCopySelection(o,a):jexcel.current.selectedCell&&jexcel.current.updateSelectionFromCoords(jexcel.current.selectedCell[0],jexcel.current.selectedCell[1],o,a))}}}jexcel.timeControl&&(clearTimeout(jexcel.timeControl),jexcel.timeControl=null)},jexcel.doubleClickControls=function(r){if(jexcel.current)if(r.target.classList.contains("jexcel_corner")){if(jexcel.current.highlighted.length>0){var e=jexcel.current.highlighted[0].getAttribute("data-x"),s=parseInt(jexcel.current.highlighted[jexcel.current.highlighted.length-1].getAttribute("data-y"))+1,o=jexcel.current.highlighted[jexcel.current.highlighted.length-1].getAttribute("data-x"),a=jexcel.current.records.length-1;jexcel.current.copyData(jexcel.current.records[s][e],jexcel.current.records[a][o])}}else if(r.target.classList.contains("jexcel_column_filter")){var d=r.target.getAttribute("data-x");jexcel.current.openFilter(d)}else{var u=jexcel.getElement(r.target);if(u[1]==1&&jexcel.current.options.columnSorting==!0){var d=r.target.getAttribute("data-x");d&&jexcel.current.orderBy(d)}if(u[1]==2&&jexcel.current.options.editable==!0&&!jexcel.current.edition){var f=function(g){if(g.parentNode){var b=g.getAttribute("data-x"),m=g.getAttribute("data-y");return b&&m?g:f(g.parentNode)}},h=f(r.target);h&&h.classList.contains("highlight")&&jexcel.current.openEditor(h)}}},jexcel.copyControls=function(r){jexcel.current&&jexcel.copyControls.enabled&&(jexcel.current.edition||jexcel.current.copy(!0))},jexcel.cutControls=function(r){jexcel.current&&(jexcel.current.edition||(jexcel.current.copy(!0),jexcel.current.options.editable==!0&&jexcel.current.setValue(jexcel.current.highlighted,"")))},jexcel.pasteControls=function(r){jexcel.current&&jexcel.current.selectedCell&&(jexcel.current.edition||jexcel.current.options.editable==!0&&(r&&r.clipboardData?(jexcel.current.paste(jexcel.current.selectedCell[0],jexcel.current.selectedCell[1],r.clipboardData.getData("text")),r.preventDefault()):window.clipboardData&&jexcel.current.paste(jexcel.current.selectedCell[0],jexcel.current.selectedCell[1],window.clipboardData.getData("text"))))},jexcel.contextMenuControls=function(r){if(r=r||window.event,"buttons"in r?r.buttons:r.which||r.button,jexcel.current){if(jexcel.current.edition)r.preventDefault();else if(jexcel.current.options.contextMenu&&(jexcel.current.contextMenu.contextmenu.close(),jexcel.current)){var e=r.target.getAttribute("data-x"),s=r.target.getAttribute("data-y");if(e||s){(e<parseInt(jexcel.current.selectedCell[0])||e>parseInt(jexcel.current.selectedCell[2])||s<parseInt(jexcel.current.selectedCell[1])||s>parseInt(jexcel.current.selectedCell[3]))&&jexcel.current.updateSelectionFromCoords(e,s,e,s);var o=jexcel.current.options.contextMenu(jexcel.current,e,s,r);jexcel.current.contextMenu.contextmenu.open(r,o),r.preventDefault()}}}},jexcel.touchStartControls=function(r){var e=jexcel.getElement(r.target);if(e[0]?jexcel.current!=e[0].jexcel&&(jexcel.current&&jexcel.current.resetSelection(),jexcel.current=e[0].jexcel):jexcel.current&&(jexcel.current.resetSelection(),jexcel.current=null),jexcel.current&&!jexcel.current.edition){var s=r.target.getAttribute("data-x"),o=r.target.getAttribute("data-y");s&&o&&(jexcel.current.updateSelectionFromCoords(s,o),jexcel.timeControl=setTimeout(function(){jexcel.current.options.columns[s].type=="color"?jexcel.tmpElement=null:jexcel.tmpElement=r.target,jexcel.current.openEditor(r.target,!1,r)},500))}},jexcel.touchEndControls=function(r){jexcel.timeControl&&(clearTimeout(jexcel.timeControl),jexcel.timeControl=null,jexcel.tmpElement&&jexcel.tmpElement.children[0].tagName=="INPUT"&&jexcel.tmpElement.children[0].focus(),jexcel.tmpElement=null)},jexcel.tabs=function(r,e){var s=[];if(r.classList.contains("jexcel_tabs"))var a=r.children[0],d=r.children[1];else{r.innerHTML="",r.classList.add("jexcel_tabs"),r.jexcel=[];var o=document.createElement("div"),a=r.appendChild(o),o=document.createElement("div"),d=r.appendChild(o)}for(var u=[],f=[],h=0;h<e.length;h++){u[h]=document.createElement("div"),u[h].classList.add("jexcel_tab");var g=jexcel(u[h],e[h]);d.appendChild(u[h]),s[h]=r.jexcel.push(g),f[h]=document.createElement("div"),f[h].classList.add("jexcel_tab_link"),f[h].setAttribute("data-spreadsheet",r.jexcel.length-1),f[h].innerHTML=e[h].sheetName,f[h].onclick=function(){for(var m=0;m<a.children.length;m++)a.children[m].classList.remove("selected"),d.children[m].style.display="none";var _=this.getAttribute("data-spreadsheet");d.children[_].style.display="block",a.children[_].classList.add("selected")},a.appendChild(f[h])}for(var b=0;b<a.children.length;b++)a.children[b].classList.remove("selected"),d.children[b].style.display="none";return a.children[a.children.length-1].classList.add("selected"),d.children[a.children.length-1].style.display="block",s},jexcel.createTabs=jexcel.tabs,jexcel.fromSpreadsheet=function(r,e){var s=function(a){var d=[];return a.SheetNames.forEach(function(u){var f={};f.rows=[],f.columns=[],f.data=[],f.style={},f.sheetName=u;var h=a.Sheets[u]["!cols"];if(h&&h.length)for(var g=0;g<h.length;g++)f.columns[g]={},h[g]&&h[g].wpx&&(f.columns[g].width=h[g].wpx+"px");var h=a.Sheets[u]["!rows"];if(h&&h.length)for(var g=0;g<h.length;g++)h[g]&&h[g].hpx&&(f.rows[g]={},f.rows[g].height=h[g].hpx+"px");var h=a.Sheets[u]["!merges"];if(h&&h.length>0){f.mergeCells=[];for(var g=0;g<h.length;g++){var b=h[g].s.c,m=h[g].s.r,_=h[g].e.c,Ge=h[g].e.r,ot=jexcel.getColumnNameFromId([b,m]);f.mergeCells[ot]=[_-b+1,Ge-m+1]}}for(var rr=0,ir=0,h=Object.keys(a.Sheets[u]),g=0;g<h.length;g++)if(h[g].substr(0,1)!="!"){var er=a.Sheets[u][h[g]],ar=jexcel.getIdFromColumnName(h[g],!0);f.data[ar[1]]||(f.data[ar[1]]=[]),f.data[ar[1]][ar[0]]=er.f?"="+er.f:er.w,rr<ar[0]&&(rr=ar[0]),ir<ar[1]&&(ir=ar[1]),er.style&&Object.keys(er.style).length>0&&(f.style[h[g]]=er.style),er.s&&er.s.fgColor&&(f.style[h[g]]&&(f.style[h[g]]+=";"),f.style[h[g]]+="background-color:#"+er.s.fgColor.rgb)}for(var Lr=f.columns,Mr=0;Mr<=ir;Mr++)for(var g=0;g<=rr;g++)f.data[Mr]||(f.data[Mr]=[]),f.data[Mr][g]||Lr<g&&(f.data[Mr][g]="");d.push(f)}),d},o;o=new XMLHttpRequest,o.open("GET",r,!0),typeof Uint8Array!="undefined"?(o.responseType="arraybuffer",o.onload=function(a){var d=o.response,u=new Uint8Array(d),f=XLSX.read(u,{type:"array",cellFormula:!0,cellStyles:!0});e(s(f))}):(o.setRequestHeader("Accept-Charset","x-user-defined"),o.onreadystatechange=function(){if(o.readyState==4&&o.status==200){var a=convertResponseBodyToText(o.responseBody),d=XLSX.read(a,{type:"binary",cellFormula:!0,cellStyles:!0});e(s(d))}}),o.send()},jexcel.validLetter=function(r){var e=/([\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC-\u0400-\u04FF']+)/g;return r.match(e)?1:0},jexcel.injectArray=function(r,e,s){return r.slice(0,e).concat(s).concat(r.slice(e))},jexcel.getColumnName=function(r){var e="";return r>701?(e+=String.fromCharCode(64+parseInt(r/676)),e+=String.fromCharCode(64+parseInt(r%676/26))):r>25&&(e+=String.fromCharCode(64+parseInt(r/26))),e+=String.fromCharCode(65+r%26),e},jexcel.getIdFromColumnName=function(r,e){var s=/^[a-zA-Z]+/.exec(r);if(s){for(var o=0,a=0;a<s[0].length;a++)o+=parseInt(s[0].charCodeAt(a)-64)*Math.pow(26,s[0].length-1-a);o--,o<0&&(o=0);var d=parseInt(/[0-9]+$/.exec(r));d>0&&d--,e==!0?r=[o,d]:r=o+"-"+d}return r},jexcel.getColumnNameFromId=function(r){return Array.isArray(r)||(r=r.split("-")),jexcel.getColumnName(parseInt(r[0]))+(parseInt(r[1])+1)},jexcel.getElement=function(r){var e=0,s=0;function o(a){a.className&&a.classList.contains("jexcel_container")&&(s=a),a.tagName=="THEAD"?e=1:a.tagName=="TBODY"&&(e=2),a.parentNode&&(s||o(a.parentNode))}return o(r),[s,e]},jexcel.doubleDigitFormat=function(r){return r=""+r,r.length==1&&(r="0"+r),r},jexcel.createFromTable=function(r,e){if(r.tagName!="TABLE")console.log("Element is not a table");else{e||(e={}),e.columns=[],e.data=[];var s=r.querySelectorAll("colgroup > col");if(s.length)for(var o=0;o<s.length;o++){var a=s[o].style.width;if(!a)var a=s[o].getAttribute("width");a&&(e.columns[o]||(e.columns[o]={}),e.columns[o].width=a)}var d=function(nr){var sr=nr.getBoundingClientRect(),Rr=sr.width>50?sr.width:50;e.columns[o]||(e.columns[o]={}),nr.getAttribute("data-celltype")?e.columns[o].type=nr.getAttribute("data-celltype"):e.columns[o].type="text",e.columns[o].width=Rr+"px",e.columns[o].title=nr.innerHTML,e.columns[o].align=nr.style.textAlign||"center",(sr=nr.getAttribute("name"))&&(e.columns[o].name=sr),(sr=nr.getAttribute("id"))&&(e.columns[o].id=sr)},u=[],f=r.querySelectorAll(":scope > thead > tr");if(f.length){for(var h=0;h<f.length-1;h++){for(var g=[],o=0;o<f[h].children.length;o++){var b={title:f[h].children[o].innerText,colspan:f[h].children[o].getAttribute("colspan")||1};g.push(b)}u.push(g)}f=f[f.length-1].children;for(var o=0;o<f.length;o++)d(f[o])}for(var m=0,_={},Ge={},ot={},rr={},ir=r.querySelectorAll(":scope > tr, :scope > tbody > tr"),h=0;h<ir.length;h++)if(e.data[m]=[],e.parseTableFirstRowAsHeader==!0&&!f.length&&h==0)for(var o=0;o<ir[h].children.length;o++)d(ir[h].children[o]);else{for(var o=0;o<ir[h].children.length;o++){var er=ir[h].children[o].getAttribute("data-formula");if(er)er.substr(0,1)!="="&&(er="="+er);else var er=ir[h].children[o].innerHTML;e.data[m].push(er);var ar=jexcel.getColumnNameFromId([o,h]),Lr=ir[h].children[o].getAttribute("class");Lr&&(rr[ar]=Lr);var Mr=parseInt(ir[h].children[o].getAttribute("colspan"))||0,Br=parseInt(ir[h].children[o].getAttribute("rowspan"))||0;(Mr||Br)&&(_[ar]=[Mr||1,Br||1]),(Qr=ir[h].children[o].style&&ir[h].children[o].style.display=="none")&&(ir[h].children[o].style.display="");var Qr=ir[h].children[o].getAttribute("style");Qr&&(ot[ar]=Qr),ir[h].children[o].classList.contains("styleBold")&&(ot[ar]?ot[ar]+="; font-weight:bold;":ot[ar]="font-weight:bold;")}ir[h].style&&ir[h].style.height&&(Ge[h]={height:ir[h].style.height}),m++}Object.keys(u).length>0&&(e.nestedHeaders=u),Object.keys(ot).length>0&&(e.style=ot),Object.keys(_).length>0&&(e.mergeCells=_),Object.keys(Ge).length>0&&(e.rows=Ge),Object.keys(rr).length>0&&(e.classes=rr);var ir=r.querySelectorAll("tfoot tr");if(ir.length){for(var ii=[],h=0;h<ir.length;h++){for(var Ir=[],o=0;o<ir[h].children.length;o++)Ir.push(ir[h].children[o].innerText);ii.push(Ir)}Object.keys(ii).length>0&&(e.footers=ii)}if(e.parseTableAutoCellType==!0)for(var gt=[],o=0;o<e.columns.length;o++){var tr=!0,br=!0;gt[o]=[];for(var h=0;h<e.data.length;h++){var er=e.data[h][o];gt[o][er]||(gt[o][er]=0),gt[o][er]++,er.length>25&&(tr=!1),er.length==10&&er.substr(4,1)=="-"&&er.substr(7,1)=="-"||(br=!1)}var tt=Object.keys(gt[o]).length;br?e.columns[o].type="calendar":tr==!0&&tt>1&&tt<=parseInt(e.data.length*.1)&&(e.columns[o].type="dropdown",e.columns[o].source=Object.keys(gt[o]))}return e}},jexcel.helpers=function(){var r={};return r.getCaretIndex=function(e){if(this.config.root)var s=this.config.root;else var s=window;var o=0,a=s.getSelection();if(a&&a.rangeCount!==0){var d=a.getRangeAt(0),u=d.cloneRange();u.selectNodeContents(e),u.setEnd(d.endContainer,d.endOffset),o=u.toString().length}return o},r.invert=function(e){for(var s=[],o=Object.keys(e),a=0;a<o.length;a++)s[e[o[a]]]=o[a];return s},r.getColumnName=function(e){var s="";return e>701?(s+=String.fromCharCode(64+parseInt(e/676)),s+=String.fromCharCode(64+parseInt(e%676/26))):e>25&&(s+=String.fromCharCode(64+parseInt(e/26))),s+=String.fromCharCode(65+e%26),s},r.getColumnNameFromCoords=function(e,s){return r.getColumnName(parseInt(e))+(parseInt(s)+1)},r.getCoordsFromColumnName=function(e){var s=/^[a-zA-Z]+/.exec(e);if(s){for(var o=0,a=0;a<s[0].length;a++)o+=parseInt(s[0].charCodeAt(a)-64)*Math.pow(26,s[0].length-1-a);o--,o<0&&(o=0);var d=parseInt(/[0-9]+$/.exec(e))||null;return d>0&&d--,[o,d]}},r.createFromTable=function(){},r.injectArray=function(e,s,o){return e.slice(0,s).concat(o).concat(e.slice(s))},r.parseCSV=function(e,s){s=s||",";for(var o=0,a=0,d=[[]],u=0,f=null,h=!1,g=!1,b=0;b<e.length;b++)if(d[a]||(d[a]=[]),d[a][o]||(d[a][o]=""),e[b]!="\r")if((e[b]==`
`||e[b]==s)&&(h==!1||g==!0||!f)){if(f=null,h=!1,g=!1,d[a][o][0]=='"'){var m=d[a][o].trim();m[m.length-1]=='"'&&(d[a][o]=m.substr(1,m.length-2))}e[b]==`
`?(o=0,a++):(o++,o>u&&(u=o))}else{if(e[b]=='"'&&(h=!h),f===null){if(f=h,f==!0)continue}else if(f===!0&&!g&&e[b]=='"'){e[b+1]=='"'?(h=!0,d[a][o]+=e[b],b++):g=!0;continue}d[a][o]+=e[b]}for(var _=0;_<d.length;_++)for(var b=0;b<=u;b++)d[_][b]===void 0&&(d[_][b]="");return d},r}(),typeof jQuery!="undefined"&&function(r){r.fn.jspreadsheet=r.fn.jexcel=function(e){var s=r(this).get(0);return s.jexcel?Array.isArray(s.jexcel)?s.jexcel[e][arguments[1]].apply(this,Array.prototype.slice.call(arguments,2)):s.jexcel[e].apply(this,Array.prototype.slice.call(arguments,1)):jexcel(r(this).get(0),arguments[0])}}(jQuery),jexcel})})(dist);var jspreadsheet=dist.exports;class Component{constructor(e,s,o){this.name=e,this.instanceFactory=s,this.type=o,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_ENTRY_NAME$1="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Provider{constructor(e,s){this.name=e,this.container=s,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const s=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(s)){const o=new Deferred;if(this.instancesDeferred.set(s,o),this.isInitialized(s)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:s});a&&o.resolve(a)}catch{}}return this.instancesDeferred.get(s).promise}getImmediate(e){var s;const o=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),a=(s=e==null?void 0:e.optional)!==null&&s!==void 0?s:!1;if(this.isInitialized(o)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:o})}catch(d){if(a)return null;throw d}else{if(a)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(isComponentEager(e))try{this.getOrInitializeService({instanceIdentifier:DEFAULT_ENTRY_NAME$1})}catch{}for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);try{const d=this.getOrInitializeService({instanceIdentifier:a});o.resolve(d)}catch{}}}}clearInstance(e=DEFAULT_ENTRY_NAME$1){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(s=>"INTERNAL"in s).map(s=>s.INTERNAL.delete()),...e.filter(s=>"_delete"in s).map(s=>s._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=DEFAULT_ENTRY_NAME$1){return this.instances.has(e)}getOptions(e=DEFAULT_ENTRY_NAME$1){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:s={}}=e,o=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(o))throw Error(`${this.name}(${o}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:o,options:s});for(const[d,u]of this.instancesDeferred.entries()){const f=this.normalizeInstanceIdentifier(d);o===f&&u.resolve(a)}return a}onInit(e,s){var o;const a=this.normalizeInstanceIdentifier(s),d=(o=this.onInitCallbacks.get(a))!==null&&o!==void 0?o:new Set;d.add(e),this.onInitCallbacks.set(a,d);const u=this.instances.get(a);return u&&e(u,a),()=>{d.delete(e)}}invokeOnInitCallbacks(e,s){const o=this.onInitCallbacks.get(s);if(!!o)for(const a of o)try{a(e,s)}catch{}}getOrInitializeService({instanceIdentifier:e,options:s={}}){let o=this.instances.get(e);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:normalizeIdentifierForFactory(e),options:s}),this.instances.set(e,o),this.instancesOptions.set(e,s),this.invokeOnInitCallbacks(o,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,o)}catch{}return o||null}normalizeInstanceIdentifier(e=DEFAULT_ENTRY_NAME$1){return this.component?this.component.multipleInstances?e:DEFAULT_ENTRY_NAME$1:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function normalizeIdentifierForFactory(r){return r===DEFAULT_ENTRY_NAME$1?void 0:r}function isComponentEager(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ComponentContainer{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const s=this.getProvider(e.name);if(s.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);s.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const s=new Provider(e,this);return this.providers.set(e,s),s}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var LogLevel;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(LogLevel||(LogLevel={}));const levelStringToEnum={debug:LogLevel.DEBUG,verbose:LogLevel.VERBOSE,info:LogLevel.INFO,warn:LogLevel.WARN,error:LogLevel.ERROR,silent:LogLevel.SILENT},defaultLogLevel=LogLevel.INFO,ConsoleMethod={[LogLevel.DEBUG]:"log",[LogLevel.VERBOSE]:"log",[LogLevel.INFO]:"info",[LogLevel.WARN]:"warn",[LogLevel.ERROR]:"error"},defaultLogHandler=(r,e,...s)=>{if(e<r.logLevel)return;const o=new Date().toISOString(),a=ConsoleMethod[e];if(a)console[a](`[${o}]  ${r.name}:`,...s);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Logger{constructor(e){this.name=e,this._logLevel=defaultLogLevel,this._logHandler=defaultLogHandler,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in LogLevel))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?levelStringToEnum[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.DEBUG,...e),this._logHandler(this,LogLevel.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.VERBOSE,...e),this._logHandler(this,LogLevel.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.INFO,...e),this._logHandler(this,LogLevel.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.WARN,...e),this._logHandler(this,LogLevel.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.ERROR,...e),this._logHandler(this,LogLevel.ERROR,...e)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PlatformLoggerServiceImpl{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(s=>{if(isVersionServiceProvider(s)){const o=s.getImmediate();return`${o.library}/${o.version}`}else return null}).filter(s=>s).join(" ")}}function isVersionServiceProvider(r){const e=r.getComponent();return(e==null?void 0:e.type)==="VERSION"}const name$o="@firebase/app",version$1$1="0.7.11";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const logger$1=new Logger("@firebase/app"),name$n="@firebase/app-compat",name$m="@firebase/analytics-compat",name$l="@firebase/analytics",name$k="@firebase/app-check-compat",name$j="@firebase/app-check",name$i="@firebase/auth",name$h="@firebase/auth-compat",name$g="@firebase/database",name$f="@firebase/database-compat",name$e="@firebase/functions",name$d="@firebase/functions-compat",name$c="@firebase/installations",name$b="@firebase/installations-compat",name$a="@firebase/messaging",name$9="@firebase/messaging-compat",name$8="@firebase/performance",name$7="@firebase/performance-compat",name$6="@firebase/remote-config",name$5="@firebase/remote-config-compat",name$4="@firebase/storage",name$3$1="@firebase/storage-compat",name$2$1="@firebase/firestore",name$1$1="@firebase/firestore-compat",name$p="firebase",version$4="9.6.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_ENTRY_NAME="[DEFAULT]",PLATFORM_LOG_STRING={[name$o]:"fire-core",[name$n]:"fire-core-compat",[name$l]:"fire-analytics",[name$m]:"fire-analytics-compat",[name$j]:"fire-app-check",[name$k]:"fire-app-check-compat",[name$i]:"fire-auth",[name$h]:"fire-auth-compat",[name$g]:"fire-rtdb",[name$f]:"fire-rtdb-compat",[name$e]:"fire-fn",[name$d]:"fire-fn-compat",[name$c]:"fire-iid",[name$b]:"fire-iid-compat",[name$a]:"fire-fcm",[name$9]:"fire-fcm-compat",[name$8]:"fire-perf",[name$7]:"fire-perf-compat",[name$6]:"fire-rc",[name$5]:"fire-rc-compat",[name$4]:"fire-gcs",[name$3$1]:"fire-gcs-compat",[name$2$1]:"fire-fst",[name$1$1]:"fire-fst-compat","fire-js":"fire-js",[name$p]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _apps=new Map,_components=new Map;function _addComponent(r,e){try{r.container.addComponent(e)}catch(s){logger$1.debug(`Component ${e.name} failed to register with FirebaseApp ${r.name}`,s)}}function _registerComponent(r){const e=r.name;if(_components.has(e))return logger$1.debug(`There were multiple attempts to register component ${e}.`),!1;_components.set(e,r);for(const s of _apps.values())_addComponent(s,r);return!0}function _getProvider(r,e){return r.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ERRORS$1={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function."},ERROR_FACTORY$1=new ErrorFactory("app","Firebase",ERRORS$1);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FirebaseAppImpl{constructor(e,s,o){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},s),this._name=s.name,this._automaticDataCollectionEnabled=s.automaticDataCollectionEnabled,this._container=o,this.container.addComponent(new Component("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ERROR_FACTORY$1.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SDK_VERSION=version$4;function initializeApp(r,e={}){typeof e!="object"&&(e={name:e});const s=Object.assign({name:DEFAULT_ENTRY_NAME,automaticDataCollectionEnabled:!1},e),o=s.name;if(typeof o!="string"||!o)throw ERROR_FACTORY$1.create("bad-app-name",{appName:String(o)});const a=_apps.get(o);if(a){if(deepEqual(r,a.options)&&deepEqual(s,a.config))return a;throw ERROR_FACTORY$1.create("duplicate-app",{appName:o})}const d=new ComponentContainer(o);for(const f of _components.values())d.addComponent(f);const u=new FirebaseAppImpl(r,s,d);return _apps.set(o,u),u}function getApp(r=DEFAULT_ENTRY_NAME){const e=_apps.get(r);if(!e)throw ERROR_FACTORY$1.create("no-app",{appName:r});return e}function registerVersion(r,e,s){var o;let a=(o=PLATFORM_LOG_STRING[r])!==null&&o!==void 0?o:r;s&&(a+=`-${s}`);const d=a.match(/\s|\//),u=e.match(/\s|\//);if(d||u){const f=[`Unable to register library "${a}" with version "${e}":`];d&&f.push(`library name "${a}" contains illegal characters (whitespace or "/")`),d&&u&&f.push("and"),u&&f.push(`version name "${e}" contains illegal characters (whitespace or "/")`),logger$1.warn(f.join(" "));return}_registerComponent(new Component(`${a}-version`,()=>({library:a,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function registerCoreComponents(r){_registerComponent(new Component("platform-logger",e=>new PlatformLoggerServiceImpl(e),"PRIVATE")),registerVersion(name$o,version$1$1,r),registerVersion(name$o,version$1$1,"esm2017"),registerVersion("fire-js","")}registerCoreComponents("");var name$3="firebase",version$3="9.6.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */registerVersion(name$3,version$3,"app");/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const APP_CHECK_STATES=new Map,DEFAULT_STATE={activated:!1,tokenObservers:[]};function getState(r){return APP_CHECK_STATES.get(r)||DEFAULT_STATE}function setState(r,e){APP_CHECK_STATES.set(r,e)}const TOKEN_REFRESH_TIME={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Refresher{constructor(e,s,o,a,d){if(this.operation=e,this.retryPolicy=s,this.getWaitDuration=o,this.lowerBound=a,this.upperBound=d,this.pending=null,this.nextErrorWaitInterval=a,a>d)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new Deferred,await sleep(this.getNextRun(e)),this.pending.resolve(),await this.pending.promise,this.pending=new Deferred,await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(s){this.retryPolicy(s)?this.process(!1).catch(()=>{}):this.stop()}}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const s=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),s}}}function sleep(r){return new Promise(e=>{setTimeout(e,r)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ERRORS={["already-initialized"]:"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.",["use-before-activation"]:"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.",["fetch-network-error"]:"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",["fetch-parse-error"]:"Fetch client could not parse response. Original error: {$originalErrorMessage}.",["fetch-status-error"]:"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",["storage-open"]:"Error thrown when opening storage. Original error: {$originalErrorMessage}.",["storage-get"]:"Error thrown when reading from storage. Original error: {$originalErrorMessage}.",["storage-set"]:"Error thrown when writing to storage. Original error: {$originalErrorMessage}.",["recaptcha-error"]:"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},ERROR_FACTORY=new ErrorFactory("appCheck","AppCheck",ERRORS);function ensureActivated(r){if(!getState(r).activated)throw ERROR_FACTORY.create("use-before-activation",{appName:r.name})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DB_NAME$1="firebase-app-check-database",DB_VERSION$1=1,STORE_NAME="firebase-app-check-store";let dbPromise=null;function getDBPromise(){return dbPromise||(dbPromise=new Promise((r,e)=>{try{const s=indexedDB.open(DB_NAME$1,DB_VERSION$1);s.onsuccess=o=>{r(o.target.result)},s.onerror=o=>{var a;e(ERROR_FACTORY.create("storage-open",{originalErrorMessage:(a=o.target.error)===null||a===void 0?void 0:a.message}))},s.onupgradeneeded=o=>{const a=o.target.result;switch(o.oldVersion){case 0:a.createObjectStore(STORE_NAME,{keyPath:"compositeKey"})}}}catch(s){e(ERROR_FACTORY.create("storage-open",{originalErrorMessage:s.message}))}}),dbPromise)}function writeTokenToIndexedDB(r,e){return write(computeKey(r),e)}async function write(r,e){const o=(await getDBPromise()).transaction(STORE_NAME,"readwrite"),d=o.objectStore(STORE_NAME).put({compositeKey:r,value:e});return new Promise((u,f)=>{d.onsuccess=h=>{u()},o.onerror=h=>{var g;f(ERROR_FACTORY.create("storage-set",{originalErrorMessage:(g=h.target.error)===null||g===void 0?void 0:g.message}))}})}function computeKey(r){return`${r.options.appId}-${r.name}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const logger=new Logger("@firebase/app-check");function writeTokenToStorage(r,e){return isIndexedDBAvailable()?writeTokenToIndexedDB(r,e).catch(s=>{logger.warn(`Failed to write token to IndexedDB. Error: ${s}`)}):Promise.resolve()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const defaultTokenErrorData={error:"UNKNOWN_ERROR"};function formatDummyToken(r){return base64.encodeString(JSON.stringify(r),!1)}async function getToken$2(r,e=!1){const s=r.app;ensureActivated(s);const o=getState(s);let a=o.token,d;if(!a){const h=await o.cachedTokenPromise;h&&isValid(h)&&(a=h)}if(!e&&a&&isValid(a))return{token:a.token};let u=!1;try{o.exchangeTokenPromise||(o.exchangeTokenPromise=o.provider.getToken().then(h=>(o.exchangeTokenPromise=void 0,h)),u=!0),a=await o.exchangeTokenPromise}catch(h){h.code==="appCheck/throttled"?logger.warn(h.message):logger.error(h),d=h}let f;return a?(f={token:a.token},setState(s,Object.assign(Object.assign({},o),{token:a})),await writeTokenToStorage(s,a)):f=makeDummyTokenResult(d),u&&notifyTokenListeners(s,f),f}function addTokenListener(r,e,s,o){const{app:a}=r,d=getState(a),u={next:s,error:o,type:e};if(setState(a,Object.assign(Object.assign({},d),{tokenObservers:[...d.tokenObservers,u]})),d.token&&isValid(d.token)){const f=d.token;Promise.resolve().then(()=>{s({token:f.token}),initTokenRefresher(r)}).catch(()=>{})}d.cachedTokenPromise.then(()=>initTokenRefresher(r))}function removeTokenListener(r,e){const s=getState(r),o=s.tokenObservers.filter(a=>a.next!==e);o.length===0&&s.tokenRefresher&&s.tokenRefresher.isRunning()&&s.tokenRefresher.stop(),setState(r,Object.assign(Object.assign({},s),{tokenObservers:o}))}function initTokenRefresher(r){const{app:e}=r,s=getState(e);let o=s.tokenRefresher;o||(o=createTokenRefresher(r),setState(e,Object.assign(Object.assign({},s),{tokenRefresher:o}))),!o.isRunning()&&s.isTokenAutoRefreshEnabled&&o.start()}function createTokenRefresher(r){const{app:e}=r;return new Refresher(async()=>{const s=getState(e);let o;if(s.token?o=await getToken$2(r,!0):o=await getToken$2(r),o.error)throw o.error},()=>!0,()=>{const s=getState(e);if(s.token){let o=s.token.issuedAtTimeMillis+(s.token.expireTimeMillis-s.token.issuedAtTimeMillis)*.5+5*60*1e3;const a=s.token.expireTimeMillis-5*60*1e3;return o=Math.min(o,a),Math.max(0,o-Date.now())}else return 0},TOKEN_REFRESH_TIME.RETRIAL_MIN_WAIT,TOKEN_REFRESH_TIME.RETRIAL_MAX_WAIT)}function notifyTokenListeners(r,e){const s=getState(r).tokenObservers;for(const o of s)try{o.type==="EXTERNAL"&&e.error!=null?o.error(e.error):o.next(e)}catch{}}function isValid(r){return r.expireTimeMillis-Date.now()>0}function makeDummyTokenResult(r){return{token:formatDummyToken(defaultTokenErrorData),error:r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AppCheckService{constructor(e,s){this.app=e,this.platformLoggerProvider=s}_delete(){const{tokenObservers:e}=getState(this.app);for(const s of e)removeTokenListener(this.app,s.next);return Promise.resolve()}}function factory$1(r,e){return new AppCheckService(r,e)}function internalFactory(r){return{getToken:e=>getToken$2(r,e),addTokenListener:e=>addTokenListener(r,"INTERNAL",e),removeTokenListener:e=>removeTokenListener(r.app,e)}}const name$2="@firebase/app-check",version$2="0.5.2",APP_CHECK_NAME="app-check",APP_CHECK_NAME_INTERNAL="app-check-internal";function registerAppCheck(){_registerComponent(new Component(APP_CHECK_NAME,r=>{const e=r.getProvider("app").getImmediate(),s=r.getProvider("platform-logger");return factory$1(e,s)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((r,e,s)=>{r.getProvider(APP_CHECK_NAME_INTERNAL).initialize()})),_registerComponent(new Component(APP_CHECK_NAME_INTERNAL,r=>{const e=r.getProvider("app-check").getImmediate();return internalFactory(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),registerVersion(name$2,version$2)}registerAppCheck();/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function __rest(r,e){var s={};for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&e.indexOf(o)<0&&(s[o]=r[o]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,o=Object.getOwnPropertySymbols(r);a<o.length;a++)e.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(r,o[a])&&(s[o[a]]=r[o[a]]);return s}function _prodErrorMap(){return{["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const prodErrorMap=_prodErrorMap,_DEFAULT_AUTH_ERROR_FACTORY=new ErrorFactory("auth","Firebase",_prodErrorMap());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const logClient=new Logger("@firebase/auth");function _logError(r,...e){logClient.logLevel<=LogLevel.ERROR&&logClient.error(`Auth (${SDK_VERSION}): ${r}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _fail(r,...e){throw createErrorInternal(r,...e)}function _createError(r,...e){return createErrorInternal(r,...e)}function _errorWithCustomMessage(r,e,s){const o=Object.assign(Object.assign({},prodErrorMap()),{[e]:s});return new ErrorFactory("auth","Firebase",o).create(e,{appName:r.name})}function createErrorInternal(r,...e){if(typeof r!="string"){const s=e[0],o=[...e.slice(1)];return o[0]&&(o[0].appName=r.name),r._errorFactory.create(s,...o)}return _DEFAULT_AUTH_ERROR_FACTORY.create(r,...e)}function _assert(r,e,...s){if(!r)throw createErrorInternal(e,...s)}function debugFail(r){const e="INTERNAL ASSERTION FAILED: "+r;throw _logError(e),new Error(e)}function debugAssert(r,e){r||debugFail(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const instanceCache=new Map;function _getInstance(r){debugAssert(r instanceof Function,"Expected a class definition");let e=instanceCache.get(r);return e?(debugAssert(e instanceof r,"Instance stored in cache mismatched with class"),e):(e=new r,instanceCache.set(r,e),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function initializeAuth(r,e){const s=_getProvider(r,"auth");if(s.isInitialized()){const a=s.getImmediate(),d=s.getOptions();if(deepEqual(d,e!=null?e:{}))return a;_fail(a,"already-initialized")}return s.initialize({options:e})}function _initializeAuthInstance(r,e){const s=(e==null?void 0:e.persistence)||[],o=(Array.isArray(s)?s:[s]).map(_getInstance);(e==null?void 0:e.errorMap)&&r._updateErrorMap(e.errorMap),r._initializeWithPersistence(o,e==null?void 0:e.popupRedirectResolver)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _getCurrentUrl(){var r;return typeof self!="undefined"&&((r=self.location)===null||r===void 0?void 0:r.href)||""}function _isHttpOrHttps(){return _getCurrentScheme()==="http:"||_getCurrentScheme()==="https:"}function _getCurrentScheme(){var r;return typeof self!="undefined"&&((r=self.location)===null||r===void 0?void 0:r.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _isOnline(){return typeof navigator!="undefined"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(_isHttpOrHttps()||isBrowserExtension()||"connection"in navigator)?navigator.onLine:!0}function _getUserLanguage(){if(typeof navigator=="undefined")return null;const r=navigator;return r.languages&&r.languages[0]||r.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Delay{constructor(e,s){this.shortDelay=e,this.longDelay=s,debugAssert(s>e,"Short delay should be less than long delay!"),this.isMobile=isMobileCordova()||isReactNative()}get(){return _isOnline()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _emulatorUrl(r,e){debugAssert(r.emulator,"Emulator should always be set here");const{url:s}=r.emulator;return e?`${s}${e.startsWith("/")?e.slice(1):e}`:s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FetchProvider{static initialize(e,s,o){this.fetchImpl=e,s&&(this.headersImpl=s),o&&(this.responseImpl=o)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self!="undefined"&&"fetch"in self)return self.fetch;debugFail("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self!="undefined"&&"Headers"in self)return self.Headers;debugFail("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self!="undefined"&&"Response"in self)return self.Response;debugFail("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SERVER_ERROR_MAP={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_API_TIMEOUT_MS=new Delay(3e4,6e4);function _addTidIfNecessary(r,e){return r.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:r.tenantId}):e}async function _performApiRequest(r,e,s,o,a={}){return _performFetchWithErrorHandling(r,a,async()=>{let d={},u={};o&&(e==="GET"?u=o:d={body:JSON.stringify(o)});const f=querystring(Object.assign({key:r.config.apiKey},u)).slice(1),h=await r._getAdditionalHeaders();return h["Content-Type"]="application/json",r.languageCode&&(h["X-Firebase-Locale"]=r.languageCode),FetchProvider.fetch()(_getFinalTarget(r,r.config.apiHost,s,f),Object.assign({method:e,headers:h,referrerPolicy:"no-referrer"},d))})}async function _performFetchWithErrorHandling(r,e,s){r._canInitEmulator=!1;const o=Object.assign(Object.assign({},SERVER_ERROR_MAP),e);try{const a=new NetworkTimeout(r),d=await Promise.race([s(),a.promise]);a.clearNetworkTimeout();const u=await d.json();if("needConfirmation"in u)throw _makeTaggedError(r,"account-exists-with-different-credential",u);if(d.ok&&!("errorMessage"in u))return u;{const f=d.ok?u.errorMessage:u.error.message,[h,g]=f.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw _makeTaggedError(r,"credential-already-in-use",u);if(h==="EMAIL_EXISTS")throw _makeTaggedError(r,"email-already-in-use",u);const b=o[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(g)throw _errorWithCustomMessage(r,b,g);_fail(r,b)}}catch(a){if(a instanceof FirebaseError)throw a;_fail(r,"network-request-failed")}}async function _performSignInRequest(r,e,s,o,a={}){const d=await _performApiRequest(r,e,s,o,a);return"mfaPendingCredential"in d&&_fail(r,"multi-factor-auth-required",{_serverResponse:d}),d}function _getFinalTarget(r,e,s,o){const a=`${e}${s}?${o}`;return r.config.emulator?_emulatorUrl(r.config,a):`${r.config.apiScheme}://${a}`}class NetworkTimeout{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((s,o)=>{this.timer=setTimeout(()=>o(_createError(this.auth,"timeout")),DEFAULT_API_TIMEOUT_MS.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function _makeTaggedError(r,e,s){const o={appName:r.name};s.email&&(o.email=s.email),s.phoneNumber&&(o.phoneNumber=s.phoneNumber);const a=_createError(r,e,o);return a.customData._tokenResponse=s,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function deleteAccount(r,e){return _performApiRequest(r,"POST","/v1/accounts:delete",e)}async function getAccountInfo(r,e){return _performApiRequest(r,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function utcTimestampToDateString(r){if(!!r)try{const e=new Date(Number(r));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function getIdTokenResult(r,e=!1){const s=getModularInstance(r),o=await s.getIdToken(e),a=_parseToken(o);_assert(a&&a.exp&&a.auth_time&&a.iat,s.auth,"internal-error");const d=typeof a.firebase=="object"?a.firebase:void 0,u=d==null?void 0:d.sign_in_provider;return{claims:a,token:o,authTime:utcTimestampToDateString(secondsStringToMilliseconds(a.auth_time)),issuedAtTime:utcTimestampToDateString(secondsStringToMilliseconds(a.iat)),expirationTime:utcTimestampToDateString(secondsStringToMilliseconds(a.exp)),signInProvider:u||null,signInSecondFactor:(d==null?void 0:d.sign_in_second_factor)||null}}function secondsStringToMilliseconds(r){return Number(r)*1e3}function _parseToken(r){const[e,s,o]=r.split(".");if(e===void 0||s===void 0||o===void 0)return _logError("JWT malformed, contained fewer than 3 sections"),null;try{const a=base64Decode(s);return a?JSON.parse(a):(_logError("Failed to decode base64 JWT payload"),null)}catch(a){return _logError("Caught error parsing JWT payload as JSON",a),null}}function _tokenExpiresIn(r){const e=_parseToken(r);return _assert(e,"internal-error"),_assert(typeof e.exp!="undefined","internal-error"),_assert(typeof e.iat!="undefined","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _logoutIfInvalidated(r,e,s=!1){if(s)return e;try{return await e}catch(o){throw o instanceof FirebaseError&&isUserInvalidated(o)&&r.auth.currentUser===r&&await r.auth.signOut(),o}}function isUserInvalidated({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ProactiveRefresh{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var s;if(e){const o=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),o}else{this.errorBackoff=3e4;const a=((s=this.user.stsTokenManager.expirationTime)!==null&&s!==void 0?s:0)-Date.now()-3e5;return Math.max(0,a)}}schedule(e=!1){if(!this.isRunning)return;const s=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},s)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UserMetadata{constructor(e,s){this.createdAt=e,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=utcTimestampToDateString(this.lastLoginAt),this.creationTime=utcTimestampToDateString(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _reloadWithoutSaving(r){var e;const s=r.auth,o=await r.getIdToken(),a=await _logoutIfInvalidated(r,getAccountInfo(s,{idToken:o}));_assert(a==null?void 0:a.users.length,s,"internal-error");const d=a.users[0];r._notifyReloadListener(d);const u=((e=d.providerUserInfo)===null||e===void 0?void 0:e.length)?extractProviderData(d.providerUserInfo):[],f=mergeProviderData(r.providerData,u),h=r.isAnonymous,g=!(r.email&&d.passwordHash)&&!(f==null?void 0:f.length),b=h?g:!1,m={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:f,metadata:new UserMetadata(d.createdAt,d.lastLoginAt),isAnonymous:b};Object.assign(r,m)}async function reload(r){const e=getModularInstance(r);await _reloadWithoutSaving(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function mergeProviderData(r,e){return[...r.filter(o=>!e.some(a=>a.providerId===o.providerId)),...e]}function extractProviderData(r){return r.map(e=>{var{providerId:s}=e,o=__rest(e,["providerId"]);return{providerId:s,uid:o.rawId||"",displayName:o.displayName||null,email:o.email||null,phoneNumber:o.phoneNumber||null,photoURL:o.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function requestStsToken(r,e){const s=await _performFetchWithErrorHandling(r,{},async()=>{const o=querystring({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:a,apiKey:d}=r.config,u=_getFinalTarget(r,a,"/v1/token",`key=${d}`),f=await r._getAdditionalHeaders();return f["Content-Type"]="application/x-www-form-urlencoded",FetchProvider.fetch()(u,{method:"POST",headers:f,body:o})});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class StsTokenManager{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){_assert(e.idToken,"internal-error"),_assert(typeof e.idToken!="undefined","internal-error"),_assert(typeof e.refreshToken!="undefined","internal-error");const s="expiresIn"in e&&typeof e.expiresIn!="undefined"?Number(e.expiresIn):_tokenExpiresIn(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,s)}async getToken(e,s=!1){return _assert(!this.accessToken||this.refreshToken,e,"user-token-expired"),!s&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(e,s){const{accessToken:o,refreshToken:a,expiresIn:d}=await requestStsToken(e,s);this.updateTokensAndExpiration(o,a,Number(d))}updateTokensAndExpiration(e,s,o){this.refreshToken=s||null,this.accessToken=e||null,this.expirationTime=Date.now()+o*1e3}static fromJSON(e,s){const{refreshToken:o,accessToken:a,expirationTime:d}=s,u=new StsTokenManager;return o&&(_assert(typeof o=="string","internal-error",{appName:e}),u.refreshToken=o),a&&(_assert(typeof a=="string","internal-error",{appName:e}),u.accessToken=a),d&&(_assert(typeof d=="number","internal-error",{appName:e}),u.expirationTime=d),u}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new StsTokenManager,this.toJSON())}_performRefresh(){return debugFail("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function assertStringOrUndefined(r,e){_assert(typeof r=="string"||typeof r=="undefined","internal-error",{appName:e})}class UserImpl{constructor(e){var{uid:s,auth:o,stsTokenManager:a}=e,d=__rest(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.emailVerified=!1,this.isAnonymous=!1,this.tenantId=null,this.providerData=[],this.proactiveRefresh=new ProactiveRefresh(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=s,this.auth=o,this.stsTokenManager=a,this.accessToken=a.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.metadata=new UserMetadata(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(e){const s=await _logoutIfInvalidated(this,this.stsTokenManager.getToken(this.auth,e));return _assert(s,this.auth,"internal-error"),this.accessToken!==s&&(this.accessToken=s,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),s}getIdTokenResult(e){return getIdTokenResult(this,e)}reload(){return reload(this)}_assign(e){this!==e&&(_assert(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(s=>Object.assign({},s)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new UserImpl(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){_assert(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,s=!1){let o=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),o=!0),s&&await _reloadWithoutSaving(this),await this.auth._persistUserIfCurrent(this),o&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await _logoutIfInvalidated(this,deleteAccount(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,s){var o,a,d,u,f,h,g,b;const m=(o=s.displayName)!==null&&o!==void 0?o:void 0,_=(a=s.email)!==null&&a!==void 0?a:void 0,Ge=(d=s.phoneNumber)!==null&&d!==void 0?d:void 0,ot=(u=s.photoURL)!==null&&u!==void 0?u:void 0,rr=(f=s.tenantId)!==null&&f!==void 0?f:void 0,ir=(h=s._redirectEventId)!==null&&h!==void 0?h:void 0,er=(g=s.createdAt)!==null&&g!==void 0?g:void 0,ar=(b=s.lastLoginAt)!==null&&b!==void 0?b:void 0,{uid:Lr,emailVerified:Mr,isAnonymous:Br,providerData:Qr,stsTokenManager:ii}=s;_assert(Lr&&ii,e,"internal-error");const Ir=StsTokenManager.fromJSON(this.name,ii);_assert(typeof Lr=="string",e,"internal-error"),assertStringOrUndefined(m,e.name),assertStringOrUndefined(_,e.name),_assert(typeof Mr=="boolean",e,"internal-error"),_assert(typeof Br=="boolean",e,"internal-error"),assertStringOrUndefined(Ge,e.name),assertStringOrUndefined(ot,e.name),assertStringOrUndefined(rr,e.name),assertStringOrUndefined(ir,e.name),assertStringOrUndefined(er,e.name),assertStringOrUndefined(ar,e.name);const gt=new UserImpl({uid:Lr,auth:e,email:_,emailVerified:Mr,displayName:m,isAnonymous:Br,photoURL:ot,phoneNumber:Ge,tenantId:rr,stsTokenManager:Ir,createdAt:er,lastLoginAt:ar});return Qr&&Array.isArray(Qr)&&(gt.providerData=Qr.map(tr=>Object.assign({},tr))),ir&&(gt._redirectEventId=ir),gt}static async _fromIdTokenResponse(e,s,o=!1){const a=new StsTokenManager;a.updateFromServerResponse(s);const d=new UserImpl({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o});return await _reloadWithoutSaving(d),d}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class InMemoryPersistence{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,s){this.storage[e]=s}async _get(e){const s=this.storage[e];return s===void 0?null:s}async _remove(e){delete this.storage[e]}_addListener(e,s){}_removeListener(e,s){}}InMemoryPersistence.type="NONE";const inMemoryPersistence=InMemoryPersistence;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _persistenceKeyName(r,e,s){return`firebase:${r}:${e}:${s}`}class PersistenceUserManager{constructor(e,s,o){this.persistence=e,this.auth=s,this.userKey=o;const{config:a,name:d}=this.auth;this.fullUserKey=_persistenceKeyName(this.userKey,a.apiKey,d),this.fullPersistenceKey=_persistenceKeyName("persistence",a.apiKey,d),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?UserImpl._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const s=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,s)return this.setCurrentUser(s)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,s,o="authUser"){if(!s.length)return new PersistenceUserManager(_getInstance(inMemoryPersistence),e,o);const a=(await Promise.all(s.map(async g=>{if(await g._isAvailable())return g}))).filter(g=>g);let d=a[0]||_getInstance(inMemoryPersistence);const u=_persistenceKeyName(o,e.config.apiKey,e.name);let f=null;for(const g of s)try{const b=await g._get(u);if(b){const m=UserImpl._fromJSON(e,b);g!==d&&(f=m),d=g;break}}catch{}const h=a.filter(g=>g._shouldAllowMigration);return!d._shouldAllowMigration||!h.length?new PersistenceUserManager(d,e,o):(d=h[0],f&&await d._set(u,f.toJSON()),await Promise.all(s.map(async g=>{if(g!==d)try{await g._remove(u)}catch{}})),new PersistenceUserManager(d,e,o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _getBrowserName(r){const e=r.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(_isIEMobile(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(_isFirefox(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(_isBlackBerry(e))return"Blackberry";if(_isWebOS(e))return"Webos";if(_isSafari(e))return"Safari";if((e.includes("chrome/")||_isChromeIOS(e))&&!e.includes("edge/"))return"Chrome";if(_isAndroid(e))return"Android";{const s=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,o=r.match(s);if((o==null?void 0:o.length)===2)return o[1]}return"Other"}function _isFirefox(r=getUA()){return/firefox\//i.test(r)}function _isSafari(r=getUA()){const e=r.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function _isChromeIOS(r=getUA()){return/crios\//i.test(r)}function _isIEMobile(r=getUA()){return/iemobile/i.test(r)}function _isAndroid(r=getUA()){return/android/i.test(r)}function _isBlackBerry(r=getUA()){return/blackberry/i.test(r)}function _isWebOS(r=getUA()){return/webos/i.test(r)}function _isIOS(r=getUA()){return/iphone|ipad|ipod/i.test(r)}function _isIOSStandalone(r=getUA()){var e;return _isIOS(r)&&!!((e=window.navigator)===null||e===void 0?void 0:e.standalone)}function _isIE10(){return isIE()&&document.documentMode===10}function _isMobileBrowser(r=getUA()){return _isIOS(r)||_isAndroid(r)||_isWebOS(r)||_isBlackBerry(r)||/windows phone/i.test(r)||_isIEMobile(r)}function _isIframe(){try{return!!(window&&window!==window.top)}catch{return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _getClientVersion(r,e=[]){let s;switch(r){case"Browser":s=_getBrowserName(getUA());break;case"Worker":s=`${_getBrowserName(getUA())}-${r}`;break;default:s=r}const o=e.length?e.join(","):"FirebaseCore-web";return`${s}/JsCore/${SDK_VERSION}/${o}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AuthImpl{constructor(e,s){this.app=e,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Subscription(this),this.idTokenSubscription=new Subscription(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=_DEFAULT_AUTH_ERROR_FACTORY,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,s){return s&&(this._popupRedirectResolver=_getInstance(s)),this._initializationPromise=this.queue(async()=>{var o,a;if(!this._deleted&&(this.persistenceManager=await PersistenceUserManager.create(this,e),!this._deleted)){if((o=this._popupRedirectResolver)===null||o===void 0?void 0:o._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(s),this.lastNotifiedUid=((a=this.currentUser)===null||a===void 0?void 0:a.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e)}}async initializeCurrentUser(e){var s;let o=await this.assertedPersistence.getCurrentUser();if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId,d=o==null?void 0:o._redirectEventId,u=await this.tryRedirectSignIn(e);(!a||a===d)&&(u==null?void 0:u.user)&&(o=u.user)}return o?o._redirectEventId?(_assert(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===o._redirectEventId?this.directlySetCurrentUser(o):this.reloadAndSetCurrentUserOrClear(o)):this.reloadAndSetCurrentUserOrClear(o):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let s=null;try{s=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return s}async reloadAndSetCurrentUserOrClear(e){try{await _reloadWithoutSaving(e)}catch(s){if(s.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=_getUserLanguage()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const s=e?getModularInstance(e):null;return s&&_assert(s.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(s&&s._clone(this))}async _updateCurrentUser(e){if(!this._deleted)return e&&_assert(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(_getInstance(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new ErrorFactory("auth","Firebase",e())}onAuthStateChanged(e,s,o){return this.registerStateListener(this.authStateSubscription,e,s,o)}onIdTokenChanged(e,s,o){return this.registerStateListener(this.idTokenSubscription,e,s,o)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,s){const o=await this.getOrInitRedirectPersistenceManager(s);return e===null?o.removeCurrentUser():o.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const s=e&&_getInstance(e)||this._popupRedirectResolver;_assert(s,this,"argument-error"),this.redirectPersistenceManager=await PersistenceUserManager.create(this,[_getInstance(s._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var s,o;return this._isInitialized&&await this.queue(async()=>{}),((s=this._currentUser)===null||s===void 0?void 0:s._redirectEventId)===e?this._currentUser:((o=this.redirectUser)===null||o===void 0?void 0:o._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const o=(s=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&s!==void 0?s:null;this.lastNotifiedUid!==o&&(this.lastNotifiedUid=o,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,s,o,a){if(this._deleted)return()=>{};const d=typeof s=="function"?s:s.next.bind(s),u=this._isInitialized?Promise.resolve():this._initializationPromise;return _assert(u,this,"internal-error"),u.then(()=>d(this.currentUser)),typeof s=="function"?e.addObserver(s,o,a):e.addObserver(s)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&(this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh()),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return _assert(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=_getClientVersion(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={["X-Client-Version"]:this.clientVersion};return this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId),e}}function _castAuth(r){return getModularInstance(r)}class Subscription{constructor(e){this.auth=e,this.observer=null,this.addObserver=createSubscribe(s=>this.observer=s)}get next(){return _assert(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AuthCredential{constructor(e,s){this.providerId=e,this.signInMethod=s}toJSON(){return debugFail("not implemented")}_getIdTokenResponse(e){return debugFail("not implemented")}_linkToIdToken(e,s){return debugFail("not implemented")}_getReauthenticationResolver(e){return debugFail("not implemented")}}async function updateEmailPassword(r,e){return _performApiRequest(r,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function signInWithPassword(r,e){return _performSignInRequest(r,"POST","/v1/accounts:signInWithPassword",_addTidIfNecessary(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function signInWithEmailLink$1(r,e){return _performSignInRequest(r,"POST","/v1/accounts:signInWithEmailLink",_addTidIfNecessary(r,e))}async function signInWithEmailLinkForLinking(r,e){return _performSignInRequest(r,"POST","/v1/accounts:signInWithEmailLink",_addTidIfNecessary(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EmailAuthCredential extends AuthCredential{constructor(e,s,o,a=null){super("password",o);this._email=e,this._password=s,this._tenantId=a}static _fromEmailAndPassword(e,s){return new EmailAuthCredential(e,s,"password")}static _fromEmailAndCode(e,s,o=null){return new EmailAuthCredential(e,s,"emailLink",o)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const s=typeof e=="string"?JSON.parse(e):e;if((s==null?void 0:s.email)&&(s==null?void 0:s.password)){if(s.signInMethod==="password")return this._fromEmailAndPassword(s.email,s.password);if(s.signInMethod==="emailLink")return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return signInWithPassword(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return signInWithEmailLink$1(e,{email:this._email,oobCode:this._password});default:_fail(e,"internal-error")}}async _linkToIdToken(e,s){switch(this.signInMethod){case"password":return updateEmailPassword(e,{idToken:s,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return signInWithEmailLinkForLinking(e,{idToken:s,email:this._email,oobCode:this._password});default:_fail(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function signInWithIdp(r,e){return _performSignInRequest(r,"POST","/v1/accounts:signInWithIdp",_addTidIfNecessary(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IDP_REQUEST_URI$1="http://localhost";class OAuthCredential extends AuthCredential{constructor(){super(...arguments);this.pendingToken=null}static _fromParams(e){const s=new OAuthCredential(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(s.idToken=e.idToken),e.accessToken&&(s.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(s.nonce=e.nonce),e.pendingToken&&(s.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(s.accessToken=e.oauthToken,s.secret=e.oauthTokenSecret):_fail("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const s=typeof e=="string"?JSON.parse(e):e,{providerId:o,signInMethod:a}=s,d=__rest(s,["providerId","signInMethod"]);if(!o||!a)return null;const u=new OAuthCredential(o,a);return u.idToken=d.idToken||void 0,u.accessToken=d.accessToken||void 0,u.secret=d.secret,u.nonce=d.nonce,u.pendingToken=d.pendingToken||null,u}_getIdTokenResponse(e){const s=this.buildRequest();return signInWithIdp(e,s)}_linkToIdToken(e,s){const o=this.buildRequest();return o.idToken=s,signInWithIdp(e,o)}_getReauthenticationResolver(e){const s=this.buildRequest();return s.autoCreate=!1,signInWithIdp(e,s)}buildRequest(){const e={requestUri:IDP_REQUEST_URI$1,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),e.postBody=querystring(s)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function parseMode(r){switch(r){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function parseDeepLink(r){const e=querystringDecode(extractQuerystring(r)).link,s=e?querystringDecode(extractQuerystring(e)).deep_link_id:null,o=querystringDecode(extractQuerystring(r)).deep_link_id;return(o?querystringDecode(extractQuerystring(o)).link:null)||o||s||e||r}class ActionCodeURL{constructor(e){var s,o,a,d,u,f;const h=querystringDecode(extractQuerystring(e)),g=(s=h.apiKey)!==null&&s!==void 0?s:null,b=(o=h.oobCode)!==null&&o!==void 0?o:null,m=parseMode((a=h.mode)!==null&&a!==void 0?a:null);_assert(g&&b&&m,"argument-error"),this.apiKey=g,this.operation=m,this.code=b,this.continueUrl=(d=h.continueUrl)!==null&&d!==void 0?d:null,this.languageCode=(u=h.languageCode)!==null&&u!==void 0?u:null,this.tenantId=(f=h.tenantId)!==null&&f!==void 0?f:null}static parseLink(e){const s=parseDeepLink(e);try{return new ActionCodeURL(s)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EmailAuthProvider{constructor(){this.providerId=EmailAuthProvider.PROVIDER_ID}static credential(e,s){return EmailAuthCredential._fromEmailAndPassword(e,s)}static credentialWithLink(e,s){const o=ActionCodeURL.parseLink(s);return _assert(o,"argument-error"),EmailAuthCredential._fromEmailAndCode(e,o.code,o.tenantId)}}EmailAuthProvider.PROVIDER_ID="password";EmailAuthProvider.EMAIL_PASSWORD_SIGN_IN_METHOD="password";EmailAuthProvider.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FederatedAuthProvider{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BaseOAuthProvider extends FederatedAuthProvider{constructor(){super(...arguments);this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FacebookAuthProvider extends BaseOAuthProvider{constructor(){super("facebook.com")}static credential(e){return OAuthCredential._fromParams({providerId:FacebookAuthProvider.PROVIDER_ID,signInMethod:FacebookAuthProvider.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return FacebookAuthProvider.credentialFromTaggedObject(e)}static credentialFromError(e){return FacebookAuthProvider.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return FacebookAuthProvider.credential(e.oauthAccessToken)}catch{return null}}}FacebookAuthProvider.FACEBOOK_SIGN_IN_METHOD="facebook.com";FacebookAuthProvider.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GoogleAuthProvider extends BaseOAuthProvider{constructor(){super("google.com");this.addScope("profile")}static credential(e,s){return OAuthCredential._fromParams({providerId:GoogleAuthProvider.PROVIDER_ID,signInMethod:GoogleAuthProvider.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:s})}static credentialFromResult(e){return GoogleAuthProvider.credentialFromTaggedObject(e)}static credentialFromError(e){return GoogleAuthProvider.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:s,oauthAccessToken:o}=e;if(!s&&!o)return null;try{return GoogleAuthProvider.credential(s,o)}catch{return null}}}GoogleAuthProvider.GOOGLE_SIGN_IN_METHOD="google.com";GoogleAuthProvider.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GithubAuthProvider extends BaseOAuthProvider{constructor(){super("github.com")}static credential(e){return OAuthCredential._fromParams({providerId:GithubAuthProvider.PROVIDER_ID,signInMethod:GithubAuthProvider.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return GithubAuthProvider.credentialFromTaggedObject(e)}static credentialFromError(e){return GithubAuthProvider.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return GithubAuthProvider.credential(e.oauthAccessToken)}catch{return null}}}GithubAuthProvider.GITHUB_SIGN_IN_METHOD="github.com";GithubAuthProvider.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TwitterAuthProvider extends BaseOAuthProvider{constructor(){super("twitter.com")}static credential(e,s){return OAuthCredential._fromParams({providerId:TwitterAuthProvider.PROVIDER_ID,signInMethod:TwitterAuthProvider.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:s})}static credentialFromResult(e){return TwitterAuthProvider.credentialFromTaggedObject(e)}static credentialFromError(e){return TwitterAuthProvider.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:s,oauthTokenSecret:o}=e;if(!s||!o)return null;try{return TwitterAuthProvider.credential(s,o)}catch{return null}}}TwitterAuthProvider.TWITTER_SIGN_IN_METHOD="twitter.com";TwitterAuthProvider.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function signUp(r,e){return _performSignInRequest(r,"POST","/v1/accounts:signUp",_addTidIfNecessary(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UserCredentialImpl{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,s,o,a=!1){const d=await UserImpl._fromIdTokenResponse(e,o,a),u=providerIdForResponse(o);return new UserCredentialImpl({user:d,providerId:u,_tokenResponse:o,operationType:s})}static async _forOperation(e,s,o){await e._updateTokensIfNecessary(o,!0);const a=providerIdForResponse(o);return new UserCredentialImpl({user:e,providerId:a,_tokenResponse:o,operationType:s})}}function providerIdForResponse(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MultiFactorError extends FirebaseError{constructor(e,s,o,a){var d;super(s.code,s.message);this.operationType=o,this.user=a,Object.setPrototypeOf(this,MultiFactorError.prototype),this.customData={appName:e.name,tenantId:(d=e.tenantId)!==null&&d!==void 0?d:void 0,_serverResponse:s.customData._serverResponse,operationType:o}}static _fromErrorAndOperation(e,s,o,a){return new MultiFactorError(e,s,o,a)}}function _processCredentialSavingMfaContextIfNecessary(r,e,s,o){return(e==="reauthenticate"?s._getReauthenticationResolver(r):s._getIdTokenResponse(r)).catch(d=>{throw d.code==="auth/multi-factor-auth-required"?MultiFactorError._fromErrorAndOperation(r,d,e,o):d})}async function _link$1(r,e,s=!1){const o=await _logoutIfInvalidated(r,e._linkToIdToken(r.auth,await r.getIdToken()),s);return UserCredentialImpl._forOperation(r,"link",o)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _reauthenticate(r,e,s=!1){const{auth:o}=r,a="reauthenticate";try{const d=await _logoutIfInvalidated(r,_processCredentialSavingMfaContextIfNecessary(o,a,e,r),s);_assert(d.idToken,o,"internal-error");const u=_parseToken(d.idToken);_assert(u,o,"internal-error");const{sub:f}=u;return _assert(r.uid===f,o,"user-mismatch"),UserCredentialImpl._forOperation(r,a,d)}catch(d){throw(d==null?void 0:d.code)==="auth/user-not-found"&&_fail(o,"user-mismatch"),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _signInWithCredential(r,e,s=!1){const o="signIn",a=await _processCredentialSavingMfaContextIfNecessary(r,o,e),d=await UserCredentialImpl._fromIdTokenResponse(r,o,a);return s||await r._updateCurrentUser(d.user),d}async function signInWithCredential(r,e){return _signInWithCredential(_castAuth(r),e)}async function createUserWithEmailAndPassword(r,e,s){const o=_castAuth(r),a=await signUp(o,{returnSecureToken:!0,email:e,password:s}),d=await UserCredentialImpl._fromIdTokenResponse(o,"signIn",a);return await o._updateCurrentUser(d.user),d}function signInWithEmailAndPassword(r,e,s){return signInWithCredential(getModularInstance(r),EmailAuthProvider.credential(e,s))}function onAuthStateChanged(r,e,s,o){return getModularInstance(r).onAuthStateChanged(e,s,o)}function signOut(r){return getModularInstance(r).signOut()}const STORAGE_AVAILABLE_KEY="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BrowserPersistenceClass{constructor(e,s){this.storageRetriever=e,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(STORAGE_AVAILABLE_KEY,"1"),this.storage.removeItem(STORAGE_AVAILABLE_KEY),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,s){return this.storage.setItem(e,JSON.stringify(s)),Promise.resolve()}_get(e){const s=this.storage.getItem(e);return Promise.resolve(s?JSON.parse(s):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _iframeCannotSyncWebStorage(){const r=getUA();return _isSafari(r)||_isIOS(r)}const _POLLING_INTERVAL_MS$1=1e3,IE10_LOCAL_STORAGE_SYNC_DELAY=10;class BrowserLocalPersistence extends BrowserPersistenceClass{constructor(){super(()=>window.localStorage,"LOCAL");this.boundEventHandler=(e,s)=>this.onStorageEvent(e,s),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=_iframeCannotSyncWebStorage()&&_isIframe(),this.fallbackToPolling=_isMobileBrowser(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const s of Object.keys(this.listeners)){const o=this.storage.getItem(s),a=this.localCache[s];o!==a&&e(s,a,o)}}onStorageEvent(e,s=!1){if(!e.key){this.forAllChangedKeys((u,f,h)=>{this.notifyListeners(u,h)});return}const o=e.key;if(s?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const u=this.storage.getItem(o);if(e.newValue!==u)e.newValue!==null?this.storage.setItem(o,e.newValue):this.storage.removeItem(o);else if(this.localCache[o]===e.newValue&&!s)return}const a=()=>{const u=this.storage.getItem(o);!s&&this.localCache[o]===u||this.notifyListeners(o,u)},d=this.storage.getItem(o);_isIE10()&&d!==e.newValue&&e.newValue!==e.oldValue?setTimeout(a,IE10_LOCAL_STORAGE_SYNC_DELAY):a()}notifyListeners(e,s){this.localCache[e]=s;const o=this.listeners[e];if(o)for(const a of Array.from(o))a(s&&JSON.parse(s))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,s,o)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:s,newValue:o}),!0)})},_POLLING_INTERVAL_MS$1)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,s){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(s)}_removeListener(e,s){this.listeners[e]&&(this.listeners[e].delete(s),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,s){await super._set(e,s),this.localCache[e]=JSON.stringify(s)}async _get(e){const s=await super._get(e);return this.localCache[e]=JSON.stringify(s),s}async _remove(e){await super._remove(e),delete this.localCache[e]}}BrowserLocalPersistence.type="LOCAL";const browserLocalPersistence=BrowserLocalPersistence;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BrowserSessionPersistence extends BrowserPersistenceClass{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,s){}_removeListener(e,s){}}BrowserSessionPersistence.type="SESSION";const browserSessionPersistence=BrowserSessionPersistence;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _allSettled(r){return Promise.all(r.map(async e=>{try{const s=await e;return{fulfilled:!0,value:s}}catch(s){return{fulfilled:!1,reason:s}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Receiver{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const s=this.receivers.find(a=>a.isListeningto(e));if(s)return s;const o=new Receiver(e);return this.receivers.push(o),o}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const s=e,{eventId:o,eventType:a,data:d}=s.data,u=this.handlersMap[a];if(!(u==null?void 0:u.size))return;s.ports[0].postMessage({status:"ack",eventId:o,eventType:a});const f=Array.from(u).map(async g=>g(s.origin,d)),h=await _allSettled(f);s.ports[0].postMessage({status:"done",eventId:o,eventType:a,response:h})}_subscribe(e,s){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(s)}_unsubscribe(e,s){this.handlersMap[e]&&s&&this.handlersMap[e].delete(s),(!s||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Receiver.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _generateEventId(r="",e=10){let s="";for(let o=0;o<e;o++)s+=Math.floor(Math.random()*10);return r+s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sender{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,s,o=50){const a=typeof MessageChannel!="undefined"?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let d,u;return new Promise((f,h)=>{const g=_generateEventId("",20);a.port1.start();const b=setTimeout(()=>{h(new Error("unsupported_event"))},o);u={messageChannel:a,onMessage(m){const _=m;if(_.data.eventId===g)switch(_.data.status){case"ack":clearTimeout(b),d=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(d),f(_.data.response);break;default:clearTimeout(b),clearTimeout(d),h(new Error("invalid_response"));break}}},this.handlers.add(u),a.port1.addEventListener("message",u.onMessage),this.target.postMessage({eventType:e,eventId:g,data:s},[a.port2])}).finally(()=>{u&&this.removeMessageHandler(u)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _window(){return window}function _setWindowLocation(r){_window().location.href=r}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _isWorker(){return typeof _window().WorkerGlobalScope!="undefined"&&typeof _window().importScripts=="function"}async function _getActiveServiceWorker(){if(!(navigator==null?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function _getServiceWorkerController(){var r;return((r=navigator==null?void 0:navigator.serviceWorker)===null||r===void 0?void 0:r.controller)||null}function _getWorkerGlobalScope(){return _isWorker()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DB_NAME="firebaseLocalStorageDb",DB_VERSION=1,DB_OBJECTSTORE_NAME="firebaseLocalStorage",DB_DATA_KEYPATH="fbase_key";class DBPromise{constructor(e){this.request=e}toPromise(){return new Promise((e,s)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function getObjectStore(r,e){return r.transaction([DB_OBJECTSTORE_NAME],e?"readwrite":"readonly").objectStore(DB_OBJECTSTORE_NAME)}function _deleteDatabase(){const r=indexedDB.deleteDatabase(DB_NAME);return new DBPromise(r).toPromise()}function _openDatabase(){const r=indexedDB.open(DB_NAME,DB_VERSION);return new Promise((e,s)=>{r.addEventListener("error",()=>{s(r.error)}),r.addEventListener("upgradeneeded",()=>{const o=r.result;try{o.createObjectStore(DB_OBJECTSTORE_NAME,{keyPath:DB_DATA_KEYPATH})}catch(a){s(a)}}),r.addEventListener("success",async()=>{const o=r.result;o.objectStoreNames.contains(DB_OBJECTSTORE_NAME)?e(o):(o.close(),await _deleteDatabase(),e(await _openDatabase()))})})}async function _putObject(r,e,s){const o=getObjectStore(r,!0).put({[DB_DATA_KEYPATH]:e,value:s});return new DBPromise(o).toPromise()}async function getObject(r,e){const s=getObjectStore(r,!1).get(e),o=await new DBPromise(s).toPromise();return o===void 0?null:o.value}function _deleteObject(r,e){const s=getObjectStore(r,!0).delete(e);return new DBPromise(s).toPromise()}const _POLLING_INTERVAL_MS=800,_TRANSACTION_RETRY_COUNT=3;class IndexedDBLocalPersistence{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await _openDatabase(),this.db)}async _withRetries(e){let s=0;for(;;)try{const o=await this._openDb();return await e(o)}catch(o){if(s++>_TRANSACTION_RETRY_COUNT)throw o;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return _isWorker()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Receiver._getInstance(_getWorkerGlobalScope()),this.receiver._subscribe("keyChanged",async(e,s)=>({keyProcessed:(await this._poll()).includes(s.key)})),this.receiver._subscribe("ping",async(e,s)=>["keyChanged"])}async initializeSender(){var e,s;if(this.activeServiceWorker=await _getActiveServiceWorker(),!this.activeServiceWorker)return;this.sender=new Sender(this.activeServiceWorker);const o=await this.sender._send("ping",{},800);!o||((e=o[0])===null||e===void 0?void 0:e.fulfilled)&&((s=o[0])===null||s===void 0?void 0:s.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||_getServiceWorkerController()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await _openDatabase();return await _putObject(e,STORAGE_AVAILABLE_KEY,"1"),await _deleteObject(e,STORAGE_AVAILABLE_KEY),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,s){return this._withPendingWrite(async()=>(await this._withRetries(o=>_putObject(o,e,s)),this.localCache[e]=s,this.notifyServiceWorker(e)))}async _get(e){const s=await this._withRetries(o=>getObject(o,e));return this.localCache[e]=s,s}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(s=>_deleteObject(s,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(a=>{const d=getObjectStore(a,!1).getAll();return new DBPromise(d).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const s=[],o=new Set;for(const{fbase_key:a,value:d}of e)o.add(a),JSON.stringify(this.localCache[a])!==JSON.stringify(d)&&(this.notifyListeners(a,d),s.push(a));for(const a of Object.keys(this.localCache))this.localCache[a]&&!o.has(a)&&(this.notifyListeners(a,null),s.push(a));return s}notifyListeners(e,s){this.localCache[e]=s;const o=this.listeners[e];if(o)for(const a of Array.from(o))a(s)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),_POLLING_INTERVAL_MS)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,s){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(s)}_removeListener(e,s){this.listeners[e]&&(this.listeners[e].delete(s),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}IndexedDBLocalPersistence.type="LOCAL";const indexedDBLocalPersistence=IndexedDBLocalPersistence;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getScriptParentElement(){var r,e;return(e=(r=document.getElementsByTagName("head"))===null||r===void 0?void 0:r[0])!==null&&e!==void 0?e:document}function _loadJS(r){return new Promise((e,s)=>{const o=document.createElement("script");o.setAttribute("src",r),o.onload=e,o.onerror=a=>{const d=_createError("internal-error");d.customData=a,s(d)},o.type="text/javascript",o.charset="UTF-8",getScriptParentElement().appendChild(o)})}function _generateCallbackName(r){return`__${r}${Math.floor(Math.random()*1e6)}`}new Delay(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _withDefaultResolver(r,e){return e?_getInstance(e):(_assert(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IdpCredential extends AuthCredential{constructor(e){super("custom","custom");this.params=e}_getIdTokenResponse(e){return signInWithIdp(e,this._buildIdpRequest())}_linkToIdToken(e,s){return signInWithIdp(e,this._buildIdpRequest(s))}_getReauthenticationResolver(e){return signInWithIdp(e,this._buildIdpRequest())}_buildIdpRequest(e){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(s.idToken=e),s}}function _signIn(r){return _signInWithCredential(r.auth,new IdpCredential(r),r.bypassAuthState)}function _reauth(r){const{auth:e,user:s}=r;return _assert(s,e,"internal-error"),_reauthenticate(s,new IdpCredential(r),r.bypassAuthState)}async function _link(r){const{auth:e,user:s}=r;return _assert(s,e,"internal-error"),_link$1(s,new IdpCredential(r),r.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AbstractPopupRedirectOperation{constructor(e,s,o,a,d=!1){this.auth=e,this.resolver=o,this.user=a,this.bypassAuthState=d,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){return new Promise(async(e,s)=>{this.pendingPromise={resolve:e,reject:s};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(o){this.reject(o)}})}async onAuthEvent(e){const{urlResponse:s,sessionId:o,postBody:a,tenantId:d,error:u,type:f}=e;if(u){this.reject(u);return}const h={auth:this.auth,requestUri:s,sessionId:o,tenantId:d||void 0,postBody:a||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(f)(h))}catch(g){this.reject(g)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return _signIn;case"linkViaPopup":case"linkViaRedirect":return _link;case"reauthViaPopup":case"reauthViaRedirect":return _reauth;default:_fail(this.auth,"internal-error")}}resolve(e){debugAssert(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){debugAssert(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _POLL_WINDOW_CLOSE_TIMEOUT=new Delay(2e3,1e4);class PopupOperation extends AbstractPopupRedirectOperation{constructor(e,s,o,a,d){super(e,s,a,d);this.provider=o,this.authWindow=null,this.pollId=null,PopupOperation.currentPopupAction&&PopupOperation.currentPopupAction.cancel(),PopupOperation.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return _assert(e,this.auth,"internal-error"),e}async onExecution(){debugAssert(this.filter.length===1,"Popup operations only handle one event");const e=_generateEventId();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(s=>{this.reject(s)}),this.resolver._isIframeWebStorageSupported(this.auth,s=>{s||this.reject(_createError(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(_createError(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,PopupOperation.currentPopupAction=null}pollUserCancellation(){const e=()=>{var s,o;if((o=(s=this.authWindow)===null||s===void 0?void 0:s.window)===null||o===void 0?void 0:o.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(_createError(this.auth,"popup-closed-by-user"))},2e3);return}this.pollId=window.setTimeout(e,_POLL_WINDOW_CLOSE_TIMEOUT.get())};e()}}PopupOperation.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PENDING_REDIRECT_KEY="pendingRedirect",redirectOutcomeMap=new Map;class RedirectAction extends AbstractPopupRedirectOperation{constructor(e,s,o=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,o);this.eventId=null}async execute(){let e=redirectOutcomeMap.get(this.auth._key());if(!e){try{const o=await _getAndClearPendingRedirectStatus(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(o)}catch(s){e=()=>Promise.reject(s)}redirectOutcomeMap.set(this.auth._key(),e)}return this.bypassAuthState||redirectOutcomeMap.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const s=await this.auth._redirectUserForId(e.eventId);if(s)return this.user=s,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function _getAndClearPendingRedirectStatus(r,e){const s=pendingRedirectKey(e),o=resolverPersistence(r);if(!await o._isAvailable())return!1;const a=await o._get(s)==="true";return await o._remove(s),a}function resolverPersistence(r){return _getInstance(r._redirectPersistence)}function pendingRedirectKey(r){return _persistenceKeyName(PENDING_REDIRECT_KEY,r.config.apiKey,r.name)}async function _getRedirectResult(r,e,s=!1){const o=_castAuth(r),a=_withDefaultResolver(o,e),u=await new RedirectAction(o,a,s).execute();return u&&!s&&(delete u.user._redirectEventId,await o._persistUserIfCurrent(u.user),await o._setRedirectUser(null,e)),u}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EVENT_DUPLICATION_CACHE_DURATION_MS=10*60*1e3;class AuthEventManager{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let s=!1;return this.consumers.forEach(o=>{this.isEventForConsumer(e,o)&&(s=!0,this.sendToConsumer(e,o),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!isRedirectEvent(e)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=e,s=!0)),s}sendToConsumer(e,s){var o;if(e.error&&!isNullRedirectEvent(e)){const a=((o=e.error.code)===null||o===void 0?void 0:o.split("auth/")[1])||"internal-error";s.onError(_createError(this.auth,a))}else s.onAuthEvent(e)}isEventForConsumer(e,s){const o=s.eventId===null||!!e.eventId&&e.eventId===s.eventId;return s.filter.includes(e.type)&&o}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=EVENT_DUPLICATION_CACHE_DURATION_MS&&this.cachedEventUids.clear(),this.cachedEventUids.has(eventUid(e))}saveEventToCache(e){this.cachedEventUids.add(eventUid(e)),this.lastProcessedEventTime=Date.now()}}function eventUid(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(e=>e).join("-")}function isNullRedirectEvent({type:r,error:e}){return r==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function isRedirectEvent(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return isNullRedirectEvent(r);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _getProjectConfig(r,e={}){return _performApiRequest(r,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IP_ADDRESS_REGEX=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,HTTP_REGEX=/^https?/;async function _validateOrigin(r){if(r.config.emulator)return;const{authorizedDomains:e}=await _getProjectConfig(r);for(const s of e)try{if(matchDomain(s))return}catch{}_fail(r,"unauthorized-domain")}function matchDomain(r){const e=_getCurrentUrl(),{protocol:s,hostname:o}=new URL(e);if(r.startsWith("chrome-extension://")){const u=new URL(r);return u.hostname===""&&o===""?s==="chrome-extension:"&&r.replace("chrome-extension://","")===e.replace("chrome-extension://",""):s==="chrome-extension:"&&u.hostname===o}if(!HTTP_REGEX.test(s))return!1;if(IP_ADDRESS_REGEX.test(r))return o===r;const a=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+a+"|"+a+")$","i").test(o)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NETWORK_TIMEOUT=new Delay(3e4,6e4);function resetUnloadedGapiModules(){const r=_window().___jsl;if(r==null?void 0:r.H){for(const e of Object.keys(r.H))if(r.H[e].r=r.H[e].r||[],r.H[e].L=r.H[e].L||[],r.H[e].r=[...r.H[e].L],r.CP)for(let s=0;s<r.CP.length;s++)r.CP[s]=null}}function loadGapi(r){return new Promise((e,s)=>{var o,a,d;function u(){resetUnloadedGapiModules(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{resetUnloadedGapiModules(),s(_createError(r,"network-request-failed"))},timeout:NETWORK_TIMEOUT.get()})}if((a=(o=_window().gapi)===null||o===void 0?void 0:o.iframes)===null||a===void 0?void 0:a.Iframe)e(gapi.iframes.getContext());else if((d=_window().gapi)===null||d===void 0?void 0:d.load)u();else{const f=_generateCallbackName("iframefcb");return _window()[f]=()=>{gapi.load?u():s(_createError(r,"network-request-failed"))},_loadJS(`https://apis.google.com/js/api.js?onload=${f}`).catch(h=>s(h))}}).catch(e=>{throw cachedGApiLoader=null,e})}let cachedGApiLoader=null;function _loadGapi(r){return cachedGApiLoader=cachedGApiLoader||loadGapi(r),cachedGApiLoader}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PING_TIMEOUT=new Delay(5e3,15e3),IFRAME_PATH="__/auth/iframe",EMULATED_IFRAME_PATH="emulator/auth/iframe",IFRAME_ATTRIBUTES={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},EID_FROM_APIHOST=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function getIframeUrl(r){const e=r.config;_assert(e.authDomain,r,"auth-domain-config-required");const s=e.emulator?_emulatorUrl(e,EMULATED_IFRAME_PATH):`https://${r.config.authDomain}/${IFRAME_PATH}`,o={apiKey:e.apiKey,appName:r.name,v:SDK_VERSION},a=EID_FROM_APIHOST.get(r.config.apiHost);a&&(o.eid=a);const d=r._getFrameworks();return d.length&&(o.fw=d.join(",")),`${s}?${querystring(o).slice(1)}`}async function _openIframe(r){const e=await _loadGapi(r),s=_window().gapi;return _assert(s,r,"internal-error"),e.open({where:document.body,url:getIframeUrl(r),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:IFRAME_ATTRIBUTES,dontclear:!0},o=>new Promise(async(a,d)=>{await o.restyle({setHideOnLeave:!1});const u=_createError(r,"network-request-failed"),f=_window().setTimeout(()=>{d(u)},PING_TIMEOUT.get());function h(){_window().clearTimeout(f),a(o)}o.ping(h).then(h,()=>{d(u)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BASE_POPUP_OPTIONS={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},DEFAULT_WIDTH=500,DEFAULT_HEIGHT=600,TARGET_BLANK="_blank",FIREFOX_EMPTY_URL="http://localhost";class AuthPopup{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function _open(r,e,s,o=DEFAULT_WIDTH,a=DEFAULT_HEIGHT){const d=Math.max((window.screen.availHeight-a)/2,0).toString(),u=Math.max((window.screen.availWidth-o)/2,0).toString();let f="";const h=Object.assign(Object.assign({},BASE_POPUP_OPTIONS),{width:o.toString(),height:a.toString(),top:d,left:u}),g=getUA().toLowerCase();s&&(f=_isChromeIOS(g)?TARGET_BLANK:s),_isFirefox(g)&&(e=e||FIREFOX_EMPTY_URL,h.scrollbars="yes");const b=Object.entries(h).reduce((_,[Ge,ot])=>`${_}${Ge}=${ot},`,"");if(_isIOSStandalone(g)&&f!=="_self")return openAsNewWindowIOS(e||"",f),new AuthPopup(null);const m=window.open(e||"",f,b);_assert(m,r,"popup-blocked");try{m.focus()}catch{}return new AuthPopup(m)}function openAsNewWindowIOS(r,e){const s=document.createElement("a");s.href=r,s.target=e;const o=document.createEvent("MouseEvent");o.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WIDGET_PATH="__/auth/handler",EMULATOR_WIDGET_PATH="emulator/auth/handler";function _getRedirectUrl(r,e,s,o,a,d){_assert(r.config.authDomain,r,"auth-domain-config-required"),_assert(r.config.apiKey,r,"invalid-api-key");const u={apiKey:r.config.apiKey,appName:r.name,authType:s,redirectUrl:o,v:SDK_VERSION,eventId:a};if(e instanceof FederatedAuthProvider){e.setDefaultLanguage(r.languageCode),u.providerId=e.providerId||"",isEmpty(e.getCustomParameters())||(u.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,g]of Object.entries(d||{}))u[h]=g}if(e instanceof BaseOAuthProvider){const h=e.getScopes().filter(g=>g!=="");h.length>0&&(u.scopes=h.join(","))}r.tenantId&&(u.tid=r.tenantId);const f=u;for(const h of Object.keys(f))f[h]===void 0&&delete f[h];return`${getHandlerBase(r)}?${querystring(f).slice(1)}`}function getHandlerBase({config:r}){return r.emulator?_emulatorUrl(r,EMULATOR_WIDGET_PATH):`https://${r.authDomain}/${WIDGET_PATH}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WEB_STORAGE_SUPPORT_KEY="webStorageSupport";class BrowserPopupRedirectResolver{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=browserSessionPersistence,this._completeRedirectFn=_getRedirectResult}async _openPopup(e,s,o,a){var d;debugAssert((d=this.eventManagers[e._key()])===null||d===void 0?void 0:d.manager,"_initialize() not called before _openPopup()");const u=_getRedirectUrl(e,s,o,_getCurrentUrl(),a);return _open(e,u,_generateEventId())}async _openRedirect(e,s,o,a){return await this._originValidation(e),_setWindowLocation(_getRedirectUrl(e,s,o,_getCurrentUrl(),a)),new Promise(()=>{})}_initialize(e){const s=e._key();if(this.eventManagers[s]){const{manager:a,promise:d}=this.eventManagers[s];return a?Promise.resolve(a):(debugAssert(d,"If manager is not set, promise should be"),d)}const o=this.initAndGetManager(e);return this.eventManagers[s]={promise:o},o.catch(()=>{delete this.eventManagers[s]}),o}async initAndGetManager(e){const s=await _openIframe(e),o=new AuthEventManager(e);return s.register("authEvent",a=>(_assert(a==null?void 0:a.authEvent,e,"invalid-auth-event"),{status:o.onEvent(a.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:o},this.iframes[e._key()]=s,o}_isIframeWebStorageSupported(e,s){this.iframes[e._key()].send(WEB_STORAGE_SUPPORT_KEY,{type:WEB_STORAGE_SUPPORT_KEY},a=>{var d;const u=(d=a==null?void 0:a[0])===null||d===void 0?void 0:d[WEB_STORAGE_SUPPORT_KEY];u!==void 0&&s(!!u),_fail(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const s=e._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=_validateOrigin(e)),this.originValidationPromises[s]}get _shouldInitProactively(){return _isMobileBrowser()||_isSafari()||_isIOS()}}const browserPopupRedirectResolver=BrowserPopupRedirectResolver;var name$1="@firebase/auth",version$1="0.19.4";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AuthInterop{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const s=this.auth.onIdTokenChanged(o=>{var a;e(((a=o)===null||a===void 0?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,s),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const s=this.internalListeners.get(e);!s||(this.internalListeners.delete(e),s(),this.updateProactiveRefresh())}assertAuthConfigured(){_assert(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getVersionForPlatform(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function registerAuth(r){_registerComponent(new Component("auth",(e,{options:s})=>{const o=e.getProvider("app").getImmediate(),{apiKey:a,authDomain:d}=o.options;return(u=>{_assert(a&&!a.includes(":"),"invalid-api-key",{appName:u.name}),_assert(!(d==null?void 0:d.includes(":")),"argument-error",{appName:u.name});const f={apiKey:a,authDomain:d,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:_getClientVersion(r)},h=new AuthImpl(u,f);return _initializeAuthInstance(h,s),h})(o)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,s,o)=>{e.getProvider("auth-internal").initialize()})),_registerComponent(new Component("auth-internal",e=>{const s=_castAuth(e.getProvider("auth").getImmediate());return(o=>new AuthInterop(o))(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),registerVersion(name$1,version$1,getVersionForPlatform(r)),registerVersion(name$1,version$1,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getAuth(r=getApp()){const e=_getProvider(r,"auth");return e.isInitialized()?e.getImmediate():initializeAuth(r,{popupRedirectResolver:browserPopupRedirectResolver,persistence:[indexedDBLocalPersistence,browserLocalPersistence,browserSessionPersistence]})}registerAuth("Browser");var commonjsGlobal=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},k$1,goog=goog||{},l=commonjsGlobal||self;function aa$1(){}function ba(r){var e=typeof r;return e=e!="object"?e:r?Array.isArray(r)?"array":e:"null",e=="array"||e=="object"&&typeof r.length=="number"}function p(r){var e=typeof r;return e=="object"&&r!=null||e=="function"}function da$1(r){return Object.prototype.hasOwnProperty.call(r,ea$1)&&r[ea$1]||(r[ea$1]=++fa$1)}var ea$1="closure_uid_"+(1e9*Math.random()>>>0),fa$1=0;function ha$1(r,e,s){return r.call.apply(r.bind,arguments)}function ia$1(r,e,s){if(!r)throw Error();if(2<arguments.length){var o=Array.prototype.slice.call(arguments,2);return function(){var a=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(a,o),r.apply(e,a)}}return function(){return r.apply(e,arguments)}}function q$1(r,e,s){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?q$1=ha$1:q$1=ia$1,q$1.apply(null,arguments)}function ja(r,e){var s=Array.prototype.slice.call(arguments,1);return function(){var o=s.slice();return o.push.apply(o,arguments),r.apply(this,o)}}function t(r,e){function s(){}s.prototype=e.prototype,r.Z=e.prototype,r.prototype=new s,r.prototype.constructor=r,r.Vb=function(o,a,d){for(var u=Array(arguments.length-2),f=2;f<arguments.length;f++)u[f-2]=arguments[f];return e.prototype[a].apply(o,u)}}function v(){this.s=this.s,this.o=this.o}var ka=0,la$1={};v.prototype.s=!1;v.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),ka!=0)){var r=da$1(this);delete la$1[r]}};v.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const ma$1=Array.prototype.indexOf?function(r,e){return Array.prototype.indexOf.call(r,e,void 0)}:function(r,e){if(typeof r=="string")return typeof e!="string"||e.length!=1?-1:r.indexOf(e,0);for(let s=0;s<r.length;s++)if(s in r&&r[s]===e)return s;return-1},na$1=Array.prototype.forEach?function(r,e,s){Array.prototype.forEach.call(r,e,s)}:function(r,e,s){const o=r.length,a=typeof r=="string"?r.split(""):r;for(let d=0;d<o;d++)d in a&&e.call(s,a[d],d,r)};function oa$1(r){e:{var e=pa$1;const s=r.length,o=typeof r=="string"?r.split(""):r;for(let a=0;a<s;a++)if(a in o&&e.call(void 0,o[a],a,r)){e=a;break e}e=-1}return 0>e?null:typeof r=="string"?r.charAt(e):r[e]}function qa$1(r){return Array.prototype.concat.apply([],arguments)}function ra$1(r){const e=r.length;if(0<e){const s=Array(e);for(let o=0;o<e;o++)s[o]=r[o];return s}return[]}function sa$1(r){return/^[\s\xa0]*$/.test(r)}var ta$1=String.prototype.trim?function(r){return r.trim()}:function(r){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(r)[1]};function w(r,e){return r.indexOf(e)!=-1}function ua$1(r,e){return r<e?-1:r>e?1:0}var x;e:{var va=l.navigator;if(va){var wa=va.userAgent;if(wa){x=wa;break e}}x=""}function xa$1(r,e,s){for(const o in r)e.call(s,r[o],o,r)}function ya$1(r){const e={};for(const s in r)e[s]=r[s];return e}var za$1="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Aa$1(r,e){let s,o;for(let a=1;a<arguments.length;a++){o=arguments[a];for(s in o)r[s]=o[s];for(let d=0;d<za$1.length;d++)s=za$1[d],Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])}}function Ca(r){return Ca[" "](r),r}Ca[" "]=aa$1;function Fa(r){var e=Ga$1;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=r(9)}var Ha$1=w(x,"Opera"),y=w(x,"Trident")||w(x,"MSIE"),Ia$1=w(x,"Edge"),Ja$1=Ia$1||y,Ka=w(x,"Gecko")&&!(w(x.toLowerCase(),"webkit")&&!w(x,"Edge"))&&!(w(x,"Trident")||w(x,"MSIE"))&&!w(x,"Edge"),La=w(x.toLowerCase(),"webkit")&&!w(x,"Edge");function Ma(){var r=l.document;return r?r.documentMode:void 0}var Na;e:{var Oa$1="",Pa=function(){var r=x;if(Ka)return/rv:([^\);]+)(\)|;)/.exec(r);if(Ia$1)return/Edge\/([\d\.]+)/.exec(r);if(y)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(r);if(La)return/WebKit\/(\S+)/.exec(r);if(Ha$1)return/(?:Version)[ \/]?(\S+)/.exec(r)}();if(Pa&&(Oa$1=Pa?Pa[1]:""),y){var Qa=Ma();if(Qa!=null&&Qa>parseFloat(Oa$1)){Na=String(Qa);break e}}Na=Oa$1}var Ga$1={};function Ra$1(){return Fa(function(){let r=0;const e=ta$1(String(Na)).split("."),s=ta$1("9").split("."),o=Math.max(e.length,s.length);for(let u=0;r==0&&u<o;u++){var a=e[u]||"",d=s[u]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],d=/(\d*)(\D*)(.*)/.exec(d)||["","","",""],a[0].length==0&&d[0].length==0)break;r=ua$1(a[1].length==0?0:parseInt(a[1],10),d[1].length==0?0:parseInt(d[1],10))||ua$1(a[2].length==0,d[2].length==0)||ua$1(a[2],d[2]),a=a[3],d=d[3]}while(r==0)}return 0<=r})}var Sa;if(l.document&&y){var Ta$1=Ma();Sa=Ta$1||parseInt(Na,10)||void 0}else Sa=void 0;var Ua=Sa,Va=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var r=!1,e=Object.defineProperty({},"passive",{get:function(){r=!0}});try{l.addEventListener("test",aa$1,e),l.removeEventListener("test",aa$1,e)}catch{}return r}();function z(r,e){this.type=r,this.g=this.target=e,this.defaultPrevented=!1}z.prototype.h=function(){this.defaultPrevented=!0};function A(r,e){if(z.call(this,r?r.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,r){var s=this.type=r.type,o=r.changedTouches&&r.changedTouches.length?r.changedTouches[0]:null;if(this.target=r.target||r.srcElement,this.g=e,e=r.relatedTarget){if(Ka){e:{try{Ca(e.nodeName);var a=!0;break e}catch{}a=!1}a||(e=null)}}else s=="mouseover"?e=r.fromElement:s=="mouseout"&&(e=r.toElement);this.relatedTarget=e,o?(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0):(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0),this.button=r.button,this.key=r.key||"",this.ctrlKey=r.ctrlKey,this.altKey=r.altKey,this.shiftKey=r.shiftKey,this.metaKey=r.metaKey,this.pointerId=r.pointerId||0,this.pointerType=typeof r.pointerType=="string"?r.pointerType:Wa$1[r.pointerType]||"",this.state=r.state,this.i=r,r.defaultPrevented&&A.Z.h.call(this)}}t(A,z);var Wa$1={2:"touch",3:"pen",4:"mouse"};A.prototype.h=function(){A.Z.h.call(this);var r=this.i;r.preventDefault?r.preventDefault():r.returnValue=!1};var B$1="closure_listenable_"+(1e6*Math.random()|0),Xa=0;function Ya(r,e,s,o,a){this.listener=r,this.proxy=null,this.src=e,this.type=s,this.capture=!!o,this.ia=a,this.key=++Xa,this.ca=this.fa=!1}function Za(r){r.ca=!0,r.listener=null,r.proxy=null,r.src=null,r.ia=null}function $a$1(r){this.src=r,this.g={},this.h=0}$a$1.prototype.add=function(r,e,s,o,a){var d=r.toString();r=this.g[d],r||(r=this.g[d]=[],this.h++);var u=ab(r,e,o,a);return-1<u?(e=r[u],s||(e.fa=!1)):(e=new Ya(e,this.src,d,!!o,a),e.fa=s,r.push(e)),e};function bb(r,e){var s=e.type;if(s in r.g){var o=r.g[s],a=ma$1(o,e),d;(d=0<=a)&&Array.prototype.splice.call(o,a,1),d&&(Za(e),r.g[s].length==0&&(delete r.g[s],r.h--))}}function ab(r,e,s,o){for(var a=0;a<r.length;++a){var d=r[a];if(!d.ca&&d.listener==e&&d.capture==!!s&&d.ia==o)return a}return-1}var cb="closure_lm_"+(1e6*Math.random()|0),db={};function fb(r,e,s,o,a){if(o&&o.once)return gb(r,e,s,o,a);if(Array.isArray(e)){for(var d=0;d<e.length;d++)fb(r,e[d],s,o,a);return null}return s=hb(s),r&&r[B$1]?r.N(e,s,p(o)?!!o.capture:!!o,a):ib(r,e,s,!1,o,a)}function ib(r,e,s,o,a,d){if(!e)throw Error("Invalid event type");var u=p(a)?!!a.capture:!!a,f=jb(r);if(f||(r[cb]=f=new $a$1(r)),s=f.add(e,s,o,u,d),s.proxy)return s;if(o=kb(),s.proxy=o,o.src=r,o.listener=s,r.addEventListener)Va||(a=u),a===void 0&&(a=!1),r.addEventListener(e.toString(),o,a);else if(r.attachEvent)r.attachEvent(lb(e.toString()),o);else if(r.addListener&&r.removeListener)r.addListener(o);else throw Error("addEventListener and attachEvent are unavailable.");return s}function kb(){function r(s){return e.call(r.src,r.listener,s)}var e=mb;return r}function gb(r,e,s,o,a){if(Array.isArray(e)){for(var d=0;d<e.length;d++)gb(r,e[d],s,o,a);return null}return s=hb(s),r&&r[B$1]?r.O(e,s,p(o)?!!o.capture:!!o,a):ib(r,e,s,!0,o,a)}function nb(r,e,s,o,a){if(Array.isArray(e))for(var d=0;d<e.length;d++)nb(r,e[d],s,o,a);else o=p(o)?!!o.capture:!!o,s=hb(s),r&&r[B$1]?(r=r.i,e=String(e).toString(),e in r.g&&(d=r.g[e],s=ab(d,s,o,a),-1<s&&(Za(d[s]),Array.prototype.splice.call(d,s,1),d.length==0&&(delete r.g[e],r.h--)))):r&&(r=jb(r))&&(e=r.g[e.toString()],r=-1,e&&(r=ab(e,s,o,a)),(s=-1<r?e[r]:null)&&ob(s))}function ob(r){if(typeof r!="number"&&r&&!r.ca){var e=r.src;if(e&&e[B$1])bb(e.i,r);else{var s=r.type,o=r.proxy;e.removeEventListener?e.removeEventListener(s,o,r.capture):e.detachEvent?e.detachEvent(lb(s),o):e.addListener&&e.removeListener&&e.removeListener(o),(s=jb(e))?(bb(s,r),s.h==0&&(s.src=null,e[cb]=null)):Za(r)}}}function lb(r){return r in db?db[r]:db[r]="on"+r}function mb(r,e){if(r.ca)r=!0;else{e=new A(e,this);var s=r.listener,o=r.ia||r.src;r.fa&&ob(r),r=s.call(o,e)}return r}function jb(r){return r=r[cb],r instanceof $a$1?r:null}var pb="__closure_events_fn_"+(1e9*Math.random()>>>0);function hb(r){return typeof r=="function"?r:(r[pb]||(r[pb]=function(e){return r.handleEvent(e)}),r[pb])}function C$1(){v.call(this),this.i=new $a$1(this),this.P=this,this.I=null}t(C$1,v);C$1.prototype[B$1]=!0;C$1.prototype.removeEventListener=function(r,e,s,o){nb(this,r,e,s,o)};function D$1(r,e){var s,o=r.I;if(o)for(s=[];o;o=o.I)s.push(o);if(r=r.P,o=e.type||e,typeof e=="string")e=new z(e,r);else if(e instanceof z)e.target=e.target||r;else{var a=e;e=new z(o,r),Aa$1(e,a)}if(a=!0,s)for(var d=s.length-1;0<=d;d--){var u=e.g=s[d];a=qb(u,o,!0,e)&&a}if(u=e.g=r,a=qb(u,o,!0,e)&&a,a=qb(u,o,!1,e)&&a,s)for(d=0;d<s.length;d++)u=e.g=s[d],a=qb(u,o,!1,e)&&a}C$1.prototype.M=function(){if(C$1.Z.M.call(this),this.i){var r=this.i,e;for(e in r.g){for(var s=r.g[e],o=0;o<s.length;o++)Za(s[o]);delete r.g[e],r.h--}}this.I=null};C$1.prototype.N=function(r,e,s,o){return this.i.add(String(r),e,!1,s,o)};C$1.prototype.O=function(r,e,s,o){return this.i.add(String(r),e,!0,s,o)};function qb(r,e,s,o){if(e=r.i.g[String(e)],!e)return!0;e=e.concat();for(var a=!0,d=0;d<e.length;++d){var u=e[d];if(u&&!u.ca&&u.capture==s){var f=u.listener,h=u.ia||u.src;u.fa&&bb(r.i,u),a=f.call(h,o)!==!1&&a}}return a&&!o.defaultPrevented}var rb=l.JSON.stringify;function sb(){var r=tb;let e=null;return r.g&&(e=r.g,r.g=r.g.next,r.g||(r.h=null),e.next=null),e}class ub{constructor(){this.h=this.g=null}add(e,s){const o=vb.get();o.set(e,s),this.h?this.h.next=o:this.g=o,this.h=o}}var vb=new class{constructor(r,e){this.i=r,this.j=e,this.h=0,this.g=null}get(){let r;return 0<this.h?(this.h--,r=this.g,this.g=r.next,r.next=null):r=this.i(),r}}(()=>new wb,r=>r.reset());class wb{constructor(){this.next=this.g=this.h=null}set(e,s){this.h=e,this.g=s,this.next=null}reset(){this.next=this.g=this.h=null}}function yb(r){l.setTimeout(()=>{throw r},0)}function zb(r,e){Ab||Bb(),Cb||(Ab(),Cb=!0),tb.add(r,e)}var Ab;function Bb(){var r=l.Promise.resolve(void 0);Ab=function(){r.then(Db)}}var Cb=!1,tb=new ub;function Db(){for(var r;r=sb();){try{r.h.call(r.g)}catch(s){yb(s)}var e=vb;e.j(r),100>e.h&&(e.h++,r.next=e.g,e.g=r)}Cb=!1}function Eb(r,e){C$1.call(this),this.h=r||1,this.g=e||l,this.j=q$1(this.kb,this),this.l=Date.now()}t(Eb,C$1);k$1=Eb.prototype;k$1.da=!1;k$1.S=null;k$1.kb=function(){if(this.da){var r=Date.now()-this.l;0<r&&r<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-r):(this.S&&(this.g.clearTimeout(this.S),this.S=null),D$1(this,"tick"),this.da&&(Fb(this),this.start()))}};k$1.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Fb(r){r.da=!1,r.S&&(r.g.clearTimeout(r.S),r.S=null)}k$1.M=function(){Eb.Z.M.call(this),Fb(this),delete this.g};function Gb(r,e,s){if(typeof r=="function")s&&(r=q$1(r,s));else if(r&&typeof r.handleEvent=="function")r=q$1(r.handleEvent,r);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:l.setTimeout(r,e||0)}function Hb(r){r.g=Gb(()=>{r.g=null,r.i&&(r.i=!1,Hb(r))},r.j);const e=r.h;r.h=null,r.m.apply(null,e)}class Ib extends v{constructor(e,s){super();this.m=e,this.j=s,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Hb(this)}M(){super.M(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function E(r){v.call(this),this.h=r,this.g={}}t(E,v);var Jb=[];function Kb(r,e,s,o){Array.isArray(s)||(s&&(Jb[0]=s.toString()),s=Jb);for(var a=0;a<s.length;a++){var d=fb(e,s[a],o||r.handleEvent,!1,r.h||r);if(!d)break;r.g[d.key]=d}}function Lb(r){xa$1(r.g,function(e,s){this.g.hasOwnProperty(s)&&ob(e)},r),r.g={}}E.prototype.M=function(){E.Z.M.call(this),Lb(this)};E.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Mb(){this.g=!0}Mb.prototype.Aa=function(){this.g=!1};function Nb(r,e,s,o,a,d){r.info(function(){if(r.g)if(d)for(var u="",f=d.split("&"),h=0;h<f.length;h++){var g=f[h].split("=");if(1<g.length){var b=g[0];g=g[1];var m=b.split("_");u=2<=m.length&&m[1]=="type"?u+(b+"="+g+"&"):u+(b+"=redacted&")}}else u=null;else u=d;return"XMLHTTP REQ ("+o+") [attempt "+a+"]: "+e+`
`+s+`
`+u})}function Ob(r,e,s,o,a,d,u){r.info(function(){return"XMLHTTP RESP ("+o+") [ attempt "+a+"]: "+e+`
`+s+`
`+d+" "+u})}function F$1(r,e,s,o){r.info(function(){return"XMLHTTP TEXT ("+e+"): "+Pb(r,s)+(o?" "+o:"")})}function Qb(r,e){r.info(function(){return"TIMEOUT: "+e})}Mb.prototype.info=function(){};function Pb(r,e){if(!r.g)return e;if(!e)return null;try{var s=JSON.parse(e);if(s){for(r=0;r<s.length;r++)if(Array.isArray(s[r])){var o=s[r];if(!(2>o.length)){var a=o[1];if(Array.isArray(a)&&!(1>a.length)){var d=a[0];if(d!="noop"&&d!="stop"&&d!="close")for(var u=1;u<a.length;u++)a[u]=""}}}}return rb(s)}catch{return e}}var H$1={},Rb=null;function Sb(){return Rb=Rb||new C$1}H$1.Ma="serverreachability";function Tb(r){z.call(this,H$1.Ma,r)}t(Tb,z);function I(r){const e=Sb();D$1(e,new Tb(e,r))}H$1.STAT_EVENT="statevent";function Ub(r,e){z.call(this,H$1.STAT_EVENT,r),this.stat=e}t(Ub,z);function J$1(r){const e=Sb();D$1(e,new Ub(e,r))}H$1.Na="timingevent";function Vb(r,e){z.call(this,H$1.Na,r),this.size=e}t(Vb,z);function K$1(r,e){if(typeof r!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){r()},e)}var Wb={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Xb={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Yb(){}Yb.prototype.h=null;function Zb(r){return r.h||(r.h=r.i())}function $b(){}var L$1={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function ac$1(){z.call(this,"d")}t(ac$1,z);function bc$1(){z.call(this,"c")}t(bc$1,z);var cc;function dc$1(){}t(dc$1,Yb);dc$1.prototype.g=function(){return new XMLHttpRequest};dc$1.prototype.i=function(){return{}};cc=new dc$1;function M$1(r,e,s,o){this.l=r,this.j=e,this.m=s,this.X=o||1,this.V=new E(this),this.P=ec$1,r=Ja$1?125:void 0,this.W=new Eb(r),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new fc$1}function fc$1(){this.i=null,this.g="",this.h=!1}var ec$1=45e3,gc$1={},hc={};k$1=M$1.prototype;k$1.setTimeout=function(r){this.P=r};function ic(r,e,s){r.K=1,r.v=jc(N$1(e)),r.s=s,r.U=!0,kc$1(r,null)}function kc$1(r,e){r.F=Date.now(),lc(r),r.A=N$1(r.v);var s=r.A,o=r.X;Array.isArray(o)||(o=[String(o)]),mc$1(s.h,"t",o),r.C=0,s=r.l.H,r.h=new fc$1,r.g=nc(r.l,s?e:null,!r.s),0<r.O&&(r.L=new Ib(q$1(r.Ia,r,r.g),r.O)),Kb(r.V,r.g,"readystatechange",r.gb),e=r.H?ya$1(r.H):{},r.s?(r.u||(r.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",r.g.ea(r.A,r.u,r.s,e)):(r.u="GET",r.g.ea(r.A,r.u,null,e)),I(1),Nb(r.j,r.u,r.A,r.m,r.X,r.s)}k$1.gb=function(r){r=r.target;const e=this.L;e&&O$1(r)==3?e.l():this.Ia(r)};k$1.Ia=function(r){try{if(r==this.g)e:{const b=O$1(this.g);var e=this.g.Da();const m=this.g.ba();if(!(3>b)&&(b!=3||Ja$1||this.g&&(this.h.h||this.g.ga()||oc(this.g)))){this.I||b!=4||e==7||(e==8||0>=m?I(3):I(2)),pc$1(this);var s=this.g.ba();this.N=s;t:if(qc(this)){var o=oc(this.g);r="";var a=o.length,d=O$1(this.g)==4;if(!this.h.i){if(typeof TextDecoder=="undefined"){P(this),rc(this);var u="";break t}this.h.i=new l.TextDecoder}for(e=0;e<a;e++)this.h.h=!0,r+=this.h.i.decode(o[e],{stream:d&&e==a-1});o.splice(0,a),this.h.g+=r,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=s==200,Ob(this.j,this.u,this.A,this.m,this.X,b,s),this.i){if(this.$&&!this.J){t:{if(this.g){var f,h=this.g;if((f=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!sa$1(f)){var g=f;break t}}g=null}if(s=g)F$1(this.j,this.m,s,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,sc(this,s);else{this.i=!1,this.o=3,J$1(12),P(this),rc(this);break e}}this.U?(tc$1(this,b,u),Ja$1&&this.i&&b==3&&(Kb(this.V,this.W,"tick",this.fb),this.W.start())):(F$1(this.j,this.m,u,null),sc(this,u)),b==4&&P(this),this.i&&!this.I&&(b==4?uc(this.l,this):(this.i=!1,lc(this)))}else s==400&&0<u.indexOf("Unknown SID")?(this.o=3,J$1(12)):(this.o=0,J$1(13)),P(this),rc(this)}}}catch{}finally{}};function qc(r){return r.g?r.u=="GET"&&r.K!=2&&r.l.Ba:!1}function tc$1(r,e,s){let o=!0,a;for(;!r.I&&r.C<s.length;)if(a=vc$1(r,s),a==hc){e==4&&(r.o=4,J$1(14),o=!1),F$1(r.j,r.m,null,"[Incomplete Response]");break}else if(a==gc$1){r.o=4,J$1(15),F$1(r.j,r.m,s,"[Invalid Chunk]"),o=!1;break}else F$1(r.j,r.m,a,null),sc(r,a);qc(r)&&a!=hc&&a!=gc$1&&(r.h.g="",r.C=0),e!=4||s.length!=0||r.h.h||(r.o=1,J$1(16),o=!1),r.i=r.i&&o,o?0<s.length&&!r.aa&&(r.aa=!0,e=r.l,e.g==r&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+s.length),wc$1(e),e.L=!0,J$1(11))):(F$1(r.j,r.m,s,"[Invalid Chunked Response]"),P(r),rc(r))}k$1.fb=function(){if(this.g){var r=O$1(this.g),e=this.g.ga();this.C<e.length&&(pc$1(this),tc$1(this,r,e),this.i&&r!=4&&lc(this))}};function vc$1(r,e){var s=r.C,o=e.indexOf(`
`,s);return o==-1?hc:(s=Number(e.substring(s,o)),isNaN(s)?gc$1:(o+=1,o+s>e.length?hc:(e=e.substr(o,s),r.C=o+s,e)))}k$1.cancel=function(){this.I=!0,P(this)};function lc(r){r.Y=Date.now()+r.P,xc$1(r,r.P)}function xc$1(r,e){if(r.B!=null)throw Error("WatchDog timer not null");r.B=K$1(q$1(r.eb,r),e)}function pc$1(r){r.B&&(l.clearTimeout(r.B),r.B=null)}k$1.eb=function(){this.B=null;const r=Date.now();0<=r-this.Y?(Qb(this.j,this.A),this.K!=2&&(I(3),J$1(17)),P(this),this.o=2,rc(this)):xc$1(this,this.Y-r)};function rc(r){r.l.G==0||r.I||uc(r.l,r)}function P(r){pc$1(r);var e=r.L;e&&typeof e.na=="function"&&e.na(),r.L=null,Fb(r.W),Lb(r.V),r.g&&(e=r.g,r.g=null,e.abort(),e.na())}function sc(r,e){try{var s=r.l;if(s.G!=0&&(s.g==r||yc$1(s.i,r))){if(s.I=r.N,!r.J&&yc$1(s.i,r)&&s.G==3){try{var o=s.Ca.g.parse(e)}catch{o=null}if(Array.isArray(o)&&o.length==3){var a=o;if(a[0]==0)e:if(!s.u){if(s.g)if(s.g.F+3e3<r.F)zc(s),Ac$1(s);else break e;Bc$1(s),J$1(18)}else s.ta=a[1],0<s.ta-s.U&&37500>a[2]&&s.N&&s.A==0&&!s.v&&(s.v=K$1(q$1(s.ab,s),6e3));if(1>=Cc(s.i)&&s.ka){try{s.ka()}catch{}s.ka=void 0}}else Q$1(s,11)}else if((r.J||s.g==r)&&zc(s),!sa$1(e))for(a=s.Ca.g.parse(e),e=0;e<a.length;e++){let g=a[e];if(s.U=g[0],g=g[1],s.G==2)if(g[0]=="c"){s.J=g[1],s.la=g[2];const b=g[3];b!=null&&(s.ma=b,s.h.info("VER="+s.ma));const m=g[4];m!=null&&(s.za=m,s.h.info("SVER="+s.za));const _=g[5];_!=null&&typeof _=="number"&&0<_&&(o=1.5*_,s.K=o,s.h.info("backChannelRequestTimeoutMs_="+o)),o=s;const Ge=r.g;if(Ge){const ot=Ge.g?Ge.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ot){var d=o.i;!d.g&&(w(ot,"spdy")||w(ot,"quic")||w(ot,"h2"))&&(d.j=d.l,d.g=new Set,d.h&&(Dc$1(d,d.h),d.h=null))}if(o.D){const rr=Ge.g?Ge.g.getResponseHeader("X-HTTP-Session-Id"):null;rr&&(o.sa=rr,R(o.F,o.D,rr))}}s.G=3,s.j&&s.j.xa(),s.$&&(s.O=Date.now()-r.F,s.h.info("Handshake RTT: "+s.O+"ms")),o=s;var u=r;if(o.oa=Ec$1(o,o.H?o.la:null,o.W),u.J){Fc(o.i,u);var f=u,h=o.K;h&&f.setTimeout(h),f.B&&(pc$1(f),lc(f)),o.g=u}else Gc(o);0<s.l.length&&Hc(s)}else g[0]!="stop"&&g[0]!="close"||Q$1(s,7);else s.G==3&&(g[0]=="stop"||g[0]=="close"?g[0]=="stop"?Q$1(s,7):Ic$1(s):g[0]!="noop"&&s.j&&s.j.wa(g),s.A=0)}}I(4)}catch{}}function Jc(r){if(r.R&&typeof r.R=="function")return r.R();if(typeof r=="string")return r.split("");if(ba(r)){for(var e=[],s=r.length,o=0;o<s;o++)e.push(r[o]);return e}e=[],s=0;for(o in r)e[s++]=r[o];return e}function Kc(r,e){if(r.forEach&&typeof r.forEach=="function")r.forEach(e,void 0);else if(ba(r)||typeof r=="string")na$1(r,e,void 0);else{if(r.T&&typeof r.T=="function")var s=r.T();else if(r.R&&typeof r.R=="function")s=void 0;else if(ba(r)||typeof r=="string"){s=[];for(var o=r.length,a=0;a<o;a++)s.push(a)}else for(a in s=[],o=0,r)s[o++]=a;o=Jc(r),a=o.length;for(var d=0;d<a;d++)e.call(void 0,o[d],s&&s[d],r)}}function S$1(r,e){this.h={},this.g=[],this.i=0;var s=arguments.length;if(1<s){if(s%2)throw Error("Uneven number of arguments");for(var o=0;o<s;o+=2)this.set(arguments[o],arguments[o+1])}else if(r)if(r instanceof S$1)for(s=r.T(),o=0;o<s.length;o++)this.set(s[o],r.get(s[o]));else for(o in r)this.set(o,r[o])}k$1=S$1.prototype;k$1.R=function(){Lc$1(this);for(var r=[],e=0;e<this.g.length;e++)r.push(this.h[this.g[e]]);return r};k$1.T=function(){return Lc$1(this),this.g.concat()};function Lc$1(r){if(r.i!=r.g.length){for(var e=0,s=0;e<r.g.length;){var o=r.g[e];T(r.h,o)&&(r.g[s++]=o),e++}r.g.length=s}if(r.i!=r.g.length){var a={};for(s=e=0;e<r.g.length;)o=r.g[e],T(a,o)||(r.g[s++]=o,a[o]=1),e++;r.g.length=s}}k$1.get=function(r,e){return T(this.h,r)?this.h[r]:e};k$1.set=function(r,e){T(this.h,r)||(this.i++,this.g.push(r)),this.h[r]=e};k$1.forEach=function(r,e){for(var s=this.T(),o=0;o<s.length;o++){var a=s[o],d=this.get(a);r.call(e,d,a,this)}};function T(r,e){return Object.prototype.hasOwnProperty.call(r,e)}var Mc=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Nc(r,e){if(r){r=r.split("&");for(var s=0;s<r.length;s++){var o=r[s].indexOf("="),a=null;if(0<=o){var d=r[s].substring(0,o);a=r[s].substring(o+1)}else d=r[s];e(d,a?decodeURIComponent(a.replace(/\+/g," ")):"")}}}function U(r,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,r instanceof U){this.g=e!==void 0?e:r.g,Oc$1(this,r.j),this.s=r.s,Pc$1(this,r.i),Qc(this,r.m),this.l=r.l,e=r.h;var s=new Rc;s.i=e.i,e.g&&(s.g=new S$1(e.g),s.h=e.h),Sc(this,s),this.o=r.o}else r&&(s=String(r).match(Mc))?(this.g=!!e,Oc$1(this,s[1]||"",!0),this.s=Tc$1(s[2]||""),Pc$1(this,s[3]||"",!0),Qc(this,s[4]),this.l=Tc$1(s[5]||"",!0),Sc(this,s[6]||"",!0),this.o=Tc$1(s[7]||"")):(this.g=!!e,this.h=new Rc(null,this.g))}U.prototype.toString=function(){var r=[],e=this.j;e&&r.push(Uc$1(e,Vc$1,!0),":");var s=this.i;return(s||e=="file")&&(r.push("//"),(e=this.s)&&r.push(Uc$1(e,Vc$1,!0),"@"),r.push(encodeURIComponent(String(s)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),s=this.m,s!=null&&r.push(":",String(s))),(s=this.l)&&(this.i&&s.charAt(0)!="/"&&r.push("/"),r.push(Uc$1(s,s.charAt(0)=="/"?Wc:Xc,!0))),(s=this.h.toString())&&r.push("?",s),(s=this.o)&&r.push("#",Uc$1(s,Yc)),r.join("")};function N$1(r){return new U(r)}function Oc$1(r,e,s){r.j=s?Tc$1(e,!0):e,r.j&&(r.j=r.j.replace(/:$/,""))}function Pc$1(r,e,s){r.i=s?Tc$1(e,!0):e}function Qc(r,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);r.m=e}else r.m=null}function Sc(r,e,s){e instanceof Rc?(r.h=e,Zc$1(r.h,r.g)):(s||(e=Uc$1(e,$c)),r.h=new Rc(e,r.g))}function R(r,e,s){r.h.set(e,s)}function jc(r){return R(r,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),r}function ad(r){return r instanceof U?N$1(r):new U(r,void 0)}function bd(r,e,s,o){var a=new U(null,void 0);return r&&Oc$1(a,r),e&&Pc$1(a,e),s&&Qc(a,s),o&&(a.l=o),a}function Tc$1(r,e){return r?e?decodeURI(r.replace(/%25/g,"%2525")):decodeURIComponent(r):""}function Uc$1(r,e,s){return typeof r=="string"?(r=encodeURI(r).replace(e,cd),s&&(r=r.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),r):null}function cd(r){return r=r.charCodeAt(0),"%"+(r>>4&15).toString(16)+(r&15).toString(16)}var Vc$1=/[#\/\?@]/g,Xc=/[#\?:]/g,Wc=/[#\?]/g,$c=/[#\?@]/g,Yc=/#/g;function Rc(r,e){this.h=this.g=null,this.i=r||null,this.j=!!e}function V(r){r.g||(r.g=new S$1,r.h=0,r.i&&Nc(r.i,function(e,s){r.add(decodeURIComponent(e.replace(/\+/g," ")),s)}))}k$1=Rc.prototype;k$1.add=function(r,e){V(this),this.i=null,r=W$1(this,r);var s=this.g.get(r);return s||this.g.set(r,s=[]),s.push(e),this.h+=1,this};function dd(r,e){V(r),e=W$1(r,e),T(r.g.h,e)&&(r.i=null,r.h-=r.g.get(e).length,r=r.g,T(r.h,e)&&(delete r.h[e],r.i--,r.g.length>2*r.i&&Lc$1(r)))}function ed(r,e){return V(r),e=W$1(r,e),T(r.g.h,e)}k$1.forEach=function(r,e){V(this),this.g.forEach(function(s,o){na$1(s,function(a){r.call(e,a,o,this)},this)},this)};k$1.T=function(){V(this);for(var r=this.g.R(),e=this.g.T(),s=[],o=0;o<e.length;o++)for(var a=r[o],d=0;d<a.length;d++)s.push(e[o]);return s};k$1.R=function(r){V(this);var e=[];if(typeof r=="string")ed(this,r)&&(e=qa$1(e,this.g.get(W$1(this,r))));else{r=this.g.R();for(var s=0;s<r.length;s++)e=qa$1(e,r[s])}return e};k$1.set=function(r,e){return V(this),this.i=null,r=W$1(this,r),ed(this,r)&&(this.h-=this.g.get(r).length),this.g.set(r,[e]),this.h+=1,this};k$1.get=function(r,e){return r?(r=this.R(r),0<r.length?String(r[0]):e):e};function mc$1(r,e,s){dd(r,e),0<s.length&&(r.i=null,r.g.set(W$1(r,e),ra$1(s)),r.h+=s.length)}k$1.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var r=[],e=this.g.T(),s=0;s<e.length;s++){var o=e[s],a=encodeURIComponent(String(o));o=this.R(o);for(var d=0;d<o.length;d++){var u=a;o[d]!==""&&(u+="="+encodeURIComponent(String(o[d]))),r.push(u)}}return this.i=r.join("&")};function W$1(r,e){return e=String(e),r.j&&(e=e.toLowerCase()),e}function Zc$1(r,e){e&&!r.j&&(V(r),r.i=null,r.g.forEach(function(s,o){var a=o.toLowerCase();o!=a&&(dd(this,o),mc$1(this,a,s))},r)),r.j=e}var fd=class{constructor(r,e){this.h=r,this.g=e}};function gd(r){this.l=r||hd,l.PerformanceNavigationTiming?(r=l.performance.getEntriesByType("navigation"),r=0<r.length&&(r[0].nextHopProtocol=="hq"||r[0].nextHopProtocol=="h2")):r=!!(l.g&&l.g.Ea&&l.g.Ea()&&l.g.Ea().Zb),this.j=r?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var hd=10;function id(r){return r.h?!0:r.g?r.g.size>=r.j:!1}function Cc(r){return r.h?1:r.g?r.g.size:0}function yc$1(r,e){return r.h?r.h==e:r.g?r.g.has(e):!1}function Dc$1(r,e){r.g?r.g.add(e):r.h=e}function Fc(r,e){r.h&&r.h==e?r.h=null:r.g&&r.g.has(e)&&r.g.delete(e)}gd.prototype.cancel=function(){if(this.i=jd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const r of this.g.values())r.cancel();this.g.clear()}};function jd(r){if(r.h!=null)return r.i.concat(r.h.D);if(r.g!=null&&r.g.size!==0){let e=r.i;for(const s of r.g.values())e=e.concat(s.D);return e}return ra$1(r.i)}function kd(){}kd.prototype.stringify=function(r){return l.JSON.stringify(r,void 0)};kd.prototype.parse=function(r){return l.JSON.parse(r,void 0)};function ld(){this.g=new kd}function md(r,e,s){const o=s||"";try{Kc(r,function(a,d){let u=a;p(a)&&(u=rb(a)),e.push(o+d+"="+encodeURIComponent(u))})}catch(a){throw e.push(o+"type="+encodeURIComponent("_badmap")),a}}function nd(r,e){const s=new Mb;if(l.Image){const o=new Image;o.onload=ja(od,s,o,"TestLoadImage: loaded",!0,e),o.onerror=ja(od,s,o,"TestLoadImage: error",!1,e),o.onabort=ja(od,s,o,"TestLoadImage: abort",!1,e),o.ontimeout=ja(od,s,o,"TestLoadImage: timeout",!1,e),l.setTimeout(function(){o.ontimeout&&o.ontimeout()},1e4),o.src=r}else e(!1)}function od(r,e,s,o,a){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,a(o)}catch{}}function pd(r){this.l=r.$b||null,this.j=r.ib||!1}t(pd,Yb);pd.prototype.g=function(){return new qd(this.l,this.j)};pd.prototype.i=function(r){return function(){return r}}({});function qd(r,e){C$1.call(this),this.D=r,this.u=e,this.m=void 0,this.readyState=rd,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}t(qd,C$1);var rd=0;k$1=qd.prototype;k$1.open=function(r,e){if(this.readyState!=rd)throw this.abort(),Error("Error reopening a connection");this.C=r,this.B=e,this.readyState=1,sd(this)};k$1.send=function(r){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};r&&(e.body=r),(this.D||l).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))};k$1.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,td(this)),this.readyState=rd};k$1.Va=function(r){if(this.g&&(this.l=r,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=r.headers,this.readyState=2,sd(this)),this.g&&(this.readyState=3,sd(this),this.g)))if(this.responseType==="arraybuffer")r.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(typeof l.ReadableStream!="undefined"&&"body"in r){if(this.j=r.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;ud(this)}else r.text().then(this.Ua.bind(this),this.ha.bind(this))};function ud(r){r.j.read().then(r.Sa.bind(r)).catch(r.ha.bind(r))}k$1.Sa=function(r){if(this.g){if(this.u&&r.value)this.response.push(r.value);else if(!this.u){var e=r.value?r.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!r.done}))&&(this.response=this.responseText+=e)}r.done?td(this):sd(this),this.readyState==3&&ud(this)}};k$1.Ua=function(r){this.g&&(this.response=this.responseText=r,td(this))};k$1.Ta=function(r){this.g&&(this.response=r,td(this))};k$1.ha=function(){this.g&&td(this)};function td(r){r.readyState=4,r.l=null,r.j=null,r.A=null,sd(r)}k$1.setRequestHeader=function(r,e){this.v.append(r,e)};k$1.getResponseHeader=function(r){return this.h&&this.h.get(r.toLowerCase())||""};k$1.getAllResponseHeaders=function(){if(!this.h)return"";const r=[],e=this.h.entries();for(var s=e.next();!s.done;)s=s.value,r.push(s[0]+": "+s[1]),s=e.next();return r.join(`\r
`)};function sd(r){r.onreadystatechange&&r.onreadystatechange.call(r)}Object.defineProperty(qd.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(r){this.m=r?"include":"same-origin"}});var vd=l.JSON.parse;function X$1(r){C$1.call(this),this.headers=new S$1,this.u=r||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=wd,this.K=this.L=!1}t(X$1,C$1);var wd="",xd=/^https?$/i,yd=["POST","PUT"];k$1=X$1.prototype;k$1.ea=function(r,e,s,o){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+r);e=e?e.toUpperCase():"GET",this.H=r,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():cc.g(),this.C=this.u?Zb(this.u):Zb(cc),this.g.onreadystatechange=q$1(this.Fa,this);try{this.F=!0,this.g.open(e,String(r),!0),this.F=!1}catch(d){zd(this,d);return}r=s||"";const a=new S$1(this.headers);o&&Kc(o,function(d,u){a.set(u,d)}),o=oa$1(a.T()),s=l.FormData&&r instanceof l.FormData,!(0<=ma$1(yd,e))||o||s||a.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),a.forEach(function(d,u){this.g.setRequestHeader(u,d)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Ad(this),0<this.B&&((this.K=Bd(this.g))?(this.g.timeout=this.B,this.g.ontimeout=q$1(this.pa,this)):this.A=Gb(this.pa,this.B,this)),this.v=!0,this.g.send(r),this.v=!1}catch(d){zd(this,d)}};function Bd(r){return y&&Ra$1()&&typeof r.timeout=="number"&&r.ontimeout!==void 0}function pa$1(r){return r.toLowerCase()=="content-type"}k$1.pa=function(){typeof goog!="undefined"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,D$1(this,"timeout"),this.abort(8))};function zd(r,e){r.h=!1,r.g&&(r.l=!0,r.g.abort(),r.l=!1),r.j=e,r.m=5,Cd(r),Dd(r)}function Cd(r){r.D||(r.D=!0,D$1(r,"complete"),D$1(r,"error"))}k$1.abort=function(r){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=r||7,D$1(this,"complete"),D$1(this,"abort"),Dd(this))};k$1.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Dd(this,!0)),X$1.Z.M.call(this)};k$1.Fa=function(){this.s||(this.F||this.v||this.l?Ed(this):this.cb())};k$1.cb=function(){Ed(this)};function Ed(r){if(r.h&&typeof goog!="undefined"&&(!r.C[1]||O$1(r)!=4||r.ba()!=2)){if(r.v&&O$1(r)==4)Gb(r.Fa,0,r);else if(D$1(r,"readystatechange"),O$1(r)==4){r.h=!1;try{const f=r.ba();e:switch(f){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var s;if(!(s=e)){var o;if(o=f===0){var a=String(r.H).match(Mc)[1]||null;if(!a&&l.self&&l.self.location){var d=l.self.location.protocol;a=d.substr(0,d.length-1)}o=!xd.test(a?a.toLowerCase():"")}s=o}if(s)D$1(r,"complete"),D$1(r,"success");else{r.m=6;try{var u=2<O$1(r)?r.g.statusText:""}catch{u=""}r.j=u+" ["+r.ba()+"]",Cd(r)}}finally{Dd(r)}}}}function Dd(r,e){if(r.g){Ad(r);const s=r.g,o=r.C[0]?aa$1:null;r.g=null,r.C=null,e||D$1(r,"ready");try{s.onreadystatechange=o}catch{}}}function Ad(r){r.g&&r.K&&(r.g.ontimeout=null),r.A&&(l.clearTimeout(r.A),r.A=null)}function O$1(r){return r.g?r.g.readyState:0}k$1.ba=function(){try{return 2<O$1(this)?this.g.status:-1}catch{return-1}};k$1.ga=function(){try{return this.g?this.g.responseText:""}catch{return""}};k$1.Qa=function(r){if(this.g){var e=this.g.responseText;return r&&e.indexOf(r)==0&&(e=e.substring(r.length)),vd(e)}};function oc(r){try{if(!r.g)return null;if("response"in r.g)return r.g.response;switch(r.J){case wd:case"text":return r.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in r.g)return r.g.mozResponseArrayBuffer}return null}catch{return null}}k$1.Da=function(){return this.m};k$1.La=function(){return typeof this.j=="string"?this.j:String(this.j)};function Fd(r){let e="";return xa$1(r,function(s,o){e+=o,e+=":",e+=s,e+=`\r
`}),e}function Gd(r,e,s){e:{for(o in s){var o=!1;break e}o=!0}o||(s=Fd(s),typeof r=="string"?s!=null&&encodeURIComponent(String(s)):R(r,e,s))}function Hd(r,e,s){return s&&s.internalChannelParams&&s.internalChannelParams[r]||e}function Id(r){this.za=0,this.l=[],this.h=new Mb,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Hd("failFast",!1,r),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Hd("baseRetryDelayMs",5e3,r),this.$a=Hd("retryDelaySeedMs",1e4,r),this.Ya=Hd("forwardChannelMaxRetries",2,r),this.ra=Hd("forwardChannelRequestTimeoutMs",2e4,r),this.qa=r&&r.xmlHttpFactory||void 0,this.Ba=r&&r.Yb||!1,this.K=void 0,this.H=r&&r.supportsCrossDomainXhr||!1,this.J="",this.i=new gd(r&&r.concurrentRequestLimit),this.Ca=new ld,this.ja=r&&r.fastHandshake||!1,this.Ra=r&&r.Wb||!1,r&&r.Aa&&this.h.Aa(),r&&r.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&r&&r.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!r||r.Xb!==!1}k$1=Id.prototype;k$1.ma=8;k$1.G=1;function Ic$1(r){if(Jd(r),r.G==3){var e=r.V++,s=N$1(r.F);R(s,"SID",r.J),R(s,"RID",e),R(s,"TYPE","terminate"),Kd(r,s),e=new M$1(r,r.h,e,void 0),e.K=2,e.v=jc(N$1(s)),s=!1,l.navigator&&l.navigator.sendBeacon&&(s=l.navigator.sendBeacon(e.v.toString(),"")),!s&&l.Image&&(new Image().src=e.v,s=!0),s||(e.g=nc(e.l,null),e.g.ea(e.v)),e.F=Date.now(),lc(e)}Ld(r)}k$1.hb=function(r){try{this.h.info("Origin Trials invoked: "+r)}catch{}};function Ac$1(r){r.g&&(wc$1(r),r.g.cancel(),r.g=null)}function Jd(r){Ac$1(r),r.u&&(l.clearTimeout(r.u),r.u=null),zc(r),r.i.cancel(),r.m&&(typeof r.m=="number"&&l.clearTimeout(r.m),r.m=null)}function Md(r,e){r.l.push(new fd(r.Za++,e)),r.G==3&&Hc(r)}function Hc(r){id(r.i)||r.m||(r.m=!0,zb(r.Ha,r),r.C=0)}function Nd(r,e){return Cc(r.i)>=r.i.j-(r.m?1:0)?!1:r.m?(r.l=e.D.concat(r.l),!0):r.G==1||r.G==2||r.C>=(r.Xa?0:r.Ya)?!1:(r.m=K$1(q$1(r.Ha,r,e),Od(r,r.C)),r.C++,!0)}k$1.Ha=function(r){if(this.m)if(this.m=null,this.G==1){if(!r){this.V=Math.floor(1e5*Math.random()),r=this.V++;const a=new M$1(this,this.h,r,void 0);let d=this.s;if(this.P&&(d?(d=ya$1(d),Aa$1(d,this.P)):d=this.P),this.o===null&&(a.H=d),this.ja)e:{for(var e=0,s=0;s<this.l.length;s++){t:{var o=this.l[s];if("__data__"in o.g&&(o=o.g.__data__,typeof o=="string")){o=o.length;break t}o=void 0}if(o===void 0)break;if(e+=o,4096<e){e=s;break e}if(e===4096||s===this.l.length-1){e=s+1;break e}}e=1e3}else e=1e3;e=Pd(this,a,e),s=N$1(this.F),R(s,"RID",r),R(s,"CVER",22),this.D&&R(s,"X-HTTP-Session-Id",this.D),Kd(this,s),this.o&&d&&Gd(s,this.o,d),Dc$1(this.i,a),this.Ra&&R(s,"TYPE","init"),this.ja?(R(s,"$req",e),R(s,"SID","null"),a.$=!0,ic(a,s,null)):ic(a,s,e),this.G=2}}else this.G==3&&(r?Qd(this,r):this.l.length==0||id(this.i)||Qd(this))};function Qd(r,e){var s;e?s=e.m:s=r.V++;const o=N$1(r.F);R(o,"SID",r.J),R(o,"RID",s),R(o,"AID",r.U),Kd(r,o),r.o&&r.s&&Gd(o,r.o,r.s),s=new M$1(r,r.h,s,r.C+1),r.o===null&&(s.H=r.s),e&&(r.l=e.D.concat(r.l)),e=Pd(r,s,1e3),s.setTimeout(Math.round(.5*r.ra)+Math.round(.5*r.ra*Math.random())),Dc$1(r.i,s),ic(s,o,e)}function Kd(r,e){r.j&&Kc({},function(s,o){R(e,o,s)})}function Pd(r,e,s){s=Math.min(r.l.length,s);var o=r.j?q$1(r.j.Oa,r.j,r):null;e:{var a=r.l;let d=-1;for(;;){const u=["count="+s];d==-1?0<s?(d=a[0].h,u.push("ofs="+d)):d=0:u.push("ofs="+d);let f=!0;for(let h=0;h<s;h++){let g=a[h].h;const b=a[h].g;if(g-=d,0>g)d=Math.max(0,a[h].h-100),f=!1;else try{md(b,u,"req"+g+"_")}catch{o&&o(b)}}if(f){o=u.join("&");break e}}}return r=r.l.splice(0,s),e.D=r,o}function Gc(r){r.g||r.u||(r.Y=1,zb(r.Ga,r),r.A=0)}function Bc$1(r){return r.g||r.u||3<=r.A?!1:(r.Y++,r.u=K$1(q$1(r.Ga,r),Od(r,r.A)),r.A++,!0)}k$1.Ga=function(){if(this.u=null,Rd(this),this.$&&!(this.L||this.g==null||0>=this.O)){var r=2*this.O;this.h.info("BP detection timer enabled: "+r),this.B=K$1(q$1(this.bb,this),r)}};k$1.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,J$1(10),Ac$1(this),Rd(this))};function wc$1(r){r.B!=null&&(l.clearTimeout(r.B),r.B=null)}function Rd(r){r.g=new M$1(r,r.h,"rpc",r.Y),r.o===null&&(r.g.H=r.s),r.g.O=0;var e=N$1(r.oa);R(e,"RID","rpc"),R(e,"SID",r.J),R(e,"CI",r.N?"0":"1"),R(e,"AID",r.U),Kd(r,e),R(e,"TYPE","xmlhttp"),r.o&&r.s&&Gd(e,r.o,r.s),r.K&&r.g.setTimeout(r.K);var s=r.g;r=r.la,s.K=1,s.v=jc(N$1(e)),s.s=null,s.U=!0,kc$1(s,r)}k$1.ab=function(){this.v!=null&&(this.v=null,Ac$1(this),Bc$1(this),J$1(19))};function zc(r){r.v!=null&&(l.clearTimeout(r.v),r.v=null)}function uc(r,e){var s=null;if(r.g==e){zc(r),wc$1(r),r.g=null;var o=2}else if(yc$1(r.i,e))s=e.D,Fc(r.i,e),o=1;else return;if(r.I=e.N,r.G!=0){if(e.i)if(o==1){s=e.s?e.s.length:0,e=Date.now()-e.F;var a=r.C;o=Sb(),D$1(o,new Vb(o,s,e,a)),Hc(r)}else Gc(r);else if(a=e.o,a==3||a==0&&0<r.I||!(o==1&&Nd(r,e)||o==2&&Bc$1(r)))switch(s&&0<s.length&&(e=r.i,e.i=e.i.concat(s)),a){case 1:Q$1(r,5);break;case 4:Q$1(r,10);break;case 3:Q$1(r,6);break;default:Q$1(r,2)}}}function Od(r,e){let s=r.Pa+Math.floor(Math.random()*r.$a);return r.j||(s*=2),s*e}function Q$1(r,e){if(r.h.info("Error code "+e),e==2){var s=null;r.j&&(s=null);var o=q$1(r.jb,r);s||(s=new U("//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Oc$1(s,"https"),jc(s)),nd(s.toString(),o)}else J$1(2);r.G=0,r.j&&r.j.va(e),Ld(r),Jd(r)}k$1.jb=function(r){r?(this.h.info("Successfully pinged google.com"),J$1(2)):(this.h.info("Failed to ping google.com"),J$1(1))};function Ld(r){r.G=0,r.I=-1,r.j&&((jd(r.i).length!=0||r.l.length!=0)&&(r.i.i.length=0,ra$1(r.l),r.l.length=0),r.j.ua())}function Ec$1(r,e,s){let o=ad(s);if(o.i!="")e&&Pc$1(o,e+"."+o.i),Qc(o,o.m);else{const a=l.location;o=bd(a.protocol,e?e+"."+a.hostname:a.hostname,+a.port,s)}return r.aa&&xa$1(r.aa,function(a,d){R(o,d,a)}),e=r.D,s=r.sa,e&&s&&R(o,e,s),R(o,"VER",r.ma),Kd(r,o),o}function nc(r,e,s){if(e&&!r.H)throw Error("Can't create secondary domain capable XhrIo object.");return e=s&&r.Ba&&!r.qa?new X$1(new pd({ib:!0})):new X$1(r.qa),e.L=r.H,e}function Sd(){}k$1=Sd.prototype;k$1.xa=function(){};k$1.wa=function(){};k$1.va=function(){};k$1.ua=function(){};k$1.Oa=function(){};function Td(){if(y&&!(10<=Number(Ua)))throw Error("Environmental error: no available transport.")}Td.prototype.g=function(r,e){return new Y$1(r,e)};function Y$1(r,e){C$1.call(this),this.g=new Id(e),this.l=r,this.h=e&&e.messageUrlParams||null,r=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(r?r["X-Client-Protocol"]="webchannel":r={"X-Client-Protocol":"webchannel"}),this.g.s=r,r=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(r?r["X-WebChannel-Content-Type"]=e.messageContentType:r={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(r?r["X-WebChannel-Client-Profile"]=e.ya:r={"X-WebChannel-Client-Profile":e.ya}),this.g.P=r,(r=e&&e.httpHeadersOverwriteParam)&&!sa$1(r)&&(this.g.o=r),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!sa$1(e)&&(this.g.D=e,r=this.h,r!==null&&e in r&&(r=this.h,e in r&&delete r[e])),this.j=new Z$1(this)}t(Y$1,C$1);Y$1.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var r=this.g,e=this.l,s=this.h||void 0;r.Wa&&(r.h.info("Origin Trials enabled."),zb(q$1(r.hb,r,e))),J$1(0),r.W=e,r.aa=s||{},r.N=r.X,r.F=Ec$1(r,null,r.W),Hc(r)};Y$1.prototype.close=function(){Ic$1(this.g)};Y$1.prototype.u=function(r){if(typeof r=="string"){var e={};e.__data__=r,Md(this.g,e)}else this.v?(e={},e.__data__=rb(r),Md(this.g,e)):Md(this.g,r)};Y$1.prototype.M=function(){this.g.j=null,delete this.j,Ic$1(this.g),delete this.g,Y$1.Z.M.call(this)};function Ud(r){ac$1.call(this);var e=r.__sm__;if(e){e:{for(const s in e){r=s;break e}r=void 0}(this.i=r)&&(r=this.i,e=e!==null&&r in e?e[r]:void 0),this.data=e}else this.data=r}t(Ud,ac$1);function Vd(){bc$1.call(this),this.status=1}t(Vd,bc$1);function Z$1(r){this.g=r}t(Z$1,Sd);Z$1.prototype.xa=function(){D$1(this.g,"a")};Z$1.prototype.wa=function(r){D$1(this.g,new Ud(r))};Z$1.prototype.va=function(r){D$1(this.g,new Vd(r))};Z$1.prototype.ua=function(){D$1(this.g,"b")};Td.prototype.createWebChannel=Td.prototype.g;Y$1.prototype.send=Y$1.prototype.u;Y$1.prototype.open=Y$1.prototype.m;Y$1.prototype.close=Y$1.prototype.close;Wb.NO_ERROR=0;Wb.TIMEOUT=8;Wb.HTTP_ERROR=6;Xb.COMPLETE="complete";$b.EventType=L$1;L$1.OPEN="a";L$1.CLOSE="b";L$1.ERROR="c";L$1.MESSAGE="d";C$1.prototype.listen=C$1.prototype.N;X$1.prototype.listenOnce=X$1.prototype.O;X$1.prototype.getLastError=X$1.prototype.La;X$1.prototype.getLastErrorCode=X$1.prototype.Da;X$1.prototype.getStatus=X$1.prototype.ba;X$1.prototype.getResponseJson=X$1.prototype.Qa;X$1.prototype.getResponseText=X$1.prototype.ga;X$1.prototype.send=X$1.prototype.ea;var createWebChannelTransport=function(){return new Td},getStatEventTarget=function(){return Sb()},ErrorCode$1=Wb,EventType=Xb,Event$1=H$1,Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},FetchXmlHttpFactory=pd,WebChannel=$b,XhrIo=X$1;const S="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}D.UNAUTHENTICATED=new D(null),D.GOOGLE_CREDENTIALS=new D("google-credentials-uid"),D.FIRST_PARTY=new D("first-party-uid"),D.MOCK_USER=new D("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let C="9.6.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N=new Logger("@firebase/firestore");function k(){return N.logLevel}function $$1(r,...e){if(N.logLevel<=LogLevel.DEBUG){const s=e.map(M);N.debug(`Firestore (${C}): ${r}`,...s)}}function F(r,...e){if(N.logLevel<=LogLevel.ERROR){const s=e.map(M);N.error(`Firestore (${C}): ${r}`,...s)}}function O(r,...e){if(N.logLevel<=LogLevel.WARN){const s=e.map(M);N.warn(`Firestore (${C}): ${r}`,...s)}}function M(r){if(typeof r=="string")return r;try{return e=r,JSON.stringify(e)}catch{return r}/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L(r="Unexpected state"){const e=`FIRESTORE (${C}) INTERNAL ASSERTION FAILED: `+r;throw F(e),new Error(e)}function B(r,e){r||L()}function q(r,e){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class j extends Error{constructor(e,s){super(s),this.code=e,this.message=s,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q{constructor(){this.promise=new Promise((e,s)=>{this.resolve=e,this.reject=s})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W{constructor(e,s){this.user=s,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class G{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,s){e.enqueueRetryable(()=>s(D.UNAUTHENTICATED))}shutdown(){}}class H{constructor(e){this.t=e,this.currentUser=D.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,s){let o=this.i;const a=h=>this.i!==o?(o=this.i,s(h)):Promise.resolve();let d=new Q;this.o=()=>{this.i++,this.currentUser=this.u(),d.resolve(),d=new Q,e.enqueueRetryable(()=>a(this.currentUser))};const u=()=>{const h=d;e.enqueueRetryable(async()=>{await h.promise,await a(this.currentUser)})},f=h=>{$$1("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.auth.addAuthTokenListener(this.o),u()};this.t.onInit(h=>f(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?f(h):($$1("FirebaseAuthCredentialsProvider","Auth not yet detected"),d.resolve(),d=new Q)}},0),u()}getToken(){const e=this.i,s=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(s).then(o=>this.i!==e?($$1("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):o?(B(typeof o.accessToken=="string"),new W(o.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return B(e===null||typeof e=="string"),new D(e)}}class J{constructor(e,s,o){this.type="FirstParty",this.user=D.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",s);const a=e.auth.getAuthHeaderValueForFirstParty([]);a&&this.headers.set("Authorization",a),o&&this.headers.set("X-Goog-Iam-Authorization-Token",o)}}class Y{constructor(e,s,o){this.h=e,this.l=s,this.m=o}getToken(){return Promise.resolve(new J(this.h,this.l,this.m))}start(e,s){e.enqueueRetryable(()=>s(D.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class X{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Z{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null}start(e,s){this.o=a=>{e.enqueueRetryable(()=>(d=>(d.error!=null&&$$1("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${d.error.message}`),s(d.token)))(a))};const o=a=>{$$1("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.appCheck.addTokenListener(this.o)};this.g.onInit(a=>o(a)),setTimeout(()=>{if(!this.appCheck){const a=this.g.getImmediate({optional:!0});a?o(a):$$1("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(s=>s?(B(typeof s.token=="string"),new X(s.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class et{constructor(e,s){this.previousValue=e,s&&(s.sequenceNumberHandler=o=>this.p(o),this.T=o=>s.writeSequenceNumber(o))}p(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.T&&this.T(e),e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nt(r){const e=typeof self!="undefined"&&(self.crypto||self.msCrypto),s=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(s);else for(let o=0;o<r;o++)s[o]=Math.floor(256*Math.random());return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */et.I=-1;class st{static A(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=Math.floor(256/e.length)*e.length;let o="";for(;o.length<20;){const a=nt(40);for(let d=0;d<a.length;++d)o.length<20&&a[d]<s&&(o+=e.charAt(a[d]%e.length))}return o}}function it(r,e){return r<e?-1:r>e?1:0}function rt(r,e,s){return r.length===e.length&&r.every((o,a)=>s(o,e[a]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class at{constructor(e,s){if(this.seconds=e,this.nanoseconds=s,s<0)throw new j(K.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(s>=1e9)throw new j(K.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(e<-62135596800)throw new j(K.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new j(K.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return at.fromMillis(Date.now())}static fromDate(e){return at.fromMillis(e.getTime())}static fromMillis(e){const s=Math.floor(e/1e3),o=Math.floor(1e6*(e-1e3*s));return new at(s,o)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?it(this.nanoseconds,e.nanoseconds):it(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ct{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ct(e)}static min(){return new ct(new at(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ut(r){let e=0;for(const s in r)Object.prototype.hasOwnProperty.call(r,s)&&e++;return e}function ht(r,e){for(const s in r)Object.prototype.hasOwnProperty.call(r,s)&&e(s,r[s])}function lt(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ft{constructor(e,s,o){s===void 0?s=0:s>e.length&&L(),o===void 0?o=e.length-s:o>e.length-s&&L(),this.segments=e,this.offset=s,this.len=o}get length(){return this.len}isEqual(e){return ft.comparator(this,e)===0}child(e){const s=this.segments.slice(this.offset,this.limit());return e instanceof ft?e.forEach(o=>{s.push(o)}):s.push(e),this.construct(s)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==e.get(s))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==e.get(s))return!1;return!0}forEach(e){for(let s=this.offset,o=this.limit();s<o;s++)e(this.segments[s])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,s){const o=Math.min(e.length,s.length);for(let a=0;a<o;a++){const d=e.get(a),u=s.get(a);if(d<u)return-1;if(d>u)return 1}return e.length<s.length?-1:e.length>s.length?1:0}}class dt extends ft{construct(e,s,o){return new dt(e,s,o)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const s=[];for(const o of e){if(o.indexOf("//")>=0)throw new j(K.INVALID_ARGUMENT,`Invalid segment (${o}). Paths must not contain // in them.`);s.push(...o.split("/").filter(a=>a.length>0))}return new dt(s)}static emptyPath(){return new dt([])}}const wt=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class _t extends ft{construct(e,s,o){return new _t(e,s,o)}static isValidIdentifier(e){return wt.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),_t.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new _t(["__name__"])}static fromServerFormat(e){const s=[];let o="",a=0;const d=()=>{if(o.length===0)throw new j(K.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);s.push(o),o=""};let u=!1;for(;a<e.length;){const f=e[a];if(f==="\\"){if(a+1===e.length)throw new j(K.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[a+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new j(K.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);o+=h,a+=2}else f==="`"?(u=!u,a++):f!=="."||u?(o+=f,a++):(d(),a++)}if(d(),u)throw new j(K.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new _t(s)}static emptyPath(){return new _t([])}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mt{constructor(e){this.fields=e,e.sort(_t.comparator)}covers(e){for(const s of this.fields)if(s.isPrefixOf(e))return!0;return!1}isEqual(e){return rt(this.fields,e.fields,(s,o)=>s.isEqual(o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yt{constructor(e){this.binaryString=e}static fromBase64String(e){const s=atob(e);return new yt(s)}static fromUint8Array(e){const s=function(o){let a="";for(let d=0;d<o.length;++d)a+=String.fromCharCode(o[d]);return a}(e);return new yt(s)}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const s=new Uint8Array(e.length);for(let o=0;o<e.length;o++)s[o]=e.charCodeAt(o);return s}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return it(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}yt.EMPTY_BYTE_STRING=new yt("");const pt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Tt(r){if(B(!!r),typeof r=="string"){let e=0;const s=pt.exec(r);if(B(!!s),s[1]){let a=s[1];a=(a+"000000000").substr(0,9),e=Number(a)}const o=new Date(r);return{seconds:Math.floor(o.getTime()/1e3),nanos:e}}return{seconds:Et(r.seconds),nanos:Et(r.nanos)}}function Et(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function It(r){return typeof r=="string"?yt.fromBase64String(r):yt.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function At(r){var e,s;return((s=(((e=r==null?void 0:r.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||s===void 0?void 0:s.stringValue)==="server_timestamp"}function Rt(r){const e=r.mapValue.fields.__previous_value__;return At(e)?Rt(e):e}function Pt(r){const e=Tt(r.mapValue.fields.__local_write_time__.timestampValue);return new at(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bt(r){return r==null}function vt(r){return r===0&&1/r==-1/0}function Vt(r){return typeof r=="number"&&Number.isInteger(r)&&!vt(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class St{constructor(e){this.path=e}static fromPath(e){return new St(dt.fromString(e))}static fromName(e){return new St(dt.fromString(e).popFirst(5))}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}isEqual(e){return e!==null&&dt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,s){return dt.comparator(e.path,s.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new St(new dt(e.slice()))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dt(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?At(r)?4:10:L()}function Ct(r,e){const s=Dt(r);if(s!==Dt(e))return!1;switch(s){case 0:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return Pt(r).isEqual(Pt(e));case 3:return function(o,a){if(typeof o.timestampValue=="string"&&typeof a.timestampValue=="string"&&o.timestampValue.length===a.timestampValue.length)return o.timestampValue===a.timestampValue;const d=Tt(o.timestampValue),u=Tt(a.timestampValue);return d.seconds===u.seconds&&d.nanos===u.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return function(o,a){return It(o.bytesValue).isEqual(It(a.bytesValue))}(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return function(o,a){return Et(o.geoPointValue.latitude)===Et(a.geoPointValue.latitude)&&Et(o.geoPointValue.longitude)===Et(a.geoPointValue.longitude)}(r,e);case 2:return function(o,a){if("integerValue"in o&&"integerValue"in a)return Et(o.integerValue)===Et(a.integerValue);if("doubleValue"in o&&"doubleValue"in a){const d=Et(o.doubleValue),u=Et(a.doubleValue);return d===u?vt(d)===vt(u):isNaN(d)&&isNaN(u)}return!1}(r,e);case 9:return rt(r.arrayValue.values||[],e.arrayValue.values||[],Ct);case 10:return function(o,a){const d=o.mapValue.fields||{},u=a.mapValue.fields||{};if(ut(d)!==ut(u))return!1;for(const f in d)if(d.hasOwnProperty(f)&&(u[f]===void 0||!Ct(d[f],u[f])))return!1;return!0}(r,e);default:return L()}}function Nt(r,e){return(r.values||[]).find(s=>Ct(s,e))!==void 0}function kt(r,e){const s=Dt(r),o=Dt(e);if(s!==o)return it(s,o);switch(s){case 0:return 0;case 1:return it(r.booleanValue,e.booleanValue);case 2:return function(a,d){const u=Et(a.integerValue||a.doubleValue),f=Et(d.integerValue||d.doubleValue);return u<f?-1:u>f?1:u===f?0:isNaN(u)?isNaN(f)?0:-1:1}(r,e);case 3:return xt(r.timestampValue,e.timestampValue);case 4:return xt(Pt(r),Pt(e));case 5:return it(r.stringValue,e.stringValue);case 6:return function(a,d){const u=It(a),f=It(d);return u.compareTo(f)}(r.bytesValue,e.bytesValue);case 7:return function(a,d){const u=a.split("/"),f=d.split("/");for(let h=0;h<u.length&&h<f.length;h++){const g=it(u[h],f[h]);if(g!==0)return g}return it(u.length,f.length)}(r.referenceValue,e.referenceValue);case 8:return function(a,d){const u=it(Et(a.latitude),Et(d.latitude));return u!==0?u:it(Et(a.longitude),Et(d.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return function(a,d){const u=a.values||[],f=d.values||[];for(let h=0;h<u.length&&h<f.length;++h){const g=kt(u[h],f[h]);if(g)return g}return it(u.length,f.length)}(r.arrayValue,e.arrayValue);case 10:return function(a,d){const u=a.fields||{},f=Object.keys(u),h=d.fields||{},g=Object.keys(h);f.sort(),g.sort();for(let b=0;b<f.length&&b<g.length;++b){const m=it(f[b],g[b]);if(m!==0)return m;const _=kt(u[f[b]],h[g[b]]);if(_!==0)return _}return it(f.length,g.length)}(r.mapValue,e.mapValue);default:throw L()}}function xt(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return it(r,e);const s=Tt(r),o=Tt(e),a=it(s.seconds,o.seconds);return a!==0?a:it(s.nanos,o.nanos)}function $t(r){return Ft(r)}function Ft(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(o){const a=Tt(o);return`time(${a.seconds},${a.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?It(r.bytesValue).toBase64():"referenceValue"in r?(s=r.referenceValue,St.fromName(s).toString()):"geoPointValue"in r?`geo(${(e=r.geoPointValue).latitude},${e.longitude})`:"arrayValue"in r?function(o){let a="[",d=!0;for(const u of o.values||[])d?d=!1:a+=",",a+=Ft(u);return a+"]"}(r.arrayValue):"mapValue"in r?function(o){const a=Object.keys(o.fields||{}).sort();let d="{",u=!0;for(const f of a)u?u=!1:d+=",",d+=`${f}:${Ft(o.fields[f])}`;return d+"}"}(r.mapValue):L();var e,s}function Ot(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function Mt(r){return!!r&&"integerValue"in r}function Lt(r){return!!r&&"arrayValue"in r}function Bt(r){return!!r&&"nullValue"in r}function Ut(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function qt(r){return!!r&&"mapValue"in r}function Kt(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return ht(r.mapValue.fields,(s,o)=>e.mapValue.fields[s]=Kt(o)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let s=0;s<(r.arrayValue.values||[]).length;++s)e.arrayValue.values[s]=Kt(r.arrayValue.values[s]);return e}return Object.assign({},r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jt{constructor(e){this.value=e}static empty(){return new jt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let s=this.value;for(let o=0;o<e.length-1;++o)if(s=(s.mapValue.fields||{})[e.get(o)],!qt(s))return null;return s=(s.mapValue.fields||{})[e.lastSegment()],s||null}}set(e,s){this.getFieldsMap(e.popLast())[e.lastSegment()]=Kt(s)}setAll(e){let s=_t.emptyPath(),o={},a=[];e.forEach((u,f)=>{if(!s.isImmediateParentOf(f)){const h=this.getFieldsMap(s);this.applyChanges(h,o,a),o={},a=[],s=f.popLast()}u?o[f.lastSegment()]=Kt(u):a.push(f.lastSegment())});const d=this.getFieldsMap(s);this.applyChanges(d,o,a)}delete(e){const s=this.field(e.popLast());qt(s)&&s.mapValue.fields&&delete s.mapValue.fields[e.lastSegment()]}isEqual(e){return Ct(this.value,e.value)}getFieldsMap(e){let s=this.value;s.mapValue.fields||(s.mapValue={fields:{}});for(let o=0;o<e.length;++o){let a=s.mapValue.fields[e.get(o)];qt(a)&&a.mapValue.fields||(a={mapValue:{fields:{}}},s.mapValue.fields[e.get(o)]=a),s=a}return s.mapValue.fields}applyChanges(e,s,o){ht(s,(a,d)=>e[a]=d);for(const a of o)delete e[a]}clone(){return new jt(Kt(this.value))}}function Qt(r){const e=[];return ht(r.fields,(s,o)=>{const a=new _t([s]);if(qt(o)){const d=Qt(o.mapValue).fields;if(d.length===0)e.push(a);else for(const u of d)e.push(a.child(u))}else e.push(a)}),new mt(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wt{constructor(e,s,o,a,d){this.key=e,this.documentType=s,this.version=o,this.data=a,this.documentState=d}static newInvalidDocument(e){return new Wt(e,0,ct.min(),jt.empty(),0)}static newFoundDocument(e,s,o){return new Wt(e,1,s,o,0)}static newNoDocument(e,s){return new Wt(e,2,s,jt.empty(),0)}static newUnknownDocument(e,s){return new Wt(e,3,s,jt.empty(),2)}convertToFoundDocument(e,s){return this.version=e,this.documentType=1,this.data=s,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=jt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=jt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Wt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}clone(){return new Wt(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gt{constructor(e,s=null,o=[],a=[],d=null,u=null,f=null){this.path=e,this.collectionGroup=s,this.orderBy=o,this.filters=a,this.limit=d,this.startAt=u,this.endAt=f,this.R=null}}function zt(r,e=null,s=[],o=[],a=null,d=null,u=null){return new Gt(r,e,s,o,a,d,u)}function Ht(r){const e=q(r);if(e.R===null){let s=e.path.canonicalString();e.collectionGroup!==null&&(s+="|cg:"+e.collectionGroup),s+="|f:",s+=e.filters.map(o=>te(o)).join(","),s+="|ob:",s+=e.orderBy.map(o=>function(a){return a.field.canonicalString()+a.dir}(o)).join(","),bt(e.limit)||(s+="|l:",s+=e.limit),e.startAt&&(s+="|lb:",s+=he(e.startAt)),e.endAt&&(s+="|ub:",s+=he(e.endAt)),e.R=s}return e.R}function Jt(r){let e=r.path.canonicalString();return r.collectionGroup!==null&&(e+=" collectionGroup="+r.collectionGroup),r.filters.length>0&&(e+=`, filters: [${r.filters.map(s=>{return`${(o=s).field.canonicalString()} ${o.op} ${$t(o.value)}`;var o}).join(", ")}]`),bt(r.limit)||(e+=", limit: "+r.limit),r.orderBy.length>0&&(e+=`, orderBy: [${r.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),r.startAt&&(e+=", startAt: "+he(r.startAt)),r.endAt&&(e+=", endAt: "+he(r.endAt)),`Target(${e})`}function Yt(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let a=0;a<r.orderBy.length;a++)if(!fe(r.orderBy[a],e.orderBy[a]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let a=0;a<r.filters.length;a++)if(s=r.filters[a],o=e.filters[a],s.op!==o.op||!s.field.isEqual(o.field)||!Ct(s.value,o.value))return!1;var s,o;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!we(r.startAt,e.startAt)&&we(r.endAt,e.endAt)}function Xt(r){return St.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}class Zt extends class{}{constructor(e,s,o){super(),this.field=e,this.op=s,this.value=o}static create(e,s,o){return e.isKeyField()?s==="in"||s==="not-in"?this.P(e,s,o):new ee(e,s,o):s==="array-contains"?new re(e,o):s==="in"?new oe(e,o):s==="not-in"?new ae(e,o):s==="array-contains-any"?new ce(e,o):new Zt(e,s,o)}static P(e,s,o){return s==="in"?new ne(e,o):new se(e,o)}matches(e){const s=e.data.field(this.field);return this.op==="!="?s!==null&&this.v(kt(s,this.value)):s!==null&&Dt(this.value)===Dt(s)&&this.v(kt(s,this.value))}v(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return L()}}V(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}function te(r){return r.field.canonicalString()+r.op.toString()+$t(r.value)}class ee extends Zt{constructor(e,s,o){super(e,s,o),this.key=St.fromName(o.referenceValue)}matches(e){const s=St.comparator(e.key,this.key);return this.v(s)}}class ne extends Zt{constructor(e,s){super(e,"in",s),this.keys=ie("in",s)}matches(e){return this.keys.some(s=>s.isEqual(e.key))}}class se extends Zt{constructor(e,s){super(e,"not-in",s),this.keys=ie("not-in",s)}matches(e){return!this.keys.some(s=>s.isEqual(e.key))}}function ie(r,e){var s;return(((s=e.arrayValue)===null||s===void 0?void 0:s.values)||[]).map(o=>St.fromName(o.referenceValue))}class re extends Zt{constructor(e,s){super(e,"array-contains",s)}matches(e){const s=e.data.field(this.field);return Lt(s)&&Nt(s.arrayValue,this.value)}}class oe extends Zt{constructor(e,s){super(e,"in",s)}matches(e){const s=e.data.field(this.field);return s!==null&&Nt(this.value.arrayValue,s)}}class ae extends Zt{constructor(e,s){super(e,"not-in",s)}matches(e){if(Nt(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const s=e.data.field(this.field);return s!==null&&!Nt(this.value.arrayValue,s)}}class ce extends Zt{constructor(e,s){super(e,"array-contains-any",s)}matches(e){const s=e.data.field(this.field);return!(!Lt(s)||!s.arrayValue.values)&&s.arrayValue.values.some(o=>Nt(this.value.arrayValue,o))}}class ue{constructor(e,s){this.position=e,this.before=s}}function he(r){return`${r.before?"b":"a"}:${r.position.map(e=>$t(e)).join(",")}`}class le{constructor(e,s="asc"){this.field=e,this.dir=s}}function fe(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}function de(r,e,s){let o=0;for(let a=0;a<r.position.length;a++){const d=e[a],u=r.position[a];if(d.field.isKeyField()?o=St.comparator(St.fromName(u.referenceValue),s.key):o=kt(u,s.data.field(d.field)),d.dir==="desc"&&(o*=-1),o!==0)break}return r.before?o<=0:o<0}function we(r,e){if(r===null)return e===null;if(e===null||r.before!==e.before||r.position.length!==e.position.length)return!1;for(let s=0;s<r.position.length;s++)if(!Ct(r.position[s],e.position[s]))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _e{constructor(e,s=null,o=[],a=[],d=null,u="F",f=null,h=null){this.path=e,this.collectionGroup=s,this.explicitOrderBy=o,this.filters=a,this.limit=d,this.limitType=u,this.startAt=f,this.endAt=h,this.S=null,this.D=null,this.startAt,this.endAt}}function me(r,e,s,o,a,d,u,f){return new _e(r,e,s,o,a,d,u,f)}function ge(r){return new _e(r)}function ye(r){return!bt(r.limit)&&r.limitType==="F"}function pe(r){return!bt(r.limit)&&r.limitType==="L"}function Te(r){return r.explicitOrderBy.length>0?r.explicitOrderBy[0].field:null}function Ee(r){for(const e of r.filters)if(e.V())return e.field;return null}function Ie(r){return r.collectionGroup!==null}function Ae(r){const e=q(r);if(e.S===null){e.S=[];const s=Ee(e),o=Te(e);if(s!==null&&o===null)s.isKeyField()||e.S.push(new le(s)),e.S.push(new le(_t.keyField(),"asc"));else{let a=!1;for(const d of e.explicitOrderBy)e.S.push(d),d.field.isKeyField()&&(a=!0);if(!a){const d=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.S.push(new le(_t.keyField(),d))}}}return e.S}function Re(r){const e=q(r);if(!e.D)if(e.limitType==="F")e.D=zt(e.path,e.collectionGroup,Ae(e),e.filters,e.limit,e.startAt,e.endAt);else{const s=[];for(const d of Ae(e)){const u=d.dir==="desc"?"asc":"desc";s.push(new le(d.field,u))}const o=e.endAt?new ue(e.endAt.position,!e.endAt.before):null,a=e.startAt?new ue(e.startAt.position,!e.startAt.before):null;e.D=zt(e.path,e.collectionGroup,s,e.filters,e.limit,o,a)}return e.D}function Pe(r,e,s){return new _e(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,s,r.startAt,r.endAt)}function be(r,e){return Yt(Re(r),Re(e))&&r.limitType===e.limitType}function ve(r){return`${Ht(Re(r))}|lt:${r.limitType}`}function Ve(r){return`Query(target=${Jt(Re(r))}; limitType=${r.limitType})`}function Se(r,e){return e.isFoundDocument()&&function(s,o){const a=o.key.path;return s.collectionGroup!==null?o.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(a):St.isDocumentKey(s.path)?s.path.isEqual(a):s.path.isImmediateParentOf(a)}(r,e)&&function(s,o){for(const a of s.explicitOrderBy)if(!a.field.isKeyField()&&o.data.field(a.field)===null)return!1;return!0}(r,e)&&function(s,o){for(const a of s.filters)if(!a.matches(o))return!1;return!0}(r,e)&&function(s,o){return!(s.startAt&&!de(s.startAt,Ae(s),o)||s.endAt&&de(s.endAt,Ae(s),o))}(r,e)}function De(r){return(e,s)=>{let o=!1;for(const a of Ae(r)){const d=Ce(a,e,s);if(d!==0)return d;o=o||a.field.isKeyField()}return 0}}function Ce(r,e,s){const o=r.field.isKeyField()?St.comparator(e.key,s.key):function(a,d,u){const f=d.data.field(a),h=u.data.field(a);return f!==null&&h!==null?kt(f,h):L()}(r.field,e,s);switch(r.dir){case"asc":return o;case"desc":return-1*o;default:return L()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ne(r,e){if(r.C){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:vt(e)?"-0":e}}function ke(r){return{integerValue:""+r}}function xe(r,e){return Vt(e)?ke(e):Ne(r,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $e{constructor(){this._=void 0}}function Fe(r,e,s){return r instanceof Le?function(o,a){const d={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:o.seconds,nanos:o.nanoseconds}}}};return a&&(d.fields.__previous_value__=a),{mapValue:d}}(s,e):r instanceof Be?Ue(r,e):r instanceof qe?Ke(r,e):function(o,a){const d=Me(o,a),u=Qe(d)+Qe(o.N);return Mt(d)&&Mt(o.N)?ke(u):Ne(o.k,u)}(r,e)}function Oe(r,e,s){return r instanceof Be?Ue(r,e):r instanceof qe?Ke(r,e):s}function Me(r,e){return r instanceof je?Mt(s=e)||function(o){return!!o&&"doubleValue"in o}(s)?e:{integerValue:0}:null;var s}class Le extends $e{}class Be extends $e{constructor(e){super(),this.elements=e}}function Ue(r,e){const s=We(e);for(const o of r.elements)s.some(a=>Ct(a,o))||s.push(o);return{arrayValue:{values:s}}}class qe extends $e{constructor(e){super(),this.elements=e}}function Ke(r,e){let s=We(e);for(const o of r.elements)s=s.filter(a=>!Ct(a,o));return{arrayValue:{values:s}}}class je extends $e{constructor(e,s){super(),this.k=e,this.N=s}}function Qe(r){return Et(r.integerValue||r.doubleValue)}function We(r){return Lt(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}function ze(r,e){return r.field.isEqual(e.field)&&function(s,o){return s instanceof Be&&o instanceof Be||s instanceof qe&&o instanceof qe?rt(s.elements,o.elements,Ct):s instanceof je&&o instanceof je?Ct(s.N,o.N):s instanceof Le&&o instanceof Le}(r.transform,e.transform)}class He{constructor(e,s){this.version=e,this.transformResults=s}}class Je{constructor(e,s){this.updateTime=e,this.exists=s}static none(){return new Je}static exists(e){return new Je(void 0,e)}static updateTime(e){return new Je(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ye(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}class Xe{}function Ze(r,e,s){r instanceof rn?function(o,a,d){const u=o.value.clone(),f=cn(o.fieldTransforms,a,d.transformResults);u.setAll(f),a.convertToFoundDocument(d.version,u).setHasCommittedMutations()}(r,e,s):r instanceof on?function(o,a,d){if(!Ye(o.precondition,a))return void a.convertToUnknownDocument(d.version);const u=cn(o.fieldTransforms,a,d.transformResults),f=a.data;f.setAll(an(o)),f.setAll(u),a.convertToFoundDocument(d.version,f).setHasCommittedMutations()}(r,e,s):function(o,a,d){a.convertToNoDocument(d.version).setHasCommittedMutations()}(0,e,s)}function tn(r,e,s){r instanceof rn?function(o,a,d){if(!Ye(o.precondition,a))return;const u=o.value.clone(),f=un(o.fieldTransforms,d,a);u.setAll(f),a.convertToFoundDocument(sn(a),u).setHasLocalMutations()}(r,e,s):r instanceof on?function(o,a,d){if(!Ye(o.precondition,a))return;const u=un(o.fieldTransforms,d,a),f=a.data;f.setAll(an(o)),f.setAll(u),a.convertToFoundDocument(sn(a),f).setHasLocalMutations()}(r,e,s):function(o,a){Ye(o.precondition,a)&&a.convertToNoDocument(ct.min())}(r,e)}function en(r,e){let s=null;for(const o of r.fieldTransforms){const a=e.data.field(o.field),d=Me(o.transform,a||null);d!=null&&(s==null&&(s=jt.empty()),s.set(o.field,d))}return s||null}function nn(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!function(s,o){return s===void 0&&o===void 0||!(!s||!o)&&rt(s,o,(a,d)=>ze(a,d))}(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}function sn(r){return r.isFoundDocument()?r.version:ct.min()}class rn extends Xe{constructor(e,s,o,a=[]){super(),this.key=e,this.value=s,this.precondition=o,this.fieldTransforms=a,this.type=0}}class on extends Xe{constructor(e,s,o,a,d=[]){super(),this.key=e,this.data=s,this.fieldMask=o,this.precondition=a,this.fieldTransforms=d,this.type=1}}function an(r){const e=new Map;return r.fieldMask.fields.forEach(s=>{if(!s.isEmpty()){const o=r.data.field(s);e.set(s,o)}}),e}function cn(r,e,s){const o=new Map;B(r.length===s.length);for(let a=0;a<s.length;a++){const d=r[a],u=d.transform,f=e.data.field(d.field);o.set(d.field,Oe(u,f,s[a]))}return o}function un(r,e,s){const o=new Map;for(const a of r){const d=a.transform,u=s.data.field(a.field);o.set(a.field,Fe(d,u,e))}return o}class hn extends Xe{constructor(e,s){super(),this.key=e,this.precondition=s,this.type=2,this.fieldTransforms=[]}}class ln extends Xe{constructor(e,s){super(),this.key=e,this.precondition=s,this.type=3,this.fieldTransforms=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fn{constructor(e){this.count=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var dn,wn;function _n(r){switch(r){default:return L();case K.CANCELLED:case K.UNKNOWN:case K.DEADLINE_EXCEEDED:case K.RESOURCE_EXHAUSTED:case K.INTERNAL:case K.UNAVAILABLE:case K.UNAUTHENTICATED:return!1;case K.INVALID_ARGUMENT:case K.NOT_FOUND:case K.ALREADY_EXISTS:case K.PERMISSION_DENIED:case K.FAILED_PRECONDITION:case K.ABORTED:case K.OUT_OF_RANGE:case K.UNIMPLEMENTED:case K.DATA_LOSS:return!0}}function mn(r){if(r===void 0)return F("GRPC error has no .code"),K.UNKNOWN;switch(r){case dn.OK:return K.OK;case dn.CANCELLED:return K.CANCELLED;case dn.UNKNOWN:return K.UNKNOWN;case dn.DEADLINE_EXCEEDED:return K.DEADLINE_EXCEEDED;case dn.RESOURCE_EXHAUSTED:return K.RESOURCE_EXHAUSTED;case dn.INTERNAL:return K.INTERNAL;case dn.UNAVAILABLE:return K.UNAVAILABLE;case dn.UNAUTHENTICATED:return K.UNAUTHENTICATED;case dn.INVALID_ARGUMENT:return K.INVALID_ARGUMENT;case dn.NOT_FOUND:return K.NOT_FOUND;case dn.ALREADY_EXISTS:return K.ALREADY_EXISTS;case dn.PERMISSION_DENIED:return K.PERMISSION_DENIED;case dn.FAILED_PRECONDITION:return K.FAILED_PRECONDITION;case dn.ABORTED:return K.ABORTED;case dn.OUT_OF_RANGE:return K.OUT_OF_RANGE;case dn.UNIMPLEMENTED:return K.UNIMPLEMENTED;case dn.DATA_LOSS:return K.DATA_LOSS;default:return L()}}(wn=dn||(dn={}))[wn.OK=0]="OK",wn[wn.CANCELLED=1]="CANCELLED",wn[wn.UNKNOWN=2]="UNKNOWN",wn[wn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",wn[wn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",wn[wn.NOT_FOUND=5]="NOT_FOUND",wn[wn.ALREADY_EXISTS=6]="ALREADY_EXISTS",wn[wn.PERMISSION_DENIED=7]="PERMISSION_DENIED",wn[wn.UNAUTHENTICATED=16]="UNAUTHENTICATED",wn[wn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",wn[wn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",wn[wn.ABORTED=10]="ABORTED",wn[wn.OUT_OF_RANGE=11]="OUT_OF_RANGE",wn[wn.UNIMPLEMENTED=12]="UNIMPLEMENTED",wn[wn.INTERNAL=13]="INTERNAL",wn[wn.UNAVAILABLE=14]="UNAVAILABLE",wn[wn.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gn{constructor(e,s){this.comparator=e,this.root=s||pn.EMPTY}insert(e,s){return new gn(this.comparator,this.root.insert(e,s,this.comparator).copy(null,null,pn.BLACK,null,null))}remove(e){return new gn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,pn.BLACK,null,null))}get(e){let s=this.root;for(;!s.isEmpty();){const o=this.comparator(e,s.key);if(o===0)return s.value;o<0?s=s.left:o>0&&(s=s.right)}return null}indexOf(e){let s=0,o=this.root;for(;!o.isEmpty();){const a=this.comparator(e,o.key);if(a===0)return s+o.left.size;a<0?o=o.left:(s+=o.left.size+1,o=o.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((s,o)=>(e(s,o),!1))}toString(){const e=[];return this.inorderTraversal((s,o)=>(e.push(`${s}:${o}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new yn(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new yn(this.root,e,this.comparator,!1)}getReverseIterator(){return new yn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new yn(this.root,e,this.comparator,!0)}}class yn{constructor(e,s,o,a){this.isReverse=a,this.nodeStack=[];let d=1;for(;!e.isEmpty();)if(d=s?o(e.key,s):1,a&&(d*=-1),d<0)e=this.isReverse?e.left:e.right;else{if(d===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const s={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return s}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class pn{constructor(e,s,o,a,d){this.key=e,this.value=s,this.color=o!=null?o:pn.RED,this.left=a!=null?a:pn.EMPTY,this.right=d!=null?d:pn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,s,o,a,d){return new pn(e!=null?e:this.key,s!=null?s:this.value,o!=null?o:this.color,a!=null?a:this.left,d!=null?d:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,s,o){let a=this;const d=o(e,a.key);return a=d<0?a.copy(null,null,null,a.left.insert(e,s,o),null):d===0?a.copy(null,s,null,null,null):a.copy(null,null,null,null,a.right.insert(e,s,o)),a.fixUp()}removeMin(){if(this.left.isEmpty())return pn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,s){let o,a=this;if(s(e,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(e,s),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),s(e,a.key)===0){if(a.right.isEmpty())return pn.EMPTY;o=a.right.min(),a=a.copy(o.key,o.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(e,s))}return a.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,pn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,pn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,s)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw L();const e=this.left.check();if(e!==this.right.check())throw L();return e+(this.isRed()?0:1)}}pn.EMPTY=null,pn.RED=!0,pn.BLACK=!1;pn.EMPTY=new class{constructor(){this.size=0}get key(){throw L()}get value(){throw L()}get color(){throw L()}get left(){throw L()}get right(){throw L()}copy(r,e,s,o,a){return this}insert(r,e,s){return new pn(r,e)}remove(r,e){return this}isEmpty(){return!0}inorderTraversal(r){return!1}reverseTraversal(r){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tn{constructor(e){this.comparator=e,this.data=new gn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((s,o)=>(e(s),!1))}forEachInRange(e,s){const o=this.data.getIteratorFrom(e[0]);for(;o.hasNext();){const a=o.getNext();if(this.comparator(a.key,e[1])>=0)return;s(a.key)}}forEachWhile(e,s){let o;for(o=s!==void 0?this.data.getIteratorFrom(s):this.data.getIterator();o.hasNext();)if(!e(o.getNext().key))return}firstAfterOrEqual(e){const s=this.data.getIteratorFrom(e);return s.hasNext()?s.getNext().key:null}getIterator(){return new En(this.data.getIterator())}getIteratorFrom(e){return new En(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let s=this;return s.size<e.size&&(s=e,e=this),e.forEach(o=>{s=s.add(o)}),s}isEqual(e){if(!(e instanceof Tn)||this.size!==e.size)return!1;const s=this.data.getIterator(),o=e.data.getIterator();for(;s.hasNext();){const a=s.getNext().key,d=o.getNext().key;if(this.comparator(a,d)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(s=>{e.push(s)}),e}toString(){const e=[];return this.forEach(s=>e.push(s)),"SortedSet("+e.toString()+")"}copy(e){const s=new Tn(this.comparator);return s.data=e,s}}class En{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const In=new gn(St.comparator);function An(){return In}const Rn=new gn(St.comparator);function Pn(){return Rn}const bn=new gn(St.comparator);function vn(){return bn}const Vn=new Tn(St.comparator);function Sn(...r){let e=Vn;for(const s of r)e=e.add(s);return e}const Dn=new Tn(it);function Cn(){return Dn}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nn{constructor(e,s,o,a,d){this.snapshotVersion=e,this.targetChanges=s,this.targetMismatches=o,this.documentUpdates=a,this.resolvedLimboDocuments=d}static createSynthesizedRemoteEventForCurrentChange(e,s){const o=new Map;return o.set(e,kn.createSynthesizedTargetChangeForCurrentChange(e,s)),new Nn(ct.min(),o,Cn(),An(),Sn())}}class kn{constructor(e,s,o,a,d){this.resumeToken=e,this.current=s,this.addedDocuments=o,this.modifiedDocuments=a,this.removedDocuments=d}static createSynthesizedTargetChangeForCurrentChange(e,s){return new kn(yt.EMPTY_BYTE_STRING,s,Sn(),Sn(),Sn())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xn{constructor(e,s,o,a){this.$=e,this.removedTargetIds=s,this.key=o,this.F=a}}class $n{constructor(e,s){this.targetId=e,this.O=s}}class Fn{constructor(e,s,o=yt.EMPTY_BYTE_STRING,a=null){this.state=e,this.targetIds=s,this.resumeToken=o,this.cause=a}}class On{constructor(){this.M=0,this.L=Bn(),this.B=yt.EMPTY_BYTE_STRING,this.U=!1,this.q=!0}get current(){return this.U}get resumeToken(){return this.B}get K(){return this.M!==0}get j(){return this.q}W(e){e.approximateByteSize()>0&&(this.q=!0,this.B=e)}G(){let e=Sn(),s=Sn(),o=Sn();return this.L.forEach((a,d)=>{switch(d){case 0:e=e.add(a);break;case 2:s=s.add(a);break;case 1:o=o.add(a);break;default:L()}}),new kn(this.B,this.U,e,s,o)}H(){this.q=!1,this.L=Bn()}J(e,s){this.q=!0,this.L=this.L.insert(e,s)}Y(e){this.q=!0,this.L=this.L.remove(e)}X(){this.M+=1}Z(){this.M-=1}tt(){this.q=!0,this.U=!0}}class Mn{constructor(e){this.et=e,this.nt=new Map,this.st=An(),this.it=Ln(),this.rt=new Tn(it)}ot(e){for(const s of e.$)e.F&&e.F.isFoundDocument()?this.at(s,e.F):this.ct(s,e.key,e.F);for(const s of e.removedTargetIds)this.ct(s,e.key,e.F)}ut(e){this.forEachTarget(e,s=>{const o=this.ht(s);switch(e.state){case 0:this.lt(s)&&o.W(e.resumeToken);break;case 1:o.Z(),o.K||o.H(),o.W(e.resumeToken);break;case 2:o.Z(),o.K||this.removeTarget(s);break;case 3:this.lt(s)&&(o.tt(),o.W(e.resumeToken));break;case 4:this.lt(s)&&(this.ft(s),o.W(e.resumeToken));break;default:L()}})}forEachTarget(e,s){e.targetIds.length>0?e.targetIds.forEach(s):this.nt.forEach((o,a)=>{this.lt(a)&&s(a)})}dt(e){const s=e.targetId,o=e.O.count,a=this.wt(s);if(a){const d=a.target;if(Xt(d))if(o===0){const u=new St(d.path);this.ct(s,u,Wt.newNoDocument(u,ct.min()))}else B(o===1);else this._t(s)!==o&&(this.ft(s),this.rt=this.rt.add(s))}}gt(e){const s=new Map;this.nt.forEach((d,u)=>{const f=this.wt(u);if(f){if(d.current&&Xt(f.target)){const h=new St(f.target.path);this.st.get(h)!==null||this.yt(u,h)||this.ct(u,h,Wt.newNoDocument(h,e))}d.j&&(s.set(u,d.G()),d.H())}});let o=Sn();this.it.forEach((d,u)=>{let f=!0;u.forEachWhile(h=>{const g=this.wt(h);return!g||g.purpose===2||(f=!1,!1)}),f&&(o=o.add(d))});const a=new Nn(e,s,this.rt,this.st,o);return this.st=An(),this.it=Ln(),this.rt=new Tn(it),a}at(e,s){if(!this.lt(e))return;const o=this.yt(e,s.key)?2:0;this.ht(e).J(s.key,o),this.st=this.st.insert(s.key,s),this.it=this.it.insert(s.key,this.Tt(s.key).add(e))}ct(e,s,o){if(!this.lt(e))return;const a=this.ht(e);this.yt(e,s)?a.J(s,1):a.Y(s),this.it=this.it.insert(s,this.Tt(s).delete(e)),o&&(this.st=this.st.insert(s,o))}removeTarget(e){this.nt.delete(e)}_t(e){const s=this.ht(e).G();return this.et.getRemoteKeysForTarget(e).size+s.addedDocuments.size-s.removedDocuments.size}X(e){this.ht(e).X()}ht(e){let s=this.nt.get(e);return s||(s=new On,this.nt.set(e,s)),s}Tt(e){let s=this.it.get(e);return s||(s=new Tn(it),this.it=this.it.insert(e,s)),s}lt(e){const s=this.wt(e)!==null;return s||$$1("WatchChangeAggregator","Detected inactive target",e),s}wt(e){const s=this.nt.get(e);return s&&s.K?null:this.et.Et(e)}ft(e){this.nt.set(e,new On),this.et.getRemoteKeysForTarget(e).forEach(s=>{this.ct(e,s,null)})}yt(e,s){return this.et.getRemoteKeysForTarget(e).has(s)}}function Ln(){return new gn(St.comparator)}function Bn(){return new gn(St.comparator)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Un=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),qn=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))();class Kn{constructor(e,s){this.databaseId=e,this.C=s}}function jn(r,e){return r.C?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Qn(r,e){return r.C?e.toBase64():e.toUint8Array()}function Wn(r,e){return jn(r,e.toTimestamp())}function Gn(r){return B(!!r),ct.fromTimestamp(function(e){const s=Tt(e);return new at(s.seconds,s.nanos)}(r))}function zn(r,e){return function(s){return new dt(["projects",s.projectId,"databases",s.database])}(r).child("documents").child(e).canonicalString()}function Hn(r){const e=dt.fromString(r);return B(As(e)),e}function Jn(r,e){return zn(r.databaseId,e.path)}function Yn(r,e){const s=Hn(e);if(s.get(1)!==r.databaseId.projectId)throw new j(K.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+s.get(1)+" vs "+r.databaseId.projectId);if(s.get(3)!==r.databaseId.database)throw new j(K.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+s.get(3)+" vs "+r.databaseId.database);return new St(es(s))}function Xn(r,e){return zn(r.databaseId,e)}function Zn(r){const e=Hn(r);return e.length===4?dt.emptyPath():es(e)}function ts(r){return new dt(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function es(r){return B(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function ns(r,e,s){return{name:Jn(r,e),fields:s.value.mapValue.fields}}function rs(r,e){let s;if("targetChange"in e){e.targetChange;const o=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:L()}(e.targetChange.targetChangeType||"NO_CHANGE"),a=e.targetChange.targetIds||[],d=function(h,g){return h.C?(B(g===void 0||typeof g=="string"),yt.fromBase64String(g||"")):(B(g===void 0||g instanceof Uint8Array),yt.fromUint8Array(g||new Uint8Array))}(r,e.targetChange.resumeToken),u=e.targetChange.cause,f=u&&function(h){const g=h.code===void 0?K.UNKNOWN:mn(h.code);return new j(g,h.message||"")}(u);s=new Fn(o,a,d,f||null)}else if("documentChange"in e){e.documentChange;const o=e.documentChange;o.document,o.document.name,o.document.updateTime;const a=Yn(r,o.document.name),d=Gn(o.document.updateTime),u=new jt({mapValue:{fields:o.document.fields}}),f=Wt.newFoundDocument(a,d,u),h=o.targetIds||[],g=o.removedTargetIds||[];s=new xn(h,g,f.key,f)}else if("documentDelete"in e){e.documentDelete;const o=e.documentDelete;o.document;const a=Yn(r,o.document),d=o.readTime?Gn(o.readTime):ct.min(),u=Wt.newNoDocument(a,d),f=o.removedTargetIds||[];s=new xn([],f,u.key,u)}else if("documentRemove"in e){e.documentRemove;const o=e.documentRemove;o.document;const a=Yn(r,o.document),d=o.removedTargetIds||[];s=new xn([],d,a,null)}else{if(!("filter"in e))return L();{e.filter;const o=e.filter;o.targetId;const a=o.count||0,d=new fn(a),u=o.targetId;s=new $n(u,d)}}return s}function os(r,e){let s;if(e instanceof rn)s={update:ns(r,e.key,e.value)};else if(e instanceof hn)s={delete:Jn(r,e.key)};else if(e instanceof on)s={update:ns(r,e.key,e.data),updateMask:Is(e.fieldMask)};else{if(!(e instanceof ln))return L();s={verify:Jn(r,e.key)}}return e.fieldTransforms.length>0&&(s.updateTransforms=e.fieldTransforms.map(o=>function(a,d){const u=d.transform;if(u instanceof Le)return{fieldPath:d.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Be)return{fieldPath:d.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof qe)return{fieldPath:d.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof je)return{fieldPath:d.field.canonicalString(),increment:u.N};throw L()}(0,o))),e.precondition.isNone||(s.currentDocument=function(o,a){return a.updateTime!==void 0?{updateTime:Wn(o,a.updateTime)}:a.exists!==void 0?{exists:a.exists}:L()}(r,e.precondition)),s}function cs(r,e){return r&&r.length>0?(B(e!==void 0),r.map(s=>function(o,a){let d=o.updateTime?Gn(o.updateTime):Gn(a);return d.isEqual(ct.min())&&(d=Gn(a)),new He(d,o.transformResults||[])}(s,e))):[]}function us(r,e){return{documents:[Xn(r,e.path)]}}function hs(r,e){const s={structuredQuery:{}},o=e.path;e.collectionGroup!==null?(s.parent=Xn(r,o),s.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s.parent=Xn(r,o.popLast()),s.structuredQuery.from=[{collectionId:o.lastSegment()}]);const a=function(f){if(f.length===0)return;const h=f.map(g=>function(b){if(b.op==="=="){if(Ut(b.value))return{unaryFilter:{field:ys(b.field),op:"IS_NAN"}};if(Bt(b.value))return{unaryFilter:{field:ys(b.field),op:"IS_NULL"}}}else if(b.op==="!="){if(Ut(b.value))return{unaryFilter:{field:ys(b.field),op:"IS_NOT_NAN"}};if(Bt(b.value))return{unaryFilter:{field:ys(b.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ys(b.field),op:gs(b.op),value:b.value}}}(g));return h.length===1?h[0]:{compositeFilter:{op:"AND",filters:h}}}(e.filters);a&&(s.structuredQuery.where=a);const d=function(f){if(f.length!==0)return f.map(h=>function(g){return{field:ys(g.field),direction:ms(g.dir)}}(h))}(e.orderBy);d&&(s.structuredQuery.orderBy=d);const u=function(f,h){return f.C||bt(h)?h:{value:h}}(r,e.limit);return u!==null&&(s.structuredQuery.limit=u),e.startAt&&(s.structuredQuery.startAt=ws(e.startAt)),e.endAt&&(s.structuredQuery.endAt=ws(e.endAt)),s}function ls(r){let e=Zn(r.parent);const s=r.structuredQuery,o=s.from?s.from.length:0;let a=null;if(o>0){B(o===1);const b=s.from[0];b.allDescendants?a=b.collectionId:e=e.child(b.collectionId)}let d=[];s.where&&(d=ds(s.where));let u=[];s.orderBy&&(u=s.orderBy.map(b=>function(m){return new le(ps(m.field),function(_){switch(_){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(m.direction))}(b)));let f=null;s.limit&&(f=function(b){let m;return m=typeof b=="object"?b.value:b,bt(m)?null:m}(s.limit));let h=null;s.startAt&&(h=_s(s.startAt));let g=null;return s.endAt&&(g=_s(s.endAt)),me(e,a,u,d,f,"F",h,g)}function fs(r,e){const s=function(o,a){switch(a){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return L()}}(0,e.purpose);return s==null?null:{"goog-listen-tags":s}}function ds(r){return r?r.unaryFilter!==void 0?[Es(r)]:r.fieldFilter!==void 0?[Ts(r)]:r.compositeFilter!==void 0?r.compositeFilter.filters.map(e=>ds(e)).reduce((e,s)=>e.concat(s)):L():[]}function ws(r){return{before:r.before,values:r.position}}function _s(r){const e=!!r.before,s=r.values||[];return new ue(s,e)}function ms(r){return Un[r]}function gs(r){return qn[r]}function ys(r){return{fieldPath:r.canonicalString()}}function ps(r){return _t.fromServerFormat(r.fieldPath)}function Ts(r){return Zt.create(ps(r.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return L()}}(r.fieldFilter.op),r.fieldFilter.value)}function Es(r){switch(r.unaryFilter.op){case"IS_NAN":const e=ps(r.unaryFilter.field);return Zt.create(e,"==",{doubleValue:NaN});case"IS_NULL":const s=ps(r.unaryFilter.field);return Zt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=ps(r.unaryFilter.field);return Zt.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=ps(r.unaryFilter.field);return Zt.create(a,"!=",{nullValue:"NULL_VALUE"});default:return L()}}function Is(r){const e=[];return r.fields.forEach(s=>e.push(s.canonicalString())),{fieldPaths:e}}function As(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}const Qs="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ws{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gs{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(s=>{this.isDone=!0,this.result=s,this.nextCallback&&this.nextCallback(s)},s=>{this.isDone=!0,this.error=s,this.catchCallback&&this.catchCallback(s)})}catch(e){return this.next(void 0,e)}next(e,s){return this.callbackAttached&&L(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(s,this.error):this.wrapSuccess(e,this.result):new Gs((o,a)=>{this.nextCallback=d=>{this.wrapSuccess(e,d).next(o,a)},this.catchCallback=d=>{this.wrapFailure(s,d).next(o,a)}})}toPromise(){return new Promise((e,s)=>{this.next(e,s)})}wrapUserFunction(e){try{const s=e();return s instanceof Gs?s:Gs.resolve(s)}catch(s){return Gs.reject(s)}}wrapSuccess(e,s){return e?this.wrapUserFunction(()=>e(s)):Gs.resolve(s)}wrapFailure(e,s){return e?this.wrapUserFunction(()=>e(s)):Gs.reject(s)}static resolve(e){return new Gs((s,o)=>{s(e)})}static reject(e){return new Gs((s,o)=>{o(e)})}static waitFor(e){return new Gs((s,o)=>{let a=0,d=0,u=!1;e.forEach(f=>{++a,f.next(()=>{++d,u&&d===a&&s()},h=>o(h))}),u=!0,d===a&&s()})}static or(e){let s=Gs.resolve(!1);for(const o of e)s=s.next(a=>a?Gs.resolve(a):o());return s}static forEach(e,s){const o=[];return e.forEach((a,d)=>{o.push(s.call(this,a,d))}),this.waitFor(o)}}function Xs(r){return r.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ri{constructor(e,s,o,a){this.batchId=e,this.localWriteTime=s,this.baseMutations=o,this.mutations=a}applyToRemoteDocument(e,s){const o=s.mutationResults;for(let a=0;a<this.mutations.length;a++){const d=this.mutations[a];d.key.isEqual(e.key)&&Ze(d,e,o[a])}}applyToLocalView(e){for(const s of this.baseMutations)s.key.isEqual(e.key)&&tn(s,e,this.localWriteTime);for(const s of this.mutations)s.key.isEqual(e.key)&&tn(s,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach(s=>{const o=e.get(s.key),a=o;this.applyToLocalView(a),o.isValidDocument()||a.convertToNoDocument(ct.min())})}keys(){return this.mutations.reduce((e,s)=>e.add(s.key),Sn())}isEqual(e){return this.batchId===e.batchId&&rt(this.mutations,e.mutations,(s,o)=>nn(s,o))&&rt(this.baseMutations,e.baseMutations,(s,o)=>nn(s,o))}}class oi{constructor(e,s,o,a){this.batch=e,this.commitVersion=s,this.mutationResults=o,this.docVersions=a}static from(e,s,o){B(e.mutations.length===o.length);let a=vn();const d=e.mutations;for(let u=0;u<d.length;u++)a=a.insert(d[u].key,o[u].version);return new oi(e,s,o,a)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ai{constructor(e,s,o,a,d=ct.min(),u=ct.min(),f=yt.EMPTY_BYTE_STRING){this.target=e,this.targetId=s,this.purpose=o,this.sequenceNumber=a,this.snapshotVersion=d,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=f}withSequenceNumber(e){return new ai(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,s){return new ai(this.target,this.targetId,this.purpose,this.sequenceNumber,s,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new ai(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ci{constructor(e){this.Gt=e}}function yi(r){const e=ls({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?Pe(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ii{constructor(){this.zt=new Ai}addToCollectionParentIndex(e,s){return this.zt.add(s),Gs.resolve()}getCollectionParents(e,s){return Gs.resolve(this.zt.getEntries(s))}}class Ai{constructor(){this.index={}}add(e){const s=e.lastSegment(),o=e.popLast(),a=this.index[s]||new Tn(dt.comparator),d=!a.has(o);return this.index[s]=a.add(o),d}has(e){const s=e.lastSegment(),o=e.popLast(),a=this.index[s];return a&&a.has(o)}getEntries(e){return(this.index[e]||new Tn(dt.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $i{constructor(e){this.se=e}next(){return this.se+=2,this.se}static ie(){return new $i(0)}static re(){return new $i(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bi(r){if(r.code!==K.FAILED_PRECONDITION||r.message!==Qs)throw r;$$1("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gi{constructor(e,s){this.mapKeyFn=e,this.equalsFn=s,this.inner={}}get(e){const s=this.mapKeyFn(e),o=this.inner[s];if(o!==void 0){for(const[a,d]of o)if(this.equalsFn(a,e))return d}}has(e){return this.get(e)!==void 0}set(e,s){const o=this.mapKeyFn(e),a=this.inner[o];if(a!==void 0){for(let d=0;d<a.length;d++)if(this.equalsFn(a[d][0],e))return void(a[d]=[e,s]);a.push([e,s])}else this.inner[o]=[[e,s]]}delete(e){const s=this.mapKeyFn(e),o=this.inner[s];if(o===void 0)return!1;for(let a=0;a<o.length;a++)if(this.equalsFn(o[a][0],e))return o.length===1?delete this.inner[s]:o.splice(a,1),!0;return!1}forEach(e){ht(this.inner,(s,o)=>{for(const[a,d]of o)e(a,d)})}isEmpty(){return lt(this.inner)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zi{constructor(){this.changes=new Gi(e=>e.toString(),(e,s)=>e.isEqual(s)),this.changesApplied=!1}getReadTime(e){const s=this.changes.get(e);return s?s.readTime:ct.min()}addEntry(e,s){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:s})}removeEntry(e,s=null){this.assertNotApplied(),this.changes.set(e,{document:Wt.newInvalidDocument(e),readTime:s})}getEntry(e,s){this.assertNotApplied();const o=this.changes.get(s);return o!==void 0?Gs.resolve(o.document):this.getFromCache(e,s)}getEntries(e,s){return this.getAllFromCache(e,s)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cr{constructor(e,s,o){this.Je=e,this.An=s,this.Jt=o}Rn(e,s){return this.An.getAllMutationBatchesAffectingDocumentKey(e,s).next(o=>this.Pn(e,s,o))}Pn(e,s,o){return this.Je.getEntry(e,s).next(a=>{for(const d of o)d.applyToLocalView(a);return a})}bn(e,s){e.forEach((o,a)=>{for(const d of s)d.applyToLocalView(a)})}vn(e,s){return this.Je.getEntries(e,s).next(o=>this.Vn(e,o).next(()=>o))}Vn(e,s){return this.An.getAllMutationBatchesAffectingDocumentKeys(e,s).next(o=>this.bn(s,o))}getDocumentsMatchingQuery(e,s,o){return function(a){return St.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(s)?this.Sn(e,s.path):Ie(s)?this.Dn(e,s,o):this.Cn(e,s,o)}Sn(e,s){return this.Rn(e,new St(s)).next(o=>{let a=Pn();return o.isFoundDocument()&&(a=a.insert(o.key,o)),a})}Dn(e,s,o){const a=s.collectionGroup;let d=Pn();return this.Jt.getCollectionParents(e,a).next(u=>Gs.forEach(u,f=>{const h=function(g,b){return new _e(b,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)}(s,f.child(a));return this.Cn(e,h,o).next(g=>{g.forEach((b,m)=>{d=d.insert(b,m)})})}).next(()=>d))}Cn(e,s,o){let a,d;return this.Je.getDocumentsMatchingQuery(e,s,o).next(u=>(a=u,this.An.getAllMutationBatchesAffectingQuery(e,s))).next(u=>(d=u,this.Nn(e,d,a).next(f=>{a=f;for(const h of d)for(const g of h.mutations){const b=g.key;let m=a.get(b);m==null&&(m=Wt.newInvalidDocument(b),a=a.insert(b,m)),tn(g,m,h.localWriteTime),m.isFoundDocument()||(a=a.remove(b))}}))).next(()=>(a.forEach((u,f)=>{Se(s,f)||(a=a.remove(u))}),a))}Nn(e,s,o){let a=Sn();for(const u of s)for(const f of u.mutations)f instanceof on&&o.get(f.key)===null&&(a=a.add(f.key));let d=o;return this.Je.getEntries(e,a).next(u=>(u.forEach((f,h)=>{h.isFoundDocument()&&(d=d.insert(f,h))}),d))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ur{constructor(e,s,o,a){this.targetId=e,this.fromCache=s,this.kn=o,this.xn=a}static $n(e,s){let o=Sn(),a=Sn();for(const d of s.docChanges)switch(d.type){case 0:o=o.add(d.doc.key);break;case 1:a=a.add(d.doc.key)}return new ur(e,s.fromCache,o,a)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hr{Fn(e){this.On=e}getDocumentsMatchingQuery(e,s,o,a){return function(d){return d.filters.length===0&&d.limit===null&&d.startAt==null&&d.endAt==null&&(d.explicitOrderBy.length===0||d.explicitOrderBy.length===1&&d.explicitOrderBy[0].field.isKeyField())}(s)||o.isEqual(ct.min())?this.Mn(e,s):this.On.vn(e,a).next(d=>{const u=this.Ln(s,d);return(ye(s)||pe(s))&&this.Bn(s.limitType,u,a,o)?this.Mn(e,s):(k()<=LogLevel.DEBUG&&$$1("QueryEngine","Re-using previous result from %s to execute query: %s",o.toString(),Ve(s)),this.On.getDocumentsMatchingQuery(e,s,o).next(f=>(u.forEach(h=>{f=f.insert(h.key,h)}),f)))})}Ln(e,s){let o=new Tn(De(e));return s.forEach((a,d)=>{Se(e,d)&&(o=o.add(d))}),o}Bn(e,s,o,a){if(o.size!==s.size)return!0;const d=e==="F"?s.last():s.first();return!!d&&(d.hasPendingWrites||d.version.compareTo(a)>0)}Mn(e,s){return k()<=LogLevel.DEBUG&&$$1("QueryEngine","Using full collection scan to execute query:",Ve(s)),this.On.getDocumentsMatchingQuery(e,s,ct.min())}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lr{constructor(e,s,o,a){this.persistence=e,this.Un=s,this.k=a,this.qn=new gn(it),this.Kn=new Gi(d=>Ht(d),Yt),this.jn=ct.min(),this.An=e.getMutationQueue(o),this.Qn=e.getRemoteDocumentCache(),this.He=e.getTargetCache(),this.Wn=new cr(this.Qn,this.An,this.persistence.getIndexManager()),this.Ye=e.getBundleCache(),this.Un.Fn(this.Wn)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",s=>e.collect(s,this.qn))}}function fr(r,e,s,o){return new lr(r,e,s,o)}async function dr(r,e){const s=q(r);let o=s.An,a=s.Wn;const d=await s.persistence.runTransaction("Handle user change","readonly",u=>{let f;return s.An.getAllMutationBatches(u).next(h=>(f=h,o=s.persistence.getMutationQueue(e),a=new cr(s.Qn,o,s.persistence.getIndexManager()),o.getAllMutationBatches(u))).next(h=>{const g=[],b=[];let m=Sn();for(const _ of f){g.push(_.batchId);for(const Ge of _.mutations)m=m.add(Ge.key)}for(const _ of h){b.push(_.batchId);for(const Ge of _.mutations)m=m.add(Ge.key)}return a.vn(u,m).next(_=>({Gn:_,removedBatchIds:g,addedBatchIds:b}))})});return s.An=o,s.Wn=a,s.Un.Fn(s.Wn),d}function wr(r,e){const s=q(r);return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",o=>{const a=e.batch.keys(),d=s.Qn.newChangeBuffer({trackRemovals:!0});return function(u,f,h,g){const b=h.batch,m=b.keys();let _=Gs.resolve();return m.forEach(Ge=>{_=_.next(()=>g.getEntry(f,Ge)).next(ot=>{const rr=h.docVersions.get(Ge);B(rr!==null),ot.version.compareTo(rr)<0&&(b.applyToRemoteDocument(ot,h),ot.isValidDocument()&&g.addEntry(ot,h.commitVersion))})}),_.next(()=>u.An.removeMutationBatch(f,b))}(s,o,e,d).next(()=>d.apply(o)).next(()=>s.An.performConsistencyCheck(o)).next(()=>s.Wn.vn(o,a))})}function _r(r){const e=q(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",s=>e.He.getLastRemoteSnapshotVersion(s))}function mr(r,e){const s=q(r),o=e.snapshotVersion;let a=s.qn;return s.persistence.runTransaction("Apply remote event","readwrite-primary",d=>{const u=s.Qn.newChangeBuffer({trackRemovals:!0});a=s.qn;const f=[];e.targetChanges.forEach((g,b)=>{const m=a.get(b);if(!m)return;f.push(s.He.removeMatchingKeys(d,g.removedDocuments,b).next(()=>s.He.addMatchingKeys(d,g.addedDocuments,b)));const _=g.resumeToken;if(_.approximateByteSize()>0){const Ge=m.withResumeToken(_,o).withSequenceNumber(d.currentSequenceNumber);a=a.insert(b,Ge),function(ot,rr,ir){return B(rr.resumeToken.approximateByteSize()>0),ot.resumeToken.approximateByteSize()===0||rr.snapshotVersion.toMicroseconds()-ot.snapshotVersion.toMicroseconds()>=3e8?!0:ir.addedDocuments.size+ir.modifiedDocuments.size+ir.removedDocuments.size>0}(m,Ge,g)&&f.push(s.He.updateTargetData(d,Ge))}});let h=An();if(e.documentUpdates.forEach((g,b)=>{e.resolvedLimboDocuments.has(g)&&f.push(s.persistence.referenceDelegate.updateLimboDocument(d,g))}),f.push(gr(d,u,e.documentUpdates,o,void 0).next(g=>{h=g})),!o.isEqual(ct.min())){const g=s.He.getLastRemoteSnapshotVersion(d).next(b=>s.He.setTargetsMetadata(d,d.currentSequenceNumber,o));f.push(g)}return Gs.waitFor(f).next(()=>u.apply(d)).next(()=>s.Wn.Vn(d,h)).next(()=>h)}).then(d=>(s.qn=a,d))}function gr(r,e,s,o,a){let d=Sn();return s.forEach(u=>d=d.add(u)),e.getEntries(r,d).next(u=>{let f=An();return s.forEach((h,g)=>{const b=u.get(h),m=(a==null?void 0:a.get(h))||o;g.isNoDocument()&&g.version.isEqual(ct.min())?(e.removeEntry(h,m),f=f.insert(h,g)):!b.isValidDocument()||g.version.compareTo(b.version)>0||g.version.compareTo(b.version)===0&&b.hasPendingWrites?(e.addEntry(g,m),f=f.insert(h,g)):$$1("LocalStore","Ignoring outdated watch update for ",h,". Current version:",b.version," Watch version:",g.version)}),f})}function yr(r,e){const s=q(r);return s.persistence.runTransaction("Get next mutation batch","readonly",o=>(e===void 0&&(e=-1),s.An.getNextMutationBatchAfterBatchId(o,e)))}function pr(r,e){const s=q(r);return s.persistence.runTransaction("Allocate target","readwrite",o=>{let a;return s.He.getTargetData(o,e).next(d=>d?(a=d,Gs.resolve(a)):s.He.allocateTargetId(o).next(u=>(a=new ai(e,u,0,o.currentSequenceNumber),s.He.addTargetData(o,a).next(()=>a))))}).then(o=>{const a=s.qn.get(o.targetId);return(a===null||o.snapshotVersion.compareTo(a.snapshotVersion)>0)&&(s.qn=s.qn.insert(o.targetId,o),s.Kn.set(e,o.targetId)),o})}async function Tr(r,e,s){const o=q(r),a=o.qn.get(e),d=s?"readwrite":"readwrite-primary";try{s||await o.persistence.runTransaction("Release target",d,u=>o.persistence.referenceDelegate.removeTarget(u,a))}catch(u){if(!Xs(u))throw u;$$1("LocalStore",`Failed to update sequence numbers for target ${e}: ${u}`)}o.qn=o.qn.remove(e),o.Kn.delete(a.target)}function Er(r,e,s){const o=q(r);let a=ct.min(),d=Sn();return o.persistence.runTransaction("Execute query","readonly",u=>function(f,h,g){const b=q(f),m=b.Kn.get(g);return m!==void 0?Gs.resolve(b.qn.get(m)):b.He.getTargetData(h,g)}(o,u,Re(e)).next(f=>{if(f)return a=f.lastLimboFreeSnapshotVersion,o.He.getMatchingKeysForTargetId(u,f.targetId).next(h=>{d=h})}).next(()=>o.Un.getDocumentsMatchingQuery(u,e,s?a:ct.min(),s?d:Sn())).next(f=>({documents:f,zn:d})))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vr{constructor(e){this.k=e,this.Xn=new Map,this.Zn=new Map}getBundleMetadata(e,s){return Gs.resolve(this.Xn.get(s))}saveBundleMetadata(e,s){var o;return this.Xn.set(s.id,{id:(o=s).id,version:o.version,createTime:Gn(o.createTime)}),Gs.resolve()}getNamedQuery(e,s){return Gs.resolve(this.Zn.get(s))}saveNamedQuery(e,s){return this.Zn.set(s.name,function(o){return{name:o.name,query:yi(o.bundledQuery),readTime:Gn(o.readTime)}}(s)),Gs.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vr{constructor(){this.ts=new Tn(Sr.es),this.ns=new Tn(Sr.ss)}isEmpty(){return this.ts.isEmpty()}addReference(e,s){const o=new Sr(e,s);this.ts=this.ts.add(o),this.ns=this.ns.add(o)}rs(e,s){e.forEach(o=>this.addReference(o,s))}removeReference(e,s){this.os(new Sr(e,s))}cs(e,s){e.forEach(o=>this.removeReference(o,s))}us(e){const s=new St(new dt([])),o=new Sr(s,e),a=new Sr(s,e+1),d=[];return this.ns.forEachInRange([o,a],u=>{this.os(u),d.push(u.key)}),d}hs(){this.ts.forEach(e=>this.os(e))}os(e){this.ts=this.ts.delete(e),this.ns=this.ns.delete(e)}ls(e){const s=new St(new dt([])),o=new Sr(s,e),a=new Sr(s,e+1);let d=Sn();return this.ns.forEachInRange([o,a],u=>{d=d.add(u.key)}),d}containsKey(e){const s=new Sr(e,0),o=this.ts.firstAfterOrEqual(s);return o!==null&&e.isEqual(o.key)}}class Sr{constructor(e,s){this.key=e,this.fs=s}static es(e,s){return St.comparator(e.key,s.key)||it(e.fs,s.fs)}static ss(e,s){return it(e.fs,s.fs)||St.comparator(e.key,s.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dr{constructor(e,s){this.Jt=e,this.referenceDelegate=s,this.An=[],this.ds=1,this.ws=new Tn(Sr.es)}checkEmpty(e){return Gs.resolve(this.An.length===0)}addMutationBatch(e,s,o,a){const d=this.ds;this.ds++,this.An.length>0&&this.An[this.An.length-1];const u=new ri(d,s,o,a);this.An.push(u);for(const f of a)this.ws=this.ws.add(new Sr(f.key,d)),this.Jt.addToCollectionParentIndex(e,f.key.path.popLast());return Gs.resolve(u)}lookupMutationBatch(e,s){return Gs.resolve(this._s(s))}getNextMutationBatchAfterBatchId(e,s){const o=s+1,a=this.gs(o),d=a<0?0:a;return Gs.resolve(this.An.length>d?this.An[d]:null)}getHighestUnacknowledgedBatchId(){return Gs.resolve(this.An.length===0?-1:this.ds-1)}getAllMutationBatches(e){return Gs.resolve(this.An.slice())}getAllMutationBatchesAffectingDocumentKey(e,s){const o=new Sr(s,0),a=new Sr(s,Number.POSITIVE_INFINITY),d=[];return this.ws.forEachInRange([o,a],u=>{const f=this._s(u.fs);d.push(f)}),Gs.resolve(d)}getAllMutationBatchesAffectingDocumentKeys(e,s){let o=new Tn(it);return s.forEach(a=>{const d=new Sr(a,0),u=new Sr(a,Number.POSITIVE_INFINITY);this.ws.forEachInRange([d,u],f=>{o=o.add(f.fs)})}),Gs.resolve(this.ys(o))}getAllMutationBatchesAffectingQuery(e,s){const o=s.path,a=o.length+1;let d=o;St.isDocumentKey(d)||(d=d.child(""));const u=new Sr(new St(d),0);let f=new Tn(it);return this.ws.forEachWhile(h=>{const g=h.key.path;return!!o.isPrefixOf(g)&&(g.length===a&&(f=f.add(h.fs)),!0)},u),Gs.resolve(this.ys(f))}ys(e){const s=[];return e.forEach(o=>{const a=this._s(o);a!==null&&s.push(a)}),s}removeMutationBatch(e,s){B(this.ps(s.batchId,"removed")===0),this.An.shift();let o=this.ws;return Gs.forEach(s.mutations,a=>{const d=new Sr(a.key,s.batchId);return o=o.delete(d),this.referenceDelegate.markPotentiallyOrphaned(e,a.key)}).next(()=>{this.ws=o})}ee(e){}containsKey(e,s){const o=new Sr(s,0),a=this.ws.firstAfterOrEqual(o);return Gs.resolve(s.isEqual(a&&a.key))}performConsistencyCheck(e){return this.An.length,Gs.resolve()}ps(e,s){return this.gs(e)}gs(e){return this.An.length===0?0:e-this.An[0].batchId}_s(e){const s=this.gs(e);return s<0||s>=this.An.length?null:this.An[s]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cr{constructor(e,s){this.Jt=e,this.Ts=s,this.docs=new gn(St.comparator),this.size=0}addEntry(e,s,o){const a=s.key,d=this.docs.get(a),u=d?d.size:0,f=this.Ts(s);return this.docs=this.docs.insert(a,{document:s.clone(),size:f,readTime:o}),this.size+=f-u,this.Jt.addToCollectionParentIndex(e,a.path.popLast())}removeEntry(e){const s=this.docs.get(e);s&&(this.docs=this.docs.remove(e),this.size-=s.size)}getEntry(e,s){const o=this.docs.get(s);return Gs.resolve(o?o.document.clone():Wt.newInvalidDocument(s))}getEntries(e,s){let o=An();return s.forEach(a=>{const d=this.docs.get(a);o=o.insert(a,d?d.document.clone():Wt.newInvalidDocument(a))}),Gs.resolve(o)}getDocumentsMatchingQuery(e,s,o){let a=An();const d=new St(s.path.child("")),u=this.docs.getIteratorFrom(d);for(;u.hasNext();){const{key:f,value:{document:h,readTime:g}}=u.getNext();if(!s.path.isPrefixOf(f.path))break;g.compareTo(o)<=0||Se(s,h)&&(a=a.insert(h.key,h.clone()))}return Gs.resolve(a)}Es(e,s){return Gs.forEach(this.docs,o=>s(o))}newChangeBuffer(e){return new Nr(this)}getSize(e){return Gs.resolve(this.size)}}class Nr extends zi{constructor(e){super(),this.De=e}applyChanges(e){const s=[];return this.changes.forEach((o,a)=>{a.document.isValidDocument()?s.push(this.De.addEntry(e,a.document,this.getReadTime(o))):this.De.removeEntry(o)}),Gs.waitFor(s)}getFromCache(e,s){return this.De.getEntry(e,s)}getAllFromCache(e,s){return this.De.getEntries(e,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kr{constructor(e){this.persistence=e,this.Is=new Gi(s=>Ht(s),Yt),this.lastRemoteSnapshotVersion=ct.min(),this.highestTargetId=0,this.As=0,this.Rs=new Vr,this.targetCount=0,this.Ps=$i.ie()}forEachTarget(e,s){return this.Is.forEach((o,a)=>s(a)),Gs.resolve()}getLastRemoteSnapshotVersion(e){return Gs.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Gs.resolve(this.As)}allocateTargetId(e){return this.highestTargetId=this.Ps.next(),Gs.resolve(this.highestTargetId)}setTargetsMetadata(e,s,o){return o&&(this.lastRemoteSnapshotVersion=o),s>this.As&&(this.As=s),Gs.resolve()}ce(e){this.Is.set(e.target,e);const s=e.targetId;s>this.highestTargetId&&(this.Ps=new $i(s),this.highestTargetId=s),e.sequenceNumber>this.As&&(this.As=e.sequenceNumber)}addTargetData(e,s){return this.ce(s),this.targetCount+=1,Gs.resolve()}updateTargetData(e,s){return this.ce(s),Gs.resolve()}removeTargetData(e,s){return this.Is.delete(s.target),this.Rs.us(s.targetId),this.targetCount-=1,Gs.resolve()}removeTargets(e,s,o){let a=0;const d=[];return this.Is.forEach((u,f)=>{f.sequenceNumber<=s&&o.get(f.targetId)===null&&(this.Is.delete(u),d.push(this.removeMatchingKeysForTargetId(e,f.targetId)),a++)}),Gs.waitFor(d).next(()=>a)}getTargetCount(e){return Gs.resolve(this.targetCount)}getTargetData(e,s){const o=this.Is.get(s)||null;return Gs.resolve(o)}addMatchingKeys(e,s,o){return this.Rs.rs(s,o),Gs.resolve()}removeMatchingKeys(e,s,o){this.Rs.cs(s,o);const a=this.persistence.referenceDelegate,d=[];return a&&s.forEach(u=>{d.push(a.markPotentiallyOrphaned(e,u))}),Gs.waitFor(d)}removeMatchingKeysForTargetId(e,s){return this.Rs.us(s),Gs.resolve()}getMatchingKeysForTargetId(e,s){const o=this.Rs.ls(s);return Gs.resolve(o)}containsKey(e,s){return Gs.resolve(this.Rs.containsKey(s))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xr{constructor(e,s){this.bs={},this.Be=new et(0),this.Ue=!1,this.Ue=!0,this.referenceDelegate=e(this),this.He=new kr(this),this.Jt=new Ii,this.Je=function(o,a){return new Cr(o,a)}(this.Jt,o=>this.referenceDelegate.vs(o)),this.k=new ci(s),this.Ye=new vr(this.k)}start(){return Promise.resolve()}shutdown(){return this.Ue=!1,Promise.resolve()}get started(){return this.Ue}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Jt}getMutationQueue(e){let s=this.bs[e.toKey()];return s||(s=new Dr(this.Jt,this.referenceDelegate),this.bs[e.toKey()]=s),s}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getBundleCache(){return this.Ye}runTransaction(e,s,o){$$1("MemoryPersistence","Starting transaction:",e);const a=new $r(this.Be.next());return this.referenceDelegate.Vs(),o(a).next(d=>this.referenceDelegate.Ss(a).next(()=>d)).toPromise().then(d=>(a.raiseOnCommittedEvent(),d))}Ds(e,s){return Gs.or(Object.values(this.bs).map(o=>()=>o.containsKey(e,s)))}}class $r extends Ws{constructor(e){super(),this.currentSequenceNumber=e}}class Fr{constructor(e){this.persistence=e,this.Cs=new Vr,this.Ns=null}static ks(e){return new Fr(e)}get xs(){if(this.Ns)return this.Ns;throw L()}addReference(e,s,o){return this.Cs.addReference(o,s),this.xs.delete(o.toString()),Gs.resolve()}removeReference(e,s,o){return this.Cs.removeReference(o,s),this.xs.add(o.toString()),Gs.resolve()}markPotentiallyOrphaned(e,s){return this.xs.add(s.toString()),Gs.resolve()}removeTarget(e,s){this.Cs.us(s.targetId).forEach(a=>this.xs.add(a.toString()));const o=this.persistence.getTargetCache();return o.getMatchingKeysForTargetId(e,s.targetId).next(a=>{a.forEach(d=>this.xs.add(d.toString()))}).next(()=>o.removeTargetData(e,s))}Vs(){this.Ns=new Set}Ss(e){const s=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Gs.forEach(this.xs,o=>{const a=St.fromPath(o);return this.$s(e,a).next(d=>{d||s.removeEntry(a)})}).next(()=>(this.Ns=null,s.apply(e)))}updateLimboDocument(e,s){return this.$s(e,s).next(o=>{o?this.xs.delete(s.toString()):this.xs.add(s.toString())})}vs(e){return 0}$s(e,s){return Gs.or([()=>Gs.resolve(this.Cs.containsKey(s)),()=>this.persistence.getTargetCache().containsKey(e,s),()=>this.persistence.Ds(e,s)])}}class jr{constructor(){this.activeTargetIds=Cn()}Ms(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ls(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Os(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Wr{constructor(){this.pi=new jr,this.Ti={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,s,o){}addLocalQueryTarget(e){return this.pi.Ms(e),this.Ti[e]||"not-current"}updateQueryState(e,s,o){this.Ti[e]=s}removeLocalQueryTarget(e){this.pi.Ls(e)}isLocalQueryTarget(e){return this.pi.activeTargetIds.has(e)}clearQueryState(e){delete this.Ti[e]}getAllActiveQueryTargets(){return this.pi.activeTargetIds}isActiveQueryTarget(e){return this.pi.activeTargetIds.has(e)}start(){return this.pi=new jr,Promise.resolve()}handleUserChange(e,s,o){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gr{Ei(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zr{constructor(){this.Ii=()=>this.Ai(),this.Ri=()=>this.Pi(),this.bi=[],this.vi()}Ei(e){this.bi.push(e)}shutdown(){window.removeEventListener("online",this.Ii),window.removeEventListener("offline",this.Ri)}vi(){window.addEventListener("online",this.Ii),window.addEventListener("offline",this.Ri)}Ai(){$$1("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.bi)e(0)}Pi(){$$1("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.bi)e(1)}static bt(){return typeof window!="undefined"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hr={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jr{constructor(e){this.Vi=e.Vi,this.Si=e.Si}Di(e){this.Ci=e}Ni(e){this.ki=e}onMessage(e){this.xi=e}close(){this.Si()}send(e){this.Vi(e)}$i(){this.Ci()}Fi(e){this.ki(e)}Oi(e){this.xi(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yr extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const s=e.ssl?"https":"http";this.Mi=s+"://"+e.host,this.Li="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Bi(e,s,o,a,d){const u=this.Ui(e,s);$$1("RestConnection","Sending: ",u,o);const f={};return this.qi(f,a,d),this.Ki(e,u,f,o).then(h=>($$1("RestConnection","Received: ",h),h),h=>{throw O("RestConnection",`${e} failed with error: `,h,"url: ",u,"request:",o),h})}ji(e,s,o,a,d){return this.Bi(e,s,o,a,d)}qi(e,s,o){e["X-Goog-Api-Client"]="gl-js/ fire/"+C,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),s&&s.headers.forEach((a,d)=>e[d]=a),o&&o.headers.forEach((a,d)=>e[d]=a)}Ui(e,s){const o=Hr[e];return`${this.Mi}/v1/${s}:${o}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}Ki(e,s,o,a){return new Promise((d,u)=>{const f=new XhrIo;f.listenOnce(EventType.COMPLETE,()=>{try{switch(f.getLastErrorCode()){case ErrorCode$1.NO_ERROR:const g=f.getResponseJson();$$1("Connection","XHR received:",JSON.stringify(g)),d(g);break;case ErrorCode$1.TIMEOUT:$$1("Connection",'RPC "'+e+'" timed out'),u(new j(K.DEADLINE_EXCEEDED,"Request time out"));break;case ErrorCode$1.HTTP_ERROR:const b=f.getStatus();if($$1("Connection",'RPC "'+e+'" failed with status:',b,"response text:",f.getResponseText()),b>0){const m=f.getResponseJson().error;if(m&&m.status&&m.message){const _=function(Ge){const ot=Ge.toLowerCase().replace(/_/g,"-");return Object.values(K).indexOf(ot)>=0?ot:K.UNKNOWN}(m.status);u(new j(_,m.message))}else u(new j(K.UNKNOWN,"Server responded with status "+f.getStatus()))}else u(new j(K.UNAVAILABLE,"Connection failed."));break;default:L()}}finally{$$1("Connection",'RPC "'+e+'" completed.')}});const h=JSON.stringify(a);f.send(s,"POST",h,o,15)})}Qi(e,s,o){const a=[this.Mi,"/","google.firestore.v1.Firestore","/",e,"/channel"],d=createWebChannelTransport(),u=getStatEventTarget(),f={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(f.xmlHttpFactory=new FetchXmlHttpFactory({})),this.qi(f.initMessageHeaders,s,o),isMobileCordova()||isReactNative()||isElectron()||isIE()||isUWP()||isBrowserExtension()||(f.httpHeadersOverwriteParam="$httpHeaders");const h=a.join("");$$1("Connection","Creating WebChannel: "+h,f);const g=d.createWebChannel(h,f);let b=!1,m=!1;const _=new Jr({Vi:ot=>{m?$$1("Connection","Not sending because WebChannel is closed:",ot):(b||($$1("Connection","Opening WebChannel transport."),g.open(),b=!0),$$1("Connection","WebChannel sending:",ot),g.send(ot))},Si:()=>g.close()}),Ge=(ot,rr,ir)=>{ot.listen(rr,er=>{try{ir(er)}catch(ar){setTimeout(()=>{throw ar},0)}})};return Ge(g,WebChannel.EventType.OPEN,()=>{m||$$1("Connection","WebChannel transport opened.")}),Ge(g,WebChannel.EventType.CLOSE,()=>{m||(m=!0,$$1("Connection","WebChannel transport closed"),_.Fi())}),Ge(g,WebChannel.EventType.ERROR,ot=>{m||(m=!0,O("Connection","WebChannel transport errored:",ot),_.Fi(new j(K.UNAVAILABLE,"The operation could not be completed")))}),Ge(g,WebChannel.EventType.MESSAGE,ot=>{var rr;if(!m){const ir=ot.data[0];B(!!ir);const er=ir,ar=er.error||((rr=er[0])===null||rr===void 0?void 0:rr.error);if(ar){$$1("Connection","WebChannel received error:",ar);const Lr=ar.status;let Mr=function(Qr){const ii=dn[Qr];if(ii!==void 0)return mn(ii)}(Lr),Br=ar.message;Mr===void 0&&(Mr=K.INTERNAL,Br="Unknown error status: "+Lr+" with message "+ar.message),m=!0,_.Fi(new j(Mr,Br)),g.close()}else $$1("Connection","WebChannel received:",ir),_.Oi(ir)}}),Ge(u,Event$1.STAT_EVENT,ot=>{ot.stat===Stat.PROXY?$$1("Connection","Detected buffering proxy"):ot.stat===Stat.NOPROXY&&$$1("Connection","Detected no buffering proxy")}),setTimeout(()=>{_.$i()},0),_}}function Zr(){return typeof document!="undefined"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function to(r){return new Kn(r,!0)}class eo{constructor(e,s,o=1e3,a=1.5,d=6e4){this.Oe=e,this.timerId=s,this.Wi=o,this.Gi=a,this.zi=d,this.Hi=0,this.Ji=null,this.Yi=Date.now(),this.reset()}reset(){this.Hi=0}Xi(){this.Hi=this.zi}Zi(e){this.cancel();const s=Math.floor(this.Hi+this.tr()),o=Math.max(0,Date.now()-this.Yi),a=Math.max(0,s-o);a>0&&$$1("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.Hi} ms, delay with jitter: ${s} ms, last attempt: ${o} ms ago)`),this.Ji=this.Oe.enqueueAfterDelay(this.timerId,a,()=>(this.Yi=Date.now(),e())),this.Hi*=this.Gi,this.Hi<this.Wi&&(this.Hi=this.Wi),this.Hi>this.zi&&(this.Hi=this.zi)}er(){this.Ji!==null&&(this.Ji.skipDelay(),this.Ji=null)}cancel(){this.Ji!==null&&(this.Ji.cancel(),this.Ji=null)}tr(){return(Math.random()-.5)*this.Hi}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class no{constructor(e,s,o,a,d,u,f,h){this.Oe=e,this.nr=o,this.sr=a,this.ir=d,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=f,this.listener=h,this.state=0,this.rr=0,this.ar=null,this.cr=null,this.stream=null,this.ur=new eo(e,s)}hr(){return this.state===1||this.state===5||this.lr()}lr(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.dr()}async stop(){this.hr()&&await this.close(0)}wr(){this.state=0,this.ur.reset()}_r(){this.lr()&&this.ar===null&&(this.ar=this.Oe.enqueueAfterDelay(this.nr,6e4,()=>this.mr()))}gr(e){this.yr(),this.stream.send(e)}async mr(){if(this.lr())return this.close(0)}yr(){this.ar&&(this.ar.cancel(),this.ar=null)}pr(){this.cr&&(this.cr.cancel(),this.cr=null)}async close(e,s){this.yr(),this.pr(),this.ur.cancel(),this.rr++,e!==4?this.ur.reset():s&&s.code===K.RESOURCE_EXHAUSTED?(F(s.toString()),F("Using maximum backoff delay to prevent overloading the backend."),this.ur.Xi()):s&&s.code===K.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.Tr(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Ni(s)}Tr(){}auth(){this.state=1;const e=this.Er(this.rr),s=this.rr;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([o,a])=>{this.rr===s&&this.Ir(o,a)},o=>{e(()=>{const a=new j(K.UNKNOWN,"Fetching auth token failed: "+o.message);return this.Ar(a)})})}Ir(e,s){const o=this.Er(this.rr);this.stream=this.Rr(e,s),this.stream.Di(()=>{o(()=>(this.state=2,this.cr=this.Oe.enqueueAfterDelay(this.sr,1e4,()=>(this.lr()&&(this.state=3),Promise.resolve())),this.listener.Di()))}),this.stream.Ni(a=>{o(()=>this.Ar(a))}),this.stream.onMessage(a=>{o(()=>this.onMessage(a))})}dr(){this.state=5,this.ur.Zi(async()=>{this.state=0,this.start()})}Ar(e){return $$1("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Er(e){return s=>{this.Oe.enqueueAndForget(()=>this.rr===e?s():($$1("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class so extends no{constructor(e,s,o,a,d,u){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",s,o,a,u),this.k=d}Rr(e,s){return this.ir.Qi("Listen",e,s)}onMessage(e){this.ur.reset();const s=rs(this.k,e),o=function(a){if(!("targetChange"in a))return ct.min();const d=a.targetChange;return d.targetIds&&d.targetIds.length?ct.min():d.readTime?Gn(d.readTime):ct.min()}(e);return this.listener.Pr(s,o)}br(e){const s={};s.database=ts(this.k),s.addTarget=function(a,d){let u;const f=d.target;return u=Xt(f)?{documents:us(a,f)}:{query:hs(a,f)},u.targetId=d.targetId,d.resumeToken.approximateByteSize()>0?u.resumeToken=Qn(a,d.resumeToken):d.snapshotVersion.compareTo(ct.min())>0&&(u.readTime=jn(a,d.snapshotVersion.toTimestamp())),u}(this.k,e);const o=fs(this.k,e);o&&(s.labels=o),this.gr(s)}vr(e){const s={};s.database=ts(this.k),s.removeTarget=e,this.gr(s)}}class io extends no{constructor(e,s,o,a,d,u){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",s,o,a,u),this.k=d,this.Vr=!1}get Sr(){return this.Vr}start(){this.Vr=!1,this.lastStreamToken=void 0,super.start()}Tr(){this.Vr&&this.Dr([])}Rr(e,s){return this.ir.Qi("Write",e,s)}onMessage(e){if(B(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Vr){this.ur.reset();const s=cs(e.writeResults,e.commitTime),o=Gn(e.commitTime);return this.listener.Cr(o,s)}return B(!e.writeResults||e.writeResults.length===0),this.Vr=!0,this.listener.Nr()}kr(){const e={};e.database=ts(this.k),this.gr(e)}Dr(e){const s={streamToken:this.lastStreamToken,writes:e.map(o=>os(this.k,o))};this.gr(s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ro extends class{}{constructor(e,s,o,a){super(),this.authCredentials=e,this.appCheckCredentials=s,this.ir=o,this.k=a,this.$r=!1}Fr(){if(this.$r)throw new j(K.FAILED_PRECONDITION,"The client has already been terminated.")}Bi(e,s,o){return this.Fr(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,d])=>this.ir.Bi(e,s,o,a,d)).catch(a=>{throw a.name==="FirebaseError"?(a.code===K.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new j(K.UNKNOWN,a.toString())})}ji(e,s,o){return this.Fr(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,d])=>this.ir.ji(e,s,o,a,d)).catch(a=>{throw a.name==="FirebaseError"?(a.code===K.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new j(K.UNKNOWN,a.toString())})}terminate(){this.$r=!0}}class oo{constructor(e,s){this.asyncQueue=e,this.onlineStateHandler=s,this.state="Unknown",this.Or=0,this.Mr=null,this.Lr=!0}Br(){this.Or===0&&(this.Ur("Unknown"),this.Mr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.Mr=null,this.qr("Backend didn't respond within 10 seconds."),this.Ur("Offline"),Promise.resolve())))}Kr(e){this.state==="Online"?this.Ur("Unknown"):(this.Or++,this.Or>=1&&(this.jr(),this.qr(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.Ur("Offline")))}set(e){this.jr(),this.Or=0,e==="Online"&&(this.Lr=!1),this.Ur(e)}Ur(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}qr(e){const s=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Lr?(F(s),this.Lr=!1):$$1("OnlineStateTracker",s)}jr(){this.Mr!==null&&(this.Mr.cancel(),this.Mr=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ao{constructor(e,s,o,a,d){this.localStore=e,this.datastore=s,this.asyncQueue=o,this.remoteSyncer={},this.Qr=[],this.Wr=new Map,this.Gr=new Set,this.zr=[],this.Hr=d,this.Hr.Ei(u=>{o.enqueueAndForget(async()=>{go(this)&&($$1("RemoteStore","Restarting streams for network reachability change."),await async function(f){const h=q(f);h.Gr.add(4),await uo(h),h.Jr.set("Unknown"),h.Gr.delete(4),await co(h)}(this))})}),this.Jr=new oo(o,a)}}async function co(r){if(go(r))for(const e of r.zr)await e(!0)}async function uo(r){for(const e of r.zr)await e(!1)}function ho(r,e){const s=q(r);s.Wr.has(e.targetId)||(s.Wr.set(e.targetId,e),mo(s)?_o(s):xo(s).lr()&&fo(s,e))}function lo(r,e){const s=q(r),o=xo(s);s.Wr.delete(e),o.lr()&&wo(s,e),s.Wr.size===0&&(o.lr()?o._r():go(s)&&s.Jr.set("Unknown"))}function fo(r,e){r.Yr.X(e.targetId),xo(r).br(e)}function wo(r,e){r.Yr.X(e),xo(r).vr(e)}function _o(r){r.Yr=new Mn({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>r.Wr.get(e)||null}),xo(r).start(),r.Jr.Br()}function mo(r){return go(r)&&!xo(r).hr()&&r.Wr.size>0}function go(r){return q(r).Gr.size===0}function yo(r){r.Yr=void 0}async function po(r){r.Wr.forEach((e,s)=>{fo(r,e)})}async function To(r,e){yo(r),mo(r)?(r.Jr.Kr(e),_o(r)):r.Jr.set("Unknown")}async function Eo(r,e,s){if(r.Jr.set("Online"),e instanceof Fn&&e.state===2&&e.cause)try{await async function(o,a){const d=a.cause;for(const u of a.targetIds)o.Wr.has(u)&&(await o.remoteSyncer.rejectListen(u,d),o.Wr.delete(u),o.Yr.removeTarget(u))}(r,e)}catch(o){$$1("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),o),await Io(r,o)}else if(e instanceof xn?r.Yr.ot(e):e instanceof $n?r.Yr.dt(e):r.Yr.ut(e),!s.isEqual(ct.min()))try{const o=await _r(r.localStore);s.compareTo(o)>=0&&await function(a,d){const u=a.Yr.gt(d);return u.targetChanges.forEach((f,h)=>{if(f.resumeToken.approximateByteSize()>0){const g=a.Wr.get(h);g&&a.Wr.set(h,g.withResumeToken(f.resumeToken,d))}}),u.targetMismatches.forEach(f=>{const h=a.Wr.get(f);if(!h)return;a.Wr.set(f,h.withResumeToken(yt.EMPTY_BYTE_STRING,h.snapshotVersion)),wo(a,f);const g=new ai(h.target,f,1,h.sequenceNumber);fo(a,g)}),a.remoteSyncer.applyRemoteEvent(u)}(r,s)}catch(o){$$1("RemoteStore","Failed to raise snapshot:",o),await Io(r,o)}}async function Io(r,e,s){if(!Xs(e))throw e;r.Gr.add(1),await uo(r),r.Jr.set("Offline"),s||(s=()=>_r(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{$$1("RemoteStore","Retrying IndexedDB access"),await s(),r.Gr.delete(1),await co(r)})}function Ao(r,e){return e().catch(s=>Io(r,s,e))}async function Ro(r){const e=q(r),s=$o(e);let o=e.Qr.length>0?e.Qr[e.Qr.length-1].batchId:-1;for(;Po(e);)try{const a=await yr(e.localStore,o);if(a===null){e.Qr.length===0&&s._r();break}o=a.batchId,bo(e,a)}catch(a){await Io(e,a)}vo(e)&&Vo(e)}function Po(r){return go(r)&&r.Qr.length<10}function bo(r,e){r.Qr.push(e);const s=$o(r);s.lr()&&s.Sr&&s.Dr(e.mutations)}function vo(r){return go(r)&&!$o(r).hr()&&r.Qr.length>0}function Vo(r){$o(r).start()}async function So(r){$o(r).kr()}async function Do(r){const e=$o(r);for(const s of r.Qr)e.Dr(s.mutations)}async function Co(r,e,s){const o=r.Qr.shift(),a=oi.from(o,e,s);await Ao(r,()=>r.remoteSyncer.applySuccessfulWrite(a)),await Ro(r)}async function No(r,e){e&&$o(r).Sr&&await async function(s,o){if(a=o.code,_n(a)&&a!==K.ABORTED){const d=s.Qr.shift();$o(s).wr(),await Ao(s,()=>s.remoteSyncer.rejectFailedWrite(d.batchId,o)),await Ro(s)}var a}(r,e),vo(r)&&Vo(r)}async function ko(r,e){const s=q(r);e?(s.Gr.delete(2),await co(s)):e||(s.Gr.add(2),await uo(s),s.Jr.set("Unknown"))}function xo(r){return r.Xr||(r.Xr=function(e,s,o){const a=q(e);return a.Fr(),new so(s,a.ir,a.authCredentials,a.appCheckCredentials,a.k,o)}(r.datastore,r.asyncQueue,{Di:po.bind(null,r),Ni:To.bind(null,r),Pr:Eo.bind(null,r)}),r.zr.push(async e=>{e?(r.Xr.wr(),mo(r)?_o(r):r.Jr.set("Unknown")):(await r.Xr.stop(),yo(r))})),r.Xr}function $o(r){return r.Zr||(r.Zr=function(e,s,o){const a=q(e);return a.Fr(),new io(s,a.ir,a.authCredentials,a.appCheckCredentials,a.k,o)}(r.datastore,r.asyncQueue,{Di:So.bind(null,r),Ni:No.bind(null,r),Nr:Do.bind(null,r),Cr:Co.bind(null,r)}),r.zr.push(async e=>{e?(r.Zr.wr(),await Ro(r)):(await r.Zr.stop(),r.Qr.length>0&&($$1("RemoteStore",`Stopping write stream with ${r.Qr.length} pending writes`),r.Qr=[]))})),r.Zr}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fo{constructor(e,s,o,a,d){this.asyncQueue=e,this.timerId=s,this.targetTimeMs=o,this.op=a,this.removalCallback=d,this.deferred=new Q,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(u=>{})}static createAndSchedule(e,s,o,a,d){const u=Date.now()+o,f=new Fo(e,s,u,a,d);return f.start(o),f}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new j(K.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Oo(r,e){if(F("AsyncQueue",`${e}: ${r}`),Xs(r))return new j(K.UNAVAILABLE,`${e}: ${r}`);throw r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mo{constructor(e){this.comparator=e?(s,o)=>e(s,o)||St.comparator(s.key,o.key):(s,o)=>St.comparator(s.key,o.key),this.keyedMap=Pn(),this.sortedSet=new gn(this.comparator)}static emptySet(e){return new Mo(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const s=this.keyedMap.get(e);return s?this.sortedSet.indexOf(s):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((s,o)=>(e(s),!1))}add(e){const s=this.delete(e.key);return s.copy(s.keyedMap.insert(e.key,e),s.sortedSet.insert(e,null))}delete(e){const s=this.get(e);return s?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(s)):this}isEqual(e){if(!(e instanceof Mo)||this.size!==e.size)return!1;const s=this.sortedSet.getIterator(),o=e.sortedSet.getIterator();for(;s.hasNext();){const a=s.getNext().key,d=o.getNext().key;if(!a.isEqual(d))return!1}return!0}toString(){const e=[];return this.forEach(s=>{e.push(s.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,s){const o=new Mo;return o.comparator=this.comparator,o.keyedMap=e,o.sortedSet=s,o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lo{constructor(){this.eo=new gn(St.comparator)}track(e){const s=e.doc.key,o=this.eo.get(s);o?e.type!==0&&o.type===3?this.eo=this.eo.insert(s,e):e.type===3&&o.type!==1?this.eo=this.eo.insert(s,{type:o.type,doc:e.doc}):e.type===2&&o.type===2?this.eo=this.eo.insert(s,{type:2,doc:e.doc}):e.type===2&&o.type===0?this.eo=this.eo.insert(s,{type:0,doc:e.doc}):e.type===1&&o.type===0?this.eo=this.eo.remove(s):e.type===1&&o.type===2?this.eo=this.eo.insert(s,{type:1,doc:o.doc}):e.type===0&&o.type===1?this.eo=this.eo.insert(s,{type:2,doc:e.doc}):L():this.eo=this.eo.insert(s,e)}no(){const e=[];return this.eo.inorderTraversal((s,o)=>{e.push(o)}),e}}class Bo{constructor(e,s,o,a,d,u,f,h){this.query=e,this.docs=s,this.oldDocs=o,this.docChanges=a,this.mutatedKeys=d,this.fromCache=u,this.syncStateChanged=f,this.excludesMetadataChanges=h}static fromInitialDocuments(e,s,o,a){const d=[];return s.forEach(u=>{d.push({type:0,doc:u})}),new Bo(e,s,Mo.emptySet(s),d,o,a,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&be(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const s=this.docChanges,o=e.docChanges;if(s.length!==o.length)return!1;for(let a=0;a<s.length;a++)if(s[a].type!==o[a].type||!s[a].doc.isEqual(o[a].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uo{constructor(){this.so=void 0,this.listeners=[]}}class qo{constructor(){this.queries=new Gi(e=>ve(e),be),this.onlineState="Unknown",this.io=new Set}}async function Ko(r,e){const s=q(r),o=e.query;let a=!1,d=s.queries.get(o);if(d||(a=!0,d=new Uo),a)try{d.so=await s.onListen(o)}catch(u){const f=Oo(u,`Initialization of query '${Ve(e.query)}' failed`);return void e.onError(f)}s.queries.set(o,d),d.listeners.push(e),e.ro(s.onlineState),d.so&&e.oo(d.so)&&Go(s)}async function jo(r,e){const s=q(r),o=e.query;let a=!1;const d=s.queries.get(o);if(d){const u=d.listeners.indexOf(e);u>=0&&(d.listeners.splice(u,1),a=d.listeners.length===0)}if(a)return s.queries.delete(o),s.onUnlisten(o)}function Qo(r,e){const s=q(r);let o=!1;for(const a of e){const d=a.query,u=s.queries.get(d);if(u){for(const f of u.listeners)f.oo(a)&&(o=!0);u.so=a}}o&&Go(s)}function Wo(r,e,s){const o=q(r),a=o.queries.get(e);if(a)for(const d of a.listeners)d.onError(s);o.queries.delete(e)}function Go(r){r.io.forEach(e=>{e.next()})}class zo{constructor(e,s,o){this.query=e,this.ao=s,this.co=!1,this.uo=null,this.onlineState="Unknown",this.options=o||{}}oo(e){if(!this.options.includeMetadataChanges){const o=[];for(const a of e.docChanges)a.type!==3&&o.push(a);e=new Bo(e.query,e.docs,e.oldDocs,o,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let s=!1;return this.co?this.ho(e)&&(this.ao.next(e),s=!0):this.lo(e,this.onlineState)&&(this.fo(e),s=!0),this.uo=e,s}onError(e){this.ao.error(e)}ro(e){this.onlineState=e;let s=!1;return this.uo&&!this.co&&this.lo(this.uo,e)&&(this.fo(this.uo),s=!0),s}lo(e,s){if(!e.fromCache)return!0;const o=s!=="Offline";return(!this.options.wo||!o)&&(!e.docs.isEmpty()||s==="Offline")}ho(e){if(e.docChanges.length>0)return!0;const s=this.uo&&this.uo.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!s)&&this.options.includeMetadataChanges===!0}fo(e){e=Bo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.co=!0,this.ao.next(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zo{constructor(e){this.key=e}}class ta{constructor(e){this.key=e}}class ea{constructor(e,s){this.query=e,this.To=s,this.Eo=null,this.current=!1,this.Io=Sn(),this.mutatedKeys=Sn(),this.Ao=De(e),this.Ro=new Mo(this.Ao)}get Po(){return this.To}bo(e,s){const o=s?s.vo:new Lo,a=s?s.Ro:this.Ro;let d=s?s.mutatedKeys:this.mutatedKeys,u=a,f=!1;const h=ye(this.query)&&a.size===this.query.limit?a.last():null,g=pe(this.query)&&a.size===this.query.limit?a.first():null;if(e.inorderTraversal((b,m)=>{const _=a.get(b),Ge=Se(this.query,m)?m:null,ot=!!_&&this.mutatedKeys.has(_.key),rr=!!Ge&&(Ge.hasLocalMutations||this.mutatedKeys.has(Ge.key)&&Ge.hasCommittedMutations);let ir=!1;_&&Ge?_.data.isEqual(Ge.data)?ot!==rr&&(o.track({type:3,doc:Ge}),ir=!0):this.Vo(_,Ge)||(o.track({type:2,doc:Ge}),ir=!0,(h&&this.Ao(Ge,h)>0||g&&this.Ao(Ge,g)<0)&&(f=!0)):!_&&Ge?(o.track({type:0,doc:Ge}),ir=!0):_&&!Ge&&(o.track({type:1,doc:_}),ir=!0,(h||g)&&(f=!0)),ir&&(Ge?(u=u.add(Ge),d=rr?d.add(b):d.delete(b)):(u=u.delete(b),d=d.delete(b)))}),ye(this.query)||pe(this.query))for(;u.size>this.query.limit;){const b=ye(this.query)?u.last():u.first();u=u.delete(b.key),d=d.delete(b.key),o.track({type:1,doc:b})}return{Ro:u,vo:o,Bn:f,mutatedKeys:d}}Vo(e,s){return e.hasLocalMutations&&s.hasCommittedMutations&&!s.hasLocalMutations}applyChanges(e,s,o){const a=this.Ro;this.Ro=e.Ro,this.mutatedKeys=e.mutatedKeys;const d=e.vo.no();d.sort((g,b)=>function(m,_){const Ge=ot=>{switch(ot){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L()}};return Ge(m)-Ge(_)}(g.type,b.type)||this.Ao(g.doc,b.doc)),this.So(o);const u=s?this.Do():[],f=this.Io.size===0&&this.current?1:0,h=f!==this.Eo;return this.Eo=f,d.length!==0||h?{snapshot:new Bo(this.query,e.Ro,a,d,e.mutatedKeys,f===0,h,!1),Co:u}:{Co:u}}ro(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ro:this.Ro,vo:new Lo,mutatedKeys:this.mutatedKeys,Bn:!1},!1)):{Co:[]}}No(e){return!this.To.has(e)&&!!this.Ro.has(e)&&!this.Ro.get(e).hasLocalMutations}So(e){e&&(e.addedDocuments.forEach(s=>this.To=this.To.add(s)),e.modifiedDocuments.forEach(s=>{}),e.removedDocuments.forEach(s=>this.To=this.To.delete(s)),this.current=e.current)}Do(){if(!this.current)return[];const e=this.Io;this.Io=Sn(),this.Ro.forEach(o=>{this.No(o.key)&&(this.Io=this.Io.add(o.key))});const s=[];return e.forEach(o=>{this.Io.has(o)||s.push(new ta(o))}),this.Io.forEach(o=>{e.has(o)||s.push(new Zo(o))}),s}ko(e){this.To=e.zn,this.Io=Sn();const s=this.bo(e.documents);return this.applyChanges(s,!0)}xo(){return Bo.fromInitialDocuments(this.query,this.Ro,this.mutatedKeys,this.Eo===0)}}class na{constructor(e,s,o){this.query=e,this.targetId=s,this.view=o}}class sa{constructor(e){this.key=e,this.$o=!1}}class ia{constructor(e,s,o,a,d,u){this.localStore=e,this.remoteStore=s,this.eventManager=o,this.sharedClientState=a,this.currentUser=d,this.maxConcurrentLimboResolutions=u,this.Fo={},this.Oo=new Gi(f=>ve(f),be),this.Mo=new Map,this.Lo=new Set,this.Bo=new gn(St.comparator),this.Uo=new Map,this.qo=new Vr,this.Ko={},this.jo=new Map,this.Qo=$i.re(),this.onlineState="Unknown",this.Wo=void 0}get isPrimaryClient(){return this.Wo===!0}}async function ra(r,e){const s=xa(r);let o,a;const d=s.Oo.get(e);if(d)o=d.targetId,s.sharedClientState.addLocalQueryTarget(o),a=d.view.xo();else{const u=await pr(s.localStore,Re(e)),f=s.sharedClientState.addLocalQueryTarget(u.targetId);o=u.targetId,a=await oa(s,e,o,f==="current"),s.isPrimaryClient&&ho(s.remoteStore,u)}return a}async function oa(r,e,s,o){r.Go=(b,m,_)=>async function(Ge,ot,rr,ir){let er=ot.view.bo(rr);er.Bn&&(er=await Er(Ge.localStore,ot.query,!1).then(({documents:Mr})=>ot.view.bo(Mr,er)));const ar=ir&&ir.targetChanges.get(ot.targetId),Lr=ot.view.applyChanges(er,Ge.isPrimaryClient,ar);return pa(Ge,ot.targetId,Lr.Co),Lr.snapshot}(r,b,m,_);const a=await Er(r.localStore,e,!0),d=new ea(e,a.zn),u=d.bo(a.documents),f=kn.createSynthesizedTargetChangeForCurrentChange(s,o&&r.onlineState!=="Offline"),h=d.applyChanges(u,r.isPrimaryClient,f);pa(r,s,h.Co);const g=new na(e,s,d);return r.Oo.set(e,g),r.Mo.has(s)?r.Mo.get(s).push(e):r.Mo.set(s,[e]),h.snapshot}async function aa(r,e){const s=q(r),o=s.Oo.get(e),a=s.Mo.get(o.targetId);if(a.length>1)return s.Mo.set(o.targetId,a.filter(d=>!be(d,e))),void s.Oo.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(o.targetId),s.sharedClientState.isActiveQueryTarget(o.targetId)||await Tr(s.localStore,o.targetId,!1).then(()=>{s.sharedClientState.clearQueryState(o.targetId),lo(s.remoteStore,o.targetId),ga(s,o.targetId)}).catch(Bi)):(ga(s,o.targetId),await Tr(s.localStore,o.targetId,!0))}async function ca(r,e,s){const o=$a(r);try{const a=await function(d,u){const f=q(d),h=at.now(),g=u.reduce((m,_)=>m.add(_.key),Sn());let b;return f.persistence.runTransaction("Locally write mutations","readwrite",m=>f.Wn.vn(m,g).next(_=>{b=_;const Ge=[];for(const ot of u){const rr=en(ot,b.get(ot.key));rr!=null&&Ge.push(new on(ot.key,rr,Qt(rr.value.mapValue),Je.exists(!0)))}return f.An.addMutationBatch(m,h,Ge,u)})).then(m=>(m.applyToLocalDocumentSet(b),{batchId:m.batchId,changes:b}))}(o.localStore,e);o.sharedClientState.addPendingMutation(a.batchId),function(d,u,f){let h=d.Ko[d.currentUser.toKey()];h||(h=new gn(it)),h=h.insert(u,f),d.Ko[d.currentUser.toKey()]=h}(o,a.batchId,s),await Ia(o,a.changes),await Ro(o.remoteStore)}catch(a){const d=Oo(a,"Failed to persist write");s.reject(d)}}async function ua(r,e){const s=q(r);try{const o=await mr(s.localStore,e);e.targetChanges.forEach((a,d)=>{const u=s.Uo.get(d);u&&(B(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1),a.addedDocuments.size>0?u.$o=!0:a.modifiedDocuments.size>0?B(u.$o):a.removedDocuments.size>0&&(B(u.$o),u.$o=!1))}),await Ia(s,o,e)}catch(o){await Bi(o)}}function ha(r,e,s){const o=q(r);if(o.isPrimaryClient&&s===0||!o.isPrimaryClient&&s===1){const a=[];o.Oo.forEach((d,u)=>{const f=u.view.ro(e);f.snapshot&&a.push(f.snapshot)}),function(d,u){const f=q(d);f.onlineState=u;let h=!1;f.queries.forEach((g,b)=>{for(const m of b.listeners)m.ro(u)&&(h=!0)}),h&&Go(f)}(o.eventManager,e),a.length&&o.Fo.Pr(a),o.onlineState=e,o.isPrimaryClient&&o.sharedClientState.setOnlineState(e)}}async function la(r,e,s){const o=q(r);o.sharedClientState.updateQueryState(e,"rejected",s);const a=o.Uo.get(e),d=a&&a.key;if(d){let u=new gn(St.comparator);u=u.insert(d,Wt.newNoDocument(d,ct.min()));const f=Sn().add(d),h=new Nn(ct.min(),new Map,new Tn(it),u,f);await ua(o,h),o.Bo=o.Bo.remove(d),o.Uo.delete(e),Ea(o)}else await Tr(o.localStore,e,!1).then(()=>ga(o,e,s)).catch(Bi)}async function fa(r,e){const s=q(r),o=e.batch.batchId;try{const a=await wr(s.localStore,e);ma(s,o,null),_a(s,o),s.sharedClientState.updateMutationState(o,"acknowledged"),await Ia(s,a)}catch(a){await Bi(a)}}async function da(r,e,s){const o=q(r);try{const a=await function(d,u){const f=q(d);return f.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let g;return f.An.lookupMutationBatch(h,u).next(b=>(B(b!==null),g=b.keys(),f.An.removeMutationBatch(h,b))).next(()=>f.An.performConsistencyCheck(h)).next(()=>f.Wn.vn(h,g))})}(o.localStore,e);ma(o,e,s),_a(o,e),o.sharedClientState.updateMutationState(e,"rejected",s),await Ia(o,a)}catch(a){await Bi(a)}}function _a(r,e){(r.jo.get(e)||[]).forEach(s=>{s.resolve()}),r.jo.delete(e)}function ma(r,e,s){const o=q(r);let a=o.Ko[o.currentUser.toKey()];if(a){const d=a.get(e);d&&(s?d.reject(s):d.resolve(),a=a.remove(e)),o.Ko[o.currentUser.toKey()]=a}}function ga(r,e,s=null){r.sharedClientState.removeLocalQueryTarget(e);for(const o of r.Mo.get(e))r.Oo.delete(o),s&&r.Fo.zo(o,s);r.Mo.delete(e),r.isPrimaryClient&&r.qo.us(e).forEach(o=>{r.qo.containsKey(o)||ya(r,o)})}function ya(r,e){r.Lo.delete(e.path.canonicalString());const s=r.Bo.get(e);s!==null&&(lo(r.remoteStore,s),r.Bo=r.Bo.remove(e),r.Uo.delete(s),Ea(r))}function pa(r,e,s){for(const o of s)o instanceof Zo?(r.qo.addReference(o.key,e),Ta(r,o)):o instanceof ta?($$1("SyncEngine","Document no longer in limbo: "+o.key),r.qo.removeReference(o.key,e),r.qo.containsKey(o.key)||ya(r,o.key)):L()}function Ta(r,e){const s=e.key,o=s.path.canonicalString();r.Bo.get(s)||r.Lo.has(o)||($$1("SyncEngine","New document in limbo: "+s),r.Lo.add(o),Ea(r))}function Ea(r){for(;r.Lo.size>0&&r.Bo.size<r.maxConcurrentLimboResolutions;){const e=r.Lo.values().next().value;r.Lo.delete(e);const s=new St(dt.fromString(e)),o=r.Qo.next();r.Uo.set(o,new sa(s)),r.Bo=r.Bo.insert(s,o),ho(r.remoteStore,new ai(Re(ge(s.path)),o,2,et.I))}}async function Ia(r,e,s){const o=q(r),a=[],d=[],u=[];o.Oo.isEmpty()||(o.Oo.forEach((f,h)=>{u.push(o.Go(h,e,s).then(g=>{if(g){o.isPrimaryClient&&o.sharedClientState.updateQueryState(h.targetId,g.fromCache?"not-current":"current"),a.push(g);const b=ur.$n(h.targetId,g);d.push(b)}}))}),await Promise.all(u),o.Fo.Pr(a),await async function(f,h){const g=q(f);try{await g.persistence.runTransaction("notifyLocalViewChanges","readwrite",b=>Gs.forEach(h,m=>Gs.forEach(m.kn,_=>g.persistence.referenceDelegate.addReference(b,m.targetId,_)).next(()=>Gs.forEach(m.xn,_=>g.persistence.referenceDelegate.removeReference(b,m.targetId,_)))))}catch(b){if(!Xs(b))throw b;$$1("LocalStore","Failed to update sequence numbers: "+b)}for(const b of h){const m=b.targetId;if(!b.fromCache){const _=g.qn.get(m),Ge=_.snapshotVersion,ot=_.withLastLimboFreeSnapshotVersion(Ge);g.qn=g.qn.insert(m,ot)}}}(o.localStore,d))}async function Aa(r,e){const s=q(r);if(!s.currentUser.isEqual(e)){$$1("SyncEngine","User change. New user:",e.toKey());const o=await dr(s.localStore,e);s.currentUser=e,function(a,d){a.jo.forEach(u=>{u.forEach(f=>{f.reject(new j(K.CANCELLED,d))})}),a.jo.clear()}(s,"'waitForPendingWrites' promise is rejected due to a user change."),s.sharedClientState.handleUserChange(e,o.removedBatchIds,o.addedBatchIds),await Ia(s,o.Gn)}}function Ra(r,e){const s=q(r),o=s.Uo.get(e);if(o&&o.$o)return Sn().add(o.key);{let a=Sn();const d=s.Mo.get(e);if(!d)return a;for(const u of d){const f=s.Oo.get(u);a=a.unionWith(f.view.Po)}return a}}function xa(r){const e=q(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=ua.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ra.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=la.bind(null,e),e.Fo.Pr=Qo.bind(null,e.eventManager),e.Fo.zo=Wo.bind(null,e.eventManager),e}function $a(r){const e=q(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=fa.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=da.bind(null,e),e}class Oa{constructor(){this.synchronizeTabs=!1}async initialize(e){this.k=to(e.databaseInfo.databaseId),this.sharedClientState=this.Jo(e),this.persistence=this.Yo(e),await this.persistence.start(),this.gcScheduler=this.Xo(e),this.localStore=this.Zo(e)}Xo(e){return null}Zo(e){return fr(this.persistence,new hr,e.initialUser,this.k)}Yo(e){return new xr(Fr.ks,this.k)}Jo(e){return new Wr}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Ba{async initialize(e,s){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(s),this.remoteStore=this.createRemoteStore(s),this.eventManager=this.createEventManager(s),this.syncEngine=this.createSyncEngine(s,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=o=>ha(this.syncEngine,o,1),this.remoteStore.remoteSyncer.handleCredentialChange=Aa.bind(null,this.syncEngine),await ko(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new qo}createDatastore(e){const s=to(e.databaseInfo.databaseId),o=(a=e.databaseInfo,new Yr(a));var a;return function(d,u,f,h){return new ro(d,u,f,h)}(e.authCredentials,e.appCheckCredentials,o,s)}createRemoteStore(e){return s=this.localStore,o=this.datastore,a=e.asyncQueue,d=f=>ha(this.syncEngine,f,0),u=zr.bt()?new zr:new Gr,new ao(s,o,a,d,u);var s,o,a,d,u}createSyncEngine(e,s){return function(o,a,d,u,f,h,g){const b=new ia(o,a,d,u,f,h);return g&&(b.Wo=!0),b}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,s)}terminate(){return async function(e){const s=q(e);$$1("RemoteStore","RemoteStore shutting down."),s.Gr.add(5),await uo(s),s.Hr.shutdown(),s.Jr.set("Unknown")}(this.remoteStore)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qa{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.ea(this.observer.next,e)}error(e){this.observer.error?this.ea(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}na(){this.muted=!0}ea(e,s){this.muted||setTimeout(()=>{this.muted||e(s)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wa{constructor(e,s,o,a){this.authCredentials=e,this.appCheckCredentials=s,this.asyncQueue=o,this.databaseInfo=a,this.user=D.UNAUTHENTICATED,this.clientId=st.A(),this.authCredentialListener=()=>Promise.resolve(),this.authCredentials.start(o,async d=>{$$1("FirestoreClient","Received user=",d.uid),await this.authCredentialListener(d),this.user=d}),this.appCheckCredentials.start(o,()=>Promise.resolve())}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new j(K.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Q;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(s){const o=Oo(s,"Failed to shutdown persistence");e.reject(o)}}),e.promise}}async function Ga(r,e){r.asyncQueue.verifyOperationInProgress(),$$1("FirestoreClient","Initializing OfflineComponentProvider");const s=await r.getConfiguration();await e.initialize(s);let o=s.initialUser;r.setCredentialChangeListener(async a=>{o.isEqual(a)||(await dr(e.localStore,a),o=a)}),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r.offlineComponents=e}async function za(r,e){r.asyncQueue.verifyOperationInProgress();const s=await Ha(r);$$1("FirestoreClient","Initializing OnlineComponentProvider");const o=await r.getConfiguration();await e.initialize(s,o),r.setCredentialChangeListener(a=>async function(d,u){const f=q(d);f.asyncQueue.verifyOperationInProgress(),$$1("RemoteStore","RemoteStore received new credentials");const h=go(f);f.Gr.add(3),await uo(f),h&&f.Jr.set("Unknown"),await f.remoteSyncer.handleCredentialChange(u),f.Gr.delete(3),await co(f)}(e.remoteStore,a)),r.onlineComponents=e}async function Ha(r){return r.offlineComponents||($$1("FirestoreClient","Using default OfflineComponentProvider"),await Ga(r,new Oa)),r.offlineComponents}async function Ja(r){return r.onlineComponents||($$1("FirestoreClient","Using default OnlineComponentProvider"),await za(r,new Ba)),r.onlineComponents}function tc(r){return Ja(r).then(e=>e.syncEngine)}async function ec(r){const e=await Ja(r),s=e.eventManager;return s.onListen=ra.bind(null,e.syncEngine),s.onUnlisten=aa.bind(null,e.syncEngine),s}function ac(r,e,s={}){const o=new Q;return r.asyncQueue.enqueueAndForget(async()=>function(a,d,u,f,h){const g=new qa({next:m=>{d.enqueueAndForget(()=>jo(a,b)),m.fromCache&&f.source==="server"?h.reject(new j(K.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(m)},error:m=>h.reject(m)}),b=new zo(u,g,{includeMetadataChanges:!0,wo:!0});return Ko(a,b)}(await ec(r),r.asyncQueue,e,s,o)),o.promise}class fc{constructor(e,s,o,a,d,u,f,h){this.databaseId=e,this.appId=s,this.persistenceKey=o,this.host=a,this.ssl=d,this.forceLongPolling=u,this.autoDetectLongPolling=f,this.useFetchStreams=h}}class dc{constructor(e,s){this.projectId=e,this.database=s||"(default)"}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof dc&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wc=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _c(r,e,s){if(!s)throw new j(K.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function mc(r,e,s,o){if(e===!0&&o===!0)throw new j(K.INVALID_ARGUMENT,`${r} and ${s} cannot be used together.`)}function gc(r){if(!St.isDocumentKey(r))throw new j(K.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function yc(r){if(St.isDocumentKey(r))throw new j(K.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function pc(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const e=function(s){return s.constructor?s.constructor.name:null}(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":L()}function Tc(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new j(K.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const s=pc(r);throw new j(K.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${s}`)}}return r}function Ec(r,e){if(e<=0)throw new j(K.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ic{constructor(e){var s;if(e.host===void 0){if(e.ssl!==void 0)throw new j(K.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(s=e.ssl)===null||s===void 0||s;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new j(K.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,mc("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ac{constructor(e,s,o){this._authCredentials=s,this._appCheckCredentials=o,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ic({}),this._settingsFrozen=!1,e instanceof dc?this._databaseId=e:(this._app=e,this._databaseId=function(a){if(!Object.prototype.hasOwnProperty.apply(a.options,["projectId"]))throw new j(K.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new dc(a.options.projectId)}(e))}get app(){if(!this._app)throw new j(K.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new j(K.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ic(e),e.credentials!==void 0&&(this._authCredentials=function(s){if(!s)return new G;switch(s.type){case"gapi":const o=s.client;return B(!(typeof o!="object"||o===null||!o.auth||!o.auth.getAuthHeaderValueForFirstParty)),new Y(o,s.sessionIndex||"0",s.iamToken||null);case"provider":return s.client;default:throw new j(K.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const s=wc.get(e);s&&($$1("ComponentProvider","Removing Datastore"),wc.delete(e),s.terminate())}(this),Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pc{constructor(e,s,o){this.converter=s,this._key=o,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new vc(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Pc(this.firestore,e,this._key)}}class bc{constructor(e,s,o){this.converter=s,this._query=o,this.type="query",this.firestore=e}withConverter(e){return new bc(this.firestore,e,this._query)}}class vc extends bc{constructor(e,s,o){super(e,s,ge(o)),this._path=o,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Pc(this.firestore,null,new St(e))}withConverter(e){return new vc(this.firestore,e,this._path)}}function Vc(r,e,...s){if(r=getModularInstance(r),_c("collection","path",e),r instanceof Ac){const o=dt.fromString(e,...s);return yc(o),new vc(r,null,o)}{if(!(r instanceof Pc||r instanceof vc))throw new j(K.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=r._path.child(dt.fromString(e,...s));return yc(o),new vc(r.firestore,null,o)}}function Dc(r,e,...s){if(r=getModularInstance(r),arguments.length===1&&(e=st.A()),_c("doc","path",e),r instanceof Ac){const o=dt.fromString(e,...s);return gc(o),new Pc(r,null,new St(o))}{if(!(r instanceof Pc||r instanceof vc))throw new j(K.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=r._path.child(dt.fromString(e,...s));return gc(o),new Pc(r.firestore,r instanceof vc?r.converter:null,new St(o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kc{constructor(){this.ma=Promise.resolve(),this.ga=[],this.ya=!1,this.pa=[],this.Ta=null,this.Ea=!1,this.Ia=!1,this.Aa=[],this.ur=new eo(this,"async_queue_retry"),this.Ra=()=>{const s=Zr();s&&$$1("AsyncQueue","Visibility state changed to "+s.visibilityState),this.ur.er()};const e=Zr();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Ra)}get isShuttingDown(){return this.ya}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pa(),this.ba(e)}enterRestrictedMode(e){if(!this.ya){this.ya=!0,this.Ia=e||!1;const s=Zr();s&&typeof s.removeEventListener=="function"&&s.removeEventListener("visibilitychange",this.Ra)}}enqueue(e){if(this.Pa(),this.ya)return new Promise(()=>{});const s=new Q;return this.ba(()=>this.ya&&this.Ia?Promise.resolve():(e().then(s.resolve,s.reject),s.promise)).then(()=>s.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.ga.push(e),this.va()))}async va(){if(this.ga.length!==0){try{await this.ga[0](),this.ga.shift(),this.ur.reset()}catch(e){if(!Xs(e))throw e;$$1("AsyncQueue","Operation failed with retryable error: "+e)}this.ga.length>0&&this.ur.Zi(()=>this.va())}}ba(e){const s=this.ma.then(()=>(this.Ea=!0,e().catch(o=>{this.Ta=o,this.Ea=!1;const a=function(d){let u=d.message||"";return d.stack&&(u=d.stack.includes(d.message)?d.stack:d.message+`
`+d.stack),u}(o);throw F("INTERNAL UNHANDLED ERROR: ",a),o}).then(o=>(this.Ea=!1,o))));return this.ma=s,s}enqueueAfterDelay(e,s,o){this.Pa(),this.Aa.indexOf(e)>-1&&(s=0);const a=Fo.createAndSchedule(this,e,s,o,d=>this.Va(d));return this.pa.push(a),a}Pa(){this.Ta&&L()}verifyOperationInProgress(){}async Sa(){let e;do e=this.ma,await e;while(e!==this.ma)}Da(e){for(const s of this.pa)if(s.timerId===e)return!0;return!1}Ca(e){return this.Sa().then(()=>{this.pa.sort((s,o)=>s.targetTimeMs-o.targetTimeMs);for(const s of this.pa)if(s.skipDelay(),e!=="all"&&s.timerId===e)break;return this.Sa()})}Na(e){this.Aa.push(e)}Va(e){const s=this.pa.indexOf(e);this.pa.splice(s,1)}}function xc(r){return function(e,s){if(typeof e!="object"||e===null)return!1;const o=e;for(const a of s)if(a in o&&typeof o[a]=="function")return!0;return!1}(r,["next","error","complete"])}class Oc extends Ac{constructor(e,s,o){super(e,s,o),this.type="firestore",this._queue=new kc,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||Uc(this),this._firestoreClient.terminate()}}function Lc(r=getApp()){return _getProvider(r,"firestore").getImmediate()}function Bc(r){return r._firestoreClient||Uc(r),r._firestoreClient.verifyNotTerminated(),r._firestoreClient}function Uc(r){var e;const s=r._freezeSettings(),o=function(a,d,u,f){return new fc(a,d,u,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,f.useFetchStreams)}(r._databaseId,((e=r._app)===null||e===void 0?void 0:e.options.appId)||"",r._persistenceKey,s);r._firestoreClient=new Wa(r._authCredentials,r._appCheckCredentials,r._queue,o)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zc{constructor(...e){for(let s=0;s<e.length;++s)if(e[s].length===0)throw new j(K.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new _t(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eu{constructor(e){this._byteString=e}static fromBase64String(e){try{return new eu(yt.fromBase64String(e))}catch(s){throw new j(K.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+s)}}static fromUint8Array(e){return new eu(yt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nu{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class su{constructor(e,s){if(!isFinite(e)||e<-90||e>90)throw new j(K.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(s)||s<-180||s>180)throw new j(K.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+s);this._lat=e,this._long=s}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return it(this._lat,e._lat)||it(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iu=/^__.*__$/;class ru{constructor(e,s,o){this.data=e,this.fieldMask=s,this.fieldTransforms=o}toMutation(e,s){return this.fieldMask!==null?new on(e,this.data,this.fieldMask,s,this.fieldTransforms):new rn(e,this.data,s,this.fieldTransforms)}}function au(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L()}}class cu{constructor(e,s,o,a,d,u){this.settings=e,this.databaseId=s,this.k=o,this.ignoreUndefinedProperties=a,d===void 0&&this.ka(),this.fieldTransforms=d||[],this.fieldMask=u||[]}get path(){return this.settings.path}get xa(){return this.settings.xa}$a(e){return new cu(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.k,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Fa(e){var s;const o=(s=this.path)===null||s===void 0?void 0:s.child(e),a=this.$a({path:o,Oa:!1});return a.Ma(e),a}La(e){var s;const o=(s=this.path)===null||s===void 0?void 0:s.child(e),a=this.$a({path:o,Oa:!1});return a.ka(),a}Ba(e){return this.$a({path:void 0,Oa:!0})}Ua(e){return Vu(e,this.settings.methodName,this.settings.qa||!1,this.path,this.settings.Ka)}contains(e){return this.fieldMask.find(s=>e.isPrefixOf(s))!==void 0||this.fieldTransforms.find(s=>e.isPrefixOf(s.field))!==void 0}ka(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ma(this.path.get(e))}Ma(e){if(e.length===0)throw this.Ua("Document fields must not be empty");if(au(this.xa)&&iu.test(e))throw this.Ua('Document fields cannot begin and end with "__"')}}class uu{constructor(e,s,o){this.databaseId=e,this.ignoreUndefinedProperties=s,this.k=o||to(e)}ja(e,s,o,a=!1){return new cu({xa:e,methodName:s,Ka:o,path:_t.emptyPath(),Oa:!1,qa:a},this.databaseId,this.k,this.ignoreUndefinedProperties)}}function hu(r){const e=r._freezeSettings(),s=to(r._databaseId);return new uu(r._databaseId,!!e.ignoreUndefinedProperties,s)}function lu(r,e,s,o,a,d={}){const u=r.ja(d.merge||d.mergeFields?2:0,e,s,a);Ru("Data must be an object, but it was:",u,o);const f=Iu(o,u);let h,g;if(d.merge)h=new mt(u.fieldMask),g=u.fieldTransforms;else if(d.mergeFields){const b=[];for(const m of d.mergeFields){const _=Pu(e,m,s);if(!u.contains(_))throw new j(K.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);Su(b,_)||b.push(_)}h=new mt(b),g=u.fieldTransforms.filter(m=>h.covers(m.field))}else h=null,g=u.fieldTransforms;return new ru(new jt(f),h,g)}function Tu(r,e,s,o=!1){return Eu(s,r.ja(o?4:3,e))}function Eu(r,e){if(Au(r=getModularInstance(r)))return Ru("Unsupported field value:",e,r),Iu(r,e);if(r instanceof nu)return function(s,o){if(!au(o.xa))throw o.Ua(`${s._methodName}() can only be used with update() and set()`);if(!o.path)throw o.Ua(`${s._methodName}() is not currently supported inside arrays`);const a=s._toFieldTransform(o);a&&o.fieldTransforms.push(a)}(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.Oa&&e.xa!==4)throw e.Ua("Nested arrays are not supported");return function(s,o){const a=[];let d=0;for(const u of s){let f=Eu(u,o.Ba(d));f==null&&(f={nullValue:"NULL_VALUE"}),a.push(f),d++}return{arrayValue:{values:a}}}(r,e)}return function(s,o){if((s=getModularInstance(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return xe(o.k,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const a=at.fromDate(s);return{timestampValue:jn(o.k,a)}}if(s instanceof at){const a=new at(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:jn(o.k,a)}}if(s instanceof su)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof eu)return{bytesValue:Qn(o.k,s._byteString)};if(s instanceof Pc){const a=o.databaseId,d=s.firestore._databaseId;if(!d.isEqual(a))throw o.Ua(`Document reference is for database ${d.projectId}/${d.database} but should be for database ${a.projectId}/${a.database}`);return{referenceValue:zn(s.firestore._databaseId||o.databaseId,s._key.path)}}throw o.Ua(`Unsupported field value: ${pc(s)}`)}(r,e)}function Iu(r,e){const s={};return lt(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ht(r,(o,a)=>{const d=Eu(a,e.Fa(o));d!=null&&(s[o]=d)}),{mapValue:{fields:s}}}function Au(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof at||r instanceof su||r instanceof eu||r instanceof Pc||r instanceof nu)}function Ru(r,e,s){if(!Au(s)||!function(o){return typeof o=="object"&&o!==null&&(Object.getPrototypeOf(o)===Object.prototype||Object.getPrototypeOf(o)===null)}(s)){const o=pc(s);throw o==="an object"?e.Ua(r+" a custom object"):e.Ua(r+" "+o)}}function Pu(r,e,s){if((e=getModularInstance(e))instanceof Zc)return e._internalPath;if(typeof e=="string")return vu(r,e);throw Vu("Field path arguments must be of type string or FieldPath.",r,!1,void 0,s)}const bu=new RegExp("[~\\*/\\[\\]]");function vu(r,e,s){if(e.search(bu)>=0)throw Vu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,s);try{return new Zc(...e.split("."))._internalPath}catch{throw Vu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,s)}}function Vu(r,e,s,o,a){const d=o&&!o.isEmpty(),u=a!==void 0;let f=`Function ${e}() called with invalid data`;s&&(f+=" (via `toFirestore()`)"),f+=". ";let h="";return(d||u)&&(h+=" (found",d&&(h+=` in field ${o}`),u&&(h+=` in document ${a}`),h+=")"),new j(K.INVALID_ARGUMENT,f+r+h)}function Su(r,e){return r.some(s=>s.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Du{constructor(e,s,o,a,d){this._firestore=e,this._userDataWriter=s,this._key=o,this._document=a,this._converter=d}get id(){return this._key.path.lastSegment()}get ref(){return new Pc(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Cu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const s=this._document.data.field(Nu("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s)}}}class Cu extends Du{data(){return super.data()}}function Nu(r,e){return typeof e=="string"?vu(r,e):e instanceof Zc?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ku{constructor(e,s){this.hasPendingWrites=e,this.fromCache=s}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class xu extends Du{constructor(e,s,o,a,d,u){super(e,s,o,a,u),this._firestore=e,this._firestoreImpl=e,this.metadata=d}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const s=new $u(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(s,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,s={}){if(this._document){const o=this._document.data.field(Nu("DocumentSnapshot.get",e));if(o!==null)return this._userDataWriter.convertValue(o,s.serverTimestamps)}}}class $u extends xu{data(e={}){return super.data(e)}}class Fu{constructor(e,s,o,a){this._firestore=e,this._userDataWriter=s,this._snapshot=a,this.metadata=new ku(a.hasPendingWrites,a.fromCache),this.query=o}get docs(){const e=[];return this.forEach(s=>e.push(s)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,s){this._snapshot.docs.forEach(o=>{e.call(s,new $u(this._firestore,this._userDataWriter,o.key,o,new ku(this._snapshot.mutatedKeys.has(o.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const s=!!e.includeMetadataChanges;if(s&&this._snapshot.excludesMetadataChanges)throw new j(K.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===s||(this._cachedChanges=function(o,a){if(o._snapshot.oldDocs.isEmpty()){let d=0;return o._snapshot.docChanges.map(u=>({type:"added",doc:new $u(o._firestore,o._userDataWriter,u.doc.key,u.doc,new ku(o._snapshot.mutatedKeys.has(u.doc.key),o._snapshot.fromCache),o.query.converter),oldIndex:-1,newIndex:d++}))}{let d=o._snapshot.oldDocs;return o._snapshot.docChanges.filter(u=>a||u.type!==3).map(u=>{const f=new $u(o._firestore,o._userDataWriter,u.doc.key,u.doc,new ku(o._snapshot.mutatedKeys.has(u.doc.key),o._snapshot.fromCache),o.query.converter);let h=-1,g=-1;return u.type!==0&&(h=d.indexOf(u.doc.key),d=d.delete(u.doc.key)),u.type!==1&&(d=d.add(u.doc),g=d.indexOf(u.doc.key)),{type:Ou(u.type),doc:f,oldIndex:h,newIndex:g}})}}(this,s),this._cachedChangesIncludeMetadataChanges=s),this._cachedChanges}}function Ou(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lu(r){if(pe(r)&&r.explicitOrderBy.length===0)throw new j(K.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Bu{}function Uu(r,...e){for(const s of e)r=s._apply(r);return r}class qu extends Bu{constructor(e,s,o){super(),this.Ga=e,this.za=s,this.Ha=o,this.type="where"}_apply(e){const s=hu(e.firestore),o=function(a,d,u,f,h,g,b){let m;if(h.isKeyField()){if(g==="array-contains"||g==="array-contains-any")throw new j(K.INVALID_ARGUMENT,`Invalid Query. You can't perform '${g}' queries on FieldPath.documentId().`);if(g==="in"||g==="not-in"){sh(b,g);const Ge=[];for(const ot of b)Ge.push(nh(f,a,ot));m={arrayValue:{values:Ge}}}else m=nh(f,a,b)}else g!=="in"&&g!=="not-in"&&g!=="array-contains-any"||sh(b,g),m=Tu(u,d,b,g==="in"||g==="not-in");const _=Zt.create(h,g,m);return function(Ge,ot){if(ot.V()){const ir=Ee(Ge);if(ir!==null&&!ir.isEqual(ot.field))throw new j(K.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${ir.toString()}' and '${ot.field.toString()}'`);const er=Te(Ge);er!==null&&ih(Ge,ot.field,er)}const rr=function(ir,er){for(const ar of ir.filters)if(er.indexOf(ar.op)>=0)return ar.op;return null}(Ge,function(ir){switch(ir){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(ot.op));if(rr!==null)throw rr===ot.op?new j(K.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${ot.op.toString()}' filter.`):new j(K.INVALID_ARGUMENT,`Invalid query. You cannot use '${ot.op.toString()}' filters with '${rr.toString()}' filters.`)}(a,_),_}(e._query,"where",s,e.firestore._databaseId,this.Ga,this.za,this.Ha);return new bc(e.firestore,e.converter,function(a,d){const u=a.filters.concat([d]);return new _e(a.path,a.collectionGroup,a.explicitOrderBy.slice(),u,a.limit,a.limitType,a.startAt,a.endAt)}(e._query,o))}}function Ku(r,e,s){const o=e,a=Nu("where",r);return new qu(a,o,s)}class ju extends Bu{constructor(e,s){super(),this.Ga=e,this.Ja=s,this.type="orderBy"}_apply(e){const s=function(o,a,d){if(o.startAt!==null)throw new j(K.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(o.endAt!==null)throw new j(K.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const u=new le(a,d);return function(f,h){if(Te(f)===null){const g=Ee(f);g!==null&&ih(f,g,h.field)}}(o,u),u}(e._query,this.Ga,this.Ja);return new bc(e.firestore,e.converter,function(o,a){const d=o.explicitOrderBy.concat([a]);return new _e(o.path,o.collectionGroup,d,o.filters.slice(),o.limit,o.limitType,o.startAt,o.endAt)}(e._query,s))}}function Qu(r,e="asc"){const s=e,o=Nu("orderBy",r);return new ju(o,s)}class Wu extends Bu{constructor(e,s,o){super(),this.type=e,this.Ya=s,this.Xa=o}_apply(e){return new bc(e.firestore,e.converter,Pe(e._query,this.Ya,this.Xa))}}function Gu(r){return Ec("limit",r),new Wu("limit",r,"F")}function nh(r,e,s){if(typeof(s=getModularInstance(s))=="string"){if(s==="")throw new j(K.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ie(e)&&s.indexOf("/")!==-1)throw new j(K.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${s}' contains a '/' character.`);const o=e.path.child(dt.fromString(s));if(!St.isDocumentKey(o))throw new j(K.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${o}' is not because it has an odd number of segments (${o.length}).`);return Ot(r,new St(o))}if(s instanceof Pc)return Ot(r,s._key);throw new j(K.INVALID_ARGUMENT,`Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ${pc(s)}.`)}function sh(r,e){if(!Array.isArray(r)||r.length===0)throw new j(K.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(r.length>10)throw new j(K.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function ih(r,e,s){if(!s.isEqual(e))throw new j(K.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${s.toString()}' instead.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rh{convertValue(e,s="none"){switch(Dt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Et(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,s);case 5:return e.stringValue;case 6:return this.convertBytes(It(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,s);case 10:return this.convertObject(e.mapValue,s);default:throw L()}}convertObject(e,s){const o={};return ht(e.fields,(a,d)=>{o[a]=this.convertValue(d,s)}),o}convertGeoPoint(e){return new su(Et(e.latitude),Et(e.longitude))}convertArray(e,s){return(e.values||[]).map(o=>this.convertValue(o,s))}convertServerTimestamp(e,s){switch(s){case"previous":const o=Rt(e);return o==null?null:this.convertValue(o,s);case"estimate":return this.convertTimestamp(Pt(e));default:return null}}convertTimestamp(e){const s=Tt(e);return new at(s.seconds,s.nanos)}convertDocumentKey(e,s){const o=dt.fromString(e);B(As(o));const a=new dc(o.get(1),o.get(3)),d=new St(o.popFirst(5));return a.isEqual(s)||F(`Document ${d} contains a document reference within a different database (${a.projectId}/${a.database}) which is not supported. It will be treated as a reference in the current database (${s.projectId}/${s.database}) instead.`),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oh(r,e,s){let o;return o=r?s&&(s.merge||s.mergeFields)?r.toFirestore(e,s):r.toFirestore(e):e,o}class lh extends rh{constructor(e){super(),this.firestore=e}convertBytes(e){return new eu(e)}convertReference(e){const s=this.convertDocumentKey(e,this.firestore._databaseId);return new Pc(this.firestore,null,s)}}function wh(r){r=Tc(r,bc);const e=Tc(r.firestore,Oc),s=Bc(e),o=new lh(e);return Lu(r._query),ac(s,r._query).then(a=>new Fu(e,o,r,a))}function gh(r,e,s){r=Tc(r,Pc);const o=Tc(r.firestore,Oc),a=oh(r.converter,e,s);return Ah(o,[lu(hu(o),"setDoc",r._key,a,r.converter!==null,s).toMutation(r._key,Je.none())])}function ph(r){return Ah(Tc(r.firestore,Oc),[new hn(r._key,Je.none())])}function Th(r,e){const s=Tc(r.firestore,Oc),o=Dc(r),a=oh(r.converter,e);return Ah(s,[lu(hu(r.firestore),"addDoc",o._key,a,r.converter!==null,{}).toMutation(o._key,Je.exists(!1))]).then(()=>o)}function Eh(r,...e){var s,o,a;r=getModularInstance(r);let d={includeMetadataChanges:!1},u=0;typeof e[u]!="object"||xc(e[u])||(d=e[u],u++);const f={includeMetadataChanges:d.includeMetadataChanges};if(xc(e[u])){const m=e[u];e[u]=(s=m.next)===null||s===void 0?void 0:s.bind(m),e[u+1]=(o=m.error)===null||o===void 0?void 0:o.bind(m),e[u+2]=(a=m.complete)===null||a===void 0?void 0:a.bind(m)}let h,g,b;if(r instanceof Pc)g=Tc(r.firestore,Oc),b=ge(r._key.path),h={next:m=>{e[u]&&e[u](Rh(g,r,m))},error:e[u+1],complete:e[u+2]};else{const m=Tc(r,bc);g=Tc(m.firestore,Oc),b=m._query;const _=new lh(g);h={next:Ge=>{e[u]&&e[u](new Fu(g,_,m,Ge))},error:e[u+1],complete:e[u+2]},Lu(r._query)}return function(m,_,Ge,ot){const rr=new qa(ot),ir=new zo(_,rr,Ge);return m.asyncQueue.enqueueAndForget(async()=>Ko(await ec(m),ir)),()=>{rr.na(),m.asyncQueue.enqueueAndForget(async()=>jo(await ec(m),ir))}}(Bc(g),b,f,h)}function Ah(r,e){return function(s,o){const a=new Q;return s.asyncQueue.enqueueAndForget(async()=>ca(await tc(s),o,a)),a.promise}(Bc(r),e)}function Rh(r,e,s){const o=s.docs.get(e._key),a=new lh(r);return new xu(r,a,e._key,o,new ku(s.hasPendingWrites,s.fromCache),e.converter)}(function(r,e=!0){(function(s){C=s})(SDK_VERSION),_registerComponent(new Component("firestore",(s,{options:o})=>{const a=s.getProvider("app").getImmediate(),d=new Oc(a,new H(s.getProvider("auth-internal")),new Z(s.getProvider("app-check-internal")));return o=Object.assign({useFetchStreams:e},o),d._setSettings(o),d},"PUBLIC")),registerVersion(S,"3.4.1",r),registerVersion(S,"3.4.1","esm2017")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_HOST="firebasestorage.googleapis.com",CONFIG_STORAGE_BUCKET_KEY="storageBucket",DEFAULT_MAX_OPERATION_RETRY_TIME=2*60*1e3,DEFAULT_MAX_UPLOAD_RETRY_TIME=10*60*1e3;class StorageError extends FirebaseError{constructor(e,s){super(prependCode(e),`Firebase Storage: ${s} (${prependCode(e)})`);this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,StorageError.prototype)}_codeEquals(e){return prependCode(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}function prependCode(r){return"storage/"+r}function unknown(){const r="An unknown error occurred, please check the error payload for server response.";return new StorageError("unknown",r)}function objectNotFound(r){return new StorageError("object-not-found","Object '"+r+"' does not exist.")}function quotaExceeded(r){return new StorageError("quota-exceeded","Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function unauthenticated(){const r="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new StorageError("unauthenticated",r)}function unauthorizedApp(){return new StorageError("unauthorized-app","This app does not have permission to access Firebase Storage on this project.")}function unauthorized(r){return new StorageError("unauthorized","User does not have permission to access '"+r+"'.")}function retryLimitExceeded(){return new StorageError("retry-limit-exceeded","Max retry time for operation exceeded, please try again.")}function canceled(){return new StorageError("canceled","User canceled the upload/download.")}function invalidUrl(r){return new StorageError("invalid-url","Invalid URL '"+r+"'.")}function invalidDefaultBucket(r){return new StorageError("invalid-default-bucket","Invalid default bucket '"+r+"'.")}function noDefaultBucket(){return new StorageError("no-default-bucket","No default bucket found. Did you set the '"+CONFIG_STORAGE_BUCKET_KEY+"' property when initializing the app?")}function cannotSliceBlob(){return new StorageError("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function serverFileWrongSize(){return new StorageError("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.")}function noDownloadURL(){return new StorageError("no-download-url","The given file does not have any download URLs.")}function invalidArgument(r){return new StorageError("invalid-argument",r)}function appDeleted(){return new StorageError("app-deleted","The Firebase app was deleted.")}function invalidRootOperation(r){return new StorageError("invalid-root-operation","The operation '"+r+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function invalidFormat(r,e){return new StorageError("invalid-format","String does not match format '"+r+"': "+e)}function internalError(r){throw new StorageError("internal-error","Internal error: "+r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Location{constructor(e,s){this.bucket=e,this.path_=s}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,s){let o;try{o=Location.makeFromUrl(e,s)}catch{return new Location(e,"")}if(o.path==="")return o;throw invalidDefaultBucket(e)}static makeFromUrl(e,s){let o=null;const a="([A-Za-z0-9.\\-_]+)";function d(Mr){Mr.path.charAt(Mr.path.length-1)==="/"&&(Mr.path_=Mr.path_.slice(0,-1))}const u="(/(.*))?$",f=new RegExp("^gs://"+a+u,"i"),h={bucket:1,path:3};function g(Mr){Mr.path_=decodeURIComponent(Mr.path)}const b="v[A-Za-z0-9_]+",m=s.replace(/[.]/g,"\\."),_="(/([^?#]*).*)?$",Ge=new RegExp(`^https?://${m}/${b}/b/${a}/o${_}`,"i"),ot={bucket:1,path:3},rr=s===DEFAULT_HOST?"(?:storage.googleapis.com|storage.cloud.google.com)":s,ir="([^?#]*)",er=new RegExp(`^https?://${rr}/${a}/${ir}`,"i"),Lr=[{regex:f,indices:h,postModify:d},{regex:Ge,indices:ot,postModify:g},{regex:er,indices:{bucket:1,path:2},postModify:g}];for(let Mr=0;Mr<Lr.length;Mr++){const Br=Lr[Mr],Qr=Br.regex.exec(e);if(Qr){const ii=Qr[Br.indices.bucket];let Ir=Qr[Br.indices.path];Ir||(Ir=""),o=new Location(ii,Ir),Br.postModify(o);break}}if(o==null)throw invalidUrl(e);return o}}class FailRequest{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function start(r,e,s){let o=1,a=null,d=null,u=!1,f=0;function h(){return f===2}let g=!1;function b(...ir){g||(g=!0,e.apply(null,ir))}function m(ir){a=setTimeout(()=>{a=null,r(Ge,h())},ir)}function _(){d&&clearTimeout(d)}function Ge(ir,...er){if(g){_();return}if(ir){_(),b.call(null,ir,...er);return}if(h()||u){_(),b.call(null,ir,...er);return}o<64&&(o*=2);let Lr;f===1?(f=2,Lr=0):Lr=(o+Math.random())*1e3,m(Lr)}let ot=!1;function rr(ir){ot||(ot=!0,_(),!g&&(a!==null?(ir||(f=2),clearTimeout(a),m(0)):ir||(f=1)))}return m(0),d=setTimeout(()=>{u=!0,rr(!0)},s),rr}function stop(r){r(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function isJustDef(r){return r!==void 0}function isFunction(r){return typeof r=="function"}function isNonArrayObject(r){return typeof r=="object"&&!Array.isArray(r)}function isString(r){return typeof r=="string"||r instanceof String}function isNativeBlob(r){return isNativeBlobDefined()&&r instanceof Blob}function isNativeBlobDefined(){return typeof Blob!="undefined"}function validateNumber(r,e,s,o){if(o<e)throw invalidArgument(`Invalid value for '${r}'. Expected ${e} or greater.`);if(o>s)throw invalidArgument(`Invalid value for '${r}'. Expected ${s} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function makeUrl(r,e,s){let o=e;return s==null&&(o=`https://${e}`),`${s}://${o}/v0${r}`}function makeQueryString(r){const e=encodeURIComponent;let s="?";for(const o in r)if(r.hasOwnProperty(o)){const a=e(o)+"="+e(r[o]);s=s+a+"&"}return s=s.slice(0,-1),s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ErrorCode;(function(r){r[r.NO_ERROR=0]="NO_ERROR",r[r.NETWORK_ERROR=1]="NETWORK_ERROR",r[r.ABORT=2]="ABORT"})(ErrorCode||(ErrorCode={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NetworkRequest{constructor(e,s,o,a,d,u,f,h,g,b,m){this.url_=e,this.method_=s,this.headers_=o,this.body_=a,this.successCodes_=d,this.additionalRetryCodes_=u,this.callback_=f,this.errorCallback_=h,this.timeout_=g,this.progressCallback_=b,this.connectionFactory_=m,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((_,Ge)=>{this.resolve_=_,this.reject_=Ge,this.start_()})}start_(){const e=(o,a)=>{if(a){o(!1,new RequestEndStatus(!1,null,!0));return}const d=this.connectionFactory_();this.pendingConnection_=d;const u=f=>{const h=f.loaded,g=f.lengthComputable?f.total:-1;this.progressCallback_!==null&&this.progressCallback_(h,g)};this.progressCallback_!==null&&d.addUploadProgressListener(u),d.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&d.removeUploadProgressListener(u),this.pendingConnection_=null;const f=d.getErrorCode()===ErrorCode.NO_ERROR,h=d.getStatus();if(!f||this.isRetryStatusCode_(h)){const b=d.getErrorCode()===ErrorCode.ABORT;o(!1,new RequestEndStatus(!1,null,b));return}const g=this.successCodes_.indexOf(h)!==-1;o(!0,new RequestEndStatus(g,d))})},s=(o,a)=>{const d=this.resolve_,u=this.reject_,f=a.connection;if(a.wasSuccessCode)try{const h=this.callback_(f,f.getResponse());isJustDef(h)?d(h):d()}catch(h){u(h)}else if(f!==null){const h=unknown();h.serverResponse=f.getErrorText(),this.errorCallback_?u(this.errorCallback_(f,h)):u(h)}else if(a.canceled){const h=this.appDelete_?appDeleted():canceled();u(h)}else{const h=retryLimitExceeded();u(h)}};this.canceled_?s(!1,new RequestEndStatus(!1,null,!0)):this.backoffId_=start(e,s,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&stop(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}isRetryStatusCode_(e){const s=e>=500&&e<600,a=[408,429].indexOf(e)!==-1,d=this.additionalRetryCodes_.indexOf(e)!==-1;return s||a||d}}class RequestEndStatus{constructor(e,s,o){this.wasSuccessCode=e,this.connection=s,this.canceled=!!o}}function addAuthHeader_(r,e){e!==null&&e.length>0&&(r.Authorization="Firebase "+e)}function addVersionHeader_(r,e){r["X-Firebase-Storage-Version"]="webjs/"+(e!=null?e:"AppManager")}function addGmpidHeader_(r,e){e&&(r["X-Firebase-GMPID"]=e)}function addAppCheckHeader_(r,e){e!==null&&(r["X-Firebase-AppCheck"]=e)}function makeRequest(r,e,s,o,a,d){const u=makeQueryString(r.urlParams),f=r.url+u,h=Object.assign({},r.headers);return addGmpidHeader_(h,e),addAuthHeader_(h,s),addVersionHeader_(h,d),addAppCheckHeader_(h,o),new NetworkRequest(f,r.method,h,r.body,r.successCodes,r.additionalRetryCodes,r.handler,r.errorHandler,r.timeout,r.progressCallback,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getBlobBuilder(){return typeof BlobBuilder!="undefined"?BlobBuilder:typeof WebKitBlobBuilder!="undefined"?WebKitBlobBuilder:void 0}function getBlob$1(...r){const e=getBlobBuilder();if(e!==void 0){const s=new e;for(let o=0;o<r.length;o++)s.append(r[o]);return s.getBlob()}else{if(isNativeBlobDefined())return new Blob(r);throw new StorageError("unsupported-environment","This browser doesn't seem to support creating Blobs")}}function sliceBlob(r,e,s){return r.webkitSlice?r.webkitSlice(e,s):r.mozSlice?r.mozSlice(e,s):r.slice?r.slice(e,s):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function decodeBase64(r){return atob(r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const StringFormat={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class StringData{constructor(e,s){this.data=e,this.contentType=s||null}}function dataFromString(r,e){switch(r){case StringFormat.RAW:return new StringData(utf8Bytes_(e));case StringFormat.BASE64:case StringFormat.BASE64URL:return new StringData(base64Bytes_(r,e));case StringFormat.DATA_URL:return new StringData(dataURLBytes_(e),dataURLContentType_(e))}throw unknown()}function utf8Bytes_(r){const e=[];for(let s=0;s<r.length;s++){let o=r.charCodeAt(s);if(o<=127)e.push(o);else if(o<=2047)e.push(192|o>>6,128|o&63);else if((o&64512)==55296)if(!(s<r.length-1&&(r.charCodeAt(s+1)&64512)==56320))e.push(239,191,189);else{const d=o,u=r.charCodeAt(++s);o=65536|(d&1023)<<10|u&1023,e.push(240|o>>18,128|o>>12&63,128|o>>6&63,128|o&63)}else(o&64512)==56320?e.push(239,191,189):e.push(224|o>>12,128|o>>6&63,128|o&63)}return new Uint8Array(e)}function percentEncodedBytes_(r){let e;try{e=decodeURIComponent(r)}catch{throw invalidFormat(StringFormat.DATA_URL,"Malformed data URL.")}return utf8Bytes_(e)}function base64Bytes_(r,e){switch(r){case StringFormat.BASE64:{const a=e.indexOf("-")!==-1,d=e.indexOf("_")!==-1;if(a||d)throw invalidFormat(r,"Invalid character '"+(a?"-":"_")+"' found: is it base64url encoded?");break}case StringFormat.BASE64URL:{const a=e.indexOf("+")!==-1,d=e.indexOf("/")!==-1;if(a||d)throw invalidFormat(r,"Invalid character '"+(a?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let s;try{s=decodeBase64(e)}catch{throw invalidFormat(r,"Invalid character found")}const o=new Uint8Array(s.length);for(let a=0;a<s.length;a++)o[a]=s.charCodeAt(a);return o}class DataURLParts{constructor(e){this.base64=!1,this.contentType=null;const s=e.match(/^data:([^,]+)?,/);if(s===null)throw invalidFormat(StringFormat.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const o=s[1]||null;o!=null&&(this.base64=endsWith(o,";base64"),this.contentType=this.base64?o.substring(0,o.length-";base64".length):o),this.rest=e.substring(e.indexOf(",")+1)}}function dataURLBytes_(r){const e=new DataURLParts(r);return e.base64?base64Bytes_(StringFormat.BASE64,e.rest):percentEncodedBytes_(e.rest)}function dataURLContentType_(r){return new DataURLParts(r).contentType}function endsWith(r,e){return r.length>=e.length?r.substring(r.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FbsBlob{constructor(e,s){let o=0,a="";isNativeBlob(e)?(this.data_=e,o=e.size,a=e.type):e instanceof ArrayBuffer?(s?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),o=this.data_.length):e instanceof Uint8Array&&(s?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),o=e.length),this.size_=o,this.type_=a}size(){return this.size_}type(){return this.type_}slice(e,s){if(isNativeBlob(this.data_)){const o=this.data_,a=sliceBlob(o,e,s);return a===null?null:new FbsBlob(a)}else{const o=new Uint8Array(this.data_.buffer,e,s-e);return new FbsBlob(o,!0)}}static getBlob(...e){if(isNativeBlobDefined()){const s=e.map(o=>o instanceof FbsBlob?o.data_:o);return new FbsBlob(getBlob$1.apply(null,s))}else{const s=e.map(u=>isString(u)?dataFromString(StringFormat.RAW,u).data:u.data_);let o=0;s.forEach(u=>{o+=u.byteLength});const a=new Uint8Array(o);let d=0;return s.forEach(u=>{for(let f=0;f<u.length;f++)a[d++]=u[f]}),new FbsBlob(a,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jsonObjectOrNull(r){let e;try{e=JSON.parse(r)}catch{return null}return isNonArrayObject(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function parent(r){if(r.length===0)return null;const e=r.lastIndexOf("/");return e===-1?"":r.slice(0,e)}function child(r,e){const s=e.split("/").filter(o=>o.length>0).join("/");return r.length===0?s:r+"/"+s}function lastComponent(r){const e=r.lastIndexOf("/",r.length-2);return e===-1?r:r.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function noXform_(r,e){return e}class Mapping{constructor(e,s,o,a){this.server=e,this.local=s||e,this.writable=!!o,this.xform=a||noXform_}}let mappings_=null;function xformPath(r){return!isString(r)||r.length<2?r:lastComponent(r)}function getMappings(){if(mappings_)return mappings_;const r=[];r.push(new Mapping("bucket")),r.push(new Mapping("generation")),r.push(new Mapping("metageneration")),r.push(new Mapping("name","fullPath",!0));function e(d,u){return xformPath(u)}const s=new Mapping("name");s.xform=e,r.push(s);function o(d,u){return u!==void 0?Number(u):u}const a=new Mapping("size");return a.xform=o,r.push(a),r.push(new Mapping("timeCreated")),r.push(new Mapping("updated")),r.push(new Mapping("md5Hash",null,!0)),r.push(new Mapping("cacheControl",null,!0)),r.push(new Mapping("contentDisposition",null,!0)),r.push(new Mapping("contentEncoding",null,!0)),r.push(new Mapping("contentLanguage",null,!0)),r.push(new Mapping("contentType",null,!0)),r.push(new Mapping("metadata","customMetadata",!0)),mappings_=r,mappings_}function addRef(r,e){function s(){const o=r.bucket,a=r.fullPath,d=new Location(o,a);return e._makeStorageReference(d)}Object.defineProperty(r,"ref",{get:s})}function fromResource(r,e,s){const o={};o.type="file";const a=s.length;for(let d=0;d<a;d++){const u=s[d];o[u.local]=u.xform(o,e[u.server])}return addRef(o,r),o}function fromResourceString(r,e,s){const o=jsonObjectOrNull(e);return o===null?null:fromResource(r,o,s)}function downloadUrlFromResourceString(r,e,s,o){const a=jsonObjectOrNull(e);if(a===null||!isString(a.downloadTokens))return null;const d=a.downloadTokens;if(d.length===0)return null;const u=encodeURIComponent;return d.split(",").map(g=>{const b=r.bucket,m=r.fullPath,_="/b/"+u(b)+"/o/"+u(m),Ge=makeUrl(_,s,o),ot=makeQueryString({alt:"media",token:g});return Ge+ot})[0]}function toResourceString(r,e){const s={},o=e.length;for(let a=0;a<o;a++){const d=e[a];d.writable&&(s[d.server]=r[d.local])}return JSON.stringify(s)}class RequestInfo{constructor(e,s,o,a){this.url=e,this.method=s,this.handler=o,this.timeout=a,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function handlerCheck(r){if(!r)throw unknown()}function metadataHandler(r,e){function s(o,a){const d=fromResourceString(r,a,e);return handlerCheck(d!==null),d}return s}function downloadUrlHandler(r,e){function s(o,a){const d=fromResourceString(r,a,e);return handlerCheck(d!==null),downloadUrlFromResourceString(d,a,r.host,r._protocol)}return s}function sharedErrorHandler(r){function e(s,o){let a;return s.getStatus()===401?s.getErrorText().includes("Firebase App Check token is invalid")?a=unauthorizedApp():a=unauthenticated():s.getStatus()===402?a=quotaExceeded(r.bucket):s.getStatus()===403?a=unauthorized(r.path):a=o,a.serverResponse=o.serverResponse,a}return e}function objectErrorHandler(r){const e=sharedErrorHandler(r);function s(o,a){let d=e(o,a);return o.getStatus()===404&&(d=objectNotFound(r.path)),d.serverResponse=a.serverResponse,d}return s}function getMetadata$2(r,e,s){const o=e.fullServerUrl(),a=makeUrl(o,r.host,r._protocol),d="GET",u=r.maxOperationRetryTime,f=new RequestInfo(a,d,metadataHandler(r,s),u);return f.errorHandler=objectErrorHandler(e),f}function getDownloadUrl(r,e,s){const o=e.fullServerUrl(),a=makeUrl(o,r.host,r._protocol),d="GET",u=r.maxOperationRetryTime,f=new RequestInfo(a,d,downloadUrlHandler(r,s),u);return f.errorHandler=objectErrorHandler(e),f}function deleteObject$2(r,e){const s=e.fullServerUrl(),o=makeUrl(s,r.host,r._protocol),a="DELETE",d=r.maxOperationRetryTime;function u(h,g){}const f=new RequestInfo(o,a,u,d);return f.successCodes=[200,204],f.errorHandler=objectErrorHandler(e),f}function determineContentType_(r,e){return r&&r.contentType||e&&e.type()||"application/octet-stream"}function metadataForUpload_(r,e,s){const o=Object.assign({},s);return o.fullPath=r.path,o.size=e.size(),o.contentType||(o.contentType=determineContentType_(null,e)),o}function multipartUpload(r,e,s,o,a){const d=e.bucketOnlyServerUrl(),u={"X-Goog-Upload-Protocol":"multipart"};function f(){let Lr="";for(let Mr=0;Mr<2;Mr++)Lr=Lr+Math.random().toString().slice(2);return Lr}const h=f();u["Content-Type"]="multipart/related; boundary="+h;const g=metadataForUpload_(e,o,a),b=toResourceString(g,s),m="--"+h+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+b+`\r
--`+h+`\r
Content-Type: `+g.contentType+`\r
\r
`,_=`\r
--`+h+"--",Ge=FbsBlob.getBlob(m,o,_);if(Ge===null)throw cannotSliceBlob();const ot={name:g.fullPath},rr=makeUrl(d,r.host,r._protocol),ir="POST",er=r.maxUploadRetryTime,ar=new RequestInfo(rr,ir,metadataHandler(r,s),er);return ar.urlParams=ot,ar.headers=u,ar.body=Ge.uploadData(),ar.errorHandler=sharedErrorHandler(e),ar}class ResumableUploadStatus{constructor(e,s,o,a){this.current=e,this.total=s,this.finalized=!!o,this.metadata=a||null}}function checkResumeHeader_(r,e){let s=null;try{s=r.getResponseHeader("X-Goog-Upload-Status")}catch{handlerCheck(!1)}return handlerCheck(!!s&&(e||["active"]).indexOf(s)!==-1),s}function createResumableUpload(r,e,s,o,a){const d=e.bucketOnlyServerUrl(),u=metadataForUpload_(e,o,a),f={name:u.fullPath},h=makeUrl(d,r.host,r._protocol),g="POST",b={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${o.size()}`,"X-Goog-Upload-Header-Content-Type":u.contentType,"Content-Type":"application/json; charset=utf-8"},m=toResourceString(u,s),_=r.maxUploadRetryTime;function Ge(rr){checkResumeHeader_(rr);let ir;try{ir=rr.getResponseHeader("X-Goog-Upload-URL")}catch{handlerCheck(!1)}return handlerCheck(isString(ir)),ir}const ot=new RequestInfo(h,g,Ge,_);return ot.urlParams=f,ot.headers=b,ot.body=m,ot.errorHandler=sharedErrorHandler(e),ot}function getResumableUploadStatus(r,e,s,o){const a={"X-Goog-Upload-Command":"query"};function d(g){const b=checkResumeHeader_(g,["active","final"]);let m=null;try{m=g.getResponseHeader("X-Goog-Upload-Size-Received")}catch{handlerCheck(!1)}m||handlerCheck(!1);const _=Number(m);return handlerCheck(!isNaN(_)),new ResumableUploadStatus(_,o.size(),b==="final")}const u="POST",f=r.maxUploadRetryTime,h=new RequestInfo(s,u,d,f);return h.headers=a,h.errorHandler=sharedErrorHandler(e),h}const RESUMABLE_UPLOAD_CHUNK_SIZE=256*1024;function continueResumableUpload(r,e,s,o,a,d,u,f){const h=new ResumableUploadStatus(0,0);if(u?(h.current=u.current,h.total=u.total):(h.current=0,h.total=o.size()),o.size()!==h.total)throw serverFileWrongSize();const g=h.total-h.current;let b=g;a>0&&(b=Math.min(b,a));const m=h.current,_=m+b,ot={"X-Goog-Upload-Command":b===g?"upload, finalize":"upload","X-Goog-Upload-Offset":`${h.current}`},rr=o.slice(m,_);if(rr===null)throw cannotSliceBlob();function ir(Mr,Br){const Qr=checkResumeHeader_(Mr,["active","final"]),ii=h.current+b,Ir=o.size();let gt;return Qr==="final"?gt=metadataHandler(e,d)(Mr,Br):gt=null,new ResumableUploadStatus(ii,Ir,Qr==="final",gt)}const er="POST",ar=e.maxUploadRetryTime,Lr=new RequestInfo(s,er,ir,ar);return Lr.headers=ot,Lr.body=rr.uploadData(),Lr.progressCallback=f||null,Lr.errorHandler=sharedErrorHandler(r),Lr}const TaskState={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function taskStateFromInternalTaskState(r){switch(r){case"running":case"pausing":case"canceling":return TaskState.RUNNING;case"paused":return TaskState.PAUSED;case"success":return TaskState.SUCCESS;case"canceled":return TaskState.CANCELED;case"error":return TaskState.ERROR;default:return TaskState.ERROR}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Observer{constructor(e,s,o){if(isFunction(e)||s!=null||o!=null)this.next=e,this.error=s!=null?s:void 0,this.complete=o!=null?o:void 0;else{const d=e;this.next=d.next,this.error=d.error,this.complete=d.complete}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function async(r){return(...e)=>{Promise.resolve().then(()=>r(...e))}}class XhrConnection{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=ErrorCode.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=ErrorCode.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=ErrorCode.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,s,o,a){if(this.sent_)throw internalError("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(s,e,!0),a!==void 0)for(const d in a)a.hasOwnProperty(d)&&this.xhr_.setRequestHeader(d,a[d].toString());return o!==void 0?this.xhr_.send(o):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw internalError("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw internalError("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw internalError("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw internalError("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class XhrTextConnection extends XhrConnection{initXhr(){this.xhr_.responseType="text"}}function newTextConnection(){return new XhrTextConnection}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UploadTask{constructor(e,s,o=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=s,this._metadata=o,this._mappings=getMappings(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=a=>{this._request=void 0,this._chunkMultiplier=1,a._codeEquals("canceled")?(this._needToFetchStatus=!0,this.completeTransitions_()):(this._error=a,this._transition("error"))},this._metadataErrorHandler=a=>{this._request=void 0,a._codeEquals("canceled")?this.completeTransitions_():(this._error=a,this._transition("error"))},this._promise=new Promise((a,d)=>{this._resolve=a,this._reject=d,this._start()}),this._promise.then(null,()=>{})}_makeProgressCallback(){const e=this._transferred;return s=>this._updateProgress(e+s)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([s,o])=>{switch(this._state){case"running":e(s,o);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,s)=>{const o=createResumableUpload(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),a=this._ref.storage._makeRequest(o,newTextConnection,e,s);this._request=a,a.getPromise().then(d=>{this._request=void 0,this._uploadUrl=d,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((s,o)=>{const a=getResumableUploadStatus(this._ref.storage,this._ref._location,e,this._blob),d=this._ref.storage._makeRequest(a,newTextConnection,s,o);this._request=d,d.getPromise().then(u=>{u=u,this._request=void 0,this._updateProgress(u.current),this._needToFetchStatus=!1,u.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=RESUMABLE_UPLOAD_CHUNK_SIZE*this._chunkMultiplier,s=new ResumableUploadStatus(this._transferred,this._blob.size()),o=this._uploadUrl;this._resolveToken((a,d)=>{let u;try{u=continueResumableUpload(this._ref._location,this._ref.storage,o,this._blob,e,this._mappings,s,this._makeProgressCallback())}catch(h){this._error=h,this._transition("error");return}const f=this._ref.storage._makeRequest(u,newTextConnection,a,d);this._request=f,f.getPromise().then(h=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(h.current),h.finalized?(this._metadata=h.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){RESUMABLE_UPLOAD_CHUNK_SIZE*this._chunkMultiplier<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,s)=>{const o=getMetadata$2(this._ref.storage,this._ref._location,this._mappings),a=this._ref.storage._makeRequest(o,newTextConnection,e,s);this._request=a,a.getPromise().then(d=>{this._request=void 0,this._metadata=d,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,s)=>{const o=multipartUpload(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),a=this._ref.storage._makeRequest(o,newTextConnection,e,s);this._request=a,a.getPromise().then(d=>{this._request=void 0,this._metadata=d,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const s=this._transferred;this._transferred=e,this._transferred!==s&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":this._state=e,this._request!==void 0&&this._request.cancel();break;case"pausing":this._state=e,this._request!==void 0&&this._request.cancel();break;case"running":const s=this._state==="paused";this._state=e,s&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=canceled(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const e=taskStateFromInternalTaskState(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,s,o,a){const d=new Observer(s||void 0,o||void 0,a||void 0);return this._addObserver(d),()=>{this._removeObserver(d)}}then(e,s){return this._promise.then(e,s)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const s=this._observers.indexOf(e);s!==-1&&this._observers.splice(s,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(s=>{this._notifyObserver(s)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch(taskStateFromInternalTaskState(this._state)){case TaskState.SUCCESS:async(this._resolve.bind(null,this.snapshot))();break;case TaskState.CANCELED:case TaskState.ERROR:const s=this._reject;async(s.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(taskStateFromInternalTaskState(this._state)){case TaskState.RUNNING:case TaskState.PAUSED:e.next&&async(e.next.bind(e,this.snapshot))();break;case TaskState.SUCCESS:e.complete&&async(e.complete.bind(e))();break;case TaskState.CANCELED:case TaskState.ERROR:e.error&&async(e.error.bind(e,this._error))();break;default:e.error&&async(e.error.bind(e,this._error))()}}resume(){const e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){const e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){const e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Reference{constructor(e,s){this._service=e,s instanceof Location?this._location=s:this._location=Location.makeFromUrl(s,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,s){return new Reference(e,s)}get root(){const e=new Location(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return lastComponent(this._location.path)}get storage(){return this._service}get parent(){const e=parent(this._location.path);if(e===null)return null;const s=new Location(this._location.bucket,e);return new Reference(this._service,s)}_throwIfRoot(e){if(this._location.path==="")throw invalidRootOperation(e)}}function uploadBytesResumable$1(r,e,s){return r._throwIfRoot("uploadBytesResumable"),new UploadTask(r,new FbsBlob(e),s)}function getDownloadURL$1(r){r._throwIfRoot("getDownloadURL");const e=getDownloadUrl(r.storage,r._location,getMappings());return r.storage.makeRequestWithTokens(e,newTextConnection).then(s=>{if(s===null)throw noDownloadURL();return s})}function deleteObject$1(r){r._throwIfRoot("deleteObject");const e=deleteObject$2(r.storage,r._location);return r.storage.makeRequestWithTokens(e,newTextConnection)}function _getChild$1(r,e){const s=child(r._location.path,e),o=new Location(r._location.bucket,s);return new Reference(r.storage,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function isUrl(r){return/^[A-Za-z]+:\/\//.test(r)}function refFromURL(r,e){return new Reference(r,e)}function refFromPath(r,e){if(r instanceof FirebaseStorageImpl){const s=r;if(s._bucket==null)throw noDefaultBucket();const o=new Reference(s,s._bucket);return e!=null?refFromPath(o,e):o}else return e!==void 0?_getChild$1(r,e):r}function ref$1(r,e){if(e&&isUrl(e)){if(r instanceof FirebaseStorageImpl)return refFromURL(r,e);throw invalidArgument("To use ref(service, url), the first argument must be a Storage instance.")}else return refFromPath(r,e)}function extractBucket(r,e){const s=e==null?void 0:e[CONFIG_STORAGE_BUCKET_KEY];return s==null?null:Location.makeFromBucketSpec(s,r)}class FirebaseStorageImpl{constructor(e,s,o,a,d){this.app=e,this._authProvider=s,this._appCheckProvider=o,this._url=a,this._firebaseVersion=d,this._bucket=null,this._host=DEFAULT_HOST,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=DEFAULT_MAX_OPERATION_RETRY_TIME,this._maxUploadRetryTime=DEFAULT_MAX_UPLOAD_RETRY_TIME,this._requests=new Set,a!=null?this._bucket=Location.makeFromBucketSpec(a,this._host):this._bucket=extractBucket(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Location.makeFromBucketSpec(this._url,e):this._bucket=extractBucket(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){validateNumber("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){validateNumber("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const s=await e.getToken();if(s!==null)return s.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Reference(this,e)}_makeRequest(e,s,o,a){if(this._deleted)return new FailRequest(appDeleted());{const d=makeRequest(e,this._appId,o,a,s,this._firebaseVersion);return this._requests.add(d),d.getPromise().then(()=>this._requests.delete(d),()=>this._requests.delete(d)),d}}async makeRequestWithTokens(e,s){const[o,a]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,s,o,a).getPromise()}}const name="@firebase/storage",version="0.9.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const STORAGE_TYPE="storage";function uploadBytesResumable(r,e,s){return r=getModularInstance(r),uploadBytesResumable$1(r,e,s)}function getDownloadURL(r){return r=getModularInstance(r),getDownloadURL$1(r)}function deleteObject(r){return r=getModularInstance(r),deleteObject$1(r)}function ref(r,e){return r=getModularInstance(r),ref$1(r,e)}function getStorage(r=getApp(),e){return r=getModularInstance(r),_getProvider(r,STORAGE_TYPE).getImmediate({identifier:e})}function factory(r,{instanceIdentifier:e}){const s=r.getProvider("app").getImmediate(),o=r.getProvider("auth-internal"),a=r.getProvider("app-check-internal");return new FirebaseStorageImpl(s,o,a,e,SDK_VERSION)}function registerStorage(){_registerComponent(new Component(STORAGE_TYPE,factory,"PUBLIC").setMultipleInstances(!0)),registerVersion(name,version,""),registerVersion(name,version,"esm2017")}registerStorage();export{toggle_class as $,getStorage as A,getAuth as B,signInWithEmailAndPassword as C,gh as D,Eh as E,Dc as F,uploadBytesResumable as G,ref as H,getDownloadURL as I,ph as J,deleteObject as K,Lc as L,createUserWithEmailAndPassword as M,check_outros as N,group_outros as O,destroy_each as P,Qu as Q,Gu as R,SvelteComponent as S,Th as T,Uu as U,Vc as V,Ku as W,select_value as X,add_render_callback as Y,select_option as Z,wh as _,attr as a,onAuthStateChanged as a0,signOut as a1,insert as b,append as c,set_data as d,element as e,detach as f,create_component as g,space as h,init as i,transition_in as j,transition_out as k,destroy_component as l,mount_component as m,noop$1 as n,listen as o,createEventDispatcher as p,set_style as q,run_all as r,safe_not_equal as s,text as t,src_url_equal as u,set_input_value as v,writable as w,empty as x,jspreadsheet as y,initializeApp as z};
